var console=console||function(){};
function HandleErrors(b){function f(n){return navigator.userAgent.match(n)}function c(n){var o=navigator.userAgent.match(/[Cc]hrome\/([0-9]{1,2})/);if(o){o=parseInt(o[1]);return o<=n}else return!1}var d=this,g=b||"/alternate",h=!1;Trailer="<ul id = 'trailer'><li class = 'first'><a href = 'http://youtu.be/VUQSoHFMD8c'>Watch the Trailer</a></li><li><a href = 'http://romealbum.com/'>Rome Album</a></li><li class = 'last'><a href = '/tech'>The Technology</a></li><li class = 'clear'></li></ul>";this.MagicVariable=
"case";this.Errors=["We are very sorry, but &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears that your computer&#39;s graphics card doesn&#39;t support WebGL technology. You can find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards."+Trailer,"Apologies for the tech trouble. &#147;3 Dreams of Black&#148; is an experiment and unfortunately does not currently function on every configuration. It appears your computer&#39;s graphics card doesn&#39;t support WebGL in Mozilla Firefox. We recommend you try it in <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>Google Chrome</a>. You can also find more details for troubleshooting <a href = 'http://get.webgl.org/troubleshooting/'>here</a> and obtain a list of recommended graphics cards."+
Trailer,"We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again. If you are unable to install a new web browser, you can try downloading the <a href = 'http://www.google.com/chromeframe'>Google Chrome Frame plugin</a> instead.","We are sorry, but it appears that your browser does not support WebGL. Please <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and try launching this site again.",
"We are sorry, but it appears that your browser does not support WebGL. &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>Google Chrome</a> in mind. Please try launching this site again on a computer with up-to-date graphics drivers. Though not the full experience, you can also watch a video trailer, access the rest of the ROME album site, and learn more about WebGL technology."+
Trailer,"This project is very experimental. With your current configuration, you may experience problems such as video flickering, so you may want to try this in Chrome Canary, the cutting-edge experimental version of Google Chrome. Download Google Chrome Canary <a href = 'http://tools.google.com/dlpage/chromesxs?platform=win'>here</a>, or <a id = 'escape-from-warning' href = '#'>try the experience anyway</a>.","We&#39;re sorry, but &#147;3 Dreams of Black&#148; is an experiment that was designed with the browser Google Chrome in mind. As a result, it may not work perfectly in your current browser. For the best viewing experience, you can <a href = 'http://www.google.com/chrome?brand=CHKX&utm_campaign=en&utm_source=en-rome-webgl&utm_medium=rome-webgl'>download Google Chrome</a> and launch this site again, or go ahead and <a id = 'escape-from-warning' href = '#'>try it anyway</a>.",
"You appear to be running an older version of Chrome. Please click on the wrench icon on the browser toolbar, and select 'Update Google Chrome' before viewing ROME.","We are sorry, but it appears that your browser does not support WebGL. This could be due to a number of different reasons. For more information visit this <a href = 'http://get.webgl.org/troubleshooting/'>page</a>.","We are sorry, but it appears that your browser will not support &#147;3 Dreams of Black&#148;. This could be due to a number of different reasons. For more information visit this <a href = 'http://get.webgl.org/troubleshooting/'>page</a>"];
this.getUrlVars=function(){for(var n=null,o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),m=0;m<o.length;m++){var p=o[m].split("=");if(p.length==2){var u=p[0];p=p[1];if(u&&p){n==null&&(n={});n[u]=p}}}return n};this.checkForErrors=function(){var n;try{n=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(o){n=!1}n={webgl:n,conditions:[f(/[cC]hrome/),f(/[Ff]ire[Ff]ox\/[4-9]/),f(/[Mm][Ss][Ii][Ee] [789]/)&&f(/[Ww]indows [Nn][Tt] [6789]/)&&
!f(/[Cc]hrome[Ff]rame/),f(/[Ss]afari/)&&f(/[Mm]ac [Oo][Ss] [Xx] 10\_[6789]/),f(/i[Pp]hone/)||f(/i[Pp]ad/)||f(/[Aa]ndroid/)],message:""};if(n.webgl){if(f(/CrOS/))window.location=g+"?"+this.MagicVariable+"="+m;if(n.conditions[1]){window.addEventListener("load",function(){var p=document.getElementById("ui-container");if(p)p.style.display="none";var u=document.createElement("div"),v=document.createElement("div");p=document.createElement("div");p.setAttribute("id","rome-error");var w=document.createElement("style");
w.innerHTML="a { color: #fff; }";document.getElementsByTagName("head")[0].appendChild(w);u.setAttribute("style","width: 100%; height: 100%; position: fixed; margin: 0; padding: 0; top: 0; left: 0;");v.setAttribute("style","position: fixed; width: 400px; margin: 0 auto; top: "+(window.innerHeight-200)/2+"px; left: "+(window.innerWidth-400)/2+"px;");p.setAttribute("style","width: 330px; padding: 50px 35px; background: rgba(0, 0, 0, 0.3); color: #fff; color: #fff; line-height: 18px !important; font: 500 12px/18px 'Futura', Arial, sans-serif; letter-spacing: 1px; text-align: center;");
p.innerHTML=d.Errors[6];var x=function(){v.style.left=(window.innerWidth-400)/2+"px";v.style.top=window.innerHeight/2+"px"},y=function(){document.body.removeChild(u);document.body.removeChild(v);window.removeEventListener("resize",x,!1);LauncherSection.showUI();localStorage.setItem("RomeError",!0)};u.addEventListener("click",function(){y()},!1);window.addEventListener("resize",x,!1);v.appendChild(p);document.body.appendChild(u);document.body.appendChild(v);document.getElementById("escape-from-warning").addEventListener("click",
function(A){A.preventDefault();y()},!1)},!1);HandleErrors.isWebGLAndBeta=!0}else if(f(/[Ww]indows/)&&c(11)&&c(10))window.location=g+"?"+this.MagicVariable+"=7"}else{for(var m=0;m<n.conditions.length;m++)if(n.conditions[m]){window.location=g+"?"+this.MagicVariable+"="+m;h=!0;break}if(!h)window.location=g+"?"+this.MagicVariable+"=8"}}}HandleErrors.isWebGLAndBeta=!1;var romeErrors=new HandleErrors,variables=romeErrors.getUrlVars();
if(variables)variables[romeErrors.MagicVariable]&&(window.addEventListener?window.addEventListener("load",function(){var b=variables[romeErrors.MagicVariable],f=document.getElementById("error");b>romeErrors.Errors.length&&(b=8);f.innerHTML='<p style="line-height: 18px !important;">'+romeErrors.Errors[b]+"</p>"},!1):window.attachEvent("load",function(){var b=variables[romeErrors.MagicVariable],f=document.getElementById("error");b>romeErrors.Errors.length&&(b=8);f.innerHTML='<p style="line-height: 18px !important;">'+
romeErrors.Errors[b]+"</p>";return!1}));else romeErrors.checkForErrors();
var Logger=function(){this.domElement=document.createElement("div");this.domElement.style.fontFamily="Helvetica, Arial, sans-serif";this.domElement.style.textAlign="left";this.domElement.style.fontSize="9px";this.domElement.style.padding="2px 0px 3px 0px";this.log=function(b){this.domElement.appendChild(document.createTextNode(b));this.domElement.appendChild(document.createElement("br"))};this.clear=function(){for(;this.domElement.childNodes.length>0;)this.domElement.removeChild(this.domElement.childNodes[0])}},
Stats=function(){function b(O,R,ca){var U,ea,la;for(ea=0;ea<30;ea++)for(U=0;U<73;U++){la=(U+ea*74)*4;O[la]=O[la+4];O[la+1]=O[la+5];O[la+2]=O[la+6]}for(ea=0;ea<30;ea++){la=(73+ea*74)*4;if(ea<R){O[la]=I[ca].bg.r;O[la+1]=I[ca].bg.g;O[la+2]=I[ca].bg.b}else{O[la]=I[ca].fg.r;O[la+1]=I[ca].fg.g;O[la+2]=I[ca].fg.b}}}var f=0,c=2,d,g=0,h=(new Date).getTime(),n=h,o=h,m=0,p=1E3,u=0,v,w,x,y,A,B=0,C=1E3,E=0,z,H,G,F,T=0,$=1E3,W=0,V,S,t,M,I={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},
fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};d=document.createElement("div");d.style.cursor="pointer";d.style.width="80px";d.style.opacity="0.9";d.style.zIndex="10001";d.addEventListener("click",function(){f++;f==c&&(f=0);v.style.display="none";z.style.display="none";V.style.display="none";switch(f){case 0:v.style.display="block";break;case 1:z.style.display="block";break;case 2:V.style.display="block"}},!1);v=document.createElement("div");v.style.backgroundColor="rgb("+Math.floor(I.fps.bg.r/
2)+","+Math.floor(I.fps.bg.g/2)+","+Math.floor(I.fps.bg.b/2)+")";v.style.padding="2px 0px 3px 0px";d.appendChild(v);w=document.createElement("div");w.style.fontFamily="Helvetica, Arial, sans-serif";w.style.textAlign="left";w.style.fontSize="9px";w.style.color="rgb("+I.fps.fg.r+","+I.fps.fg.g+","+I.fps.fg.b+")";w.style.margin="0px 0px 1px 3px";w.innerHTML='<span style="font-weight:bold">FPS</span>';v.appendChild(w);x=document.createElement("canvas");x.width=74;x.height=30;x.style.display="block";x.style.marginLeft=
"3px";v.appendChild(x);y=x.getContext("2d");y.fillStyle="rgb("+I.fps.bg.r+","+I.fps.bg.g+","+I.fps.bg.b+")";y.fillRect(0,0,x.width,x.height);A=y.getImageData(0,0,x.width,x.height);z=document.createElement("div");z.style.backgroundColor="rgb("+Math.floor(I.ms.bg.r/2)+","+Math.floor(I.ms.bg.g/2)+","+Math.floor(I.ms.bg.b/2)+")";z.style.padding="2px 0px 3px 0px";z.style.display="none";d.appendChild(z);H=document.createElement("div");H.style.fontFamily="Helvetica, Arial, sans-serif";H.style.textAlign=
"left";H.style.fontSize="9px";H.style.color="rgb("+I.ms.fg.r+","+I.ms.fg.g+","+I.ms.fg.b+")";H.style.margin="0px 0px 1px 3px";H.innerHTML='<span style="font-weight:bold">MS</span>';z.appendChild(H);x=document.createElement("canvas");x.width=74;x.height=30;x.style.display="block";x.style.marginLeft="3px";z.appendChild(x);G=x.getContext("2d");G.fillStyle="rgb("+I.ms.bg.r+","+I.ms.bg.g+","+I.ms.bg.b+")";G.fillRect(0,0,x.width,x.height);F=G.getImageData(0,0,x.width,x.height);try{webkitPerformance&&webkitPerformance.memory.totalJSHeapSize&&
(c=3)}catch(P){}V=document.createElement("div");V.style.backgroundColor="rgb("+Math.floor(I.mem.bg.r/2)+","+Math.floor(I.mem.bg.g/2)+","+Math.floor(I.mem.bg.b/2)+")";V.style.padding="2px 0px 3px 0px";V.style.display="none";d.appendChild(V);S=document.createElement("div");S.style.fontFamily="Helvetica, Arial, sans-serif";S.style.textAlign="left";S.style.fontSize="9px";S.style.color="rgb("+I.mem.fg.r+","+I.mem.fg.g+","+I.mem.fg.b+")";S.style.margin="0px 0px 1px 3px";S.innerHTML='<span style="font-weight:bold">MEM</span>';
V.appendChild(S);x=document.createElement("canvas");x.width=74;x.height=30;x.style.display="block";x.style.marginLeft="3px";V.appendChild(x);t=x.getContext("2d");t.fillStyle="#301010";t.fillRect(0,0,x.width,x.height);M=t.getImageData(0,0,x.width,x.height);return{domElement:d,update:function(){g++;h=(new Date).getTime();B=h-n;C=Math.min(C,B);E=Math.max(E,B);b(F.data,Math.min(30,30-B/200*30),"ms");H.innerHTML='<span style="font-weight:bold">'+B+" MS</span> ("+C+"-"+E+")";G.putImageData(F,0,0);n=h;if(h>
o+1E3){m=Math.round(g*1E3/(h-o));p=Math.min(p,m);u=Math.max(u,m);b(A.data,Math.min(30,30-m/100*30),"fps");w.innerHTML='<span style="font-weight:bold">'+m+" FPS</span> ("+p+"-"+u+")";y.putImageData(A,0,0);if(c==3){T=webkitPerformance.memory.usedJSHeapSize*9.54E-7;$=Math.min($,T);W=Math.max(W,T);b(M.data,Math.min(30,30-T/2),"mem");S.innerHTML='<span style="font-weight:bold">'+Math.round(T)+" MEM</span> ("+Math.round($)+"-"+Math.round(W)+")";t.putImageData(M,0,0)}o=h;g=0}}}},GUI=function(){var b=this,
f=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.innerHTML="#guidat{position:fixed;top:0;right:0;width:auto;z-index:1001;text-align:right}.guidat{color:#fff;opacity:0.97;text-align:left;float:right;margin-right:20px;margin-bottom:20px;background-color:#fff}.guidat,.guidat input{font:9.5px Lucida Grande,sans-serif}.guidat-controllers{height:300px;overflow-y:auto;overflow-x:hidden;background-color:rgba(0,0,0,0.1)}a.guidat-toggle{text-decoration:none;cursor:pointer;color:#fff;background-color:#222;text-align:center;display:block;padding:5px}a.guidat-toggle:hover{background-color:#000}.guidat-controller{padding:3px;height:25px;clear:left;border-bottom:1px solid #222;background-color:#111}.guidat-controller,.guidat-controller input,.guidat-slider-bg,.guidat-slider-fg{-moz-transition:background-color 0.15s linear;-webkit-transition:background-color 0.15s linear;transition:background-color 0.15s linear}.guidat-controller.boolean:hover,.guidat-controller.function:hover{background-color:#000}.guidat-controller input{float:right;outline:none;border:0;padding:4px;margin-top:2px;background-color:#222}.guidat-controller input:hover{background-color:#444}.guidat-controller input:focus{background-color:#555}.guidat-controller.number{border-left:5px solid #00aeff}.guidat-controller.string{border-left:5px solid #1ed36f}.guidat-controller.string input{border:0;color:#1ed36f;margin-right:2px;width:148px}.guidat-controller.boolean{border-left:5px solid #54396e}.guidat-controller.function{border-left:5px solid #e61d5f}.guidat-controller.number input[type=text]{width:35px;margin-left:5px;margin-right:2px;color:#00aeff}.guidat .guidat-controller.boolean input{margin-top:6px;margin-right:2px;font-size:20px}.guidat-controller:last-child{border-bottom:none;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.5);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.5);box-shadow:0px 1px 3px rgba(0,0,0,0.5)}.guidat-propertyname{padding:5px;padding-top:7px;cursor:default;display:inline-block}.guidat-slider-bg:hover,.guidat-slider-bg.active{background-color:#444}.guidat-slider-bg:hover .guidat-slider-fg,.guidat-slider-bg.active .guidat-slider-fg{background-color:#52c8ff}.guidat-slider-bg{background-color:#222;cursor:ew-resize;width:40%;margin-top:2px;float:right;height:21px}.guidat-slider-fg{background-color:#00aeff;height:20px}";
f.appendChild(c);var d=[],g=[],h=!0,n,o,m=0;b=this;var p=!1,u=280,v=!1,w,x,y=0,A;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat");this.domElement.style.width=u+"px";var B=document.createElement("div");B.setAttribute("class","guidat-controllers");B.addEventListener("DOMMouseScroll",function(R){var ca=this.scrollTop;if(R.wheelDelta)ca+=R.wheelDelta;else R.detail&&(ca+=R.detail);R.preventDefault&&R.preventDefault();R.returnValue=!1;B.scrollTop=ca},!1);B.style.height=
"0px";var C=document.createElement("a");C.setAttribute("class","guidat-toggle");C.setAttribute("href","#");C.innerHTML="Show Controls";var E=!1,z=0,H=!1,G,F,T,$,W=function(R){F=G;$=T;G=R.pageY;T=R.pageX;R=G-F;if(!p)if(R>0){p=!0;m=w=1;C.innerHTML=x||"Hide Controls"}else return;var ca=$-T;if(R>0&&m>o){var U=GUI.map(m,o,o+100,1,0);R*=U}E=!0;z+=R;dragDisplacementX+=ca;w+=R;u+=ca;m+=R;B.style.height=w+"px";u=GUI.constrain(u,240,500);b.domElement.style.width=u+"px";M()};C.addEventListener("mousedown",function(R){F=
G=R.pageY;$=T=R.pageX;H=!0;R.preventDefault();dragDisplacementX=z=0;document.addEventListener("mousemove",W,!1);return!1},!1);C.addEventListener("click",function(R){R.preventDefault();return!1},!1);document.addEventListener("mouseup",function(R){if(H&&!E){b.toggle();b.domElement.style.width=u+1+"px";setTimeout(function(){b.domElement.style.width=u+"px"},1)}if(H&&E){if(dragDisplacementX==0){b.domElement.style.width=u+1+"px";setTimeout(function(){b.domElement.style.width=u+"px"},1)}if(w>o){clearTimeout(A);
w=y=o;P()}else if(B.children.length>=1){var ca=B.children[0].offsetHeight;clearTimeout(A);y=Math.round(m/ca)*ca-1;if(y<=0){b.hide();w=ca*2}else{w=y;P()}}}document.removeEventListener("mousemove",W,!1);R.preventDefault();E=!1;H=!1;return!1},!1);this.domElement.appendChild(B);this.domElement.appendChild(C);if(GUI.autoPlace){if(GUI.autoPlaceContainer==null){GUI.autoPlaceContainer=document.createElement("div");GUI.autoPlaceContainer.setAttribute("id","guidat");document.body.appendChild(GUI.autoPlaceContainer)}GUI.autoPlaceContainer.appendChild(this.domElement)}this.autoListenIntervalTime=
1E3/60;var V=function(){n=setInterval(function(){b.listen()},this.autoListenIntervalTime)};this.__defineSetter__("autoListen",function(R){if(h=R)g.length>0&&V();else clearInterval(n)});this.__defineGetter__("autoListen",function(){return h});this.listenTo=function(R){g.length==0&&V();g.push(R)};this.unlistenTo=function(R){for(var ca=0;ca<g.length;ca++)g[ca]==R&&g.splice(ca,1);g.length<=0&&clearInterval(n)};this.listen=function(R){R=R||g;for(var ca in R)R[ca].updateDisplay()};this.listenAll=function(){this.listen(d)};
this.autoListen=!0;var S=function(R,ca){for(var U in d)if(d[U].object==R&&d[U].propertyName==ca)return!0;return!1},t=function(R,ca){function U(){return R.apply(this,ca)}U.prototype=R.prototype;return new U};this.add=function(){var R=arguments[0],ca=arguments[1];S(R,ca);var U=R[ca];if(U==undefined)GUI.error(R+' either has no property "'+ca+'", or the property is inaccessible.');else{R=typeof U;U=I[R];if(U==undefined)GUI.error('Cannot create controller for data type "'+R+'"');else{for(var ea=[this],
la=0;la<arguments.length;la++)ea.push(arguments[la]);if(U=t(U,ea)){B.appendChild(U.domElement);d.push(U);GUI.allControllers.push(U);if(R!="function"&&GUI.saveIndex<GUI.savedValues.length){U.setValue(GUI.savedValues[GUI.saveIndex]);GUI.saveIndex++}M();v||(w=o);return U}else GUI.error('Error creating controller for "'+ca+'".')}}};var M=function(){o=0;for(var R in d)o+=d[R].domElement.offsetHeight;B.style.overflowY=o-1>w?"auto":"hidden"},I={number:GUI.NumberController,string:GUI.StringController,"boolean":GUI.BooleanController,
"function":GUI.FunctionController};S=function(R,ca){for(var U in d)if(d[U].object==R&&d[U].propertyName==ca)return!0;return!1};t=function(R,ca){function U(){return R.apply(this,ca)}U.prototype=R.prototype;return new U};this.reset=function(){};this.toggle=function(){p?this.hide():this.show()};this.show=function(){C.innerHTML=x||"Hide Controls";y=w;clearTimeout(A);P();p=!0};this.hide=function(){C.innerHTML=x||"Show Controls";y=0;clearTimeout(A);P();p=!1};this.name=function(R){x=R;C.innerHTML=R};this.appearanceVars=
function(){return[p,u,w,B.scrollTop]};var P=function(){m+=(y-m)*0.6;if(Math.abs(m-y)<1)m=y;else A=setTimeout(P,1E3/30);B.style.height=Math.round(m)+"px";M()};if(GUI.guiIndex<GUI.savedAppearanceVars.length){u=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][1]);b.domElement.style.width=u+"px";w=parseInt(GUI.savedAppearanceVars[GUI.guiIndex][2]);v=!0;if(eval(GUI.savedAppearanceVars[GUI.guiIndex][0])==!0){m=w;var O=GUI.savedAppearanceVars[GUI.guiIndex][3];setTimeout(function(){B.scrollTop=O},0);if(GUI.scrollTop>
-1)document.body.scrollTop=GUI.scrollTop;y=w;this.show()}GUI.guiIndex++}GUI.allGuis.push(this)};GUI.autoPlace=!0;GUI.autoPlaceContainer=null;GUI.allControllers=[];GUI.allGuis=[];GUI.saveURL=function(){title=window.location;url=GUI.replaceGetVar("saveString",GUI.getSaveString());window.location=url};GUI.scrollTop=-1;
GUI.load=function(b){b=b.split(",");var f=parseInt(b[0]);GUI.scrollTop=parseInt(b[1]);for(var c=0;c<f;c++){var d=b.splice(2,4);GUI.savedAppearanceVars.push(d)}GUI.savedValues=b.splice(2,b.length)};GUI.savedValues=[];GUI.savedAppearanceVars=[];
GUI.getSaveString=function(){var b=[];b.push(GUI.allGuis.length);b.push(document.body.scrollTop);for(var f in GUI.allGuis)for(var c=GUI.allGuis[f].appearanceVars(),d=0;d<c.length;d++)b.push(c[d]);for(f in GUI.allControllers)if(GUI.allControllers[f].type!="function"){c=GUI.allControllers[f].getValue();GUI.allControllers[f].type=="number"&&(c=GUI.roundToDecimal(c,4));b.push(c)}return b.join(",")};
GUI.getVarFromURL=function(b){for(var f,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){f=c[d].split("=");if(f!=undefined&&f[0]==b)return f[1]}return null};
GUI.replaceGetVar=function(b,f){for(var c,d=window.location.href,g=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),h=0;h<g.length;h++){c=g[h].split("=");if(c!=undefined&&c[0]==b)return d.replace(c[1],f)}if(window.location.href.indexOf("?")!=-1)return d+"&"+b+"="+f;return d+"?"+b+"="+f};GUI.saveIndex=0;GUI.guiIndex=0;GUI.showSaveString=function(){alert(GUI.getSaveString())};
GUI.makeUnselectable=function(b){b.onselectstart=function(){return!1};b.style.MozUserSelect="none";b.style.KhtmlUserSelect="none";b.unselectable="on"};GUI.makeSelectable=function(b){b.onselectstart=function(){};b.style.MozUserSelect="auto";b.style.KhtmlUserSelect="auto";b.unselectable="off"};GUI.map=function(b,f,c,d,g){return d+(g-d)*((b-f)/(c-f))};GUI.constrain=function(b,f,c){if(b<f)b=f;else b>c&&(b=c);return b};
GUI.error=function(b){typeof console.error=="function"&&console.error("[GUI ERROR] "+b)};GUI.roundToDecimal=function(b,f){var c=Math.pow(10,f);return Math.round(b*c)/c};GUI.extendController=function(b){b.prototype=new GUI.Controller;b.prototype.constructor=b};GUI.getVarFromURL("saveString")!=null&&GUI.load(GUI.getVarFromURL("saveString"));
GUI.Slider=function(b,f,c,d,g){var h=!1,n=this;this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-slider-bg");this.fg=document.createElement("div");this.fg.setAttribute("class","guidat-slider-fg");this.domElement.appendChild(this.fg);this.__defineSetter__("value",function(m){this.fg.style.width=GUI.map(m,f,c,0,100)+"%"});var o=function(m){if(h){var p;p=n.domElement;var u=curtop=0;if(p.offsetParent){do{u+=p.offsetLeft;curtop+=p.offsetTop}while(p=p.offsetParent);
p=[u,curtop]}else p=void 0;m=GUI.map(m.pageX,p[0],p[0]+n.domElement.offsetWidth,f,c);m=Math.round(m/d)*d;b.setValue(m)}};this.domElement.addEventListener("mousedown",function(m){h=!0;n.domElement.setAttribute("class","guidat-slider-bg active");n.fg.setAttribute("class","guidat-slider-fg active");o(m)},!1);document.addEventListener("mouseup",function(){n.domElement.setAttribute("class","guidat-slider-bg");n.fg.setAttribute("class","guidat-slider-fg");h=!1},!1);document.addEventListener("mousemove",
o,!1);this.value=g};
GUI.Controller=function(){this.parent=arguments[0];this.object=arguments[1];this.propertyName=arguments[2];if(arguments.length>0)this.initialValue=this.propertyName[this.object];this.domElement=document.createElement("div");this.domElement.setAttribute("class","guidat-controller "+this.type);this.propertyNameElement=document.createElement("span");this.propertyNameElement.setAttribute("class","guidat-propertyname");this.name(this.propertyName);this.domElement.appendChild(this.propertyNameElement);GUI.makeUnselectable(this.domElement)};
GUI.Controller.prototype.changeFunction=null;GUI.Controller.prototype.name=function(b){this.propertyNameElement.innerHTML=b;return this};GUI.Controller.prototype.reset=function(){this.setValue(this.initialValue);return this};GUI.Controller.prototype.listen=function(){this.parent.listenTo(this);return this};GUI.Controller.prototype.unlisten=function(){this.parent.unlistenTo(this);return this};
GUI.Controller.prototype.setValue=function(b){this.object[this.propertyName]=b;this.changeFunction!=null&&this.changeFunction.call(this,b);this.updateDisplay();return this};GUI.Controller.prototype.getValue=function(){return this.object[this.propertyName]};GUI.Controller.prototype.updateDisplay=function(){};GUI.Controller.prototype.onChange=function(b){this.changeFunction=b;return this};
GUI.StringController=function(){this.type="string";var b=this;GUI.Controller.apply(this,arguments);var f=document.createElement("input"),c=this.getValue();f.setAttribute("value",c);f.setAttribute("spellcheck","false");this.domElement.addEventListener("mouseup",function(){f.focus();f.select()},!1);f.addEventListener("keyup",function(){b.setValue(f.value)},!1);this.updateDisplay=function(){f.value=b.getValue()};this.domElement.appendChild(f)};GUI.extendController(GUI.StringController);
GUI.NumberController=function(){this.type="number";GUI.Controller.apply(this,arguments);var b=this,f=!1,c=!1,d=py=0,g=arguments[3],h=arguments[4],n=arguments[5];n||(n=g!=undefined&&h!=undefined?(h-g)*0.01:1);var o=document.createElement("input");o.setAttribute("id",this.propertyName);o.setAttribute("type","text");o.setAttribute("value",this.getValue());n&&o.setAttribute("step",n);this.domElement.appendChild(o);var m;if(g!=undefined&&h!=undefined){m=new GUI.Slider(this,g,h,n,this.getValue());this.domElement.appendChild(m.domElement)}o.addEventListener("blur",
function(){var u=parseFloat(this.value);if(isNaN(u))this.value=b.getValue();else b.updateDisplay()},!1);o.addEventListener("mousewheel",function(u){u.preventDefault();b.setValue(b.getValue()+Math.abs(u.wheelDeltaY)/u.wheelDeltaY*n);return!1},!1);o.addEventListener("mousedown",function(u){py=d=u.pageY;c=!0;document.addEventListener("mousemove",p,!1)},!1);o.addEventListener("keydown",function(u){switch(u.keyCode){case 38:u=b.getValue()+n;b.setValue(u);break;case 40:u=b.getValue()-n;b.setValue(u)}},
!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",p,!1);GUI.makeSelectable(b.parent.domElement);GUI.makeSelectable(o);if(c&&!f){o.focus();o.select()}f=!1;c=!1},!1);var p=function(u){f=!0;u.preventDefault();GUI.makeUnselectable(b.parent.domElement);GUI.makeUnselectable(o);py=d;d=u.pageY;u=py-d;u=b.getValue()+u*n;b.setValue(u);return!1};this.setValue=function(u){u=parseFloat(u);if(g!=undefined&&u<=g)u=g;else h!=undefined&&u>=h&&(u=h);return GUI.Controller.prototype.setValue.call(this,
u)};this.updateDisplay=function(){o.value=GUI.roundToDecimal(b.getValue(),4);if(m)m.value=b.getValue()}};GUI.extendController(GUI.NumberController);GUI.FunctionController=function(){this.type="function";var b=this;GUI.Controller.apply(this,arguments);this.domElement.addEventListener("click",function(){b.object[b.propertyName].call(b.object)},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer"};GUI.extendController(GUI.FunctionController);
GUI.BooleanController=function(){this.type="boolean";GUI.Controller.apply(this,arguments);var b=this,f=document.createElement("input");f.setAttribute("type","checkbox");this.domElement.addEventListener("click",function(c){f.checked=!f.checked;c.preventDefault();b.setValue(f.checked)},!1);f.addEventListener("mouseup",function(){f.checked=!f.checked},!1);this.domElement.style.cursor="pointer";this.propertyNameElement.style.cursor="pointer";this.domElement.appendChild(f);this.updateDisplay=function(){f.checked=
b.getValue()};this.setValue=function(c){if(typeof c!="boolean")try{c=eval(c)}catch(d){}return GUI.Controller.prototype.setValue.call(this,c)}};GUI.extendController(GUI.BooleanController);var DAT=DAT||{};
DAT.Color=function(){function b(){var m=DAT.color.rgba_to_hsva(h.r,h.g,h.b,h.a),p;for(p in m)isNaN(m[p])||(n[p]=m[p])}function f(m){var p=DAT.color["hex"+DAT.color.prefix_substitute+m];d.__defineGetter__(m,function(){return h[m]});d.__defineSetter__(m,function(u){if(typeof u!="number")throw DAT.color.InvalidArgumentException;h[m]=u;h.hex!=undefined&&console.log("wtf");g=p.call(d,g,u);b()})}function c(m){d.__defineSetter__(m,function(p){if(typeof p!="number")throw DAT.color.InvalidArgumentException;
isNaN(p)||(n[m]=p);h=DAT.color.hsva_to_rgba(n.h,n.s,n.v,h.a);h.hex!=undefined&&console.log("wtf");g=DAT.color.rgba_to_hex(h.r,h.g,h.b,h.a)});d.__defineGetter__(m,function(){return n[m]})}var d=this,g=DAT.color.args_to_hex(arguments),h={},n={};if(arguments.length==1&&DAT.color.has_rgba_props(arguments[0])){h.r=arguments[0].r;h.g=arguments[0].g;h.b=arguments[0].b;h.a=arguments[0].a}else if(arguments.length==1&&DAT.color.has_rgb_props(arguments[0])){h.r=arguments[0].r;h.g=arguments[0].g;h.b=arguments[0].b;
h.a=DAT.color.bounds.a}else h=DAT.color.hex_to_rgba(g);if(arguments.length==1&&arguments[0]instanceof DAT.Color){n.h=arguments[0].h;n.s=arguments[0].s;n.v=arguments[0].v}else b();this.__defineSetter__("hex",function(m){g=m;h=DAT.color.hex_to_rgba(g);b()});this.__defineGetter__("hex",function(){return g});this.toString=function(){return DAT.color.hex_to_string(g)};for(var o=0;o<4;o++)f("argb"[o]);for(o=0;o<3;o++)c("hsv"[o])};DAT.color={};
(function(b){function f(g){var h="bgra"[g],n=g*8;b["hex"+b.prefix_component+h]=function(o){return(o>>n&255)/255*b.bounds[h]};b["hex"+b.prefix_substitute+h]=function(o,m){m=m/b.bounds[h]*255;return m<<n|o&~(255<<n)}}function c(g){b["hex"+b.prefix_component+g]=function(h){h=b.hex_to_rgba(h);return b.rgba_to_hsva(h.r,h.g,h.b,h.a)[g]};b["hex"+b.prefix_substitute+g]=function(h,n){var o=b.hex_to_rgba(h);o=b.rgba_to_hsva(o.r,o.g,o.b,o.a);o[g]=n;o=b.hsva_to_rgba(o.h,o.s,o.v,o.a);return b.rgba_to_hex(o.r,
o.g,o.b,o.a)}}b.prefix_component="_to_";b.prefix_substitute="_with_";b.InvalidArgumentException="Invalid argument.";b.bounds={a:1,r:255,g:255,b:255,h:360,s:100,v:100};b.rgb=function(g,h,n,o){return b.rgba(g,h,n,o||b.bounds.a)};b.rgba=function(g,h,n,o){return new DAT.Color(g,h,n,o||b.bounds.a)};b.hsv=function(g,h,n,o){return b.hsva(g,h,n,o||b.bounds.a)};b.hsva=function(g,h,n,o){g=b.hsva_to_rgba(g,h,n,o||b.bounds.a);return new DAT.Color(g.r,g.g,g.b,g.a)};b.args_to_hex=function(g){return g.length==0?
0:g.length==1?typeof g[0]=="number"?g[0]:typeof g[0]=="array"?b.rgba_to_hex(g[0][0],g[0][1],g[0][2],g[0][3]):typeof g[0]=="object"&&b.has_rgba_props(g[0])?b.rgba_to_hex(g[0].r,g[0].g,g[0].b,g[0].a):typeof g[0]=="object"&&b.has_rgb_props(g[0])?b.rgba_to_hex(g[0].r,g[0].g,g[0].b):0:g.length==3?b.rgb_to_hex(g[0],g[1],g[2]):g.length==4?b.rgba_to_hex(g[0],g[1],g[2],g[3]):0};b.hsva_to_rgba=function(g,h,n,o){g=isNaN(g)?0:g;g=g/b.bounds.h*360;h/=b.bounds.s;n/=b.bounds.v;o=o||b.bounds.a;var m=g/60-Math.floor(g/
60),p=n*(1-h),u=n*(1-m*h);h=n*(1-(1-m)*h);g=[[n,h,p],[u,n,p],[p,n,h],[p,u,n],[h,p,n],[n,p,u]][Math.floor(g/60)%6];return{r:g[0]*b.bounds.r,g:g[1]*b.bounds.g,b:g[2]*b.bounds.b,a:o||b.bounds.a}};b.hsv_to_rgb=b.hsva_to_rgba;b.rgba_to_hsva=function(g,h,n,o){g/=b.bounds.r;h/=b.bounds.g;n/=b.bounds.b;var m=Math.max(g,h,n),p=m-Math.min(g,h,n),u=m;if(m==0)return{h:0,s:0,v:0,a:o||b.bounds.a};g=g==m?(h-n)/p:h==m?2+(n-g)/p:4+(g-h)/p;g/=6;g<0&&(g+=1);return{h:g*b.bounds.h,s:p/m*b.bounds.s,v:m*b.bounds.v,a:o||
b.bounds.a}};b.rgb_to_hsv=b.rgba_to_hsva;b.rgba_to_hex=function(g,h,n,o){o=b["hex"+b.prefix_substitute+"a"](0,o||b.bounds.a);o=b["hex"+b.prefix_substitute+"r"](o,g);o=b["hex"+b.prefix_substitute+"g"](o,h);return b["hex"+b.prefix_substitute+"b"](o,n)};b.rgb_to_hex=b.rgba_to_hex;b.hex_to_rgba=function(g){return{a:b["hex"+b.prefix_component+"a"](g),r:b["hex"+b.prefix_component+"r"](g),g:b["hex"+b.prefix_component+"g"](g),b:b["hex"+b.prefix_component+"b"](g)}};b.hex_to_rgb=b.hex_to_rgba;b.hex_to_string=
function(g){var h=b["hex"+b.prefix_component+"a"](g)/b.bounds.a,n=Math.round(b["hex"+b.prefix_component+"r"](g)/b.bounds.r*255),o=Math.round(b["hex"+b.prefix_component+"g"](g)/b.bounds.g*255);g=Math.round(b["hex"+b.prefix_component+"b"](g)/b.bounds.b*255);return"rgba("+n+","+o+","+g+","+h+")"};b.has_rgba_props=function(g){return g.r!=undefined&&g.g!=undefined&&g.b!=undefined&&g.a!=undefined};b.has_rgb_props=function(g){return g.r!=undefined&&g.g!=undefined&&g.b!=undefined};for(var d=0;d<4;d++)f(d);
for(d=0;d<3;d++)c("hsv"[d])})(DAT.color);
var signals=function(){function b(c,d,g,h,n){this._listener=d;this._isOnce=g;this.context=h;this._signal=c;this._priority=n||0}var f={VERSION:"0.5.3"};b.prototype={_isEnabled:!0,execute:function(c){var d;if(this._isEnabled){d=this._listener.apply(this.context,c);this._isOnce&&this.detach()}return d},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;
delete this._listener;delete this.context},disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+"]"}};f.Signal=function(){this._bindings=[]};f.Signal.prototype={_shouldPropagate:!0,_isEnabled:!0,_registerListener:function(c,d,g,h){if(typeof c!=="function")throw Error("listener is a required param of add() and addOnce() and should be a Function.");
var n=this._indexOfListener(c);if(n!==-1){c=this._bindings[n];if(c.isOnce()!==d)throw Error("You cannot add"+(d?"":"Once")+"() then add"+(!d?"":"Once")+"() the same listener without removing the relationship first.");}else{c=new b(this,c,d,g,h);this._addBinding(c)}return c},_addBinding:function(c){var d=this._bindings.length;do--d;while(this._bindings[d]&&c._priority<=this._bindings[d]._priority);this._bindings.splice(d+1,0,c)},_indexOfListener:function(c){for(var d=this._bindings.length;d--;)if(this._bindings[d]._listener===
c)return d;return-1},add:function(c,d,g){return this._registerListener(c,!1,d,g)},addOnce:function(c,d,g){return this._registerListener(c,!0,d,g)},remove:function(c){if(typeof c!=="function")throw Error("listener is a required param of remove() and should be a Function.");var d=this._indexOfListener(c);if(d!==-1){this._bindings[d]._destroy();this._bindings.splice(d,1)}return c},removeAll:function(){for(var c=this._bindings.length;c--;)this._bindings[c]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
disable:function(){this._isEnabled=!1},enable:function(){this._isEnabled=!0},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this._isEnabled){var c=Array.prototype.slice.call(arguments),d=this._bindings.slice(),g=this._bindings.length;this._shouldPropagate=!0;do g--;while(d[g]&&this._shouldPropagate&&d[g].execute(c)!==!1)}},dispose:function(){this.removeAll();delete this._bindings},toString:function(){return"[Signal isEnabled: "+this._isEnabled+
" numListeners: "+this.getNumListeners()+"]"}};return f}(),TWEEN=TWEEN||function(){var b,f,c,d=[];this.add=function(g){d.push(g)};this.remove=function(g){b=d.indexOf(g);b!==-1&&d.splice(b,1)};this.update=function(){b=0;f=d.length;for(c=(new Date).getTime();b<f;)if(d[b].update(c))b++;else{d.splice(b,1);f--}};return this}();
TWEEN.Tween=function(b){var f={},c={},d={},g=1E3,h=0,n=null,o=TWEEN.Easing.Linear.EaseNone,m=null,p=null,u=null;this.to=function(v,w){w!==null&&(g=w);for(var x in v)b[x]!==null&&(d[x]=v[x]);return this};this.start=function(){TWEEN.add(this);n=(new Date).getTime()+h;for(var v in d)if(b[v]!==null){f[v]=b[v];c[v]=d[v]-b[v]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(v){h=v;return this};this.easing=function(v){o=v;return this};this.chain=function(v){m=v};this.onUpdate=
function(v){p=v;return this};this.onComplete=function(v){u=v;return this};this.update=function(v){var w,x;if(v<n)return!0;v=(v-n)/g;v=v>1?1:v;x=o(v);for(w in c)b[w]=f[w]+c[w]*x;p!==null&&p.call(b,x);if(v==1){u!==null&&u.call(b);m!==null&&m.start();return!1}return!0}};TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(b){return b};
TWEEN.Easing.Quadratic.EaseIn=function(b){return b*b};TWEEN.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};TWEEN.Easing.Quadratic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};TWEEN.Easing.Cubic.EaseIn=function(b){return b*b*b};TWEEN.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};TWEEN.Easing.Cubic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b;return 0.5*((b-=2)*b*b+2)};TWEEN.Easing.Quartic.EaseIn=function(b){return b*b*b*b};
TWEEN.Easing.Quartic.EaseOut=function(b){return-(--b*b*b*b-1)};TWEEN.Easing.Quartic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b;return-0.5*((b-=2)*b*b*b-2)};TWEEN.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};TWEEN.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};TWEEN.Easing.Quintic.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*b*b*b;return 0.5*((b-=2)*b*b*b*b+2)};TWEEN.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};
TWEEN.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*Math.PI/2)};TWEEN.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};TWEEN.Easing.Exponential.EaseIn=function(b){return b==0?0:Math.pow(2,10*(b-1))};TWEEN.Easing.Exponential.EaseOut=function(b){return b==1?1:-Math.pow(2,-10*b)+1};TWEEN.Easing.Exponential.EaseInOut=function(b){if(b==0)return 0;if(b==1)return 1;if((b*=2)<1)return 0.5*Math.pow(2,10*(b-1));return 0.5*(-Math.pow(2,-10*(b-1))+2)};
TWEEN.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};TWEEN.Easing.Circular.EaseOut=function(b){return Math.sqrt(1- --b*b)};TWEEN.Easing.Circular.EaseInOut=function(b){if((b/=0.5)<1)return-0.5*(Math.sqrt(1-b*b)-1);return 0.5*(Math.sqrt(1-(b-=2)*b)+1)};TWEEN.Easing.Elastic.EaseIn=function(b){var f,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;f=d/4}else f=d/(2*Math.PI)*Math.asin(1/c);return-(c*Math.pow(2,10*(b-=1))*Math.sin((b-f)*2*Math.PI/d))};
TWEEN.Easing.Elastic.EaseOut=function(b){var f,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;f=d/4}else f=d/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*b)*Math.sin((b-f)*2*Math.PI/d)+1};
TWEEN.Easing.Elastic.EaseInOut=function(b){var f,c=0.1,d=0.4;if(b==0)return 0;if(b==1)return 1;d||(d=0.3);if(!c||c<1){c=1;f=d/4}else f=d/(2*Math.PI)*Math.asin(1/c);if((b*=2)<1)return-0.5*c*Math.pow(2,10*(b-=1))*Math.sin((b-f)*2*Math.PI/d);return c*Math.pow(2,-10*(b-=1))*Math.sin((b-f)*2*Math.PI/d)*0.5+1};TWEEN.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};TWEEN.Easing.Back.EaseOut=function(b){return(b-=1)*b*(2.70158*b+1.70158)+1};
TWEEN.Easing.Back.EaseInOut=function(b){if((b*=2)<1)return 0.5*b*b*(3.5949095*b-2.5949095);return 0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};TWEEN.Easing.Bounce.EaseIn=function(b){return 1-TWEEN.Easing.Bounce.EaseOut(1-b)};TWEEN.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};
TWEEN.Easing.Bounce.EaseInOut=function(b){if(b<0.5)return TWEEN.Easing.Bounce.EaseIn(b*2)*0.5;return TWEEN.Easing.Bounce.EaseOut(b*2-1)*0.5+0.5};var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}THREE.Color=function(b){this.setHex(b)};
THREE.Color.prototype={copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;this.hex=b.hex},setHex:function(b){this.hex=~~b&16777215;this.updateRGB()},setRGB:function(b,f,c){this.r=b;this.g=f;this.b=c;this.updateHex()},setHSV:function(b,f,c){var d,g,h,n,o,m;if(c==0)d=g=h=0;else switch(n=Math.floor(b*6),o=b*6-n,b=c*(1-f),m=c*(1-f*o),f=c*(1-f*(1-o)),n){case 1:d=m;g=c;h=b;break;case 2:d=b;g=c;h=f;break;case 3:d=b;g=m;h=c;break;case 4:d=f;g=b;h=c;break;case 5:d=c;g=b;h=m;break;case 6:case 0:d=c;g=f;h=b}this.setRGB(d,
g,h)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(b,f){this.set(b||0,f||0)};
THREE.Vector2.prototype={set:function(b,f){this.x=b;this.y=f;return this},copy:function(b){this.x=b.x;this.y=b.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(b,f){this.x=b.x+f.x;this.y=b.y+f.y;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;return this},sub:function(b,f){this.x=b.x-f.x;this.y=b.y-f.y;return this},subSelf:function(b){this.x-=b.x;this.y-=b.y;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;return this},divideScalar:function(b){b?
(this.x/=b,this.y/=b):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){return this.normalize().multiplyScalar(b)},unit:function(){return this.normalize()}};THREE.Vector3=function(b,f,c){this.set(b||0,f||0,c||0)};
THREE.Vector3.prototype={set:function(b,f,c){this.x=b;this.y=f;this.z=c;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(b,f){this.x=b.x+f.x;this.y=b.y+f.y;this.z=b.z+f.z;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;return this},sub:function(b,f){this.x=b.x-f.x;this.y=b.y-f.y;this.z=b.z-f.z;return this},subSelf:function(b){this.x-=
b.x;this.y-=b.y;this.z-=b.z;return this},multiply:function(b,f){this.x=b.x*f.x;this.y=b.y*f.y;this.z=b.z*f.z;return this},multiplySelf:function(b){this.x*=b.x;this.y*=b.y;this.z*=b.y;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;return this},divideSelf:function(b){return this.divide(this,b)},divideScalar:function(b){b?(this.x/=b,this.y/=b,this.z/=b):this.set(0,0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y+this.z*
b.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){return this.normalize().multiplyScalar(b)},cross:function(b,f){this.x=b.y*f.z-b.z*f.y;this.y=b.z*f.x-b.x*f.z;this.z=b.x*f.y-b.y*f.x;return this},crossSelf:function(b){return this.set(this.y*b.z-this.z*b.y,this.z*b.x-this.x*b.z,this.x*
b.y-this.y*b.x)},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){return(new THREE.Vector3).sub(this,b).lengthSq()},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(b){var f=Math.cos(this.y);this.y=Math.asin(b.n13);Math.abs(f)>1.0E-5?(this.x=Math.atan2(-b.n23/f,b.n33/f),this.z=Math.atan2(-b.n12/f,b.n11/f)):(this.x=0,this.z=Math.atan2(b.n21,b.n22))},isZero:function(){return this.lengthSq()<1.0E-4}};
THREE.Vector4=function(b,f,c,d){this.set(b||0,f||0,c||0,d||1)};
THREE.Vector4.prototype={set:function(b,f,c,d){this.x=b;this.y=f;this.z=c;this.w=d;return this},copy:function(b){return this.set(b.x,b.y,b.z,b.w||1)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(b,f){this.x=b.x+f.x;this.y=b.y+f.y;this.z=b.z+f.z;this.w=b.w+f.w;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;this.w+=b.w;return this},sub:function(b,f){this.x=b.x-f.x;this.y=b.y-f.y;this.z=b.z-f.z;this.w=b.w-f.w;return this},subSelf:function(b){this.x-=
b.x;this.y-=b.y;this.z-=b.z;this.w-=b.w;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;this.w*=b;return this},divideScalar:function(b){b?(this.x/=b,this.y/=b,this.z/=b,this.w/=b):this.set(0,0,0,1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},
setLength:function(b){return this.normalize().multiplyScalar(b)},lerpSelf:function(b,f){this.x+=(b.x-this.x)*f;this.y+=(b.y-this.y)*f;this.z+=(b.z-this.z)*f;this.w+=(b.w-this.w)*f;return this}};THREE.Ray=function(b,f){this.origin=b||new THREE.Vector3;this.direction=f||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(b){return this.intersectObjects(b.objects)},intersectObjects:function(b){var f,c,d=[];f=0;for(c=b.length;f<c;f++)d=d.concat(this.intersectObject(b[f]));d.sort(function(g,h){return g.distance-h.distance});return d},intersectObject:function(b){function f(C,E,z){var H;H=z.position.clone().subSelf(C).dot(E);C=C.clone().addSelf(E.clone().multiplyScalar(H));return z.position.distanceTo(C)}function c(C,E,z,H){H=H.clone().subSelf(E);z=z.clone().subSelf(E);var G=
C.clone().subSelf(E);C=H.dot(H);E=H.dot(z);H=H.dot(G);var F=z.dot(z);z=z.dot(G);G=1/(C*F-E*E);F=(F*H-E*z)*G;C=(C*z-E*H)*G;return F>0&&C>0&&F+C<1}if(b instanceof THREE.Particle){var d=f(this.origin,this.direction,b);if(!d||d>b.scale.x)return[];return[{distance:d,point:b.position,face:null,object:b}]}else if(b instanceof THREE.Mesh){d=f(this.origin,this.direction,b);if(!d||d>b.geometry.boundingSphere.radius*Math.max(b.scale.x,Math.max(b.scale.y,b.scale.z)))return[];var g,h,n,o,m,p,u,v,w,x,y=b.geometry,
A=y.vertices,B=[];d=0;for(g=y.faces.length;d<g;d++)if(h=y.faces[d],w=this.origin.clone(),x=this.direction.clone(),p=b.matrixWorld,n=p.multiplyVector3(A[h.a].position.clone()),o=p.multiplyVector3(A[h.b].position.clone()),m=p.multiplyVector3(A[h.c].position.clone()),p=h instanceof THREE.Face4?p.multiplyVector3(A[h.d].position.clone()):null,u=b.matrixRotationWorld.multiplyVector3(h.normal.clone()),v=x.dot(u),b.doubleSided||(b.flipSided?v>0:v<0))if(u=u.dot((new THREE.Vector3).sub(n,w))/v,w=w.addSelf(x.multiplyScalar(u)),
h instanceof THREE.Face3)c(w,n,o,m)&&(h={distance:this.origin.distanceTo(w),point:w,face:h,object:b},B.push(h));else if(h instanceof THREE.Face4&&(c(w,n,o,p)||c(w,o,m,p))){h={distance:this.origin.distanceTo(w),point:w,face:h,object:b};B.push(h)}return B}else return[]}};
THREE.Rectangle=function(){function b(){h=d-f;n=g-c}var f,c,d,g,h,n,o=!0;this.getX=function(){return f};this.getY=function(){return c};this.getWidth=function(){return h};this.getHeight=function(){return n};this.getLeft=function(){return f};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return g};this.set=function(m,p,u,v){o=!1;f=m;c=p;d=u;g=v;b()};this.addPoint=function(m,p){o?(o=!1,f=m,c=p,d=m,g=p):(f=f<m?f:m,c=c<p?c:p,d=d>m?d:m,g=g>p?g:p);b()};this.add3Points=
function(m,p,u,v,w,x){o?(o=!1,f=m<u?m<w?m:w:u<w?u:w,c=p<v?p<x?p:x:v<x?v:x,d=m>u?m>w?m:w:u>w?u:w,g=p>v?p>x?p:x:v>x?v:x):(f=m<u?m<w?m<f?m:f:w<f?w:f:u<w?u<f?u:f:w<f?w:f,c=p<v?p<x?p<c?p:c:x<c?x:c:v<x?v<c?v:c:x<c?x:c,d=m>u?m>w?m>d?m:d:w>d?w:d:u>w?u>d?u:d:w>d?w:d,g=p>v?p>x?p>g?p:g:x>g?x:g:v>x?v>g?v:g:x>g?x:g);b()};this.addRectangle=function(m){o?(o=!1,f=m.getLeft(),c=m.getTop(),d=m.getRight(),g=m.getBottom()):(f=f<m.getLeft()?f:m.getLeft(),c=c<m.getTop()?c:m.getTop(),d=d>m.getRight()?d:m.getRight(),g=g>
m.getBottom()?g:m.getBottom());b()};this.inflate=function(m){f-=m;c-=m;d+=m;g+=m;b()};this.minSelf=function(m){f=f>m.getLeft()?f:m.getLeft();c=c>m.getTop()?c:m.getTop();d=d<m.getRight()?d:m.getRight();g=g<m.getBottom()?g:m.getBottom();b()};this.instersects=function(m){return Math.min(d,m.getRight())-Math.max(f,m.getLeft())>=0&&Math.min(g,m.getBottom())-Math.max(c,m.getTop())>=0};this.empty=function(){o=!0;g=d=c=f=0;b()};this.isEmpty=function(){return o}};THREE.Matrix3=function(){this.m=[]};
THREE.Matrix3.prototype={transpose:function(){var b,f=this.m;b=f[1];f[1]=f[3];f[3]=b;b=f[2];f[2]=f[6];f[6]=b;b=f[5];f[5]=f[7];f[7]=b;return this},transposeIntoArray:function(b){var f=this.m;b[0]=f[0];b[1]=f[3];b[2]=f[6];b[3]=f[1];b[4]=f[4];b[5]=f[7];b[6]=f[2];b[7]=f[5];b[8]=f[8];return this}};THREE.Matrix4=function(b,f,c,d,g,h,n,o,m,p,u,v,w,x,y,A){this.set(b||1,f||0,c||0,d||0,g||0,h||1,n||0,o||0,m||0,p||0,u||1,v||0,w||0,x||0,y||0,A||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(b,f,c,d,g,h,n,o,m,p,u,v,w,x,y,A){this.n11=b;this.n12=f;this.n13=c;this.n14=d;this.n21=g;this.n22=h;this.n23=n;this.n24=o;this.n31=m;this.n32=p;this.n33=u;this.n34=v;this.n41=w;this.n42=x;this.n43=y;this.n44=A;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(b,f,c){var d=THREE.Matrix4.__v1,
g=THREE.Matrix4.__v2,h=THREE.Matrix4.__v3;h.sub(b,f).normalize();if(h.length()===0)h.z=1;d.cross(c,h).normalize();d.length()===0&&(h.x+=1.0E-4,d.cross(c,h).normalize());g.cross(h,d).normalize();this.n11=d.x;this.n12=g.x;this.n13=h.x;this.n21=d.y;this.n22=g.y;this.n23=h.y;this.n31=d.z;this.n32=g.z;this.n33=h.z;return this},multiplyVector3:function(b){var f=b.x,c=b.y,d=b.z,g=1/(this.n41*f+this.n42*c+this.n43*d+this.n44);b.x=(this.n11*f+this.n12*c+this.n13*d+this.n14)*g;b.y=(this.n21*f+this.n22*c+this.n23*
d+this.n24)*g;b.z=(this.n31*f+this.n32*c+this.n33*d+this.n34)*g;return b},multiplyVector4:function(b){var f=b.x,c=b.y,d=b.z,g=b.w;b.x=this.n11*f+this.n12*c+this.n13*d+this.n14*g;b.y=this.n21*f+this.n22*c+this.n23*d+this.n24*g;b.z=this.n31*f+this.n32*c+this.n33*d+this.n34*g;b.w=this.n41*f+this.n42*c+this.n43*d+this.n44*g;return b},rotateAxis:function(b){var f=b.x,c=b.y,d=b.z;b.x=f*this.n11+c*this.n12+d*this.n13;b.y=f*this.n21+c*this.n22+d*this.n23;b.z=f*this.n31+c*this.n32+d*this.n33;b.normalize();
return b},crossVector:function(b){var f=new THREE.Vector4;f.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;f.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;f.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;f.w=b.w?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return f},multiply:function(b,f){var c=b.n11,d=b.n12,g=b.n13,h=b.n14,n=b.n21,o=b.n22,m=b.n23,p=b.n24,u=b.n31,v=b.n32,w=b.n33,x=b.n34,y=b.n41,A=b.n42,B=b.n43,C=b.n44,E=f.n11,z=f.n12,H=f.n13,G=f.n14,F=f.n21,T=f.n22,
$=f.n23,W=f.n24,V=f.n31,S=f.n32,t=f.n33,M=f.n34;this.n11=c*E+d*F+g*V;this.n12=c*z+d*T+g*S;this.n13=c*H+d*$+g*t;this.n14=c*G+d*W+g*M+h;this.n21=n*E+o*F+m*V;this.n22=n*z+o*T+m*S;this.n23=n*H+o*$+m*t;this.n24=n*G+o*W+m*M+p;this.n31=u*E+v*F+w*V;this.n32=u*z+v*T+w*S;this.n33=u*H+v*$+w*t;this.n34=u*G+v*W+w*M+x;this.n41=y*E+A*F+B*V;this.n42=y*z+A*T+B*S;this.n43=y*H+A*$+B*t;this.n44=y*G+A*W+B*M+C;return this},multiplyToArray:function(b,f,c){this.multiply(b,f);c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=
this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return this},multiplySelf:function(b){this.multiply(this,b);return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},determinant:function(){var b=
this.n11,f=this.n12,c=this.n13,d=this.n14,g=this.n21,h=this.n22,n=this.n23,o=this.n24,m=this.n31,p=this.n32,u=this.n33,v=this.n34,w=this.n41,x=this.n42,y=this.n43,A=this.n44;return d*n*p*w-c*o*p*w-d*h*u*w+f*o*u*w+c*h*v*w-f*n*v*w-d*n*m*x+c*o*m*x+d*g*u*x-b*o*u*x-c*g*v*x+b*n*v*x+d*h*m*y-f*o*m*y-d*g*p*y+b*o*p*y+f*g*v*y-b*h*v*y-c*h*m*A+f*n*m*A+c*g*p*A-b*n*p*A-f*g*u*A+b*h*u*A},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=
this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;
this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=
this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(b,f){b[f]=this.n11;b[f+1]=this.n21;b[f+2]=this.n31;b[f+3]=this.n41;b[f+4]=this.n12;b[f+5]=this.n22;b[f+6]=this.n32;b[f+7]=this.n42;b[f+8]=this.n13;b[f+9]=this.n23;b[f+10]=this.n33;b[f+11]=this.n43;b[f+12]=this.n14;b[f+13]=this.n24;b[f+14]=this.n34;b[f+15]=this.n44;return b},setTranslation:function(b,f,c){this.set(1,0,0,b,0,1,0,f,0,0,1,c,0,0,0,1);return this},setScale:function(b,
f,c){this.set(b,0,0,0,0,f,0,0,0,0,c,0,0,0,0,1);return this},setRotationX:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,f,-b,0,0,b,f,0,0,0,0,1);return this},setRotationY:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(f,0,b,0,0,1,0,0,-b,0,f,0,0,0,0,1);return this},setRotationZ:function(b){var f=Math.cos(b);b=Math.sin(b);this.set(f,-b,0,0,b,f,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(b,f){var c=Math.cos(f),d=Math.sin(f),g=1-c,h=b.x,n=b.y,o=b.z,m=g*h,p=g*n;this.set(m*
h+c,m*n-d*o,m*o+d*n,0,m*n+d*o,p*n+c,p*o-d*h,0,m*o-d*n,p*o+d*h,g*o*o+c,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){if(!this.position)this.position=new THREE.Vector3;this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX)this.columnX=new THREE.Vector3;this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY)this.columnY=new THREE.Vector3;
this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ)this.columnZ=new THREE.Vector3;this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(b){var f=b.x,c=b.y,d=b.z;b=Math.cos(f);f=Math.sin(f);var g=Math.cos(c);c=Math.sin(c);var h=Math.cos(d);d=Math.sin(d);var n=b*c,o=f*c;this.n11=g*h;this.n12=-g*d;this.n13=c;this.n21=o*h+b*d;this.n22=-o*d+b*h;this.n23=-f*g;this.n31=-n*h+f*d;this.n32=n*d+f*h;this.n33=b*g;return this},
setRotationFromQuaternion:function(b){var f=b.x,c=b.y,d=b.z,g=b.w,h=f+f,n=c+c,o=d+d;b=f*h;var m=f*n;f*=o;var p=c*n;c*=o;d*=o;h*=g;n*=g;g*=o;this.n11=1-(p+d);this.n12=m-g;this.n13=f+n;this.n21=m+g;this.n22=1-(b+d);this.n23=c-h;this.n31=f-n;this.n32=c+h;this.n33=1-(b+p);return this},scale:function(b){var f=b.x,c=b.y;b=b.z;this.n11*=f;this.n12*=c;this.n13*=b;this.n21*=f;this.n22*=c;this.n23*=b;this.n31*=f;this.n32*=c;this.n33*=b;this.n41*=f;this.n42*=c;this.n43*=b;return this},extractPosition:function(b){this.n14=
b.n14;this.n24=b.n24;this.n34=b.n34},extractRotation:function(b,f){var c=1/f.x,d=1/f.y,g=1/f.z;this.n11=b.n11*c;this.n21=b.n21*c;this.n31=b.n31*c;this.n12=b.n12*d;this.n22=b.n22*d;this.n32=b.n32*d;this.n13=b.n13*g;this.n23=b.n23*g;this.n33=b.n33*g}};
THREE.Matrix4.makeInvert=function(b,f){var c=b.n11,d=b.n12,g=b.n13,h=b.n14,n=b.n21,o=b.n22,m=b.n23,p=b.n24,u=b.n31,v=b.n32,w=b.n33,x=b.n34,y=b.n41,A=b.n42,B=b.n43,C=b.n44;f===void 0&&(f=new THREE.Matrix4);f.n11=m*x*A-p*w*A+p*v*B-o*x*B-m*v*C+o*w*C;f.n12=h*w*A-g*x*A-h*v*B+d*x*B+g*v*C-d*w*C;f.n13=g*p*A-h*m*A+h*o*B-d*p*B-g*o*C+d*m*C;f.n14=h*m*v-g*p*v-h*o*w+d*p*w+g*o*x-d*m*x;f.n21=p*w*y-m*x*y-p*u*B+n*x*B+m*u*C-n*w*C;f.n22=g*x*y-h*w*y+h*u*B-c*x*B-g*u*C+c*w*C;f.n23=h*m*y-g*p*y-h*n*B+c*p*B+g*n*C-c*m*C;f.n24=
g*p*u-h*m*u+h*n*w-c*p*w-g*n*x+c*m*x;f.n31=o*x*y-p*v*y+p*u*A-n*x*A-o*u*C+n*v*C;f.n32=h*v*y-d*x*y-h*u*A+c*x*A+d*u*C-c*v*C;f.n33=g*p*y-h*o*y+h*n*A-c*p*A-d*n*C+c*o*C;f.n34=h*o*u-d*p*u-h*n*v+c*p*v+d*n*x-c*o*x;f.n41=m*v*y-o*w*y-m*u*A+n*w*A+o*u*B-n*v*B;f.n42=d*w*y-g*v*y+g*u*A-c*w*A-d*u*B+c*v*B;f.n43=g*o*y-d*m*y-g*n*A+c*m*A+d*n*B-c*o*B;f.n44=d*m*u-g*o*u+g*n*v-c*m*v-d*n*w+c*o*w;f.multiplyScalar(1/b.determinant());return f};
THREE.Matrix4.makeInvert3x3=function(b){var f=b.m33,c=f.m,d=b.n33*b.n22-b.n32*b.n23,g=-b.n33*b.n21+b.n31*b.n23,h=b.n32*b.n21-b.n31*b.n22,n=-b.n33*b.n12+b.n32*b.n13,o=b.n33*b.n11-b.n31*b.n13,m=-b.n32*b.n11+b.n31*b.n12,p=b.n23*b.n12-b.n22*b.n13,u=-b.n23*b.n11+b.n21*b.n13,v=b.n22*b.n11-b.n21*b.n12;b=b.n11*d+b.n21*n+b.n31*p;b==0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");b=1/b;c[0]=b*d;c[1]=b*g;c[2]=b*h;c[3]=b*n;c[4]=b*o;c[5]=b*m;c[6]=b*p;c[7]=b*u;c[8]=b*v;return f};
THREE.Matrix4.makeFrustum=function(b,f,c,d,g,h){var n;n=new THREE.Matrix4;n.n11=2*g/(f-b);n.n12=0;n.n13=(f+b)/(f-b);n.n14=0;n.n21=0;n.n22=2*g/(d-c);n.n23=(d+c)/(d-c);n.n24=0;n.n31=0;n.n32=0;n.n33=-(h+g)/(h-g);n.n34=-2*h*g/(h-g);n.n41=0;n.n42=0;n.n43=-1;n.n44=0;return n};THREE.Matrix4.makePerspective=function(b,f,c,d){var g;b=c*Math.tan(b*Math.PI/360);g=-b;return THREE.Matrix4.makeFrustum(g*f,b*f,g,b,c,d)};
THREE.Matrix4.makeOrtho=function(b,f,c,d,g,h){var n,o,m,p;n=new THREE.Matrix4;o=f-b;m=c-d;p=h-g;n.n11=2/o;n.n12=0;n.n13=0;n.n14=-((f+b)/o);n.n21=0;n.n22=2/m;n.n23=0;n.n24=-((c+d)/m);n.n31=0;n.n32=0;n.n33=-2/p;n.n34=-((h+g)/p);n.n41=0;n.n42=0;n.n43=0;n.n44=1;return n};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.dynamic=!1;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;
this.visible=!0;this._vector=new THREE.Vector3;this.name=""};
THREE.Object3D.prototype={translate:function(b,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(b))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(b){if(this.children.indexOf(b)===
-1){b.parent!==void 0&&b.parent.removeChild(b);b.parent=this;this.children.push(b);for(var f=this;f.parent!==void 0;)f=f.parent;f!==void 0&&f instanceof THREE.Scene&&f.addChildRecurse(b)}},removeChild:function(b){var f=this.children.indexOf(b);if(f!==-1){b.parent=void 0;this.children.splice(f,1)}},getChildByName:function(b,f){var c,d,g;c=0;for(d=this.children.length;c<d;c++){g=this.children[c];if(g.name===b)return g;if(f&&(g=g.getChildByName(b,f),g!==void 0))return g}},updateMatrix:function(){this.matrix.setPosition(this.position);
this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(b,f,c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||f){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);
this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;f=!0}b=0;for(var d=this.children.length;b<d;b++)this.children[b].update(this.matrixWorld,f,c)}};THREE.Quaternion=function(b,f,c,d){this.set(b||0,f||0,c||0,d!==void 0?d:1)};
THREE.Quaternion.prototype={set:function(b,f,c,d){this.x=b;this.y=f;this.z=c;this.w=d;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(b){var f=0.5*Math.PI/360,c=b.x*f,d=b.y*f,g=b.z*f;b=Math.cos(d);d=Math.sin(d);f=Math.cos(-g);g=Math.sin(-g);var h=Math.cos(c);c=Math.sin(c);var n=b*f,o=d*g;this.w=n*h-o*c;this.x=n*c+o*h;this.y=d*f*h+b*g*c;this.z=b*g*h-d*f*c;return this},setFromAxisAngle:function(b,f){var c=f/2,d=Math.sin(c);this.x=b.x*d;this.y=
b.y*d;this.z=b.z*d;this.w=Math.cos(c);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);b==0?this.w=this.z=this.y=this.x=0:(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=b);return this},
multiplySelf:function(b){var f=this.x,c=this.y,d=this.z,g=this.w,h=b.x,n=b.y,o=b.z;b=b.w;this.x=f*b+g*h+c*o-d*n;this.y=c*b+g*n+d*h-f*o;this.z=d*b+g*o+f*n-c*h;this.w=g*b-f*h-c*n-d*o;return this},multiply:function(b,f){this.x=b.x*f.w+b.y*f.z-b.z*f.y+b.w*f.x;this.y=-b.x*f.z+b.y*f.w+b.z*f.x+b.w*f.y;this.z=b.x*f.y-b.y*f.x+b.z*f.w+b.w*f.z;this.w=-b.x*f.x-b.y*f.y-b.z*f.z+b.w*f.w;return this},multiplyVector3:function(b,f){f||(f=b);var c=b.x,d=b.y,g=b.z,h=this.x,n=this.y,o=this.z,m=this.w,p=m*c+n*g-o*d,u=
m*d+o*c-h*g,v=m*g+h*d-n*c;c=-h*c-n*d-o*g;f.x=p*m+c*-h+u*-o-v*-n;f.y=u*m+c*-n+v*-h-p*-o;f.z=v*m+c*-o+p*-n-u*-h;return f}};
THREE.Quaternion.slerp=function(b,f,c,d){var g=b.w*f.w+b.x*f.x+b.y*f.y+b.z*f.z;if(Math.abs(g)>=1)return c.w=b.w,c.x=b.x,c.y=b.y,c.z=b.z,c;var h=Math.acos(g),n=Math.sqrt(1-g*g);if(Math.abs(n)<0.0010)return c.w=0.5*(b.w+f.w),c.x=0.5*(b.x+f.x),c.y=0.5*(b.y+f.y),c.z=0.5*(b.z+f.z),c;g=Math.sin((1-d)*h)/n;d=Math.sin(d*h)/n;c.w=b.w*g+f.w*d;c.x=b.x*g+f.x*d;c.y=b.y*g+f.y*d;c.z=b.z*g+f.z*d;return c};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};
THREE.Face3=function(b,f,c,d,g,h){this.a=b;this.b=f;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=g instanceof THREE.Color?g:new THREE.Color;this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materials=h instanceof Array?h:[h];this.centroid=new THREE.Vector3};
THREE.Face4=function(b,f,c,d,g,h,n){this.a=b;this.b=f;this.c=c;this.d=d;this.normal=g instanceof THREE.Vector3?g:new THREE.Vector3;this.vertexNormals=g instanceof Array?g:[];this.color=h instanceof THREE.Color?h:new THREE.Color;this.vertexColors=h instanceof Array?h:[];this.vertexTangents=[];this.materials=n instanceof Array?n:[n];this.centroid=new THREE.Vector3};THREE.UV=function(b,f){this.set(b||0,f||0)};
THREE.UV.prototype={set:function(b,f){this.u=b;this.v=f;return this},copy:function(b){this.set(b.u,b.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var b,f,c;b=0;for(f=this.faces.length;b<f;b++){c=this.faces[b];c.centroid.set(0,0,0);c instanceof THREE.Face3?(c.centroid.addSelf(this.vertices[c.a].position),c.centroid.addSelf(this.vertices[c.b].position),c.centroid.addSelf(this.vertices[c.c].position),c.centroid.divideScalar(3)):c instanceof THREE.Face4&&(c.centroid.addSelf(this.vertices[c.a].position),c.centroid.addSelf(this.vertices[c.b].position),c.centroid.addSelf(this.vertices[c.c].position),
c.centroid.addSelf(this.vertices[c.d].position),c.centroid.divideScalar(4))}},computeFaceNormals:function(b){var f,c,d,g,h,n,o=new THREE.Vector3,m=new THREE.Vector3;d=0;for(g=this.faces.length;d<g;d++){h=this.faces[d];if(b&&h.vertexNormals.length){o.set(0,0,0);f=0;for(c=h.vertexNormals.length;f<c;f++)o.addSelf(h.vertexNormals[f]);o.divideScalar(3)}else{f=this.vertices[h.a];c=this.vertices[h.b];n=this.vertices[h.c];o.sub(n.position,c.position);m.sub(f.position,c.position);o.crossSelf(m)}o.isZero()||
o.normalize();h.normal.copy(o)}},computeVertexNormals:function(){var b,f,c,d;if(this.__tmpVertices==void 0){d=this.__tmpVertices=Array(this.vertices.length);b=0;for(f=this.vertices.length;b<f;b++)d[b]=new THREE.Vector3;b=0;for(f=this.faces.length;b<f;b++)if(c=this.faces[b],c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else{d=
this.__tmpVertices;b=0;for(f=this.vertices.length;b<f;b++)d[b].set(0,0,0)}b=0;for(f=this.faces.length;b<f;b++){c=this.faces[b];c instanceof THREE.Face3?(d[c.a].addSelf(c.normal),d[c.b].addSelf(c.normal),d[c.c].addSelf(c.normal)):c instanceof THREE.Face4&&(d[c.a].addSelf(c.normal),d[c.b].addSelf(c.normal),d[c.c].addSelf(c.normal),d[c.d].addSelf(c.normal))}b=0;for(f=this.vertices.length;b<f;b++)d[b].normalize();b=0;for(f=this.faces.length;b<f;b++){c=this.faces[b];c instanceof THREE.Face3?(c.vertexNormals[0].copy(d[c.a]),
c.vertexNormals[1].copy(d[c.b]),c.vertexNormals[2].copy(d[c.c])):c instanceof THREE.Face4&&(c.vertexNormals[0].copy(d[c.a]),c.vertexNormals[1].copy(d[c.b]),c.vertexNormals[2].copy(d[c.c]),c.vertexNormals[3].copy(d[c.d]))}},computeTangents:function(){function b(R,ca,U,ea,la,ta,xa){o=R.vertices[ca].position;m=R.vertices[U].position;p=R.vertices[ea].position;u=n[la];v=n[ta];w=n[xa];x=m.x-o.x;y=p.x-o.x;A=m.y-o.y;B=p.y-o.y;C=m.z-o.z;E=p.z-o.z;z=v.u-u.u;H=w.u-u.u;G=v.v-u.v;F=w.v-u.v;T=1/(z*F-H*G);S.set((F*
x-G*y)*T,(F*A-G*B)*T,(F*C-G*E)*T);t.set((z*y-H*x)*T,(z*B-H*A)*T,(z*E-H*C)*T);W[ca].addSelf(S);W[U].addSelf(S);W[ea].addSelf(S);V[ca].addSelf(t);V[U].addSelf(t);V[ea].addSelf(t)}var f,c,d,g,h,n,o,m,p,u,v,w,x,y,A,B,C,E,z,H,G,F,T,$,W=[],V=[],S=new THREE.Vector3,t=new THREE.Vector3,M=new THREE.Vector3,I=new THREE.Vector3,P=new THREE.Vector3;f=0;for(c=this.vertices.length;f<c;f++){W[f]=new THREE.Vector3;V[f]=new THREE.Vector3}f=0;for(c=this.faces.length;f<c;f++){h=this.faces[f];n=this.faceVertexUvs[0][f];
h instanceof THREE.Face3?b(this,h.a,h.b,h.c,0,1,2):h instanceof THREE.Face4&&(b(this,h.a,h.b,h.c,0,1,2),b(this,h.a,h.b,h.d,0,1,3))}var O=["a","b","c","d"];f=0;for(c=this.faces.length;f<c;f++){h=this.faces[f];for(d=0;d<h.vertexNormals.length;d++){P.copy(h.vertexNormals[d]);g=h[O[d]];$=W[g];M.copy($);M.subSelf(P.multiplyScalar(P.dot($))).normalize();I.cross(h.vertexNormals[d],$);g=I.dot(V[g]);g=g<0?-1:1;h.vertexTangents[d]=new THREE.Vector4(M.x,M.y,M.z,g)}}this.hasTangents=!0},computeBoundingBox:function(){var b;
if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var f=1,c=this.vertices.length;f<c;f++){b=this.vertices[f];if(b.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=b.position.x;else if(b.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=b.position.x;if(b.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=b.position.y;
else if(b.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=b.position.y;if(b.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=b.position.z;else if(b.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=b.position.z}}},computeBoundingSphere:function(){for(var b=0,f=0,c=this.vertices.length;f<c;f++)b=Math.max(b,this.vertices[f].position.length());this.boundingSphere={radius:b}},computeEdgeFaces:function(){function b(m,p){return Math.min(m,p)+"_"+Math.max(m,p)}function f(m,p,u){m[p]===
void 0?(m[p]={set:{},array:[]},m[p].set[u]=1,m[p].array.push(u)):m[p].set[u]===void 0&&(m[p].set[u]=1,m[p].array.push(u))}var c,d,g,h,n,o={};c=0;for(d=this.faces.length;c<d;c++){n=this.faces[c];n instanceof THREE.Face3?(g=b(n.a,n.b),f(o,g,c),g=b(n.b,n.c),f(o,g,c),g=b(n.a,n.c),f(o,g,c)):n instanceof THREE.Face4&&(g=b(n.b,n.d),f(o,g,c),g=b(n.a,n.b),f(o,g,c),g=b(n.a,n.d),f(o,g,c),g=b(n.b,n.c),f(o,g,c),g=b(n.c,n.d),f(o,g,c))}c=0;for(d=this.edges.length;c<d;c++){n=this.edges[c];g=n.vertexIndices[0];h=
n.vertexIndices[1];n.faceIndices=o[b(g,h)].array;for(g=0;g<n.faceIndices.length;g++){h=n.faceIndices[g];n.faces.push(this.faces[h])}}}};THREE.GeometryIdCounter=0;
THREE.Spline=function(b){function f(x,y,A,B,C,E,z){x=(A-x)*0.5;B=(B-y)*0.5;return(2*(y-A)+x+B)*z+(-3*(y-A)-2*x-B)*E+x*C+y}this.points=b;var c=[],d={x:0,y:0,z:0},g,h,n,o,m,p,u,v,w;this.initFromArray=function(x){this.points=[];for(var y=0;y<x.length;y++)this.points[y]={x:x[y][0],y:x[y][1],z:x[y][2]}};this.getPoint=function(x){g=(this.points.length-1)*x;h=Math.floor(g);n=g-h;c[0]=h==0?h:h-1;c[1]=h;c[2]=h>this.points.length-2?h:h+1;c[3]=h>this.points.length-3?h:h+2;p=this.points[c[0]];u=this.points[c[1]];
v=this.points[c[2]];w=this.points[c[3]];o=n*n;m=n*o;d.x=f(p.x,u.x,v.x,w.x,n,o,m);d.y=f(p.y,u.y,v.y,w.y,n,o,m);d.z=f(p.z,u.z,v.z,w.z,n,o,m);return d};this.getControlPointsArray=function(){var x,y,A=this.points.length,B=[];for(x=0;x<A;x++){y=this.points[x];B[x]=[y.x,y.y,y.z]}return B};this.getLength=function(x){var y,A,B=0,C=new THREE.Vector3,E=new THREE.Vector3,z=[],H=0;z[0]=0;x||(x=100);A=this.points.length*x;C.copy(this.points[0]);for(x=1;x<A;x++){y=x/A;position=this.getPoint(y);E.copy(position);
H+=E.distanceTo(C);C.copy(position);y*=this.points.length-1;y=Math.floor(y);y!=B&&(z[y]=H,B=y)}z[z.length]=H;return{chunks:z,total:H}};this.reparametrizeByArcLength=function(x){var y,A,B,C,E,z,H=[],G=new THREE.Vector3,F=this.getLength();H.push(G.copy(this.points[0]).clone());for(y=1;y<this.points.length;y++){A=F.chunks[y]-F.chunks[y-1];z=Math.ceil(x*A/F.total);C=(y-1)/(this.points.length-1);E=y/(this.points.length-1);for(A=1;A<z-1;A++){B=C+A*(1/z)*(E-C);position=this.getPoint(B);H.push(G.copy(position).clone())}H.push(G.copy(this.points[y]).clone())}this.points=
H}};THREE.Edge=function(b,f,c,d){this.vertices=[b,f];this.vertexIndices=[c,d];this.faces=[];this.faceIndices=[]};THREE.Camera=function(b,f,c,d,g){THREE.Object3D.call(this);this.fov=b||50;this.aspect=f||1;this.near=c||0.1;this.far=d||2E3;this.target=g||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;
THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(b,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(b));this.target.position.addSelf(f.multiplyScalar(b))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.Camera.prototype.update=function(b,f,c){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);f=!0}else if(this.matrixAutoUpdate&&this.updateMatrix(),f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;f=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,f,c)};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,f,c,d){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=f||1;this.distance=c||0;this.castShadow=d!==void 0?d:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,f,c){THREE.Light.call(this,b);this.position=new THREE.Vector3;this.intensity=f||1;this.distance=c||0};
THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(b,f,c,d){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=void 0;b!==void 0&&this.add(b,f,c,d)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;
THREE.LensFlare.prototype.add=function(b,f,c,d){f===void 0&&(f=-1);c===void 0&&(c=0);if(d===void 0)d=THREE.BillboardBlending;c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:f,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,f=this.lensFlares.length,c,d=-this.positionScreen.x*2,g=-this.positionScreen.y*2;for(b=0;b<f;b++){c=this.lensFlares[b];c.x=this.positionScreen.x+d*c.distance;c.y=this.positionScreen.y+g*c.distance;c.wantedRotation=c.x*Math.PI*0.25;c.rotation+=(c.wantedRotation-c.rotation)*0.25}};
THREE.Material=function(b){this.id=THREE.MaterialCounter.value++;b=b||{};this.opacity=b.opacity!==void 0?b.opacity:1;this.transparent=b.transparent!==void 0?b.transparent:!1;this.blending=b.blending!==void 0?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==void 0?b.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==void 0?b.linewidth:1;this.linecap=b.linecap!==void 0?b.linecap:"round";this.linejoin=b.linejoin!==void 0?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==
void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};
THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==
void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};
THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==void 0?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==void 0?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==void 0?b.shininess:30;this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;
this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==
void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.fragmentShader=b.fragmentShader!==void 0?b.fragmentShader:"void main() {}";this.vertexShader=b.vertexShader!==void 0?b.vertexShader:"void main() {}";this.uniforms=b.uniforms!==void 0?b.uniforms:{};this.attributes=b.attributes;this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.fog=
b.fog!==void 0?b.fog:!1;this.lights=b.lights!==void 0?b.lights:!1;this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.size=b.size!==void 0?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==void 0?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ShadowVolumeDynamicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.shading=b.shading!==
void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};
THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.Texture=function(b,f,c,d,g,h){this.image=b;this.mapping=f!==void 0?f:new THREE.UVMapping;this.wrapS=c!==void 0?c:THREE.ClampToEdgeWrapping;this.wrapT=d!==void 0?d:THREE.ClampToEdgeWrapping;this.magFilter=g!==void 0?g:THREE.LinearFilter;this.minFilter=h!==void 0?h:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.needsUpdate=!1};
THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;
THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.materials=b instanceof Array?b:[b]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;
THREE.ParticleSystem=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(b,f,c){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.type=c!=void 0?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;
THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f&&f.length?f:[f];this.overdraw=this.doubleSided=this.flipSided=!1;if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=b.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0;c<this.geometry.morphTargets.length;c++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[c].name]=
c}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==void 0)return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(b,f,c){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.skinMatrix.multiply(b,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var d,g=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(d=0;d<g;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.skinMatrix,f,c):b.update(this.matrixWorld,!0,c)}}else for(d=0;d<g;d++)this.children[d].update(this.skinMatrix,
f,c)};THREE.Bone.prototype.addChild=function(b){if(this.children.indexOf(b)===-1&&(b.parent!==void 0&&b.parent.removeChild(b),b.parent=this,this.children.push(b),!(b instanceof THREE.Bone)))this.hasNoneBoneChildren=!0};
THREE.SkinnedMesh=function(b,f){THREE.Mesh.call(this,b,f);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var c,d,g,h,n,o;if(this.geometry.bones!==void 0){for(c=0;c<this.geometry.bones.length;c++){g=this.geometry.bones[c];h=g.pos;n=g.rotq;o=g.scl;d=this.addBone();d.name=g.name;d.position.set(h[0],h[1],h[2]);d.quaternion.set(n[0],n[1],n[2],n[3]);d.useQuaternion=!0;o!==void 0?d.scale.set(o[0],o[1],o[2]):d.scale.set(1,1,1)}for(c=0;c<this.bones.length;c++){g=this.geometry.bones[c];
d=this.bones[c];g.parent===-1?this.addChild(d):this.bones[g.parent].addChild(d)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(b,f,c){if(this.visible){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var d,g=this.children.length;for(d=0;d<g;d++){b=this.children[d];b instanceof THREE.Bone?b.update(this.identityMatrix,!1,c):b.update(this.matrixWorld,f,c)}c=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(f=0;f<c;f++)ba[f].skinMatrix.flattenToArrayOffset(bm,
f*16)}};THREE.SkinnedMesh.prototype.addBone=function(b){b===void 0&&(b=new THREE.Bone(this));this.bones.push(b);return b};
THREE.SkinnedMesh.prototype.pose=function(){this.update(void 0,!0);for(var b,f=[],c=0;c<this.bones.length;c++){b=this.bones[c];f.push(THREE.Matrix4.makeInvert(b.skinMatrix));b.skinMatrix.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var d;for(b=0;b<this.geometry.skinIndices.length;b++){c=this.geometry.vertices[b].position;var g=this.geometry.skinIndices[b].x,h=this.geometry.skinIndices[b].y;d=new THREE.Vector3(c.x,
c.y,c.z);this.geometry.skinVerticesA.push(f[g].multiplyVector3(d));d=new THREE.Vector3(c.x,c.y,c.z);this.geometry.skinVerticesB.push(f[h].multiplyVector3(d));this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y!==1&&(c=(1-(this.geometry.skinWeights[b].x+this.geometry.skinWeights[b].y))*0.5,this.geometry.skinWeights[b].x+=c,this.geometry.skinWeights[b].y+=c)}}};
THREE.Ribbon=function(b,f){THREE.Object3D.call(this);this.geometry=b;this.materials=f instanceof Array?f:[f];this.doubleSided=this.flipSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(b,f,c,d){THREE.Object3D.call(this);this.isPlaying=this.isAddedToDOM=this.isLoaded=!1;this.duration=-1;this.radius=f!==void 0?Math.abs(f):100;this.volume=Math.min(1,Math.max(0,c!==void 0?c:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=d!==void 0?d:!0;this.sources=b instanceof Array?b:[b];var g;c=this.sources.length;for(b=0;b<c;b++)if(f=this.sources[b],f.toLowerCase(),f.indexOf(".mp3")!==-1?g="audio/mpeg":
f.indexOf(".ogg")!==-1?g="audio/ogg":f.indexOf(".wav")!==-1&&(g="audio/wav"),this.domElement.canPlayType(g)){g=document.createElement("source");g.src=this.sources[b];this.domElement.THREESound=this;this.domElement.appendChild(g);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var b=this.THREESound;if(!b.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);b.isLoaded=!0;b.duration=this.duration;b.isPlaying&&b.play()}};THREE.Sound.prototype.addToDOM=function(b){this.isAddedToDOM=!0;b.appendChild(this.domElement)};THREE.Sound.prototype.play=function(b){this.isPlaying=!0;if(this.isLoaded&&(this.domElement.play(),b))this.domElement.currentTime=b%this.duration};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(b){b=b.length();this.domElement.volume=b<=this.radius?this.volume*(1-b/this.radius):0};
THREE.Sound.prototype.update=function(b,f,c){this.matrixAutoUpdate&&(this.matrix.setPosition(this.position),f=!0);if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}var d=this.children.length;for(b=0;b<d;b++)this.children[b].update(this.matrixWorld,f,c)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(b,f){f===void 0&&(f=0);f=Math.abs(f);for(var c=0;c<this.LODs.length;c++)if(f<this.LODs[c].visibleAtDistance)break;this.LODs.splice(c,0,{visibleAtDistance:f,object3D:b});this.addChild(b)};
THREE.LOD.prototype.update=function(b,f,c){this.matrixAutoUpdate&&(f|=this.updateMatrix());if(f||this.matrixWorldNeedsUpdate){b?this.matrixWorld.multiply(b,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;f=!0}if(this.LODs.length>1){b=c.matrixWorldInverse;b=-(b.n31*this.position.x+b.n32*this.position.y+b.n33*this.position.z+b.n34);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length;d++)if(b>=this.LODs[d].visibleAtDistance){this.LODs[d-1].object3D.visible=
!1;this.LODs[d].object3D.visible=!0}else break;for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}for(b=0;b<this.children.length;b++)this.children[b].update(this.matrixWorld,f,c)};THREE.ShadowVolume=function(b,f){b instanceof THREE.Mesh?(THREE.Mesh.call(this,b.geometry,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]),b.addChild(this)):THREE.Mesh.call(this,b,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};
THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var b,f,c,d,g,h,n,o,m,p,u,v,w,x,y=new THREE.Geometry;y.vertices=this.geometry.vertices;d=y.faces=this.geometry.faces;var A=y.egdes=this.geometry.edges,B=y.edgeFaces=[];g=0;var C=[];b=0;for(f=d.length;b<f;b++)if(c=d[b],C.push(g),g+=c instanceof THREE.Face3?3:4,c.vertexNormals[0]=c.normal,c.vertexNormals[1]=c.normal,c.vertexNormals[2]=c.normal,c instanceof THREE.Face4)c.vertexNormals[3]=
c.normal;b=0;for(f=A.length;b<f;b++){o=A[b];c=o.faces[0];d=o.faces[1];g=o.faceIndices[0];h=o.faceIndices[1];n=o.vertexIndices[0];o=o.vertexIndices[1];c.a===n?(m="a",u=C[g]+0):c.b===n?(m="b",u=C[g]+1):c.c===n?(m="c",u=C[g]+2):c.d===n&&(m="d",u=C[g]+3);c.a===o?(m+="a",v=C[g]+0):c.b===o?(m+="b",v=C[g]+1):c.c===o?(m+="c",v=C[g]+2):c.d===o&&(m+="d",v=C[g]+3);d.a===n?(p="a",w=C[h]+0):d.b===n?(p="b",w=C[h]+1):d.c===n?(p="c",w=C[h]+2):d.d===n&&(p="d",w=C[h]+3);d.a===o?(p+="a",x=C[h]+0):d.b===o?(p+="b",x=
C[h]+1):d.c===o?(p+="c",x=C[h]+2):d.d===o&&(p+="d",x=C[h]+3);m==="ac"||m==="ad"||m==="ca"||m==="da"?u>v&&(c=u,u=v,v=c):u<v&&(c=u,u=v,v=c);p==="ac"||p==="ad"||p==="ca"||p==="da"?w>x&&(c=w,w=x,x=c):w<x&&(c=w,w=x,x=c);c=new THREE.Face4(u,v,w,x);c.normal.set(1,0,0);B.push(c)}this.geometry=y}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)};
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(b){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=b.boundingSphere;this.geometry.edgeFaces=[];var f=this.geometry.vertices,c=this.geometry.faces,d=this.geometry.edgeFaces,g=b.faces;b=b.vertices;var h=g.length,n,o,m,p,u,v=["a","b","c","d"];for(m=0;m<h;m++){o=f.length;n=g[m];n instanceof THREE.Face4?(p=4,o=new THREE.Face4(o,o+1,o+2,o+3)):(p=3,o=new THREE.Face3(o,o+1,o+2));o.normal.copy(n.normal);c.push(o);
for(o=0;o<p;o++){u=b[n[v[o]]];f.push(new THREE.Vertex(u.position.clone()))}}for(h=0;h<g.length-1;h++){b=c[h];for(n=h+1;n<g.length;n++){o=c[n];o=this.facesShareEdge(f,b,o);o!==void 0&&(o=new THREE.Face4(o.indices[0],o.indices[3],o.indices[2],o.indices[1]),o.normal.set(1,0,0),d.push(o))}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(b,f,c){var d,g,h,n,o,m,p,u,v,w,x,y,A,B=0,C=["a","b","c","d"];d=f instanceof THREE.Face4?4:3;g=c instanceof THREE.Face4?4:3;for(y=0;y<d;y++){h=f[C[y]];o=b[h];for(A=0;A<g;A++)if(n=c[C[A]],m=b[n],Math.abs(o.position.x-m.position.x)<1.0E-4&&Math.abs(o.position.y-m.position.y)<1.0E-4&&Math.abs(o.position.z-m.position.z)<1.0E-4&&(B++,B===1&&(p=o,u=m,v=h,w=n,x=C[y]),B===2))return x+=C[y],x==="ad"||x==="ac"?{faces:[f,c],vertices:[p,u,m,o],indices:[v,w,
n,h],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[f,c],vertices:[p,o,m,u],indices:[v,h,n,w],vertexTypes:[1,1,2,2],extrudable:!0}}};
THREE.Sprite=function(b){THREE.Object3D.call(this);if(b.material!==void 0){this.material=b.material;this.map=void 0;this.blending=material.blending}else if(b.map!==void 0){this.map=b.map instanceof THREE.Texture?b.map:ImageUtils.loadTexture(b.map);this.material=void 0;this.blending=b.blending!==void 0?b.blending:THREE.NormalBlending}this.useScreenCoordinates=b.useScreenCoordinates!==void 0?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==void 0?b.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=
b.affectedByDistance!==void 0?b.affectedByDistance:!this.useScreenCoordinates;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;
THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);
THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);
THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(b){this.supr.addChild.call(this,b);this.addChildRecurse(b)};
THREE.Scene.prototype.addChildRecurse=function(b){if(b instanceof THREE.Light)this.lights.indexOf(b)===-1&&this.lights.push(b);else if(b instanceof THREE.Sound)this.sounds.indexOf(b)===-1&&this.sounds.push(b);else if(!(b instanceof THREE.Camera||b instanceof THREE.Bone)&&this.objects.indexOf(b)===-1){this.objects.push(b);this.__objectsAdded.push(b)}for(var f=0;f<b.children.length;f++)this.addChildRecurse(b.children[f])};
THREE.Scene.prototype.removeChild=function(b){this.supr.removeChild.call(this,b);this.removeChildRecurse(b)};THREE.Scene.prototype.removeChildRecurse=function(b){if(b instanceof THREE.Light){var f=this.lights.indexOf(b);f!==-1&&this.lights.splice(f,1)}else b instanceof THREE.Sound?(f=this.sounds.indexOf(b),f!==-1&&this.sounds.splice(f,1)):b instanceof THREE.Camera||(f=this.objects.indexOf(b),f!==-1&&(this.objects.splice(f,1),this.__objectsRemoved.push(b)));for(f=0;f<b.children.length;f++)this.removeChildRecurse(b.children[f])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(b,f,c){this.color=new THREE.Color(b);this.near=f||1;this.far=c||1E3};THREE.FogExp2=function(b,f){this.color=new THREE.Color(b);this.density=f!==void 0?f:2.5E-4};
THREE.Projector=function(){function b(){var V=o[n]=o[n]||new THREE.RenderableVertex;n++;return V}function f(V,S){return S.z-V.z}var c,d,g=[],h,n,o=[],m,p,u=[],v,w=[],x,y,A=[],B,C,E=[],z=new THREE.Vector4,H=new THREE.Vector4,G=new THREE.Matrix4,F=new THREE.Matrix4,T=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],$=new THREE.Vector4,W=new THREE.Vector4;this.projectVector=function(V,S){G.multiply(S.projectionMatrix,S.matrixWorldInverse);
G.multiplyVector3(V);return V};this.unprojectVector=function(V,S){G.multiply(S.matrixWorld,THREE.Matrix4.makeInvert(S.projectionMatrix));G.multiplyVector3(V);return V};this.projectObjects=function(V,S,t){S=[];var M,I,P;d=0;I=V.objects;V=0;for(M=I.length;V<M;V++){P=I[V];var O;if(!(O=!P.visible))if(O=P instanceof THREE.Mesh){a:{O=void 0;for(var R=P.matrixWorld,ca=-P.geometry.boundingSphere.radius*Math.max(P.scale.x,Math.max(P.scale.y,P.scale.z)),U=0;U<6;U++)if(O=T[U].x*R.n14+T[U].y*R.n24+T[U].z*R.n34+
T[U].w,O<=ca){O=!1;break a}O=!0}O=!O}if(!O){O=g[d]=g[d]||new THREE.RenderableObject;d++;c=O;z.copy(P.position);G.multiplyVector3(z);c.object=P;c.z=z.z;S.push(c)}}t&&S.sort(f);return S};this.projectScene=function(V,S,t){var M=[],I=S.near,P=S.far,O,R,ca,U,ea,la,ta,xa,ya,oa,Fa,Ca,Ga,Ha,wa,aa,ia;C=y=v=p=0;S.matrixAutoUpdate&&S.update(void 0,!0);V.update(void 0,!1,S);G.multiply(S.projectionMatrix,S.matrixWorldInverse);T[0].set(G.n41-G.n11,G.n42-G.n12,G.n43-G.n13,G.n44-G.n14);T[1].set(G.n41+G.n11,G.n42+
G.n12,G.n43+G.n13,G.n44+G.n14);T[2].set(G.n41+G.n21,G.n42+G.n22,G.n43+G.n23,G.n44+G.n24);T[3].set(G.n41-G.n21,G.n42-G.n22,G.n43-G.n23,G.n44-G.n24);T[4].set(G.n41-G.n31,G.n42-G.n32,G.n43-G.n33,G.n44-G.n34);T[5].set(G.n41+G.n31,G.n42+G.n32,G.n43+G.n33,G.n44+G.n34);for(O=0;O<6;O++){ya=T[O];ya.divideScalar(Math.sqrt(ya.x*ya.x+ya.y*ya.y+ya.z*ya.z))}ya=this.projectObjects(V,S,!0);V=0;for(O=ya.length;V<O;V++)if(oa=ya[V].object,oa.visible)if(Fa=oa.matrixWorld,Ca=oa.matrixRotationWorld,Ga=oa.materials,Ha=
oa.overdraw,n=0,oa instanceof THREE.Mesh){wa=oa.geometry;U=wa.vertices;aa=wa.faces;wa=wa.faceVertexUvs;R=0;for(ca=U.length;R<ca;R++){h=b();h.positionWorld.copy(U[R].position);Fa.multiplyVector3(h.positionWorld);h.positionScreen.copy(h.positionWorld);G.multiplyVector4(h.positionScreen);h.positionScreen.x/=h.positionScreen.w;h.positionScreen.y/=h.positionScreen.w;h.visible=h.positionScreen.z>I&&h.positionScreen.z<P}U=0;for(R=aa.length;U<R;U++){ca=aa[U];if(ca instanceof THREE.Face3)if(ea=o[ca.a],la=
o[ca.b],ta=o[ca.c],ea.visible&&la.visible&&ta.visible&&(oa.doubleSided||oa.flipSided!=(ta.positionScreen.x-ea.positionScreen.x)*(la.positionScreen.y-ea.positionScreen.y)-(ta.positionScreen.y-ea.positionScreen.y)*(la.positionScreen.x-ea.positionScreen.x)<0)){xa=u[p]=u[p]||new THREE.RenderableFace3;p++;m=xa;m.v1.copy(ea);m.v2.copy(la);m.v3.copy(ta)}else continue;else if(ca instanceof THREE.Face4)if(ea=o[ca.a],la=o[ca.b],ta=o[ca.c],xa=o[ca.d],ea.visible&&la.visible&&ta.visible&&xa.visible&&(oa.doubleSided||
oa.flipSided!=((xa.positionScreen.x-ea.positionScreen.x)*(la.positionScreen.y-ea.positionScreen.y)-(xa.positionScreen.y-ea.positionScreen.y)*(la.positionScreen.x-ea.positionScreen.x)<0||(la.positionScreen.x-ta.positionScreen.x)*(xa.positionScreen.y-ta.positionScreen.y)-(la.positionScreen.y-ta.positionScreen.y)*(xa.positionScreen.x-ta.positionScreen.x)<0))){ia=w[v]=w[v]||new THREE.RenderableFace4;v++;m=ia;m.v1.copy(ea);m.v2.copy(la);m.v3.copy(ta);m.v4.copy(xa)}else continue;m.normalWorld.copy(ca.normal);
Ca.multiplyVector3(m.normalWorld);m.centroidWorld.copy(ca.centroid);Fa.multiplyVector3(m.centroidWorld);m.centroidScreen.copy(m.centroidWorld);G.multiplyVector3(m.centroidScreen);ta=ca.vertexNormals;ea=0;for(la=ta.length;ea<la;ea++){xa=m.vertexNormalsWorld[ea];xa.copy(ta[ea]);Ca.multiplyVector3(xa)}ea=0;for(la=wa.length;ea<la;ea++)if(ia=wa[ea][U]){ta=0;for(xa=ia.length;ta<xa;ta++)m.uvs[ea][ta]=ia[ta]}m.meshMaterials=Ga;m.faceMaterials=ca.materials;m.overdraw=Ha;m.z=m.centroidScreen.z;M.push(m)}}else if(oa instanceof
THREE.Line){F.multiply(G,Fa);U=oa.geometry.vertices;ea=b();ea.positionScreen.copy(U[0].position);F.multiplyVector4(ea.positionScreen);R=1;for(ca=U.length;R<ca;R++){ea=b();ea.positionScreen.copy(U[R].position);F.multiplyVector4(ea.positionScreen);la=o[n-2];$.copy(ea.positionScreen);W.copy(la.positionScreen);Fa=$;Ca=W;Ga=0;Ha=1;wa=Fa.z+Fa.w;aa=Ca.z+Ca.w;ia=-Fa.z+Fa.w;var na=-Ca.z+Ca.w;if(wa>=0&&aa>=0&&ia>=0&&na>=0||(wa<0&&aa<0||ia<0&&na<0?0:(wa<0?Ga=Math.max(Ga,wa/(wa-aa)):aa<0&&(Ha=Math.min(Ha,wa/
(wa-aa))),ia<0?Ga=Math.max(Ga,ia/(ia-na)):na<0&&(Ha=Math.min(Ha,ia/(ia-na))),Ha<Ga?!1:(Fa.lerpSelf(Ca,Ga),Ca.lerpSelf(Fa,1-Ha),!0)))){$.multiplyScalar(1/$.w);W.multiplyScalar(1/W.w);Fa=A[y]=A[y]||new THREE.RenderableLine;y++;x=Fa;x.v1.positionScreen.copy($);x.v2.positionScreen.copy(W);x.z=Math.max($.z,W.z);x.materials=oa.materials;M.push(x)}}}else if(oa instanceof THREE.Particle&&(H.set(oa.matrixWorld.n14,oa.matrixWorld.n24,oa.matrixWorld.n34,1),G.multiplyVector4(H),H.z/=H.w,H.z>0&&H.z<1)){Fa=E[C]=
E[C]||new THREE.RenderableParticle;C++;B=Fa;B.x=H.x/H.w;B.y=H.y/H.w;B.z=H.z;B.rotation=oa.rotation.z;B.scale.x=oa.scale.x*Math.abs(B.x-(H.x+S.projectionMatrix.n11)/(H.w+S.projectionMatrix.n14));B.scale.y=oa.scale.y*Math.abs(B.y-(H.y+S.projectionMatrix.n22)/(H.w+S.projectionMatrix.n24));B.materials=oa.materials;M.push(B)}t&&M.sort(f);return M}};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(b,f,c){c&&b.update(void 0,!1,f);c=b.sounds;var d,g=c.length;for(d=0;d<g;d++){b=c[d];this.soundPosition.set(b.matrixWorld.n14,b.matrixWorld.n24,b.matrixWorld.n34);this.soundPosition.subSelf(f.position);b.isPlaying&&b.isLoaded&&(b.isAddedToDOM||b.addToDOM(this.domElement),b.calculateVolumeAndPan(this.soundPosition))}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",
lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(b){var f,c,d,g={};for(f=0;f<b.length;f++)for(c in d=this.clone(b[f]),d)g[c]=d[c];return g},clone:function(b){var f,c,d,g={};for(f in b)for(c in g[f]={},b[f]){d=b[f][c];g[f][c]=d instanceof THREE.Color||d instanceof THREE.Vector3||d instanceof THREE.Texture?d.clone():d}return g}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",
value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},
map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},
lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},
sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",
fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},
shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},
depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},
fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,
THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",
THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function f(D,X,L){var J,N,fa,da=D.vertices,Z=da.length,ha=D.colors,ma=ha.length,Q=D.__vertexArray,ga=D.__colorArray,ka=D.__sortArray,sa=D.__dirtyVertices,qa=D.__dirtyColors;if(L.sortParticles){Fa.multiplySelf(L.matrixWorld);for(J=0;J<Z;J++){N=da[J].position;Ha.copy(N);Fa.multiplyVector3(Ha);ka[J]=[Ha.z,J]}ka.sort(function(Ia,za){return za[0]-Ia[0]});for(J=0;J<Z;J++){N=da[ka[J][1]].position;fa=J*3;Q[fa]=N.x;Q[fa+1]=N.y;Q[fa+2]=N.z}for(J=0;J<ma;J++){fa=J*3;color=ha[ka[J][1]];
ga[fa]=color.r;ga[fa+1]=color.g;ga[fa+2]=color.b}}else{if(sa)for(J=0;J<Z;J++){N=da[J].position;fa=J*3;Q[fa]=N.x;Q[fa+1]=N.y;Q[fa+2]=N.z}if(qa)for(J=0;J<ma;J++){color=ha[J];fa=J*3;ga[fa]=color.r;ga[fa+1]=color.g;ga[fa+2]=color.b}}if(sa||L.sortParticles){t.bindBuffer(t.ARRAY_BUFFER,D.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,Q,X)}if(qa||L.sortParticles){t.bindBuffer(t.ARRAY_BUFFER,D.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,ga,X)}}function c(D,X,L,J,N){J.program||S.initMaterial(J,X,L,N);
var fa=J.program,da=fa.uniforms,Z=J.uniforms;fa!=I&&(t.useProgram(fa),I=fa);t.uniformMatrix4fv(da.projectionMatrix,!1,Ca);if(L&&(J instanceof THREE.MeshBasicMaterial||J instanceof THREE.MeshLambertMaterial||J instanceof THREE.MeshPhongMaterial||J instanceof THREE.LineBasicMaterial||J instanceof THREE.ParticleBasicMaterial||J.fog))if(Z.fogColor.value=L.color,L instanceof THREE.Fog){Z.fogNear.value=L.near;Z.fogFar.value=L.far}else if(L instanceof THREE.FogExp2)Z.fogDensity.value=L.density;if(J instanceof
THREE.MeshPhongMaterial||J instanceof THREE.MeshLambertMaterial||J.lights){var ha,ma,Q=0,ga=0,ka=0,sa,qa,Ia,za,Ja=wa,Xa=Ja.directional.colors,ib=Ja.directional.positions,Aa=Ja.point.colors,Ba=Ja.point.positions,Da=Ja.point.distances,Qa=0,Y=0;L=ma=0;for(ha=X.length;L<ha;L++)if(ma=X[L],sa=ma.color,qa=ma.position,Ia=ma.intensity,za=ma.distance,ma instanceof THREE.AmbientLight){Q+=sa.r;ga+=sa.g;ka+=sa.b}else if(ma instanceof THREE.DirectionalLight){za=Qa*3;Xa[za]=sa.r*Ia;Xa[za+1]=sa.g*Ia;Xa[za+2]=sa.b*
Ia;ib[za]=qa.x;ib[za+1]=qa.y;ib[za+2]=qa.z;Qa+=1}else if(ma instanceof THREE.PointLight){ma=Y*3;Aa[ma]=sa.r*Ia;Aa[ma+1]=sa.g*Ia;Aa[ma+2]=sa.b*Ia;Ba[ma]=qa.x;Ba[ma+1]=qa.y;Ba[ma+2]=qa.z;Da[Y]=za;Y+=1}for(L=Qa*3;L<Xa.length;L++)Xa[L]=0;for(L=Y*3;L<Aa.length;L++)Aa[L]=0;Ja.point.length=Y;Ja.directional.length=Qa;Ja.ambient[0]=Q;Ja.ambient[1]=ga;Ja.ambient[2]=ka;L=wa;Z.enableLighting.value=L.directional.length+L.point.length;Z.ambientLightColor.value=L.ambient;Z.directionalLightColor.value=L.directional.colors;
Z.directionalLightDirection.value=L.directional.positions;Z.pointLightColor.value=L.point.colors;Z.pointLightPosition.value=L.point.positions;Z.pointLightDistance.value=L.point.distances}if(J instanceof THREE.MeshBasicMaterial||J instanceof THREE.MeshLambertMaterial||J instanceof THREE.MeshPhongMaterial){Z.diffuse.value=J.color;Z.opacity.value=J.opacity;(Z.map.texture=J.map)&&Z.offsetRepeat.value.set(J.map.offset.x,J.map.offset.y,J.map.repeat.x,J.map.repeat.y);Z.lightMap.texture=J.lightMap;Z.envMap.texture=
J.envMap;Z.reflectivity.value=J.reflectivity;Z.refractionRatio.value=J.refractionRatio;Z.combine.value=J.combine;Z.useRefract.value=J.envMap&&J.envMap.mapping instanceof THREE.CubeRefractionMapping}if(J instanceof THREE.LineBasicMaterial){Z.diffuse.value=J.color;Z.opacity.value=J.opacity}else if(J instanceof THREE.ParticleBasicMaterial){Z.psColor.value=J.color;Z.opacity.value=J.opacity;Z.size.value=J.size;Z.scale.value=aa.height/2;Z.map.texture=J.map}else if(J instanceof THREE.MeshPhongMaterial){Z.ambient.value=
J.ambient;Z.specular.value=J.specular;Z.shininess.value=J.shininess}else if(J instanceof THREE.MeshDepthMaterial){Z.mNear.value=D.near;Z.mFar.value=D.far;Z.opacity.value=J.opacity}else if(J instanceof THREE.MeshNormalMaterial)Z.opacity.value=J.opacity;for(var pa in Z)if(ga=fa.uniforms[pa])if(ha=Z[pa],Q=ha.type,L=ha.value,Q=="i")t.uniform1i(ga,L);else if(Q=="f")t.uniform1f(ga,L);else if(Q=="fv1")t.uniform1fv(ga,L);else if(Q=="fv")t.uniform3fv(ga,L);else if(Q=="v2")t.uniform2f(ga,L.x,L.y);else if(Q==
"v3")t.uniform3f(ga,L.x,L.y,L.z);else if(Q=="v4")t.uniform4f(ga,L.x,L.y,L.z,L.w);else if(Q=="c")t.uniform3f(ga,L.r,L.g,L.b);else if(Q=="t"&&(t.uniform1i(ga,L),ha=ha.texture))if(ha.image instanceof Array&&ha.image.length==6){if(ha.image.length==6){if(ha.needsUpdate){if(ha.__webglInit){t.bindTexture(t.TEXTURE_CUBE_MAP,ha.image.__webglTextureCube);for(Q=0;Q<6;++Q)t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,0,0,t.RGBA,t.UNSIGNED_BYTE,ha.image[Q])}else{ha.image.__webglTextureCube=t.createTexture();
t.bindTexture(t.TEXTURE_CUBE_MAP,ha.image.__webglTextureCube);for(Q=0;Q<6;++Q)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ha.image[Q]);ha.__webglInit=!0}G(t.TEXTURE_CUBE_MAP,ha,ha.image[0]);t.bindTexture(t.TEXTURE_CUBE_MAP,null);ha.needsUpdate=!1}t.activeTexture(t.TEXTURE0+L);t.bindTexture(t.TEXTURE_CUBE_MAP,ha.image.__webglTextureCube)}}else F(ha,L);t.uniformMatrix4fv(da.modelViewMatrix,!1,N._modelViewMatrixArray);t.uniformMatrix3fv(da.normalMatrix,!1,N._normalMatrixArray);
(J instanceof THREE.MeshShaderMaterial||J instanceof THREE.MeshPhongMaterial||J.envMap)&&da.cameraPosition!==null&&t.uniform3f(da.cameraPosition,D.position.x,D.position.y,D.position.z);(J instanceof THREE.MeshShaderMaterial||J.envMap||J.skinning)&&da.objectMatrix!==null&&t.uniformMatrix4fv(da.objectMatrix,!1,N._objectMatrixArray);(J instanceof THREE.MeshPhongMaterial||J instanceof THREE.MeshLambertMaterial||J instanceof THREE.MeshShaderMaterial||J.skinning)&&da.viewMatrix!==null&&t.uniformMatrix4fv(da.viewMatrix,
!1,Ga);if(J instanceof THREE.ShadowVolumeDynamicMaterial){D=Z.directionalLightDirection.value;D[0]=-X[1].position.x;D[1]=-X[1].position.y;D[2]=-X[1].position.z;t.uniform3fv(da.directionalLightDirection,D);t.uniformMatrix4fv(da.objectMatrix,!1,N._objectMatrixArray);t.uniformMatrix4fv(da.viewMatrix,!1,Ga)}J.skinning&&(t.uniformMatrix4fv(da.cameraInverseMatrix,!1,Ga),t.uniformMatrix4fv(da.boneGlobalMatrices,!1,N.boneMatrices));return fa}function d(D,X,L,J,N,fa){if(J.opacity!=0){var da;D=c(D,X,L,J,fa).attributes;
if(!J.morphTargets&&D.position>=0){t.bindBuffer(t.ARRAY_BUFFER,N.__webglVertexBuffer);t.vertexAttribPointer(D.position,3,t.FLOAT,!1,0,0)}else{X=J.program.attributes;fa.morphTargetBase!==-1?(t.bindBuffer(t.ARRAY_BUFFER,N.__webglMorphTargetsBuffers[fa.morphTargetBase]),t.vertexAttribPointer(X.position,3,t.FLOAT,!1,0,0)):X.position>=0&&(t.bindBuffer(t.ARRAY_BUFFER,N.__webglVertexBuffer),t.vertexAttribPointer(X.position,3,t.FLOAT,!1,0,0));if(fa.morphTargetForcedOrder.length){L=0;for(var Z=fa.morphTargetForcedOrder,
ha=fa.morphTargetInfluences;L<J.numSupportedMorphTargets&&L<Z.length;){t.bindBuffer(t.ARRAY_BUFFER,N.__webglMorphTargetsBuffers[Z[L]]);t.vertexAttribPointer(X["morphTarget"+L],3,t.FLOAT,!1,0,0);fa.__webglMorphTargetInfluences[L]=ha[Z[L]];L++}}else{Z=[];var ma=-1,Q=0;ha=fa.morphTargetInfluences;var ga,ka=ha.length;L=0;for(fa.morphTargetBase!==-1&&(Z[fa.morphTargetBase]=!0);L<J.numSupportedMorphTargets;){for(ga=0;ga<ka;ga++)!Z[ga]&&ha[ga]>ma&&(Q=ga,ma=ha[Q]);t.bindBuffer(t.ARRAY_BUFFER,N.__webglMorphTargetsBuffers[Q]);
t.vertexAttribPointer(X["morphTarget"+L],3,t.FLOAT,!1,0,0);fa.__webglMorphTargetInfluences[L]=ma;Z[Q]=1;ma=-1;L++}}J.program.uniforms.morphTargetInfluences!==null&&t.uniform1fv(J.program.uniforms.morphTargetInfluences,fa.__webglMorphTargetInfluences)}if(N.__webglCustomAttributes)for(da in N.__webglCustomAttributes)D[da]>=0&&(X=N.__webglCustomAttributes[da],t.bindBuffer(t.ARRAY_BUFFER,X.buffer),t.vertexAttribPointer(D[da],X.size,t.FLOAT,!1,0,0));D.color>=0&&(t.bindBuffer(t.ARRAY_BUFFER,N.__webglColorBuffer),
t.vertexAttribPointer(D.color,3,t.FLOAT,!1,0,0));D.normal>=0&&(t.bindBuffer(t.ARRAY_BUFFER,N.__webglNormalBuffer),t.vertexAttribPointer(D.normal,3,t.FLOAT,!1,0,0));D.tangent>=0&&(t.bindBuffer(t.ARRAY_BUFFER,N.__webglTangentBuffer),t.vertexAttribPointer(D.tangent,4,t.FLOAT,!1,0,0));D.uv>=0&&(N.__webglUVBuffer?(t.bindBuffer(t.ARRAY_BUFFER,N.__webglUVBuffer),t.vertexAttribPointer(D.uv,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(D.uv)):t.disableVertexAttribArray(D.uv));D.uv2>=0&&(N.__webglUV2Buffer?(t.bindBuffer(t.ARRAY_BUFFER,
N.__webglUV2Buffer),t.vertexAttribPointer(D.uv2,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(D.uv2)):t.disableVertexAttribArray(D.uv2));J.skinning&&D.skinVertexA>=0&&D.skinVertexB>=0&&D.skinIndex>=0&&D.skinWeight>=0&&(t.bindBuffer(t.ARRAY_BUFFER,N.__webglSkinVertexABuffer),t.vertexAttribPointer(D.skinVertexA,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,N.__webglSkinVertexBBuffer),t.vertexAttribPointer(D.skinVertexB,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,N.__webglSkinIndicesBuffer),t.vertexAttribPointer(D.skinIndex,
4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,N.__webglSkinWeightsBuffer),t.vertexAttribPointer(D.skinWeight,4,t.FLOAT,!1,0,0));fa instanceof THREE.Mesh?(J.wireframe?(t.lineWidth(J.wireframeLinewidth),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,N.__webglLineBuffer),t.drawElements(t.LINES,N.__webglLineCount,t.UNSIGNED_SHORT,0)):(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,N.__webglFaceBuffer),t.drawElements(t.TRIANGLES,N.__webglFaceCount,t.UNSIGNED_SHORT,0)),S.data.vertices+=N.__webglFaceCount,S.data.faces+=N.__webglFaceCount/
3,S.data.drawCalls++):fa instanceof THREE.Line?(fa=fa.type==THREE.LineStrip?t.LINE_STRIP:t.LINES,t.lineWidth(J.linewidth),t.drawArrays(fa,0,N.__webglLineCount),S.data.drawCalls++):fa instanceof THREE.ParticleSystem?(t.drawArrays(t.POINTS,0,N.__webglParticleCount),S.data.drawCalls++):fa instanceof THREE.Ribbon&&(t.drawArrays(t.TRIANGLE_STRIP,0,N.__webglVertexCount),S.data.drawCalls++)}}function g(D,X,L){if(!D.__webglVertexBuffer)D.__webglVertexBuffer=t.createBuffer();if(!D.__webglNormalBuffer)D.__webglNormalBuffer=
t.createBuffer();D.hasPos&&(t.bindBuffer(t.ARRAY_BUFFER,D.__webglVertexBuffer),t.bufferData(t.ARRAY_BUFFER,D.positionArray,t.DYNAMIC_DRAW),t.enableVertexAttribArray(X.attributes.position),t.vertexAttribPointer(X.attributes.position,3,t.FLOAT,!1,0,0));if(D.hasNormal){t.bindBuffer(t.ARRAY_BUFFER,D.__webglNormalBuffer);if(L==THREE.FlatShading){var J,N,fa,da,Z,ha,ma,Q,ga,ka,sa=D.count*3;for(ka=0;ka<sa;ka+=9){L=D.normalArray;J=L[ka];N=L[ka+1];fa=L[ka+2];da=L[ka+3];ha=L[ka+4];Q=L[ka+5];Z=L[ka+6];ma=L[ka+
7];ga=L[ka+8];J=(J+da+Z)/3;N=(N+ha+ma)/3;fa=(fa+Q+ga)/3;L[ka]=J;L[ka+1]=N;L[ka+2]=fa;L[ka+3]=J;L[ka+4]=N;L[ka+5]=fa;L[ka+6]=J;L[ka+7]=N;L[ka+8]=fa}}t.bufferData(t.ARRAY_BUFFER,D.normalArray,t.DYNAMIC_DRAW);t.enableVertexAttribArray(X.attributes.normal);t.vertexAttribPointer(X.attributes.normal,3,t.FLOAT,!1,0,0)}t.drawArrays(t.TRIANGLES,0,D.count);D.count=0}function h(D){if(R!=D.doubleSided){D.doubleSided?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE);R=D.doubleSided}if(ca!=D.flipSided){D.flipSided?
t.frontFace(t.CW):t.frontFace(t.CCW);ca=D.flipSided}}function n(D){ea!=D&&(D?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),ea=D)}function o(D){oa[0].set(D.n41-D.n11,D.n42-D.n12,D.n43-D.n13,D.n44-D.n14);oa[1].set(D.n41+D.n11,D.n42+D.n12,D.n43+D.n13,D.n44+D.n14);oa[2].set(D.n41+D.n21,D.n42+D.n22,D.n43+D.n23,D.n44+D.n24);oa[3].set(D.n41-D.n21,D.n42-D.n22,D.n43-D.n23,D.n44-D.n24);oa[4].set(D.n41-D.n31,D.n42-D.n32,D.n43-D.n33,D.n44-D.n34);oa[5].set(D.n41+D.n31,D.n42+D.n32,D.n43+D.n33,D.n44+D.n34);var X;
for(D=0;D<6;D++){X=oa[D];X.divideScalar(Math.sqrt(X.x*X.x+X.y*X.y+X.z*X.z))}}function m(D){for(var X=D.matrixWorld,L=-D.geometry.boundingSphere.radius*Math.max(D.scale.x,Math.max(D.scale.y,D.scale.z)),J=0;J<6;J++)if(D=oa[J].x*X.n14+oa[J].y*X.n24+oa[J].z*X.n34+oa[J].w,D<=L)return!1;return!0}function p(D,X){D.list[D.count]=X;D.count+=1}function u(D){var X,L,J=D.object,N=D.opaque,fa=D.transparent;fa.count=0;D=N.count=0;for(X=J.materials.length;D<X;D++){L=J.materials[D];L.transparent?p(fa,L):p(N,L)}}
function v(D){var X,L,J,N,fa=D.object,da=D.buffer,Z=D.opaque,ha=D.transparent;ha.count=0;D=Z.count=0;for(J=fa.materials.length;D<J;D++)if(X=fa.materials[D],X instanceof THREE.MeshFaceMaterial){X=0;for(L=da.materials.length;X<L;X++)(N=da.materials[X])&&(N.transparent?p(ha,N):p(Z,N))}else(N=X)&&(N.transparent?p(ha,N):p(Z,N))}function w(D,X){return X.z-D.z}function x(D){t.enable(t.POLYGON_OFFSET_FILL);t.polygonOffset(0.1,1);t.enable(t.STENCIL_TEST);t.enable(t.DEPTH_TEST);t.depthMask(!1);t.colorMask(!1,
!1,!1,!1);t.stencilFunc(t.ALWAYS,1,255);t.stencilOpSeparate(t.BACK,t.KEEP,t.INCR,t.KEEP);t.stencilOpSeparate(t.FRONT,t.KEEP,t.DECR,t.KEEP);var X,L=D.lights.length,J,N=D.lights,fa=[],da,Z,ha,ma,Q,ga=D.__webglShadowVolumes.length;for(X=0;X<L;X++)if(J=D.lights[X],J instanceof THREE.DirectionalLight&&J.castShadow){fa[0]=-J.position.x;fa[1]=-J.position.y;fa[2]=-J.position.z;for(Q=0;Q<ga;Q++){J=D.__webglShadowVolumes[Q].object;da=D.__webglShadowVolumes[Q].buffer;Z=J.materials[0];Z.program||S.initMaterial(Z,
N,void 0,J);Z=Z.program;ha=Z.uniforms;ma=Z.attributes;I!==Z&&(t.useProgram(Z),I=Z,t.uniformMatrix4fv(ha.projectionMatrix,!1,Ca),t.uniformMatrix4fv(ha.viewMatrix,!1,Ga),t.uniform3fv(ha.directionalLightDirection,fa));J.matrixWorld.flattenToArray(J._objectMatrixArray);t.uniformMatrix4fv(ha.objectMatrix,!1,J._objectMatrixArray);t.bindBuffer(t.ARRAY_BUFFER,da.__webglVertexBuffer);t.vertexAttribPointer(ma.position,3,t.FLOAT,!1,0,0);t.bindBuffer(t.ARRAY_BUFFER,da.__webglNormalBuffer);t.vertexAttribPointer(ma.normal,
3,t.FLOAT,!1,0,0);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,da.__webglFaceBuffer);t.cullFace(t.FRONT);t.drawElements(t.TRIANGLES,da.__webglFaceCount,t.UNSIGNED_SHORT,0);t.cullFace(t.BACK);t.drawElements(t.TRIANGLES,da.__webglFaceCount,t.UNSIGNED_SHORT,0)}}t.disable(t.POLYGON_OFFSET_FILL);t.colorMask(!0,!0,!0,!0);t.stencilFunc(t.NOTEQUAL,0,255);t.stencilOp(t.KEEP,t.KEEP,t.KEEP);t.disable(t.DEPTH_TEST);U=-1;I=va.program;t.useProgram(va.program);t.uniformMatrix4fv(va.projectionLocation,!1,Ca);t.uniform1f(va.darknessLocation,
va.darkness);t.bindBuffer(t.ARRAY_BUFFER,va.vertexBuffer);t.vertexAttribPointer(va.vertexLocation,3,t.FLOAT,!1,0,0);t.enableVertexAttribArray(va.vertexLocation);t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);t.blendEquation(t.FUNC_ADD);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,va.elementBuffer);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);t.disable(t.STENCIL_TEST);t.enable(t.DEPTH_TEST);t.depthMask(O)}function y(D,X){var L,J,N;L=_sprite.attributes;var fa=_sprite.uniforms,da=ya/xa,Z,ha=[],ma=xa*0.5,Q=ya*0.5,
ga=!0;t.useProgram(_sprite.program);I=_sprite.program;U=-1;Cb||(t.enableVertexAttribArray(_sprite.attributes.position),t.enableVertexAttribArray(_sprite.attributes.uv),Cb=!0);t.disable(t.CULL_FACE);t.enable(t.BLEND);t.depthMask(!0);t.bindBuffer(t.ARRAY_BUFFER,_sprite.vertexBuffer);t.vertexAttribPointer(L.position,2,t.FLOAT,!1,16,0);t.vertexAttribPointer(L.uv,2,t.FLOAT,!1,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);t.uniformMatrix4fv(fa.projectionMatrix,!1,Ca);t.activeTexture(t.TEXTURE0);
t.uniform1i(fa.map,0);L=0;for(J=D.__webglSprites.length;L<J;L++){N=D.__webglSprites[L];N.useScreenCoordinates?N.z=-N.position.z:(N._modelViewMatrix.multiplyToArray(X.matrixWorldInverse,N.matrixWorld,N._modelViewMatrixArray),N.z=-N._modelViewMatrix.n34)}D.__webglSprites.sort(w);L=0;for(J=D.__webglSprites.length;L<J;L++){N=D.__webglSprites[L];N.material===void 0&&N.map&&N.map.image&&N.map.image.width&&(N.useScreenCoordinates?(t.uniform1i(fa.useScreenCoordinates,1),t.uniform3f(fa.screenPosition,(N.position.x-
ma)/ma,(Q-N.position.y)/Q,Math.max(0,Math.min(1,N.position.z)))):(t.uniform1i(fa.useScreenCoordinates,0),t.uniform1i(fa.affectedByDistance,N.affectedByDistance?1:0),t.uniformMatrix4fv(fa.modelViewMatrix,!1,N._modelViewMatrixArray)),Z=N.map.image.width/(N.affectedByDistance?1:ya),ha[0]=Z*da*N.scale.x,ha[1]=Z*N.scale.y,t.uniform2f(fa.uvScale,N.uvScale.x,N.uvScale.y),t.uniform2f(fa.uvOffset,N.uvOffset.x,N.uvOffset.y),t.uniform2f(fa.alignment,N.alignment.x,N.alignment.y),t.uniform1f(fa.opacity,N.opacity),
t.uniform1f(fa.rotation,N.rotation),t.uniform2fv(fa.scale,ha),N.mergeWith3D&&!ga?(t.enable(t.DEPTH_TEST),ga=!0):!N.mergeWith3D&&ga&&(t.disable(t.DEPTH_TEST),ga=!1),H(N.blending),F(N.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}t.enable(t.CULL_FACE);t.enable(t.DEPTH_TEST);t.depthMask(O)}function A(D,X){var L,J,N=D.__webglLensFlares.length,fa,da,Z,ha=new THREE.Vector3,ma=ya/xa,Q=xa*0.5,ga=ya*0.5,ka=16/ya,sa=[ka*ma,ka],qa=[1,1,0],Ia=[1,1],za=ra.uniforms;L=ra.attributes;t.useProgram(ra.program);
I=ra.program;U=-1;Db||(t.enableVertexAttribArray(ra.attributes.vertex),t.enableVertexAttribArray(ra.attributes.uv),Db=!0);t.uniform1i(za.occlusionMap,0);t.uniform1i(za.map,1);t.bindBuffer(t.ARRAY_BUFFER,ra.vertexBuffer);t.vertexAttribPointer(L.vertex,2,t.FLOAT,!1,16,0);t.vertexAttribPointer(L.uv,2,t.FLOAT,!1,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ra.elementBuffer);t.disable(t.CULL_FACE);t.depthMask(!1);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,ra.occlusionTexture);t.activeTexture(t.TEXTURE1);
for(J=0;J<N;J++)if(L=D.__webglLensFlares[J].object,ha.set(L.matrixWorld.n14,L.matrixWorld.n24,L.matrixWorld.n34),X.matrixWorldInverse.multiplyVector3(ha),X.projectionMatrix.multiplyVector3(ha),qa[0]=ha.x,qa[1]=ha.y,qa[2]=ha.z,Ia[0]=qa[0]*Q+Q,Ia[1]=qa[1]*ga+ga,ra.hasVertexTexture||Ia[0]>0&&Ia[0]<xa&&Ia[1]>0&&Ia[1]<ya){t.bindTexture(t.TEXTURE_2D,ra.tempTexture);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,Ia[0]-8,Ia[1]-8,16,16,0);t.uniform1i(za.renderType,0);t.uniform2fv(za.scale,sa);t.uniform3fv(za.screenPosition,
qa);t.disable(t.BLEND);t.enable(t.DEPTH_TEST);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);t.bindTexture(t.TEXTURE_2D,ra.occlusionTexture);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,Ia[0]-8,Ia[1]-8,16,16,0);t.uniform1i(za.renderType,1);t.disable(t.DEPTH_TEST);t.bindTexture(t.TEXTURE_2D,ra.tempTexture);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);L.positionScreen.x=qa[0];L.positionScreen.y=qa[1];L.positionScreen.z=qa[2];L.customUpdateCallback?L.customUpdateCallback(L):L.updateLensFlares();t.uniform1i(za.renderType,
2);t.enable(t.BLEND);fa=0;for(da=L.lensFlares.length;fa<da;fa++)if(Z=L.lensFlares[fa],Z.opacity>0.0010&&Z.scale>0.0010){qa[0]=Z.x;qa[1]=Z.y;qa[2]=Z.z;ka=Z.size*Z.scale/ya;sa[0]=ka*ma;sa[1]=ka;t.uniform3fv(za.screenPosition,qa);t.uniform2fv(za.scale,sa);t.uniform1f(za.rotation,Z.rotation);t.uniform1f(za.opacity,Z.opacity);H(Z.blending);F(Z.texture,1);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}}t.enable(t.CULL_FACE);t.enable(t.DEPTH_TEST);t.depthMask(O)}function B(D,X){D._modelViewMatrix.multiplyToArray(X.matrixWorldInverse,
D.matrixWorld,D._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(D._modelViewMatrix).transposeIntoArray(D._normalMatrixArray)}function C(D){var X,L,J,N,fa;if(D instanceof THREE.Mesh){L=D.geometry;for(X in L.geometryGroups){J=L.geometryGroups[X];fa=!1;for(N in J.__webglCustomAttributes)if(J.__webglCustomAttributes[N].needsUpdate){fa=!0;break}if(L.__dirtyVertices||L.__dirtyMorphTargets||L.__dirtyElements||L.__dirtyUvs||L.__dirtyNormals||L.__dirtyColors||L.__dirtyTangents||fa){fa=D;var da=t.DYNAMIC_DRAW;
if(J.__inittedArrays){var Z=void 0,ha=void 0,ma=void 0,Q=void 0,ga=void 0,ka=void 0,sa=void 0,qa=void 0,Ia=void 0,za=void 0,Ja=void 0,Xa=void 0,ib=void 0,Aa=void 0,Ba=void 0,Da=void 0,Qa=void 0,Y=void 0,pa=void 0,K=void 0,fb=void 0,jb=ma=ma=Q=void 0,Ra=0,Ta=0,mb=0,nb=0,$a=0,ab=0,Ka=0,bb=0,Sa=0,ja=0,Ua=0;pa=Y=0;var Va=J.__vertexArray,tb=J.__uvArray,ub=J.__uv2Array,gb=J.__normalArray,La=J.__tangentArray,Wa=J.__colorArray,Ma=J.__skinVertexAArray,Na=J.__skinVertexBArray,Oa=J.__skinIndexArray,Pa=J.__skinWeightArray,
vb=J.__morphTargetsArrays,hb=J.__webglCustomAttributes;K=void 0;var cb=J.__faceArray,db=J.__lineArray,Eb=J.__needsSmoothNormals;za=J.__vertexColorType;Ia=J.__uvType;Ja=J.__normalType;var Ya=fa.geometry,wb=Ya.__dirtyVertices,xb=Ya.__dirtyElements,sb=Ya.__dirtyUvs,yb=Ya.__dirtyNormals,zb=Ya.__dirtyTangents,Ab=Ya.__dirtyColors,Bb=Ya.__dirtyMorphTargets,ob=Ya.vertices,Fb=J.faces,Ib=Ya.faces,Gb=Ya.faceVertexUvs[0],Hb=Ya.faceVertexUvs[1],pb=Ya.skinVerticesA,qb=Ya.skinVerticesB,rb=Ya.skinIndices,kb=Ya.skinWeights,
lb=fa instanceof THREE.ShadowVolume?Ya.edgeFaces:void 0;morphTargets=Ya.morphTargets;if(hb)for(jb in hb){hb[jb].offset=0;hb[jb].offsetSrc=0}Z=0;for(ha=Fb.length;Z<ha;Z++)if(ma=Fb[Z],Q=Ib[ma],Gb&&(Xa=Gb[ma]),Hb&&(ib=Hb[ma]),ma=Q.vertexNormals,ga=Q.normal,ka=Q.vertexColors,sa=Q.color,qa=Q.vertexTangents,Q instanceof THREE.Face3){if(wb){Aa=ob[Q.a].position;Ba=ob[Q.b].position;Da=ob[Q.c].position;Va[Ta]=Aa.x;Va[Ta+1]=Aa.y;Va[Ta+2]=Aa.z;Va[Ta+3]=Ba.x;Va[Ta+4]=Ba.y;Va[Ta+5]=Ba.z;Va[Ta+6]=Da.x;Va[Ta+7]=
Da.y;Va[Ta+8]=Da.z;Ta+=9}if(hb)for(jb in hb)if(K=hb[jb],K.needsUpdate){Y=K.offset;pa=K.offsetSrc;K.size===1?(K.boundTo===void 0||K.boundTo==="vertices"?(K.array[Y+0]=K.value[Q.a],K.array[Y+1]=K.value[Q.b],K.array[Y+2]=K.value[Q.c]):K.boundTo==="faces"?(K.array[Y+0]=K.value[pa],K.array[Y+1]=K.value[pa],K.array[Y+2]=K.value[pa],K.offsetSrc++):K.boundTo==="faceVertices"&&(K.array[Y+0]=K.value[pa+0],K.array[Y+1]=K.value[pa+1],K.array[Y+2]=K.value[pa+2],K.offsetSrc+=3),K.offset+=3):(K.boundTo===void 0||
K.boundTo==="vertices"?(Aa=K.value[Q.a],Ba=K.value[Q.b],Da=K.value[Q.c]):K.boundTo==="faces"?(Aa=K.value[pa],Ba=K.value[pa],Da=K.value[pa],K.offsetSrc++):K.boundTo==="faceVertices"&&(Aa=K.value[pa+0],Ba=K.value[pa+1],Da=K.value[pa+2],K.offsetSrc+=3),K.size===2?(K.array[Y+0]=Aa.x,K.array[Y+1]=Aa.y,K.array[Y+2]=Ba.x,K.array[Y+3]=Ba.y,K.array[Y+4]=Da.x,K.array[Y+5]=Da.y,K.offset+=6):K.size===3?(K.type==="c"?(K.array[Y+0]=Aa.r,K.array[Y+1]=Aa.g,K.array[Y+2]=Aa.b,K.array[Y+3]=Ba.r,K.array[Y+4]=Ba.g,K.array[Y+
5]=Ba.b,K.array[Y+6]=Da.r,K.array[Y+7]=Da.g,K.array[Y+8]=Da.b):(K.array[Y+0]=Aa.x,K.array[Y+1]=Aa.y,K.array[Y+2]=Aa.z,K.array[Y+3]=Ba.x,K.array[Y+4]=Ba.y,K.array[Y+5]=Ba.z,K.array[Y+6]=Da.x,K.array[Y+7]=Da.y,K.array[Y+8]=Da.z),K.offset+=9):(K.array[Y+0]=Aa.x,K.array[Y+1]=Aa.y,K.array[Y+2]=Aa.z,K.array[Y+3]=Aa.w,K.array[Y+4]=Ba.x,K.array[Y+5]=Ba.y,K.array[Y+6]=Ba.z,K.array[Y+7]=Ba.w,K.array[Y+8]=Da.x,K.array[Y+9]=Da.y,K.array[Y+10]=Da.z,K.array[Y+11]=Da.w,K.offset+=12))}if(Bb){Y=0;for(pa=morphTargets.length;Y<
pa;Y++){Aa=morphTargets[Y].vertices[Q.a].position;Ba=morphTargets[Y].vertices[Q.b].position;Da=morphTargets[Y].vertices[Q.c].position;K=vb[Y];K[Ua+0]=Aa.x;K[Ua+1]=Aa.y;K[Ua+2]=Aa.z;K[Ua+3]=Ba.x;K[Ua+4]=Ba.y;K[Ua+5]=Ba.z;K[Ua+6]=Da.x;K[Ua+7]=Da.y;K[Ua+8]=Da.z}Ua+=9}if(kb.length){Y=kb[Q.a];pa=kb[Q.b];K=kb[Q.c];Pa[ja]=Y.x;Pa[ja+1]=Y.y;Pa[ja+2]=Y.z;Pa[ja+3]=Y.w;Pa[ja+4]=pa.x;Pa[ja+5]=pa.y;Pa[ja+6]=pa.z;Pa[ja+7]=pa.w;Pa[ja+8]=K.x;Pa[ja+9]=K.y;Pa[ja+10]=K.z;Pa[ja+11]=K.w;Y=rb[Q.a];pa=rb[Q.b];K=rb[Q.c];
Oa[ja]=Y.x;Oa[ja+1]=Y.y;Oa[ja+2]=Y.z;Oa[ja+3]=Y.w;Oa[ja+4]=pa.x;Oa[ja+5]=pa.y;Oa[ja+6]=pa.z;Oa[ja+7]=pa.w;Oa[ja+8]=K.x;Oa[ja+9]=K.y;Oa[ja+10]=K.z;Oa[ja+11]=K.w;Y=pb[Q.a];pa=pb[Q.b];K=pb[Q.c];Ma[ja]=Y.x;Ma[ja+1]=Y.y;Ma[ja+2]=Y.z;Ma[ja+3]=1;Ma[ja+4]=pa.x;Ma[ja+5]=pa.y;Ma[ja+6]=pa.z;Ma[ja+7]=1;Ma[ja+8]=K.x;Ma[ja+9]=K.y;Ma[ja+10]=K.z;Ma[ja+11]=1;Y=qb[Q.a];pa=qb[Q.b];K=qb[Q.c];Na[ja]=Y.x;Na[ja+1]=Y.y;Na[ja+2]=Y.z;Na[ja+3]=1;Na[ja+4]=pa.x;Na[ja+5]=pa.y;Na[ja+6]=pa.z;Na[ja+7]=1;Na[ja+8]=K.x;Na[ja+9]=K.y;
Na[ja+10]=K.z;Na[ja+11]=1;ja+=12}if(Ab&&za){ka.length==3&&za==THREE.VertexColors?(Q=ka[0],Y=ka[1],pa=ka[2]):pa=Y=Q=sa;Wa[Sa]=Q.r;Wa[Sa+1]=Q.g;Wa[Sa+2]=Q.b;Wa[Sa+3]=Y.r;Wa[Sa+4]=Y.g;Wa[Sa+5]=Y.b;Wa[Sa+6]=pa.r;Wa[Sa+7]=pa.g;Wa[Sa+8]=pa.b;Sa+=9}if(zb&&Ya.hasTangents){ka=qa[0];sa=qa[1];Q=qa[2];La[Ka]=ka.x;La[Ka+1]=ka.y;La[Ka+2]=ka.z;La[Ka+3]=ka.w;La[Ka+4]=sa.x;La[Ka+5]=sa.y;La[Ka+6]=sa.z;La[Ka+7]=sa.w;La[Ka+8]=Q.x;La[Ka+9]=Q.y;La[Ka+10]=Q.z;La[Ka+11]=Q.w;Ka+=12}if(yb&&Ja)if(ma.length==3&&Eb)for(qa=0;qa<
3;qa++){ga=ma[qa];gb[ab]=ga.x;gb[ab+1]=ga.y;gb[ab+2]=ga.z;ab+=3}else for(qa=0;qa<3;qa++){gb[ab]=ga.x;gb[ab+1]=ga.y;gb[ab+2]=ga.z;ab+=3}if(sb&&Xa!==void 0&&Ia)for(qa=0;qa<3;qa++){ma=Xa[qa];tb[mb]=ma.u;tb[mb+1]=ma.v;mb+=2}if(sb&&ib!==void 0&&Ia)for(qa=0;qa<3;qa++){ma=ib[qa];ub[nb]=ma.u;ub[nb+1]=ma.v;nb+=2}xb&&(cb[$a]=Ra,cb[$a+1]=Ra+1,cb[$a+2]=Ra+2,$a+=3,db[bb]=Ra,db[bb+1]=Ra+1,db[bb+2]=Ra,db[bb+3]=Ra+2,db[bb+4]=Ra+1,db[bb+5]=Ra+2,bb+=6,Ra+=3)}else if(Q instanceof THREE.Face4){if(wb){Aa=ob[Q.a].position;
Ba=ob[Q.b].position;Da=ob[Q.c].position;Qa=ob[Q.d].position;Va[Ta]=Aa.x;Va[Ta+1]=Aa.y;Va[Ta+2]=Aa.z;Va[Ta+3]=Ba.x;Va[Ta+4]=Ba.y;Va[Ta+5]=Ba.z;Va[Ta+6]=Da.x;Va[Ta+7]=Da.y;Va[Ta+8]=Da.z;Va[Ta+9]=Qa.x;Va[Ta+10]=Qa.y;Va[Ta+11]=Qa.z;Ta+=12}if(hb)for(jb in hb)if(K=hb[jb],K.needsUpdate){Y=K.offset;pa=K.offsetSrc;K.size===1?(K.boundTo===void 0||K.boundTo==="vertices"?(K.array[Y+0]=K.value[Q.a],K.array[Y+1]=K.value[Q.b],K.array[Y+2]=K.value[Q.c],K.array[Y+3]=K.value[Q.d]):K.boundTo==="faces"?(K.array[Y+0]=
K.value[pa],K.array[Y+1]=K.value[pa],K.array[Y+2]=K.value[pa],K.array[Y+3]=K.value[pa],K.offsetSrc++):K.boundTo==="faceVertices"&&(K.array[Y+0]=K.value[pa+0],K.array[Y+1]=K.value[pa+1],K.array[Y+2]=K.value[pa+2],K.array[Y+3]=K.value[pa+3],K.offsetSrc+=4),K.offset+=4):(K.boundTo===void 0||K.boundTo==="vertices"?(Aa=K.value[Q.a],Ba=K.value[Q.b],Da=K.value[Q.c],Qa=K.value[Q.d]):K.boundTo==="faces"?(Aa=K.value[pa],Ba=K.value[pa],Da=K.value[pa],Qa=K.value[pa],K.offsetSrc++):K.boundTo==="faceVertices"&&
(Aa=K.value[pa+0],Ba=K.value[pa+1],Da=K.value[pa+2],Qa=K.value[pa+3],K.offsetSrc+=4),K.size===2?(K.array[Y+0]=Aa.x,K.array[Y+1]=Aa.y,K.array[Y+2]=Ba.x,K.array[Y+3]=Ba.y,K.array[Y+4]=Da.x,K.array[Y+5]=Da.y,K.array[Y+6]=Qa.x,K.array[Y+7]=Qa.y,K.offset+=8):K.size===3?(K.type==="c"?(K.array[Y+0]=Aa.r,K.array[Y+1]=Aa.g,K.array[Y+2]=Aa.b,K.array[Y+3]=Ba.r,K.array[Y+4]=Ba.g,K.array[Y+5]=Ba.b,K.array[Y+6]=Da.r,K.array[Y+7]=Da.g,K.array[Y+8]=Da.b,K.array[Y+9]=Qa.r,K.array[Y+10]=Qa.g,K.array[Y+11]=Qa.b):(K.array[Y+
0]=Aa.x,K.array[Y+1]=Aa.y,K.array[Y+2]=Aa.z,K.array[Y+3]=Ba.x,K.array[Y+4]=Ba.y,K.array[Y+5]=Ba.z,K.array[Y+6]=Da.x,K.array[Y+7]=Da.y,K.array[Y+8]=Da.z,K.array[Y+9]=Qa.x,K.array[Y+10]=Qa.y,K.array[Y+11]=Qa.z),K.offset+=12):(K.array[Y+0]=Aa.x,K.array[Y+1]=Aa.y,K.array[Y+2]=Aa.z,K.array[Y+3]=Aa.w,K.array[Y+4]=Ba.x,K.array[Y+5]=Ba.y,K.array[Y+6]=Ba.z,K.array[Y+7]=Ba.w,K.array[Y+8]=Da.x,K.array[Y+9]=Da.y,K.array[Y+10]=Da.z,K.array[Y+11]=Da.w,K.array[Y+12]=Qa.x,K.array[Y+13]=Qa.y,K.array[Y+14]=Qa.z,K.array[Y+
15]=Qa.w,K.offset+=16))}if(Bb){Y=0;for(pa=morphTargets.length;Y<pa;Y++){Aa=morphTargets[Y].vertices[Q.a].position;Ba=morphTargets[Y].vertices[Q.b].position;Da=morphTargets[Y].vertices[Q.c].position;Qa=morphTargets[Y].vertices[Q.d].position;K=vb[Y];K[Ua+0]=Aa.x;K[Ua+1]=Aa.y;K[Ua+2]=Aa.z;K[Ua+3]=Ba.x;K[Ua+4]=Ba.y;K[Ua+5]=Ba.z;K[Ua+6]=Da.x;K[Ua+7]=Da.y;K[Ua+8]=Da.z;K[Ua+9]=Qa.x;K[Ua+10]=Qa.y;K[Ua+11]=Qa.z}Ua+=12}if(kb.length){Y=kb[Q.a];pa=kb[Q.b];K=kb[Q.c];fb=kb[Q.d];Pa[ja]=Y.x;Pa[ja+1]=Y.y;Pa[ja+2]=
Y.z;Pa[ja+3]=Y.w;Pa[ja+4]=pa.x;Pa[ja+5]=pa.y;Pa[ja+6]=pa.z;Pa[ja+7]=pa.w;Pa[ja+8]=K.x;Pa[ja+9]=K.y;Pa[ja+10]=K.z;Pa[ja+11]=K.w;Pa[ja+12]=fb.x;Pa[ja+13]=fb.y;Pa[ja+14]=fb.z;Pa[ja+15]=fb.w;Y=rb[Q.a];pa=rb[Q.b];K=rb[Q.c];fb=rb[Q.d];Oa[ja]=Y.x;Oa[ja+1]=Y.y;Oa[ja+2]=Y.z;Oa[ja+3]=Y.w;Oa[ja+4]=pa.x;Oa[ja+5]=pa.y;Oa[ja+6]=pa.z;Oa[ja+7]=pa.w;Oa[ja+8]=K.x;Oa[ja+9]=K.y;Oa[ja+10]=K.z;Oa[ja+11]=K.w;Oa[ja+12]=fb.x;Oa[ja+13]=fb.y;Oa[ja+14]=fb.z;Oa[ja+15]=fb.w;Y=pb[Q.a];pa=pb[Q.b];K=pb[Q.c];fb=pb[Q.d];Ma[ja]=Y.x;
Ma[ja+1]=Y.y;Ma[ja+2]=Y.z;Ma[ja+3]=1;Ma[ja+4]=pa.x;Ma[ja+5]=pa.y;Ma[ja+6]=pa.z;Ma[ja+7]=1;Ma[ja+8]=K.x;Ma[ja+9]=K.y;Ma[ja+10]=K.z;Ma[ja+11]=1;Ma[ja+12]=fb.x;Ma[ja+13]=fb.y;Ma[ja+14]=fb.z;Ma[ja+15]=1;Y=qb[Q.a];pa=qb[Q.b];K=qb[Q.c];Q=qb[Q.d];Na[ja]=Y.x;Na[ja+1]=Y.y;Na[ja+2]=Y.z;Na[ja+3]=1;Na[ja+4]=pa.x;Na[ja+5]=pa.y;Na[ja+6]=pa.z;Na[ja+7]=1;Na[ja+8]=K.x;Na[ja+9]=K.y;Na[ja+10]=K.z;Na[ja+11]=1;Na[ja+12]=Q.x;Na[ja+13]=Q.y;Na[ja+14]=Q.z;Na[ja+15]=1;ja+=16}if(Ab&&za){ka.length==4&&za==THREE.VertexColors?
(Q=ka[0],Y=ka[1],pa=ka[2],ka=ka[3]):ka=pa=Y=Q=sa;Wa[Sa]=Q.r;Wa[Sa+1]=Q.g;Wa[Sa+2]=Q.b;Wa[Sa+3]=Y.r;Wa[Sa+4]=Y.g;Wa[Sa+5]=Y.b;Wa[Sa+6]=pa.r;Wa[Sa+7]=pa.g;Wa[Sa+8]=pa.b;Wa[Sa+9]=ka.r;Wa[Sa+10]=ka.g;Wa[Sa+11]=ka.b;Sa+=12}if(zb&&Ya.hasTangents){ka=qa[0];sa=qa[1];Q=qa[2];qa=qa[3];La[Ka]=ka.x;La[Ka+1]=ka.y;La[Ka+2]=ka.z;La[Ka+3]=ka.w;La[Ka+4]=sa.x;La[Ka+5]=sa.y;La[Ka+6]=sa.z;La[Ka+7]=sa.w;La[Ka+8]=Q.x;La[Ka+9]=Q.y;La[Ka+10]=Q.z;La[Ka+11]=Q.w;La[Ka+12]=qa.x;La[Ka+13]=qa.y;La[Ka+14]=qa.z;La[Ka+15]=qa.w;Ka+=
16}if(yb&&Ja)if(ma.length==4&&Eb)for(qa=0;qa<4;qa++){ga=ma[qa];gb[ab]=ga.x;gb[ab+1]=ga.y;gb[ab+2]=ga.z;ab+=3}else for(qa=0;qa<4;qa++){gb[ab]=ga.x;gb[ab+1]=ga.y;gb[ab+2]=ga.z;ab+=3}if(sb&&Xa!==void 0&&Ia)for(qa=0;qa<4;qa++){ma=Xa[qa];tb[mb]=ma.u;tb[mb+1]=ma.v;mb+=2}if(sb&&ib!==void 0&&Ia)for(qa=0;qa<4;qa++){ma=ib[qa];ub[nb]=ma.u;ub[nb+1]=ma.v;nb+=2}xb&&(cb[$a]=Ra,cb[$a+1]=Ra+1,cb[$a+2]=Ra+3,cb[$a+3]=Ra+1,cb[$a+4]=Ra+2,cb[$a+5]=Ra+3,$a+=6,db[bb]=Ra,db[bb+1]=Ra+1,db[bb+2]=Ra,db[bb+3]=Ra+3,db[bb+4]=Ra+
1,db[bb+5]=Ra+2,db[bb+6]=Ra+2,db[bb+7]=Ra+3,bb+=8,Ra+=4)}if(lb){Z=0;for(ha=lb.length;Z<ha;Z++){cb[$a]=lb[Z].a;cb[$a+1]=lb[Z].b;cb[$a+2]=lb[Z].c;cb[$a+3]=lb[Z].a;cb[$a+4]=lb[Z].c;cb[$a+5]=lb[Z].d;$a+=6}}wb&&(t.bindBuffer(t.ARRAY_BUFFER,J.__webglVertexBuffer),t.bufferData(t.ARRAY_BUFFER,Va,da));if(hb)for(jb in hb)if(K=hb[jb],K.needsUpdate){t.bindBuffer(t.ARRAY_BUFFER,K.buffer);t.bufferData(t.ARRAY_BUFFER,K.array,da);K.needsUpdate=!1}if(Bb){Y=0;for(pa=morphTargets.length;Y<pa;Y++){t.bindBuffer(t.ARRAY_BUFFER,
J.__webglMorphTargetsBuffers[Y]);t.bufferData(t.ARRAY_BUFFER,vb[Y],da)}}Ab&&Sa>0&&(t.bindBuffer(t.ARRAY_BUFFER,J.__webglColorBuffer),t.bufferData(t.ARRAY_BUFFER,Wa,da));yb&&(t.bindBuffer(t.ARRAY_BUFFER,J.__webglNormalBuffer),t.bufferData(t.ARRAY_BUFFER,gb,da));zb&&Ya.hasTangents&&(t.bindBuffer(t.ARRAY_BUFFER,J.__webglTangentBuffer),t.bufferData(t.ARRAY_BUFFER,La,da));sb&&mb>0&&(t.bindBuffer(t.ARRAY_BUFFER,J.__webglUVBuffer),t.bufferData(t.ARRAY_BUFFER,tb,da));sb&&nb>0&&(t.bindBuffer(t.ARRAY_BUFFER,
J.__webglUV2Buffer),t.bufferData(t.ARRAY_BUFFER,ub,da));xb&&(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,J.__webglFaceBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,cb,da),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,J.__webglLineBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,db,da));ja>0&&(t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinVertexABuffer),t.bufferData(t.ARRAY_BUFFER,Ma,da),t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinVertexBBuffer),t.bufferData(t.ARRAY_BUFFER,Na,da),t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinIndicesBuffer),
t.bufferData(t.ARRAY_BUFFER,Oa,da),t.bindBuffer(t.ARRAY_BUFFER,J.__webglSkinWeightsBuffer),t.bufferData(t.ARRAY_BUFFER,Pa,da));fa.dynamic||(delete J.__inittedArrays,delete J.__colorArray,delete J.__normalArray,delete J.__tangentArray,delete J.__uvArray,delete J.__uv2Array,delete J.__faceArray,delete J.__vertexArray,delete J.__lineArray,delete J.__skinVertexAArray,delete J.__skinVertexBArray,delete J.__skinIndexArray,delete J.__skinWeightArray)}}}L.__dirtyVertices=!1;L.__dirtyMorphTargets=!1;L.__dirtyElements=
!1;L.__dirtyUvs=!1;L.__dirtyNormals=!1;L.__dirtyTangents=!1;L.__dirtyColors=!1}else if(D instanceof THREE.Ribbon){L=D.geometry;if(L.__dirtyVertices||L.__dirtyColors){D=L;X=t.DYNAMIC_DRAW;Ia=D.vertices;J=D.colors;za=Ia.length;fa=J.length;Ja=D.__vertexArray;da=D.__colorArray;Xa=D.__dirtyColors;if(D.__dirtyVertices){for(Z=0;Z<za;Z++){ha=Ia[Z].position;N=Z*3;Ja[N]=ha.x;Ja[N+1]=ha.y;Ja[N+2]=ha.z}t.bindBuffer(t.ARRAY_BUFFER,D.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,Ja,X)}if(Xa){for(Z=0;Z<fa;Z++){color=
J[Z];N=Z*3;da[N]=color.r;da[N+1]=color.g;da[N+2]=color.b}t.bindBuffer(t.ARRAY_BUFFER,D.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,da,X)}}L.__dirtyVertices=!1;L.__dirtyColors=!1}else if(D instanceof THREE.Line){L=D.geometry;if(L.__dirtyVertices||L.__dirtyColors){D=L;X=t.DYNAMIC_DRAW;Ia=D.vertices;J=D.colors;za=Ia.length;fa=J.length;Ja=D.__vertexArray;da=D.__colorArray;Xa=D.__dirtyColors;if(D.__dirtyVertices){for(Z=0;Z<za;Z++){ha=Ia[Z].position;N=Z*3;Ja[N]=ha.x;Ja[N+1]=ha.y;Ja[N+2]=ha.z}t.bindBuffer(t.ARRAY_BUFFER,
D.__webglVertexBuffer);t.bufferData(t.ARRAY_BUFFER,Ja,X)}if(Xa){for(Z=0;Z<fa;Z++){color=J[Z];N=Z*3;da[N]=color.r;da[N+1]=color.g;da[N+2]=color.b}t.bindBuffer(t.ARRAY_BUFFER,D.__webglColorBuffer);t.bufferData(t.ARRAY_BUFFER,da,X)}}L.__dirtyVertices=!1;L.__dirtyColors=!1}else if(D instanceof THREE.ParticleSystem){L=D.geometry;(L.__dirtyVertices||L.__dirtyColors||D.sortParticles)&&f(L,t.DYNAMIC_DRAW,D);L.__dirtyVertices=!1;L.__dirtyColors=!1}}function E(D){function X(ka){var sa=[];L=0;for(J=ka.length;L<
J;L++)ka[L]==void 0?sa.push("undefined"):sa.push(ka[L].id);return sa.join("_")}var L,J,N,fa,da,Z,ha,ma,Q={},ga=D.morphTargets!==void 0?D.morphTargets.length:0;D.geometryGroups={};N=0;for(fa=D.faces.length;N<fa;N++){da=D.faces[N];Z=da.materials;ha=X(Z);Q[ha]==void 0&&(Q[ha]={hash:ha,counter:0});ma=Q[ha].hash+"_"+Q[ha].counter;D.geometryGroups[ma]==void 0&&(D.geometryGroups[ma]={faces:[],materials:Z,vertices:0,numMorphTargets:ga});da=da instanceof THREE.Face3?3:4;D.geometryGroups[ma].vertices+da>65535&&
(Q[ha].counter+=1,ma=Q[ha].hash+"_"+Q[ha].counter,D.geometryGroups[ma]==void 0&&(D.geometryGroups[ma]={faces:[],materials:Z,vertices:0,numMorphTargets:ga}));D.geometryGroups[ma].faces.push(N);D.geometryGroups[ma].vertices+=da}}function z(D,X,L){D.push({buffer:X,object:L,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function H(D){if(D!=U){switch(D){case THREE.AdditiveBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.SRC_ALPHA,t.ONE);break;case THREE.SubtractiveBlending:t.blendEquation(t.FUNC_ADD);
t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:t.blendEquation(t.FUNC_ADD);t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD);t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}U=D}}function G(D,X,L){(L.width&L.width-1)==0&&(L.height&L.height-1)==0?(t.texParameteri(D,t.TEXTURE_WRAP_S,V(X.wrapS)),t.texParameteri(D,t.TEXTURE_WRAP_T,V(X.wrapT)),t.texParameteri(D,t.TEXTURE_MAG_FILTER,V(X.magFilter)),
t.texParameteri(D,t.TEXTURE_MIN_FILTER,V(X.minFilter)),t.generateMipmap(D)):(t.texParameteri(D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(D,t.TEXTURE_MAG_FILTER,W(X.magFilter)),t.texParameteri(D,t.TEXTURE_MIN_FILTER,W(X.minFilter)))}function F(D,X){if(D.needsUpdate){if(D.__webglTexture)D.__webglTexture=t.deleteTexture(D.__webglTexture);D.__webglTexture=t.createTexture();t.bindTexture(t.TEXTURE_2D,D.__webglTexture);t.texImage2D(t.TEXTURE_2D,
0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,D.image);G(t.TEXTURE_2D,D,D.image);t.bindTexture(t.TEXTURE_2D,null);D.needsUpdate=!1}t.activeTexture(t.TEXTURE0+X);t.bindTexture(t.TEXTURE_2D,D.__webglTexture)}function T(D){if(D&&!D.__webglFramebuffer){if(D.depthBuffer===void 0)D.depthBuffer=!0;if(D.stencilBuffer===void 0)D.stencilBuffer=!0;D.__webglFramebuffer=t.createFramebuffer();D.__webglRenderbuffer=t.createRenderbuffer();D.__webglTexture=t.createTexture();t.bindTexture(t.TEXTURE_2D,D.__webglTexture);t.texParameteri(t.TEXTURE_2D,
t.TEXTURE_WRAP_S,V(D.wrapS));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,V(D.wrapT));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,V(D.magFilter));t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,V(D.minFilter));t.texImage2D(t.TEXTURE_2D,0,V(D.format),D.width,D.height,0,V(D.format),V(D.type),null);t.bindRenderbuffer(t.RENDERBUFFER,D.__webglRenderbuffer);t.bindFramebuffer(t.FRAMEBUFFER,D.__webglFramebuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,D.__webglTexture,
0);D.depthBuffer&&!D.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,D.width,D.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,D.__webglRenderbuffer)):D.depthBuffer&&D.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,D.width,D.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,D.__webglRenderbuffer)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,D.width,D.height);t.bindTexture(t.TEXTURE_2D,
null);t.bindRenderbuffer(t.RENDERBUFFER,null);t.bindFramebuffer(t.FRAMEBUFFER,null)}var X,L;D?(X=D.__webglFramebuffer,L=D.width,D=D.height):(X=null,L=xa,D=ya);X!=P&&(t.bindFramebuffer(t.FRAMEBUFFER,X),t.viewport(la,ta,L,D),P=X)}function $(D,X){var L;D=="fragment"?L=t.createShader(t.FRAGMENT_SHADER):D=="vertex"&&(L=t.createShader(t.VERTEX_SHADER));t.shaderSource(L,X);t.compileShader(L);if(!t.getShaderParameter(L,t.COMPILE_STATUS))return console.error(t.getShaderInfoLog(L)),console.error(X),null;return L}
function W(D){switch(D){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return t.NEAREST;default:return t.LINEAR}}function V(D){switch(D){case THREE.RepeatWrapping:return t.REPEAT;case THREE.ClampToEdgeWrapping:return t.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return t.MIRRORED_REPEAT;case THREE.NearestFilter:return t.NEAREST;case THREE.NearestMipMapNearestFilter:return t.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return t.NEAREST_MIPMAP_LINEAR;
case THREE.LinearFilter:return t.LINEAR;case THREE.LinearMipMapNearestFilter:return t.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return t.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return t.BYTE;case THREE.UnsignedByteType:return t.UNSIGNED_BYTE;case THREE.ShortType:return t.SHORT;case THREE.UnsignedShortType:return t.UNSIGNED_SHORT;case THREE.IntType:return t.INT;case THREE.UnsignedShortType:return t.UNSIGNED_INT;case THREE.FloatType:return t.FLOAT;case THREE.AlphaFormat:return t.ALPHA;
case THREE.RGBFormat:return t.RGB;case THREE.RGBAFormat:return t.RGBA;case THREE.LuminanceFormat:return t.LUMINANCE;case THREE.LuminanceAlphaFormat:return t.LUMINANCE_ALPHA}return 0}var S=this,t,M=[],I=null,P=null,O=!0,R=null,ca=null,U=null,ea=null,la=0,ta=0,xa=0,ya=0,oa=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Fa=new THREE.Matrix4,Ca=new Float32Array(16),Ga=new Float32Array(16),Ha=new THREE.Vector4,wa={ambient:[0,0,0],directional:{length:0,
colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};b=b||{};var aa=b.canvas!==void 0?b.canvas:document.createElement("canvas"),ia=b.stencil!==void 0?b.stencil:!0,na=b.antialias!==void 0?b.antialias:!1,ua=b.clearColor!==void 0?new THREE.Color(b.clearColor):new THREE.Color(0),Ea=b.clearAlpha!==void 0?b.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=aa;this.sortObjects=this.autoClear=!0;try{if(!(t=aa.getContext("experimental-webgl",
{antialias:na,stencil:ia})))throw"Error creating WebGL context.";}catch(Za){console.error(Za)}console.log(navigator.userAgent+" | "+t.getParameter(t.VERSION)+" | "+t.getParameter(t.VENDOR)+" | "+t.getParameter(t.RENDERER)+" | "+t.getParameter(t.SHADING_LANGUAGE_VERSION));t.clearColor(0,0,0,1);t.clearDepth(1);t.enable(t.DEPTH_TEST);t.depthFunc(t.LEQUAL);t.frontFace(t.CCW);t.cullFace(t.BACK);t.enable(t.CULL_FACE);t.enable(t.BLEND);t.blendEquation(t.FUNC_ADD);t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);
t.clearColor(ua.r,ua.g,ua.b,Ea);this.context=t;var eb=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(ia){var va={};va.vertices=new Float32Array(12);va.faces=new Uint16Array(6);va.darkness=0.5;va.vertices[0]=-20;va.vertices[1]=-20;va.vertices[2]=-1;va.vertices[3]=20;va.vertices[4]=-20;va.vertices[5]=-1;va.vertices[6]=20;va.vertices[7]=20;va.vertices[8]=-1;va.vertices[9]=-20;va.vertices[10]=20;va.vertices[11]=-1;va.faces[0]=0;va.faces[1]=1;va.faces[2]=2;va.faces[3]=0;va.faces[4]=2;va.faces[5]=
3;va.vertexBuffer=t.createBuffer();va.elementBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,va.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,va.vertices,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,va.elementBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,va.faces,t.STATIC_DRAW);va.program=t.createProgram();t.attachShader(va.program,$("fragment",THREE.ShaderLib.shadowPost.fragmentShader));t.attachShader(va.program,$("vertex",THREE.ShaderLib.shadowPost.vertexShader));t.linkProgram(va.program);va.vertexLocation=
t.getAttribLocation(va.program,"position");va.projectionLocation=t.getUniformLocation(va.program,"projectionMatrix");va.darknessLocation=t.getUniformLocation(va.program,"darkness")}var ra={};ra.vertices=new Float32Array(16);ra.faces=new Uint16Array(6);b=0;ra.vertices[b++]=-1;ra.vertices[b++]=-1;ra.vertices[b++]=0;ra.vertices[b++]=0;ra.vertices[b++]=1;ra.vertices[b++]=-1;ra.vertices[b++]=1;ra.vertices[b++]=0;ra.vertices[b++]=1;ra.vertices[b++]=1;ra.vertices[b++]=1;ra.vertices[b++]=1;ra.vertices[b++]=
-1;ra.vertices[b++]=1;ra.vertices[b++]=0;ra.vertices[b++]=1;b=0;ra.faces[b++]=0;ra.faces[b++]=1;ra.faces[b++]=2;ra.faces[b++]=0;ra.faces[b++]=2;ra.faces[b++]=3;ra.vertexBuffer=t.createBuffer();ra.elementBuffer=t.createBuffer();ra.tempTexture=t.createTexture();ra.occlusionTexture=t.createTexture();t.bindBuffer(t.ARRAY_BUFFER,ra.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,ra.vertices,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ra.elementBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,ra.faces,t.STATIC_DRAW);
t.bindTexture(t.TEXTURE_2D,ra.tempTexture);t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);t.bindTexture(t.TEXTURE_2D,ra.occlusionTexture);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,
t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(ra.hasVertexTexture=!1,ra.program=t.createProgram(),t.attachShader(ra.program,$("fragment",THREE.ShaderLib.lensFlare.fragmentShader)),t.attachShader(ra.program,$("vertex",THREE.ShaderLib.lensFlare.vertexShader))):(ra.hasVertexTexture=
!0,ra.program=t.createProgram(),t.attachShader(ra.program,$("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader)),t.attachShader(ra.program,$("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader)));t.linkProgram(ra.program);ra.attributes={};ra.uniforms={};ra.attributes.vertex=t.getAttribLocation(ra.program,"position");ra.attributes.uv=t.getAttribLocation(ra.program,"UV");ra.uniforms.renderType=t.getUniformLocation(ra.program,"renderType");ra.uniforms.map=t.getUniformLocation(ra.program,
"map");ra.uniforms.occlusionMap=t.getUniformLocation(ra.program,"occlusionMap");ra.uniforms.opacity=t.getUniformLocation(ra.program,"opacity");ra.uniforms.scale=t.getUniformLocation(ra.program,"scale");ra.uniforms.rotation=t.getUniformLocation(ra.program,"rotation");ra.uniforms.screenPosition=t.getUniformLocation(ra.program,"screenPosition");var Db=!1;_sprite={};_sprite.vertices=new Float32Array(16);_sprite.faces=new Uint16Array(6);b=0;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=
0;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=-1;_sprite.vertices[b++]=1;_sprite.vertices[b++]=0;_sprite.vertices[b++]=1;b=0;_sprite.faces[b++]=0;_sprite.faces[b++]=1;_sprite.faces[b++]=2;_sprite.faces[b++]=0;_sprite.faces[b++]=2;_sprite.faces[b++]=3;_sprite.vertexBuffer=t.createBuffer();_sprite.elementBuffer=
t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,_sprite.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,_sprite.vertices,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,_sprite.faces,t.STATIC_DRAW);_sprite.program=t.createProgram();t.attachShader(_sprite.program,$("fragment",THREE.ShaderLib.sprite.fragmentShader));t.attachShader(_sprite.program,$("vertex",THREE.ShaderLib.sprite.vertexShader));t.linkProgram(_sprite.program);_sprite.attributes={};
_sprite.uniforms={};_sprite.attributes.position=t.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=t.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=t.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=t.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=t.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=t.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=t.getUniformLocation(_sprite.program,
"alignment");_sprite.uniforms.map=t.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=t.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=t.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=t.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=t.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=t.getUniformLocation(_sprite.program,
"modelViewMatrix");_sprite.uniforms.projectionMatrix=t.getUniformLocation(_sprite.program,"projectionMatrix");var Cb=!1;this.setSize=function(D,X){aa.width=D;aa.height=X;this.setViewport(0,0,aa.width,aa.height)};this.setViewport=function(D,X,L,J){la=D;ta=X;xa=L;ya=J;t.viewport(la,ta,xa,ya)};this.setScissor=function(D,X,L,J){t.scissor(D,X,L,J)};this.enableScissorTest=function(D){D?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)};this.enableDepthBufferWrite=function(D){O=D;t.depthMask(D)};this.setClearColorHex=
function(D,X){ua.setHex(D);Ea=X;t.clearColor(ua.r,ua.g,ua.b,Ea)};this.setClearColor=function(D,X){ua.copy(D);Ea=X;t.clearColor(ua.r,ua.g,ua.b,Ea)};this.clear=function(){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(D){va.darkness=D};this.getContext=function(){return t};this.initMaterial=function(D,X,L,J){var N,fa,da;D instanceof THREE.MeshDepthMaterial?da="depth":D instanceof THREE.ShadowVolumeDynamicMaterial?da="shadowVolumeDynamic":D instanceof
THREE.MeshNormalMaterial?da="normal":D instanceof THREE.MeshBasicMaterial?da="basic":D instanceof THREE.MeshLambertMaterial?da="lambert":D instanceof THREE.MeshPhongMaterial?da="phong":D instanceof THREE.LineBasicMaterial?da="basic":D instanceof THREE.ParticleBasicMaterial&&(da="particle_basic");if(da){var Z=THREE.ShaderLib[da];D.uniforms=THREE.UniformsUtils.clone(Z.uniforms);D.vertexShader=Z.vertexShader;D.fragmentShader=Z.fragmentShader}var ha,ma,Q;ha=Q=Z=0;for(ma=X.length;ha<ma;ha++){fa=X[ha];
fa instanceof THREE.DirectionalLight&&Q++;fa instanceof THREE.PointLight&&Z++}Z+Q<=4?X=Q:(X=Math.ceil(4*Q/(Z+Q)),Z=4-X);fa={directional:X,point:Z};Q=50;if(J!==void 0&&J instanceof THREE.SkinnedMesh)Q=J.bones.length;var ga;a:{ha=D.fragmentShader;ma=D.vertexShader;Z=D.uniforms;X=D.attributes;L={map:!!D.map,envMap:!!D.envMap,lightMap:!!D.lightMap,vertexColors:D.vertexColors,fog:L,sizeAttenuation:D.sizeAttenuation,skinning:D.skinning,morphTargets:D.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:fa.directional,
maxPointLights:fa.point,maxBones:Q};var ka;fa=[];da?fa.push(da):(fa.push(ha),fa.push(ma));for(ka in L){fa.push(ka);fa.push(L[ka])}da=fa.join();ka=0;for(fa=M.length;ka<fa;ka++)if(M[ka].code==da){ga=M[ka].program;break a}ka=t.createProgram();prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+L.maxDirLights,"#define MAX_POINT_LIGHTS "+L.maxPointLights,L.fog?"#define USE_FOG":"",L.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",L.map?"#define USE_MAP":"",L.envMap?
"#define USE_ENVMAP":"",L.lightMap?"#define USE_LIGHTMAP":"",L.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");prefix_vertex=[eb?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+L.maxDirLights,"#define MAX_POINT_LIGHTS "+L.maxPointLights,"#define MAX_BONES "+L.maxBones,L.map?"#define USE_MAP":"",L.envMap?"#define USE_ENVMAP":"",L.lightMap?"#define USE_LIGHTMAP":"",L.vertexColors?"#define USE_COLOR":"",L.skinning?"#define USE_SKINNING":
"",L.morphTargets?"#define USE_MORPHTARGETS":"",L.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
t.attachShader(ka,$("fragment",prefix_fragment+ha));t.attachShader(ka,$("vertex",prefix_vertex+ma));t.linkProgram(ka);t.getProgramParameter(ka,t.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+t.getProgramParameter(ka,t.VALIDATE_STATUS)+", gl error ["+t.getError()+"]");ka.uniforms={};ka.attributes={};var sa;ha=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];
for(sa in Z)ha.push(sa);sa=ha;Z=0;for(ha=sa.length;Z<ha;Z++){ma=sa[Z];ka.uniforms[ma]=t.getUniformLocation(ka,ma)}ha=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(sa=0;sa<L.maxMorphTargets;sa++)ha.push("morphTarget"+sa);for(ga in X)ha.push(ga);ga=ha;sa=0;for(X=ga.length;sa<X;sa++){L=ga[sa];ka.attributes[L]=t.getAttribLocation(ka,L)}M.push({program:ka,code:da});ga=ka}D.program=ga;ga=D.program.attributes;ga.position>=0&&t.enableVertexAttribArray(ga.position);
ga.color>=0&&t.enableVertexAttribArray(ga.color);ga.normal>=0&&t.enableVertexAttribArray(ga.normal);ga.tangent>=0&&t.enableVertexAttribArray(ga.tangent);D.skinning&&ga.skinVertexA>=0&&ga.skinVertexB>=0&&ga.skinIndex>=0&&ga.skinWeight>=0&&(t.enableVertexAttribArray(ga.skinVertexA),t.enableVertexAttribArray(ga.skinVertexB),t.enableVertexAttribArray(ga.skinIndex),t.enableVertexAttribArray(ga.skinWeight));if(D.attributes)for(N in D.attributes)ga[N]!==void 0&&ga[N]>=0&&t.enableVertexAttribArray(ga[N]);
if(D.morphTargets){D.numSupportedMorphTargets=0;ga.morphTarget0>=0&&(t.enableVertexAttribArray(ga.morphTarget0),D.numSupportedMorphTargets++);ga.morphTarget1>=0&&(t.enableVertexAttribArray(ga.morphTarget1),D.numSupportedMorphTargets++);ga.morphTarget2>=0&&(t.enableVertexAttribArray(ga.morphTarget2),D.numSupportedMorphTargets++);ga.morphTarget3>=0&&(t.enableVertexAttribArray(ga.morphTarget3),D.numSupportedMorphTargets++);ga.morphTarget4>=0&&(t.enableVertexAttribArray(ga.morphTarget4),D.numSupportedMorphTargets++);
ga.morphTarget5>=0&&(t.enableVertexAttribArray(ga.morphTarget5),D.numSupportedMorphTargets++);ga.morphTarget6>=0&&(t.enableVertexAttribArray(ga.morphTarget6),D.numSupportedMorphTargets++);ga.morphTarget7>=0&&(t.enableVertexAttribArray(ga.morphTarget7),D.numSupportedMorphTargets++);J.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);D=0;for(N=this.maxMorphTargets;D<N;D++)J.__webglMorphTargetInfluences[D]=0}};this.render=function(D,X,L,J){var N,fa,da,Z,ha,ma,Q,ga,ka=D.lights,sa=D.fog;
S.data.vertices=0;S.data.faces=0;S.data.drawCalls=0;X.matrixAutoUpdate&&X.update(void 0,!0);D.update(void 0,!1,X);X.matrixWorldInverse.flattenToArray(Ga);X.projectionMatrix.flattenToArray(Ca);Fa.multiply(X.projectionMatrix,X.matrixWorldInverse);o(Fa);this.initWebGLObjects(D);T(L);(this.autoClear||J)&&this.clear();ha=D.__webglObjects.length;for(J=0;J<ha;J++)if(N=D.__webglObjects[J],Q=N.object,Q.visible)if(!(Q instanceof THREE.Mesh)||m(Q)){if(Q.matrixWorld.flattenToArray(Q._objectMatrixArray),B(Q,X),
v(N),N.render=!0,this.sortObjects){Ha.copy(Q.position);Fa.multiplyVector3(Ha);N.z=Ha.z}}else N.render=!1;else N.render=!1;this.sortObjects&&D.__webglObjects.sort(w);ma=D.__webglObjectsImmediate.length;for(J=0;J<ma;J++){N=D.__webglObjectsImmediate[J];Q=N.object;Q.visible&&(Q.matrixAutoUpdate&&Q.matrixWorld.flattenToArray(Q._objectMatrixArray),B(Q,X),u(N))}H(THREE.NormalBlending);for(J=0;J<ha;J++)if(N=D.__webglObjects[J],N.render){Q=N.object;ga=N.buffer;da=N.opaque;h(Q);for(N=0;N<da.count;N++){Z=da.list[N];
n(Z.depthTest);d(X,ka,sa,Z,ga,Q)}}for(J=0;J<ma;J++)if(N=D.__webglObjectsImmediate[J],Q=N.object,Q.visible){da=N.opaque;h(Q);for(N=0;N<da.count;N++){Z=da.list[N];n(Z.depthTest);fa=c(X,ka,sa,Z,Q);Q.render(function(qa){g(qa,fa,Z.shading)})}}for(J=0;J<ha;J++)if(N=D.__webglObjects[J],N.render){Q=N.object;ga=N.buffer;da=N.transparent;h(Q);for(N=0;N<da.count;N++){Z=da.list[N];H(Z.blending);n(Z.depthTest);d(X,ka,sa,Z,ga,Q)}}for(J=0;J<ma;J++)if(N=D.__webglObjectsImmediate[J],Q=N.object,Q.visible){da=N.transparent;
h(Q);for(N=0;N<da.count;N++){Z=da.list[N];H(Z.blending);n(Z.depthTest);fa=c(X,ka,sa,Z,Q);Q.render(function(qa){g(qa,fa,Z.shading)})}}D.__webglSprites.length&&y(D,X);ia&&D.__webglShadowVolumes.length&&D.lights.length&&x(D);D.__webglLensFlares.length&&A(D,X);L&&L.minFilter!==THREE.NearestFilter&&L.minFilter!==THREE.LinearFilter&&(t.bindTexture(t.TEXTURE_2D,L.__webglTexture),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null))};this.initWebGLObjects=function(D){if(!D.__webglObjects){D.__webglObjects=
[];D.__webglObjectsImmediate=[];D.__webglShadowVolumes=[];D.__webglLensFlares=[];D.__webglSprites=[]}for(;D.__objectsAdded.length;){var X=D.__objectsAdded[0],L=D,J=void 0,N=void 0,fa=void 0;if(X._modelViewMatrix==void 0){X._modelViewMatrix=new THREE.Matrix4;X._normalMatrixArray=new Float32Array(9);X._modelViewMatrixArray=new Float32Array(16);X._objectMatrixArray=new Float32Array(16);X.matrixWorld.flattenToArray(X._objectMatrixArray)}if(X instanceof THREE.Mesh)for(J in N=X.geometry,N.geometryGroups==
void 0&&E(N),N.geometryGroups){fa=N.geometryGroups[J];if(!fa.__webglVertexBuffer){var da=fa;da.__webglVertexBuffer=t.createBuffer();da.__webglNormalBuffer=t.createBuffer();da.__webglTangentBuffer=t.createBuffer();da.__webglColorBuffer=t.createBuffer();da.__webglUVBuffer=t.createBuffer();da.__webglUV2Buffer=t.createBuffer();da.__webglSkinVertexABuffer=t.createBuffer();da.__webglSkinVertexBBuffer=t.createBuffer();da.__webglSkinIndicesBuffer=t.createBuffer();da.__webglSkinWeightsBuffer=t.createBuffer();
da.__webglFaceBuffer=t.createBuffer();da.__webglLineBuffer=t.createBuffer();if(da.numMorphTargets){var Z=void 0,ha=void 0;da.__webglMorphTargetsBuffers=[];Z=0;for(ha=da.numMorphTargets;Z<ha;Z++)da.__webglMorphTargetsBuffers.push(t.createBuffer())}da=fa;Z=X;var ma=void 0,Q=void 0,ga=void 0,ka=void 0,sa=void 0,qa=void 0,Ia=qa=ha=0,za=void 0;ka=Z.geometry;za=ka.faces;sa=da.faces;ma=0;for(Q=sa.length;ma<Q;ma++){ga=sa[ma];ga=za[ga];ga instanceof THREE.Face3?(ha+=3,qa+=1,Ia+=3):ga instanceof THREE.Face4&&
(ha+=4,qa+=2,Ia+=4)}ma=da;Q=Z;var Ja=void 0,Xa=void 0;Ja=void 0;ga=[];za=0;for(sa=Q.materials.length;za<sa;za++)if(Ja=Q.materials[za],Ja instanceof THREE.MeshFaceMaterial){Ja=0;for(l=ma.materials.length;Ja<l;Ja++)(Xa=ma.materials[Ja])&&ga.push(Xa)}else(Xa=Ja)&&ga.push(Xa);ma=ga;a:{za=void 0;sa=ma.length;for(Q=0;Q<sa;Q++)if(za=ma[Q],za.map||za.lightMap||za instanceof THREE.MeshShaderMaterial){Q=!0;break a}Q=!1}a:{sa=void 0;ga=ma.length;for(za=0;za<ga;za++)if(sa=ma[za],!(sa instanceof THREE.MeshBasicMaterial&&
!sa.envMap||sa instanceof THREE.MeshDepthMaterial)){za=sa&&sa.shading!=void 0&&sa.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}za=!1}a:{ga=void 0;Ja=ma.length;for(sa=0;sa<Ja;sa++)if(ga=ma[sa],ga.vertexColors){ga=ga.vertexColors;break a}ga=!1}da.__vertexArray=new Float32Array(ha*3);if(za)da.__normalArray=new Float32Array(ha*3);if(ka.hasTangents)da.__tangentArray=new Float32Array(ha*4);if(ga)da.__colorArray=new Float32Array(ha*3);if(Q){if(ka.faceUvs.length>0||ka.faceVertexUvs.length>
0)da.__uvArray=new Float32Array(ha*2);if(ka.faceUvs.length>1||ka.faceVertexUvs.length>1)da.__uv2Array=new Float32Array(ha*2)}if(Z.geometry.skinWeights.length&&Z.geometry.skinIndices.length){da.__skinVertexAArray=new Float32Array(ha*4);da.__skinVertexBArray=new Float32Array(ha*4);da.__skinIndexArray=new Float32Array(ha*4);da.__skinWeightArray=new Float32Array(ha*4)}da.__faceArray=new Uint16Array(qa*3+(Z.geometry.edgeFaces?Z.geometry.edgeFaces.length*6:0));da.__lineArray=new Uint16Array(Ia*2);if(da.numMorphTargets){da.__morphTargetsArrays=
[];ka=0;for(sa=da.numMorphTargets;ka<sa;ka++)da.__morphTargetsArrays.push(new Float32Array(ha*3))}da.__needsSmoothNormals=za==THREE.SmoothShading;da.__uvType=Q;da.__vertexColorType=ga;da.__normalType=za;da.__webglFaceCount=qa*3+(Z.geometry.edgeFaces?Z.geometry.edgeFaces.length*6:0);da.__webglLineCount=Ia*2;ka=0;for(sa=ma.length;ka<sa;ka++)if(ma[ka].attributes)for(a in da.__webglCustomAttributes={},ma[ka].attributes){Q={};for(prop in ma[ka].attributes[a])Q[prop]=ma[ka].attributes[a][prop];if(!Q.__webglInitialized||
Q.createUniqueBuffers){Q.__webglInitialized=!0;qa=1;Q.type==="v2"?qa=2:Q.type==="v3"?qa=3:Q.type==="v4"?qa=4:Q.type==="c"&&(qa=3);Q.size=qa;Q.needsUpdate=!0;Q.array=new Float32Array(ha*qa);Q.buffer=t.createBuffer();Q.buffer.belongsToAttribute=a}da.__webglCustomAttributes[a]=Q}da.__inittedArrays=!0;N.__dirtyVertices=!0;N.__dirtyMorphTargets=!0;N.__dirtyElements=!0;N.__dirtyUvs=!0;N.__dirtyNormals=!0;N.__dirtyTangents=!0;N.__dirtyColors=!0}X instanceof THREE.ShadowVolume?z(L.__webglShadowVolumes,fa,
X):z(L.__webglObjects,fa,X)}else if(X instanceof THREE.LensFlare)z(L.__webglLensFlares,void 0,X);else if(X instanceof THREE.Ribbon){N=X.geometry;if(!N.__webglVertexBuffer){J=N;J.__webglVertexBuffer=t.createBuffer();J.__webglColorBuffer=t.createBuffer();J=N;fa=J.vertices.length;J.__vertexArray=new Float32Array(fa*3);J.__colorArray=new Float32Array(fa*3);J.__webglVertexCount=fa;N.__dirtyVertices=!0;N.__dirtyColors=!0}z(L.__webglObjects,N,X)}else if(X instanceof THREE.Line){N=X.geometry;if(!N.__webglVertexBuffer){J=
N;J.__webglVertexBuffer=t.createBuffer();J.__webglColorBuffer=t.createBuffer();J=N;fa=J.vertices.length;J.__vertexArray=new Float32Array(fa*3);J.__colorArray=new Float32Array(fa*3);J.__webglLineCount=fa;N.__dirtyVertices=!0;N.__dirtyColors=!0}z(L.__webglObjects,N,X)}else if(X instanceof THREE.ParticleSystem){N=X.geometry;if(!N.__webglVertexBuffer){J=N;J.__webglVertexBuffer=t.createBuffer();J.__webglColorBuffer=t.createBuffer();J=N;fa=J.vertices.length;J.__vertexArray=new Float32Array(fa*3);J.__colorArray=
new Float32Array(fa*3);J.__sortArray=[];J.__webglParticleCount=fa;N.__dirtyVertices=!0;N.__dirtyColors=!0}z(L.__webglObjects,N,X)}else THREE.MarchingCubes!==void 0&&X instanceof THREE.MarchingCubes?L.__webglObjectsImmediate.push({object:X,opaque:{list:[],count:0},transparent:{list:[],count:0}}):X instanceof THREE.Sprite&&L.__webglSprites.push(X);D.__objectsAdded.splice(0,1)}for(;D.__objectsRemoved.length;){X=D.__objectsRemoved[0];L=D;J=void 0;if(X instanceof THREE.Mesh)for(N=L.__webglObjects.length-
1;N>=0;N--){if(J=L.__webglObjects[N].object,X==J){L.__webglObjects.splice(N,1);break}}else if(X instanceof THREE.Sprite)for(N=L.__webglSprites.length-1;N>=0;N--)if(J=L.__webglSprites[N],X==J){L.__webglSprites.splice(N,1);break}D.__objectsRemoved.splice(0,1)}X=0;for(L=D.__webglObjects.length;X<L;X++)C(D.__webglObjects[X].object,D);X=0;for(L=D.__webglShadowVolumes.length;X<L;X++)C(D.__webglShadowVolumes[X].object,D);X=0;for(L=D.__webglLensFlares.length;X<L;X++)C(D.__webglLensFlares[X].object,D)};this.setFaceCulling=
function(D,X){D?(!X||X=="ccw"?t.frontFace(t.CCW):t.frontFace(t.CW),D=="back"?t.cullFace(t.BACK):D=="front"?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK),t.enable(t.CULL_FACE)):t.disable(t.CULL_FACE)};this.supportsVertexTextures=function(){return eb}};
THREE.WebGLRenderTarget=function(b,f,c){this.width=b;this.height=f;c=c||{};this.wrapS=c.wrapS!==void 0?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=c.wrapT!==void 0?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=c.magFilter!==void 0?c.magFilter:THREE.LinearFilter;this.minFilter=c.minFilter!==void 0?c.minFilter:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=c.format!==void 0?c.format:THREE.RGBAFormat;this.type=c.type!==void 0?c.type:
THREE.UnsignedByteType;this.depthBuffer=c.depthBuffer!==void 0?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==void 0?c.stencilBuffer:!0};
THREE.ColorUtils={adjustHSV:function(b,f,c,d){var g=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,g);g.h=THREE.ColorUtils.clamp(g.h+f,0,1);g.s=THREE.ColorUtils.clamp(g.s+c,0,1);g.v=THREE.ColorUtils.clamp(g.v+d,0,1);b.setHSV(g.h,g.s,g.v)},rgbToHsv:function(b,f){var c=b.r,d=b.g,g=b.b,h=Math.max(Math.max(c,d),g),n=Math.min(Math.min(c,d),g);if(n==h)n=c=0;else{var o=h-n;n=o/h;c=c==h?(d-g)/o:d==h?2+(g-c)/o:4+(c-d)/o;c/=6;c<0&&(c+=1);c>1&&(c-=1)}f===void 0&&(f={h:0,s:0,v:0});f.h=c;f.s=n;f.v=h;return f},
clamp:function(b,f,c){return b<f?f:b>c?c:b}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};
var GeometryUtils={merge:function(b,f){var c=f instanceof THREE.Mesh,d=b.vertices.length,g=c?f.geometry:f,h=b.vertices,n=g.vertices,o=b.faces,m=g.faces,p=b.faceVertexUvs[0];g=g.faceVertexUvs[0];c&&f.matrixAutoUpdate&&f.updateMatrix();for(var u=0,v=n.length;u<v;u++){var w=new THREE.Vertex(n[u].position.clone());c&&f.matrix.multiplyVector3(w.position);h.push(w)}u=0;for(v=m.length;u<v;u++){n=m[u];var x,y,A=n.vertexNormals;w=n.vertexColors;n instanceof THREE.Face3?x=new THREE.Face3(n.a+d,n.b+d,n.c+d):
n instanceof THREE.Face4&&(x=new THREE.Face4(n.a+d,n.b+d,n.c+d,n.d+d));x.normal.copy(n.normal);c=0;for(h=A.length;c<h;c++){y=A[c];x.vertexNormals.push(y.clone())}x.color.copy(n.color);c=0;for(h=w.length;c<h;c++){y=w[c];x.vertexColors.push(y.clone())}x.materials=n.materials.slice();x.centroid.copy(n.centroid);o.push(x)}u=0;for(v=g.length;u<v;u++){d=g[u];o=[];c=0;for(h=d.length;c<h;c++)o.push(new THREE.UV(d[c].u,d[c].v));p.push(o)}}};
THREE.ImageUtils={loadTexture:function(b,f,c){var d=new Image,g=new THREE.Texture(d,f);d.onload=function(){g.needsUpdate=!0;c&&c(this)};d.src=b;return g},loadTextureCube:function(b,f,c){var d,g=[],h=new THREE.Texture(g,f);f=g.loadCount=0;for(d=b.length;f<d;++f){g[f]=new Image;g[f].onload=function(){g.loadCount+=1;if(g.loadCount==6)h.needsUpdate=!0;c&&c(this)};g[f].src=b[f]}return h}};
THREE.SceneUtils={addMesh:function(b,f,c,d,g,h,n,o,m,p){f=new THREE.Mesh(f,p);f.scale.x=f.scale.y=f.scale.z=c;f.position.x=d;f.position.y=g;f.position.z=h;f.rotation.x=n;f.rotation.y=o;f.rotation.z=m;b.addObject(f);return f},addPanoramaCubeWebGL:function(b,f,c){var d=THREE.ShaderUtils.lib.cube;d.uniforms.tCube.texture=c;c=new THREE.MeshShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:d.uniforms});f=new THREE.Mesh(new THREE.Cube(f,f,f,1,1,1,null,!0),c);b.addObject(f);
return f},addPanoramaCube:function(b,f,c){var d=[];d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[4])}));d.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));f=new THREE.Mesh(new THREE.Cube(f,f,f,1,1,d,!0),
new THREE.MeshFaceMaterial);b.addObject(f);return f},addPanoramaCubePlanes:function(b,f,c){var d=f/2;f=new THREE.Plane(f,f);var g=Math.PI,h=Math.PI/2;THREE.SceneUtils.addMesh(b,f,1,0,0,-d,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[5])}));THREE.SceneUtils.addMesh(b,f,1,-d,0,0,0,h,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[0])}));THREE.SceneUtils.addMesh(b,f,1,d,0,0,0,-h,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[1])}));THREE.SceneUtils.addMesh(b,f,1,0,d,0,h,
0,g,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[2])}));THREE.SceneUtils.addMesh(b,f,1,0,-d,0,-h,0,g,new THREE.MeshBasicMaterial({map:new THREE.Texture(c[3])}))},showHierarchy:function(b,f){THREE.SceneUtils.traverseHierarchy(b,function(c){c.visible=f})},traverseHierarchy:function(b,f){var c,d,g=b.children.length;for(d=0;d<g;d++){c=b.children[d];f(c);THREE.SceneUtils.traverseHierarchy(c,f)}}};
THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new THREE.Vector3},uPointLightColor:{type:"c",
value:new THREE.Color(15658734)},uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(15658734)},uAmbientLightColor:{type:"c",value:new THREE.Color(328965)},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30}},fragmentShader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 specularTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight * pointDiffuseWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight * dirDiffuseWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertexShader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(b){var f,c,d,g,h=2*Math.ceil(b*3)+1;h>25&&(h=25);g=(h-1)*0.5;c=Array(h);for(f=d=0;f<h;++f){c[f]=Math.exp(-((f-g)*(f-g))/(2*b*b));d+=c[f]}for(f=0;f<h;++f)c[f]/=d;return c}};
THREE.AnimationHandler=function(){var b=[],f={},c={update:function(g){for(var h=0;h<b.length;h++)b[h].update(g)},addToUpdate:function(g){b.indexOf(g)===-1&&b.push(g)},removeFromUpdate:function(g){g=b.indexOf(g);g!==-1&&b.splice(g,1)},add:function(g){f[g.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+g.name+" already exists in library. Overwriting.");f[g.name]=g;if(g.initialized!==!0){for(var h=0;h<g.hierarchy.length;h++){for(var n=0;n<g.hierarchy[h].keys.length;n++){if(g.hierarchy[h].keys[n].time<
0)g.hierarchy[h].keys[n].time=0;if(g.hierarchy[h].keys[n].rot!==void 0&&!(g.hierarchy[h].keys[n].rot instanceof THREE.Quaternion)){var o=g.hierarchy[h].keys[n].rot;g.hierarchy[h].keys[n].rot=new THREE.Quaternion(o[0],o[1],o[2],o[3])}}if(g.hierarchy[h].keys[0].morphTargets!==void 0){o={};for(n=0;n<g.hierarchy[h].keys.length;n++)for(var m=0;m<g.hierarchy[h].keys[n].morphTargets.length;m++){var p=g.hierarchy[h].keys[n].morphTargets[m];o[p]=-1}g.hierarchy[h].usedMorphTargets=o;for(n=0;n<g.hierarchy[h].keys.length;n++){var u=
{};for(p in o){for(m=0;m<g.hierarchy[h].keys[n].morphTargets.length;m++)if(g.hierarchy[h].keys[n].morphTargets[m]===p){u[p]=g.hierarchy[h].keys[n].morphTargetsInfluences[m];break}m===g.hierarchy[h].keys[n].morphTargets.length&&(u[p]=0)}g.hierarchy[h].keys[n].morphTargetsInfluences=u}}for(n=1;n<g.hierarchy[h].keys.length;n++)g.hierarchy[h].keys[n].time===g.hierarchy[h].keys[n-1].time&&(g.hierarchy[h].keys.splice(n,1),n--);for(n=1;n<g.hierarchy[h].keys.length;n++)g.hierarchy[h].keys[n].index=n}n=parseInt(g.length*
g.fps,10);g.JIT={};g.JIT.hierarchy=[];for(h=0;h<g.hierarchy.length;h++)g.JIT.hierarchy.push(Array(n));g.initialized=!0}},get:function(g){if(typeof g==="string")return f[g]?f[g]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+g),null)},parse:function(g){var h=[];if(g instanceof THREE.SkinnedMesh)for(var n=0;n<g.bones.length;n++)h.push(g.bones[n]);else d(g,h);return h}},d=function(g,h){h.push(g);for(var n=0;n<g.children.length;n++)d(g.children[n],h)};c.LINEAR=0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=
2;return c}();THREE.Animation=function(b,f,c,d){this.root=b;this.data=THREE.AnimationHandler.get(f);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=c!==void 0?c:THREE.AnimationHandler.LINEAR;this.JITCompile=d!==void 0?d:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,f){if(!this.isPlaying){this.isPlaying=!0;this.loop=b!==void 0?b:!0;this.currentTime=f!==void 0?f:0;var c,d=this.hierarchy.length,g;for(c=0;c<d;c++){g=this.hierarchy[c];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)g.useQuaternion=!0;g.matrixAutoUpdate=!0;if(g.animationCache===void 0){g.animationCache={};g.animationCache.prevKey={pos:0,rot:0,scl:0};g.animationCache.nextKey={pos:0,rot:0,scl:0};g.animationCache.originalMatrix=g instanceof
THREE.Bone?g.skinMatrix:g.matrix}var h=g.animationCache.prevKey;g=g.animationCache.nextKey;h.pos=this.data.hierarchy[c].keys[0];h.rot=this.data.hierarchy[c].keys[0];h.scl=this.data.hierarchy[c].keys[0];g.pos=this.getNextKeyWith("pos",c,1);g.rot=this.getNextKeyWith("rot",c,1);g.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++)if(this.hierarchy[b].animationCache!==void 0){this.hierarchy[b]instanceof THREE.Bone?this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix:this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix;delete this.hierarchy[b].animationCache}};
THREE.Animation.prototype.update=function(b){if(this.isPlaying){var f=["pos","rot","scl"],c,d,g,h,n,o,m,p,u=this.data.JIT.hierarchy,v,w;this.currentTime+=b*this.timeScale;w=this.currentTime;v=this.currentTime%=this.data.length;p=parseInt(Math.min(v*this.data.fps,this.data.length*this.data.fps),10);for(var x=0,y=this.hierarchy.length;x<y;x++)if(b=this.hierarchy[x],m=b.animationCache,this.JITCompile&&u[x][p]!==void 0)b instanceof THREE.Bone?(b.skinMatrix=u[x][p],b.matrixAutoUpdate=!1,b.matrixWorldNeedsUpdate=
!1):(b.matrix=u[x][p],b.matrixAutoUpdate=!1,b.matrixWorldNeedsUpdate=!0);else{if(this.JITCompile)b instanceof THREE.Bone?b.skinMatrix=b.animationCache.originalMatrix:b.matrix=b.animationCache.originalMatrix;for(var A=0;A<3;A++){c=f[A];n=m.prevKey[c];o=m.nextKey[c];if(o.time<=w){if(v<w)if(this.loop){n=this.data.hierarchy[x].keys[0];for(o=this.getNextKeyWith(c,x,1);o.time<v;){n=o;o=this.getNextKeyWith(c,x,o.index+1)}}else{this.stop();return}else{do{n=o;o=this.getNextKeyWith(c,x,o.index+1)}while(o.time<
v)}m.prevKey[c]=n;m.nextKey[c]=o}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;d=(v-n.time)/(o.time-n.time);g=n[c];h=o[c];if(d<0||d>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+x);d=d<0?0:1}if(c==="pos")if(c=b.position,this.interpolationType===THREE.AnimationHandler.LINEAR){c.x=g[0]+(h[0]-g[0])*d;c.y=g[1]+(h[1]-g[1])*d;c.z=g[2]+(h[2]-g[2])*d}else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)if(this.points[0]=
this.getPrevKeyWith("pos",x,n.index-1).pos,this.points[1]=g,this.points[2]=h,this.points[3]=this.getNextKeyWith("pos",x,o.index+1).pos,d=d*0.33+0.33,g=this.interpolateCatmullRom(this.points,d),c.x=g[0],c.y=g[1],c.z=g[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){d=this.interpolateCatmullRom(this.points,d*1.01);this.target.set(d[0],d[1],d[2]);this.target.subSelf(c);this.target.y=0;this.target.normalize();d=Math.atan2(this.target.x,this.target.z);b.rotation.set(0,d,0)}}else if(c===
"rot")THREE.Quaternion.slerp(g,h,b.quaternion,d);else if(c==="scl"){c=b.scale;c.x=g[0]+(h[0]-g[0])*d;c.y=g[1]+(h[1]-g[1])*d;c.z=g[2]+(h[2]-g[2])*d}}}if(this.JITCompile&&u[0][p]===void 0){this.hierarchy[0].update(void 0,!0);for(x=0;x<this.hierarchy.length;x++)u[x][p]=this.hierarchy[x]instanceof THREE.Bone?this.hierarchy[x].skinMatrix.clone():this.hierarchy[x].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,f){var c=[],d=[],g,h,n,o,m,p;g=(b.length-1)*f;h=Math.floor(g);g-=h;c[0]=h==0?h:h-1;c[1]=h;c[2]=h>b.length-2?h:h+1;c[3]=h>b.length-3?h:h+2;h=b[c[0]];o=b[c[1]];m=b[c[2]];p=b[c[3]];c=g*g;n=g*c;d[0]=this.interpolate(h[0],o[0],m[0],p[0],g,c,n);d[1]=this.interpolate(h[1],o[1],m[1],p[1],g,c,n);d[2]=this.interpolate(h[2],o[2],m[2],p[2],g,c,n);return d};
THREE.Animation.prototype.interpolate=function(b,f,c,d,g,h,n){b=(c-b)*0.5;d=(d-f)*0.5;return(2*(f-c)+b+d)*n+(-3*(f-c)-2*b-d)*h+b*g+f};THREE.Animation.prototype.getNextKeyWith=function(b,f,c){var d=this.data.hierarchy[f].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c=c<d.length-1?c:d.length-1:c%=d.length;c<d.length;c++)if(d[c][b]!==void 0)return d[c];return this.data.hierarchy[f].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,f,c){var d=this.data.hierarchy[f].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(d[c][b]!==void 0)return d[c];return this.data.hierarchy[f].keys[d.length-1]};
THREE.QuakeCamera=function(b){function f(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.movementSpeed=1;this.lookSpeed=0.0050;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(b){if(b.movementSpeed!==void 0)this.movementSpeed=
b.movementSpeed;if(b.lookSpeed!==void 0)this.lookSpeed=b.lookSpeed;if(b.noFly!==void 0)this.noFly=b.noFly;if(b.lookVertical!==void 0)this.lookVertical=b.lookVertical;if(b.autoForward!==void 0)this.autoForward=b.autoForward;if(b.activeLook!==void 0)this.activeLook=b.activeLook;if(b.heightSpeed!==void 0)this.heightSpeed=b.heightSpeed;if(b.heightCoef!==void 0)this.heightCoef=b.heightCoef;if(b.heightMin!==void 0)this.heightMin=b.heightMin;if(b.heightMax!==void 0)this.heightMax=b.heightMax;if(b.constrainVertical!==
void 0)this.constrainVertical=b.constrainVertical;if(b.verticalMin!==void 0)this.verticalMin=b.verticalMin;if(b.verticalMax!==void 0)this.verticalMax=b.verticalMax;if(b.domElement!==void 0)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();
c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=
!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var c=(new Date).getTime();this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;if(!this.freeze){this.autoSpeedFactor=
this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var d=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(d+this.autoSpeedFactor));this.moveBackward&&this.translateZ(d);this.moveLeft&&this.translateX(-d);this.moveRight&&this.translateX(d);d=this.tdiff*this.lookSpeed;this.activeLook||(d=0);this.lon+=this.mouseX*d;this.lookVertical&&
(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;c=this.target.position;var g=this.position;c.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=g.y+100*Math.cos(this.phi);c.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*d;this.lookVertical&&(this.lat-=this.mouseY*d);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=
(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin;c=this.target.position;g=this.position;c.x=g.x+100*Math.sin(this.phi)*Math.cos(this.theta);c.y=g.y+100*Math.cos(this.phi);c.z=g.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",f(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",f(this,this.onMouseDown),
!1);this.domElement.addEventListener("mouseup",f(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",f(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",f(this,this.onKeyUp),!1)};THREE.QuakeCamera.prototype=new THREE.Camera;THREE.QuakeCamera.prototype.constructor=THREE.QuakeCamera;THREE.QuakeCamera.prototype.supr=THREE.Camera.prototype;
THREE.QuakeCamera.prototype.translate=function(b,f){this.matrix.rotateAxis(f);if(this.noFly)f.y=0;this.position.addSelf(f.multiplyScalar(b));this.target.position.addSelf(f.multiplyScalar(b))};
THREE.PathCamera=function(b){function f(p,u,v,w){var x={name:v,fps:0.6,length:w,hierarchy:[]},y,A=u.getControlPointsArray(),B=u.getLength(),C=A.length,E=0;y=C-1;u={parent:-1,keys:[]};u.keys[0]={time:0,pos:A[0],rot:[0,0,0,1],scl:[1,1,1]};u.keys[y]={time:w,pos:A[y],rot:[0,0,0,1],scl:[1,1,1]};for(y=1;y<C-1;y++){E=w*B.chunks[y]/B.total;u.keys[y]={time:E,pos:A[y]}}x.hierarchy[0]=u;THREE.AnimationHandler.add(x);return new THREE.Animation(p,v,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function c(p,u){var v,
w,x=new THREE.Geometry;for(v=0;v<p.points.length*u;v++){w=v/(p.points.length*u);w=p.getPoint(w);x.vertices[v]=new THREE.Vertex(new THREE.Vector3(w.x,w.y,w.z))}return x}function d(p,u){var v=c(u,10),w=c(u,10),x=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(v,x);particleObj=new THREE.ParticleSystem(w,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);p.addChild(lineObj);particleObj.scale.set(1,1,1);p.addChild(particleObj);w=new THREE.Sphere(1,
16,8);x=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<u.points.length;i++){v=new THREE.Mesh(w,x);v.position.copy(u.points[i]);v.updateMatrix();p.addChild(v)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=1E4;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.0050;this.lookHorizontal=
this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(b){if(b.duration!==void 0)this.duration=b.duration*1E3;if(b.waypoints!==void 0)this.waypoints=b.waypoints;if(b.useConstantSpeed!==void 0)this.useConstantSpeed=b.useConstantSpeed;if(b.resamplingCoef!==void 0)this.resamplingCoef=b.resamplingCoef;if(b.createDebugPath!==void 0)this.createDebugPath=b.createDebugPath;if(b.createDebugDummy!==
void 0)this.createDebugDummy=b.createDebugDummy;if(b.lookSpeed!==void 0)this.lookSpeed=b.lookSpeed;if(b.lookVertical!==void 0)this.lookVertical=b.lookVertical;if(b.lookHorizontal!==void 0)this.lookHorizontal=b.lookHorizontal;if(b.verticalAngleMap!==void 0)this.verticalAngleMap=b.verticalAngleMap;if(b.horizontalAngleMap!==void 0)this.horizontalAngleMap=b.horizontalAngleMap;if(b.domElement!==void 0)this.domElement=b.domElement}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=
window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var g=Math.PI*2,h=Math.PI/180;this.update=function(p,u,v){var w,x;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*h;this.theta=this.lon*h;w=this.phi%g;this.phi=w>=0?w:w+g;w=this.verticalAngleMap.srcRange;x=this.verticalAngleMap.dstRange;var y=x[1]-x[0];this.phi=
TWEEN.Easing.Quadratic.EaseInOut(((this.phi-w[0])*(x[1]-x[0])/(w[1]-w[0])+x[0]-x[0])/y)*y+x[0];w=this.horizontalAngleMap.srcRange;x=this.horizontalAngleMap.dstRange;y=x[1]-x[0];this.theta=TWEEN.Easing.Quadratic.EaseInOut(((this.theta-w[0])*(x[1]-x[0])/(w[1]-w[0])+x[0]-x[0])/y)*y+x[0];w=this.target.position;w.x=100*Math.sin(this.phi)*Math.cos(this.theta);w.y=100*Math.cos(this.phi);w.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,p,u,v)};this.onMouseMove=function(p){this.mouseX=
p.clientX-this.windowHalfX;this.mouseY=p.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){b=new THREE.MeshLambertMaterial({color:30719});var n=new THREE.MeshLambertMaterial({color:65280}),o=new THREE.Cube(10,10,20),m=new THREE.Cube(2,2,10);this.animationParent=new THREE.Mesh(o,b);b=new THREE.Mesh(m,n);b.position.set(0,10,0);this.animation=f(this.animationParent,
this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(b)}else{this.animation=f(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this.target);this.animationParent.addChild(this)}this.createDebugPath&&d(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(p,u){return function(){u.apply(p,arguments)}}(this,this.onMouseMove),!1)};
THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;
THREE.FlyCamera=function(b){function f(c,d){return function(){d.apply(c,arguments)}}THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.0050;this.autoForward=this.dragToLook=!1;this.domElement=document;if(b){if(b.movementSpeed!==void 0)this.movementSpeed=b.movementSpeed;if(b.rollSpeed!==void 0)this.rollSpeed=b.rollSpeed;if(b.dragToLook!==void 0)this.dragToLook=b.dragToLook;if(b.autoForward!==void 0)this.autoForward=
b.autoForward;if(b.domElement!==void 0)this.domElement=b.domElement}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function")this[c.type](c)};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=
0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};
this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;
case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}};this.mousemove=function(c){if(!this.dragToLook||this.mouseStatus>0){var d=this.getContainerDimensions(),g=d.size[0]/2,h=d.size[1]/2;this.moveState.yawLeft=-(c.clientX-d.offset[0]-g)/g;this.moveState.pitchDown=(c.clientY-
d.offset[1]-h)/h;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()};this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=c;this.tdiff=(c-this.lastUpdate)/1E3;this.lastUpdate=c;c=this.tdiff*this.movementSpeed;var d=this.tdiff*
this.rollSpeed;this.translateX(this.moveVector.x*c);this.translateY(this.moveVector.y*c);this.translateZ(this.moveVector.z*c);this.tmpQuaternion.set(this.rotationVector.x*d,this.rotationVector.y*d,this.rotationVector.z*d,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||
this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=
document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",f(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",f(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",f(this,this.mouseup),!1);window.addEventListener("keydown",f(this,this.keydown),!1);window.addEventListener("keyup",f(this,
this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;
THREE.RollCamera=function(b,f,c,d){THREE.Camera.call(this,b,f,c,d);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.matrixAutoUpdate=this.useTarget=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var g=new THREE.Vector3,h=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Matrix4,m=!1,p=1,u=0,v=0,w=0,x=0,y=0,A=window.innerWidth/2,B=window.innerHeight/2;this.update=
function(){var C=(new Date).getTime();if(this.lastUpdate==-1)this.lastUpdate=C;this.delta=(C-this.lastUpdate)/1E3;this.lastUpdate=C;this.mouseLook&&(C=this.delta*this.lookSpeed,this.rotateHorizontally(C*x),this.rotateVertically(C*y));C=this.delta*this.movementSpeed;this.translateZ(C*(u>0||this.autoForward&&!(u<0)?1:u));this.translateX(C*v);this.translateY(C*w);m&&(this.roll+=this.rollSpeed*this.delta*p);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<
this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}n.copy(this.forward);h.set(0,1,0);g.cross(h,n).normalize();h.cross(n,g).normalize();this.matrix.n11=g.x;this.matrix.n12=h.x;this.matrix.n13=n.x;this.matrix.n21=g.y;this.matrix.n22=h.y;this.matrix.n23=n.y;this.matrix.n31=g.z;this.matrix.n32=h.z;this.matrix.n33=n.z;o.identity();o.n11=Math.cos(this.roll);o.n12=-Math.sin(this.roll);o.n21=Math.sin(this.roll);o.n22=Math.cos(this.roll);this.matrix.multiplySelf(o);
this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(C){this.position.x+=this.matrix.n11*C;this.position.y+=this.matrix.n21*C;this.position.z+=this.matrix.n31*C};this.translateY=function(C){this.position.x+=this.matrix.n12*C;this.position.y+=this.matrix.n22*C;this.position.z+=this.matrix.n32*C};this.translateZ=function(C){this.position.x-=this.matrix.n13*C;this.position.y-=
this.matrix.n23*C;this.position.z-=this.matrix.n33*C};this.rotateHorizontally=function(C){g.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);g.multiplyScalar(C);this.forward.subSelf(g);this.forward.normalize()};this.rotateVertically=function(C){h.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);h.multiplyScalar(C);this.forward.addSelf(h);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(C){C.preventDefault()},!1);this.domElement.addEventListener("mousemove",
function(C){x=(C.clientX-A)/window.innerWidth;y=(C.clientY-B)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(C){C.preventDefault();C.stopPropagation();switch(C.button){case 0:u=1;break;case 2:u=-1}},!1);this.domElement.addEventListener("mouseup",function(C){C.preventDefault();C.stopPropagation();switch(C.button){case 0:u=0;break;case 2:u=0}},!1);this.domElement.addEventListener("keydown",function(C){switch(C.keyCode){case 38:case 87:u=1;break;case 37:case 65:v=-1;break;
case 40:case 83:u=-1;break;case 39:case 68:v=1;break;case 81:m=!0;p=1;break;case 69:m=!0;p=-1;break;case 82:w=1;break;case 70:w=-1}},!1);this.domElement.addEventListener("keyup",function(C){switch(C.keyCode){case 38:case 87:u=0;break;case 37:case 65:v=0;break;case 40:case 83:u=0;break;case 39:case 68:v=0;break;case 81:m=!1;break;case 69:m=!1;break;case 82:w=0;break;case 70:w=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;
THREE.RollCamera.prototype.supr=THREE.Camera.prototype;
THREE.TrackballCamera=function(b){function f(v,w){return function(){w.apply(v,arguments)}}b=b||{};THREE.Camera.call(this,b.fov,b.aspect,b.near,b.far,b.target);this.domElement=b.domElement||document;this.screen=b.screen||{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=b.radius||(this.screen.width+this.screen.height)/4;this.rotateSpeed=b.rotateSpeed||1;this.zoomSpeed=b.zoomSpeed||1.2;this.panSpeed=b.panSpeed||0.3;this.noZoom=b.noZoom||!1;this.noPan=b.noPan||
!1;this.staticMoving=b.staticMoving||!1;this.dynamicDampingFactor=b.dynamicDampingFactor||0.2;this.minDistance=b.minDistance||0;this.maxDistance=b.maxDistance||Infinity;this.keys=b.keys||[65,83,68];this.useTarget=!0;var c=!1,d=this.STATE.NONE,g=new THREE.Vector3,h=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector2,m=new THREE.Vector2,p=new THREE.Vector2,u=new THREE.Vector2;this.handleEvent=function(v){if(typeof this[v.type]=="function")this[v.type](v)};this.getMouseOnScreen=function(v,w){return new THREE.Vector2((v-
this.screen.offsetLeft)/this.radius*0.5,(w-this.screen.offsetTop)/this.radius*0.5)};this.getMouseProjectionOnBall=function(v,w){var x=new THREE.Vector3((v-this.screen.width*0.5-this.screen.offsetLeft)/this.radius,(this.screen.height*0.5+this.screen.offsetTop-w)/this.radius,0),y=x.length();y>1?x.normalize():x.z=Math.sqrt(1-y*y);g=this.position.clone().subSelf(this.target.position);y=this.up.clone().setLength(x.y);y.addSelf(this.up.clone().crossSelf(g).setLength(x.x));y.addSelf(g.setLength(x.z));return y};
this.rotateCamera=function(){var v=Math.acos(h.dot(n)/h.length()/n.length());if(v){var w=(new THREE.Vector3).cross(h,n).normalize(),x=new THREE.Quaternion;v*=this.rotateSpeed;x.setFromAxisAngle(w,-v);x.multiplyVector3(g);x.multiplyVector3(this.up);x.multiplyVector3(n);this.staticMoving?h=n:(x.setFromAxisAngle(w,v*(this.dynamicDampingFactor-1)),x.multiplyVector3(h))}};this.zoomCamera=function(){var v=1+(m.y-o.y)*this.zoomSpeed;v!==1&&v>0&&(g.multiplyScalar(v),this.staticMoving?o=m:o.y+=(m.y-o.y)*this.dynamicDampingFactor)};
this.panCamera=function(){var v=u.clone().subSelf(p);if(v.lengthSq()){v.multiplyScalar(g.length()*this.panSpeed);var w=g.clone().crossSelf(this.up).setLength(v.x);w.addSelf(this.up.clone().setLength(v.y));this.position.addSelf(w);this.target.position.addSelf(w);this.staticMoving?p=u:p.addSelf(v.sub(u,p).multiplyScalar(this.dynamicDampingFactor))}};this.checkDistances=function(){if(!this.noZoom||!this.noPan){this.position.lengthSq()>this.maxDistance*this.maxDistance&&this.position.setLength(this.maxDistance);
g.lengthSq()<this.minDistance*this.minDistance&&this.position.add(this.target.position,g.setLength(this.minDistance))}};this.update=function(v,w,x){g=this.position.clone().subSelf(this.target.position);this.rotateCamera();this.noZoom||this.zoomCamera();this.noPan||this.panCamera();this.position.add(this.target.position,g);this.checkDistances();this.supr.update.call(this,v,w,x)};this.domElement.addEventListener("contextmenu",function(v){v.preventDefault()},!1);this.domElement.addEventListener("mousemove",
f(this,function(v){c&&(h=n=this.getMouseProjectionOnBall(v.clientX,v.clientY),o=m=this.getMouseOnScreen(v.clientX,v.clientY),p=u=this.getMouseOnScreen(v.clientX,v.clientY),c=!1);d!==this.STATE.NONE&&(d===this.STATE.ROTATE?n=this.getMouseProjectionOnBall(v.clientX,v.clientY):d===this.STATE.ZOOM&&!this.noZoom?m=this.getMouseOnScreen(v.clientX,v.clientY):d===this.STATE.PAN&&!this.noPan&&(u=this.getMouseOnScreen(v.clientX,v.clientY)))}),!1);this.domElement.addEventListener("mousedown",f(this,function(v){v.preventDefault();
v.stopPropagation();if(d===this.STATE.NONE){d=v.button;d===this.STATE.ROTATE?h=n=this.getMouseProjectionOnBall(v.clientX,v.clientY):d===this.STATE.ZOOM&&!this.noZoom?o=m=this.getMouseOnScreen(v.clientX,v.clientY):this.noPan||(p=u=this.getMouseOnScreen(v.clientX,v.clientY))}}),!1);this.domElement.addEventListener("mouseup",f(this,function(v){v.preventDefault();v.stopPropagation();d=this.STATE.NONE}),!1);window.addEventListener("keydown",f(this,function(v){if(d===this.STATE.NONE){if(v.keyCode===this.keys[this.STATE.ROTATE])d=
this.STATE.ROTATE;else if(v.keyCode===this.keys[this.STATE.ZOOM]&&!this.noZoom)d=this.STATE.ZOOM;else if(v.keyCode===this.keys[this.STATE.PAN]&&!this.noPan)d=this.STATE.PAN;d!==this.STATE.NONE&&(c=!0)}}),!1);window.addEventListener("keyup",f(this,function(){if(d!==this.STATE.NONE)d=this.STATE.NONE}),!1)};THREE.TrackballCamera.prototype=new THREE.Camera;THREE.TrackballCamera.prototype.constructor=THREE.TrackballCamera;THREE.TrackballCamera.prototype.supr=THREE.Camera.prototype;
THREE.TrackballCamera.prototype.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};
THREE.Cube=function(b,f,c,d,g,h,n,o,m){function p(B,C,E,z,H,G,F,T){var $,W,V=d||1,S=g||1,t=H/2,M=G/2,I=u.vertices.length;if(B=="x"&&C=="y"||B=="y"&&C=="x")$="z";else if(B=="x"&&C=="z"||B=="z"&&C=="x"){$="y";S=h||1}else if(B=="z"&&C=="y"||B=="y"&&C=="z"){$="x";V=h||1}var P=V+1,O=S+1;H/=V;var R=G/S;for(W=0;W<O;W++)for(G=0;G<P;G++){var ca=new THREE.Vector3;ca[B]=(G*H-t)*E;ca[C]=(W*R-M)*z;ca[$]=F;u.vertices.push(new THREE.Vertex(ca))}for(W=0;W<S;W++)for(G=0;G<V;G++){u.faces.push(new THREE.Face4(G+P*W+
I,G+P*(W+1)+I,G+1+P*(W+1)+I,G+1+P*W+I,null,null,T));u.faceVertexUvs[0].push([new THREE.UV(G/V,W/S),new THREE.UV(G/V,(W+1)/S),new THREE.UV((G+1)/V,(W+1)/S),new THREE.UV((G+1)/V,W/S)])}}THREE.Geometry.call(this);var u=this,v=b/2,w=f/2,x=c/2;o=o?-1:1;if(n!==void 0)if(n instanceof Array)this.materials=n;else{this.materials=[];for(var y=0;y<6;y++)this.materials.push([n])}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(m!=void 0)for(var A in m)this.sides[A]!=void 0&&(this.sides[A]=
m[A]);this.sides.px&&p("z","y",1*o,-1,c,f,-v,this.materials[0]);this.sides.nx&&p("z","y",-1*o,-1,c,f,v,this.materials[1]);this.sides.py&&p("x","z",1*o,1,b,c,w,this.materials[2]);this.sides.ny&&p("x","z",1*o,-1,b,c,-w,this.materials[3]);this.sides.pz&&p("x","y",1*o,-1,b,f,x,this.materials[4]);this.sides.nz&&p("x","y",-1*o,-1,b,f,-x,this.materials[5]);(function(){for(var B=[],C=[],E=0,z=u.vertices.length;E<z;E++){for(var H=u.vertices[E],G=!1,F=0,T=B.length;F<T;F++){var $=B[F];if(H.position.x==$.position.x&&
H.position.y==$.position.y&&H.position.z==$.position.z){C[E]=F;G=!0;break}}if(!G){C[E]=B.length;B.push(new THREE.Vertex(H.position.clone()))}}E=0;for(z=u.faces.length;E<z;E++){H=u.faces[E];H.a=C[H.a];H.b=C[H.b];H.c=C[H.c];H.d=C[H.d]}u.vertices=B})();this.computeCentroids();this.computeFaceNormals()};THREE.Cube.prototype=new THREE.Geometry;THREE.Cube.prototype.constructor=THREE.Cube;
THREE.Cylinder=function(b,f,c,d,g,h){function n(w,x,y){o.vertices.push(new THREE.Vertex(new THREE.Vector3(w,x,y)))}THREE.Geometry.call(this);var o=this,m,p=Math.PI*2,u=d/2;for(m=0;m<b;m++)n(Math.sin(p*m/b)*f,Math.cos(p*m/b)*f,-u);for(m=0;m<b;m++)n(Math.sin(p*m/b)*c,Math.cos(p*m/b)*c,u);for(m=0;m<b;m++)o.faces.push(new THREE.Face4(m,m+b,b+(m+1)%b,(m+1)%b));if(c>0){n(0,0,-u-(h||0));for(m=b;m<b+b/2;m++)o.faces.push(new THREE.Face4(2*b,(2*m-2*b)%b,(2*m-2*b+1)%b,(2*m-2*b+2)%b))}if(f>0){n(0,0,u+(g||0));
for(m=b+b/2;m<2*b;m++)o.faces.push(new THREE.Face4(2*b+1,(2*m-2*b+2)%b+b,(2*m-2*b+1)%b+b,(2*m-2*b)%b+b))}m=0;for(b=this.faces.length;m<b;m++){f=[];c=this.faces[m];g=this.vertices[c.a];h=this.vertices[c.b];u=this.vertices[c.c];var v=this.vertices[c.d];f.push(new THREE.UV(0.5+Math.atan2(g.position.x,g.position.y)/p,0.5+g.position.z/d));f.push(new THREE.UV(0.5+Math.atan2(h.position.x,h.position.y)/p,0.5+h.position.z/d));f.push(new THREE.UV(0.5+Math.atan2(u.position.x,u.position.y)/p,0.5+u.position.z/
d));c instanceof THREE.Face4&&f.push(new THREE.UV(0.5+Math.atan2(v.position.x,v.position.y)/p,0.5+v.position.z/d));this.faceVertexUvs[0].push(f)}this.computeCentroids();this.computeFaceNormals()};THREE.Cylinder.prototype=new THREE.Geometry;THREE.Cylinder.prototype.constructor=THREE.Cylinder;
THREE.Icosahedron=function(b){function f(v,w,x){var y=Math.sqrt(v*v+w*w+x*x);return g.vertices.push(new THREE.Vertex(new THREE.Vector3(v/y,w/y,x/y)))-1}function c(v,w,x,y){y.faces.push(new THREE.Face3(v,w,x))}function d(v,w){var x=g.vertices[v].position,y=g.vertices[w].position;return f((x.x+y.x)/2,(x.y+y.y)/2,(x.z+y.z)/2)}var g=this,h=new THREE.Geometry,n;this.subdivisions=b||0;THREE.Geometry.call(this);b=(1+Math.sqrt(5))/2;f(-1,b,0);f(1,b,0);f(-1,-b,0);f(1,-b,0);f(0,-1,b);f(0,1,b);f(0,-1,-b);f(0,
1,-b);f(b,0,-1);f(b,0,1);f(-b,0,-1);f(-b,0,1);c(0,11,5,h);c(0,5,1,h);c(0,1,7,h);c(0,7,10,h);c(0,10,11,h);c(1,5,9,h);c(5,11,4,h);c(11,10,2,h);c(10,7,6,h);c(7,1,8,h);c(3,9,4,h);c(3,4,2,h);c(3,2,6,h);c(3,6,8,h);c(3,8,9,h);c(4,9,5,h);c(2,4,11,h);c(6,2,10,h);c(8,6,7,h);c(9,8,1,h);for(b=0;b<this.subdivisions;b++){n=new THREE.Geometry;for(var o in h.faces){var m=d(h.faces[o].a,h.faces[o].b),p=d(h.faces[o].b,h.faces[o].c),u=d(h.faces[o].c,h.faces[o].a);c(h.faces[o].a,m,u,n);c(h.faces[o].b,p,m,n);c(h.faces[o].c,
u,p,n);c(m,p,u,n)}h.faces=n.faces}g.faces=h.faces;delete h;delete n;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Icosahedron.prototype=new THREE.Geometry;THREE.Icosahedron.prototype.constructor=THREE.Icosahedron;
THREE.Lathe=function(b,f,c){THREE.Geometry.call(this);this.steps=f||12;this.angle=c||2*Math.PI;f=this.angle/this.steps;c=[];for(var d=[],g=[],h=[],n=(new THREE.Matrix4).setRotationZ(f),o=0;o<b.length;o++){this.vertices.push(new THREE.Vertex(b[o]));c[o]=b[o].clone();d[o]=this.vertices.length-1}for(var m=0;m<=this.angle+0.0010;m+=f){for(o=0;o<c.length;o++)m<this.angle?(c[o]=n.multiplyVector3(c[o].clone()),this.vertices.push(new THREE.Vertex(c[o])),g[o]=this.vertices.length-1):g=h;m==0&&(h=d);for(o=
0;o<d.length-1;o++){this.faces.push(new THREE.Face4(g[o],g[o+1],d[o+1],d[o]));this.faceVertexUvs[0].push([new THREE.UV(1-m/this.angle,o/b.length),new THREE.UV(1-m/this.angle,(o+1)/b.length),new THREE.UV(1-(m-f)/this.angle,(o+1)/b.length),new THREE.UV(1-(m-f)/this.angle,o/b.length)])}d=g;g=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Lathe.prototype=new THREE.Geometry;THREE.Lathe.prototype.constructor=THREE.Lathe;
THREE.Plane=function(b,f,c,d){THREE.Geometry.call(this);var g,h=b/2,n=f/2;c=c||1;d=d||1;var o=c+1,m=d+1;b/=c;var p=f/d;for(g=0;g<m;g++)for(f=0;f<o;f++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(f*b-h,-(g*p-n),0)));for(g=0;g<d;g++)for(f=0;f<c;f++){this.faces.push(new THREE.Face4(f+o*g,f+o*(g+1),f+1+o*(g+1),f+1+o*g));this.faceVertexUvs[0].push([new THREE.UV(f/c,g/d),new THREE.UV(f/c,(g+1)/d),new THREE.UV((f+1)/c,(g+1)/d),new THREE.UV((f+1)/c,g/d)])}this.computeCentroids();this.computeFaceNormals()};
THREE.Plane.prototype=new THREE.Geometry;THREE.Plane.prototype.constructor=THREE.Plane;
THREE.Sphere=function(b,f,c){THREE.Geometry.call(this);var d,g=Math.PI,h=Math.max(3,f||8),n=Math.max(2,c||6);f=[];for(c=0;c<n+1;c++){d=c/n;var o=b*Math.cos(d*g),m=b*Math.sin(d*g),p=[],u=0;for(d=0;d<h;d++){var v=2*d/h,w=m*Math.sin(v*g);v=m*Math.cos(v*g);(c==0||c==n)&&d>0||(u=this.vertices.push(new THREE.Vertex(new THREE.Vector3(v,o,w)))-1);p.push(u)}f.push(p)}var x,y,A;g=f.length;for(c=0;c<g;c++)if(h=f[c].length,c>0)for(d=0;d<h;d++){p=d==h-1;n=f[c][p?0:d+1];o=f[c][p?h-1:d];m=f[c-1][p?h-1:d];p=f[c-
1][p?0:d+1];w=c/(g-1);x=(c-1)/(g-1);y=(d+1)/h;v=d/h;u=new THREE.UV(1-y,w);w=new THREE.UV(1-v,w);v=new THREE.UV(1-v,x);var B=new THREE.UV(1-y,x);c<f.length-1&&(x=this.vertices[n].position.clone(),y=this.vertices[o].position.clone(),A=this.vertices[m].position.clone(),x.normalize(),y.normalize(),A.normalize(),this.faces.push(new THREE.Face3(n,o,m,[new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(y.x,y.y,y.z),new THREE.Vector3(A.x,A.y,A.z)])),this.faceVertexUvs[0].push([u,w,v]));c>1&&(x=this.vertices[n].position.clone(),
y=this.vertices[m].position.clone(),A=this.vertices[p].position.clone(),x.normalize(),y.normalize(),A.normalize(),this.faces.push(new THREE.Face3(n,m,p,[new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(y.x,y.y,y.z),new THREE.Vector3(A.x,A.y,A.z)])),this.faceVertexUvs[0].push([u,v,B]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:b}};THREE.Sphere.prototype=new THREE.Geometry;THREE.Sphere.prototype.constructor=THREE.Sphere;
THREE.Torus=function(b,f,c,d){THREE.Geometry.call(this);this.radius=b||100;this.tube=f||40;this.segmentsR=c||8;this.segmentsT=d||6;b=[];for(f=0;f<=this.segmentsR;++f)for(c=0;c<=this.segmentsT;++c){d=c/this.segmentsT*2*Math.PI;var g=f/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(g))*Math.cos(d),(this.radius+this.tube*Math.cos(g))*Math.sin(d),this.tube*Math.sin(g))));b.push([c/this.segmentsT,1-f/this.segmentsR])}for(f=1;f<=this.segmentsR;++f)for(c=
1;c<=this.segmentsT;++c){d=(this.segmentsT+1)*f+c;g=(this.segmentsT+1)*f+c-1;var h=(this.segmentsT+1)*(f-1)+c-1,n=(this.segmentsT+1)*(f-1)+c;this.faces.push(new THREE.Face4(d,g,h,n));this.faceVertexUvs[0].push([new THREE.UV(b[d][0],b[d][1]),new THREE.UV(b[g][0],b[g][1]),new THREE.UV(b[h][0],b[h][1]),new THREE.UV(b[n][0],b[n][1])])}delete b;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.Torus.prototype=new THREE.Geometry;THREE.Torus.prototype.constructor=THREE.Torus;
THREE.TorusKnot=function(b,f,c,d,g,h,n){function o(v,w,x,y,A,B){w=x/y*v;x=Math.cos(w);return new THREE.Vector3(A*(2+x)*0.5*Math.cos(v),A*(2+x)*Math.sin(v)*0.5,B*A*Math.sin(w)*0.5)}THREE.Geometry.call(this);this.radius=b||200;this.tube=f||40;this.segmentsR=c||64;this.segmentsT=d||8;this.p=g||2;this.q=h||3;this.heightScale=n||1;this.grid=Array(this.segmentsR);c=new THREE.Vector3;d=new THREE.Vector3;h=new THREE.Vector3;for(b=0;b<this.segmentsR;++b){this.grid[b]=Array(this.segmentsT);for(f=0;f<this.segmentsT;++f){var m=
b/this.segmentsR*2*this.p*Math.PI;n=f/this.segmentsT*2*Math.PI;g=o(m,n,this.q,this.p,this.radius,this.heightScale);m=o(m+0.01,n,this.q,this.p,this.radius,this.heightScale);c.x=m.x-g.x;c.y=m.y-g.y;c.z=m.z-g.z;d.x=m.x+g.x;d.y=m.y+g.y;d.z=m.z+g.z;h.cross(c,d);d.cross(h,c);h.normalize();d.normalize();m=-this.tube*Math.cos(n);n=this.tube*Math.sin(n);g.x+=m*d.x+n*h.x;g.y+=m*d.y+n*h.y;g.z+=m*d.z+n*h.z;this.grid[b][f]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(g.x,g.y,g.z)))-1}}for(b=0;b<this.segmentsR;++b)for(f=
0;f<this.segmentsT;++f){d=(b+1)%this.segmentsR;h=(f+1)%this.segmentsT;g=this.grid[b][f];c=this.grid[d][f];d=this.grid[d][h];h=this.grid[b][h];n=new THREE.UV(b/this.segmentsR,f/this.segmentsT);m=new THREE.UV((b+1)/this.segmentsR,f/this.segmentsT);var p=new THREE.UV((b+1)/this.segmentsR,(f+1)/this.segmentsT),u=new THREE.UV(b/this.segmentsR,(f+1)/this.segmentsT);this.faces.push(new THREE.Face4(g,c,d,h));this.faceVertexUvs[0].push([n,m,p,u])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};
THREE.TorusKnot.prototype=new THREE.Geometry;THREE.TorusKnot.prototype.constructor=THREE.TorusKnot;THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var f="Loaded ";f+=b.total?(100*b.loaded/b.total).toFixed(0)+"%":(b.loaded/1E3).toFixed(2)+" KB";
this.statusDomElement.innerHTML=f},extractUrlbase:function(b){b=b.split("/");b.pop();return b.join("/")},init_materials:function(b,f,c){b.materials=[];for(var d=0;d<f.length;++d)b.materials[d]=[THREE.Loader.prototype.createMaterial(f[d],c)]},createMaterial:function(b,f){function c(o){o=Math.log(o)/Math.LN2;return Math.floor(o)==o}function d(o,m){var p=new Image;p.onload=function(){if(!c(this.width)||!c(this.height)){var u=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),v=Math.pow(2,Math.round(Math.log(this.height)/
Math.LN2));o.image.width=u;o.image.height=v;o.image.getContext("2d").drawImage(this,0,0,u,v)}else o.image=this;o.needsUpdate=!0};p.src=m}var g,h,n;g="MeshLambertMaterial";h={color:15658734,opacity:1,map:null,lightMap:null,wireframe:b.wireframe};b.shading&&(b.shading=="Phong"?g="MeshPhongMaterial":b.shading=="Basic"&&(g="MeshBasicMaterial"));if(b.blending)if(b.blending=="Additive")h.blending=THREE.AdditiveBlending;else if(b.blending=="Subtractive")h.blending=THREE.SubtractiveBlending;else if(b.blending==
"Multiply")h.blending=THREE.MultiplyBlending;if(b.transparent!==void 0||b.opacity<1)h.transparent=b.transparent;if(b.depthTest!==void 0)h.depthTest=b.depthTest;if(b.vertexColors!==void 0)if(b.vertexColors=="face")h.vertexColors=THREE.FaceColors;else if(b.vertexColors)h.vertexColors=THREE.VertexColors;if(b.mapDiffuse&&f){n=document.createElement("canvas");h.map=new THREE.Texture(n);h.map.sourceFile=b.mapDiffuse;d(h.map,f+"/"+b.mapDiffuse)}else if(b.colorDiffuse){n=(b.colorDiffuse[0]*255<<16)+(b.colorDiffuse[1]*
255<<8)+b.colorDiffuse[2]*255;h.color=n;h.opacity=b.transparency}else if(b.DbgColor)h.color=b.DbgColor;if(b.mapLightmap&&f){n=document.createElement("canvas");h.lightMap=new THREE.Texture(n);h.lightMap.sourceFile=b.mapLightmap;d(h.lightMap,f+"/"+b.mapLightmap)}return new THREE[g](h)}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;
THREE.JSONLoader.prototype.load=function(b){var f=this,c=b.model,d=b.callback,g=b.texture_path?b.texture_path:this.extractUrlbase(c);b=new Worker(c);b.onmessage=function(h){f.createModel(h.data,d,g);f.onLoadComplete()};this.onLoadStart();b.postMessage((new Date).getTime())};
THREE.JSONLoader.prototype.createModel=function(b,f,c){var d=new THREE.Geometry,g=b.scale!==void 0?1/b.scale:1;this.init_materials(d,b.materials,c);(function(h){if(b.version===void 0||b.version!=2)console.error("Deprecated file format.");else{var n,o,m,p,u,v,w,x,y,A,B,C,E,z,H=b.faces;v=b.vertices;var G=b.normals,F=b.colors,T=0;for(n=0;n<b.uvs.length;n++)b.uvs[n].length&&T++;for(n=0;n<T;n++){d.faceUvs[n]=[];d.faceVertexUvs[n]=[]}p=0;for(u=v.length;p<u;){w=new THREE.Vertex;w.position.x=v[p++]*h;w.position.y=
v[p++]*h;w.position.z=v[p++]*h;d.vertices.push(w)}p=0;for(u=H.length;p<u;){h=H[p++];v=h&1;m=h&2;n=h&4;o=h&8;x=h&16;w=h&32;A=h&64;h&=128;v?(B=new THREE.Face4,B.a=H[p++],B.b=H[p++],B.c=H[p++],B.d=H[p++],v=4):(B=new THREE.Face3,B.a=H[p++],B.b=H[p++],B.c=H[p++],v=3);if(m){m=H[p++];B.materials=d.materials[m]}m=d.faces.length;if(n)for(n=0;n<T;n++){C=b.uvs[n];y=H[p++];z=C[y*2];y=C[y*2+1];d.faceUvs[n][m]=new THREE.UV(z,y)}if(o)for(n=0;n<T;n++){C=b.uvs[n];E=[];for(o=0;o<v;o++){y=H[p++];z=C[y*2];y=C[y*2+1];
E[o]=new THREE.UV(z,y)}d.faceVertexUvs[n][m]=E}if(x){x=H[p++]*3;o=new THREE.Vector3;o.x=G[x++];o.y=G[x++];o.z=G[x];B.normal=o}if(w)for(n=0;n<v;n++){x=H[p++]*3;o=new THREE.Vector3;o.x=G[x++];o.y=G[x++];o.z=G[x];B.vertexNormals.push(o)}if(A){w=H[p++];w=new THREE.Color(F[w]);B.color=w}if(h)for(n=0;n<v;n++){w=H[p++];w=new THREE.Color(F[w]);B.vertexColors.push(w)}d.faces.push(B)}}})(g);(function(){var h,n,o,m;if(b.skinWeights){h=0;for(n=b.skinWeights.length;h<n;h+=2){o=b.skinWeights[h];m=b.skinWeights[h+
1];d.skinWeights.push(new THREE.Vector4(o,m,0,0))}}if(b.skinIndices){h=0;for(n=b.skinIndices.length;h<n;h+=2){o=b.skinIndices[h];m=b.skinIndices[h+1];d.skinIndices.push(new THREE.Vector4(o,m,0,0))}}d.bones=b.bones;d.animation=b.animation})();(function(h){if(b.morphTargets!==void 0){var n,o,m,p,u,v,w,x,y;n=0;for(o=b.morphTargets.length;n<o;n++){d.morphTargets[n]={};d.morphTargets[n].name=b.morphTargets[n].name;d.morphTargets[n].vertices=[];x=d.morphTargets[n].vertices;y=b.morphTargets[n].vertices;
m=0;for(p=y.length;m<p;m+=3){u=y[m]*h;v=y[m+1]*h;w=y[m+2]*h;x.push(new THREE.Vertex(new THREE.Vector3(u,v,w)))}}}if(b.morphColors!==void 0){n=0;for(o=b.morphColors.length;n<o;n++){d.morphColors[n]={};d.morphColors[n].name=b.morphColors[n].name;d.morphColors[n].colors=[];p=d.morphColors[n].colors;u=b.morphColors[n].colors;h=0;for(m=u.length;h<m;h+=3){v=new THREE.Color(16755200);v.setRGB(u[h],u[h+1],u[h+2]);p.push(v)}}}})(g);(function(){if(b.edges!==void 0){var h,n,o;for(h=0;h<b.edges.length;h+=2){n=
b.edges[h];o=b.edges[h+1];d.edges.push(new THREE.Edge(d.vertices[n],d.vertices[o],n,o))}}})();d.computeCentroids();d.computeFaceNormals();f(d)};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;
THREE.BinaryLoader.prototype={load:function(b){var f=b.model,c=b.callback,d=b.texture_path?b.texture_path:THREE.Loader.prototype.extractUrlbase(f),g=b.bin_path?b.bin_path:THREE.Loader.prototype.extractUrlbase(f);b=(new Date).getTime();f=new Worker(f);var h=this.showProgress?THREE.Loader.prototype.updateProgress:null;f.onmessage=function(n){THREE.BinaryLoader.prototype.loadAjaxBuffers(n.data.buffers,n.data.materials,c,g,d,h)};f.onerror=function(n){alert("worker.onerror: "+n.message+"\n"+n.data);n.preventDefault()};
f.postMessage(b)},loadAjaxBuffers:function(b,f,c,d,g,h){var n=new XMLHttpRequest,o=d+"/"+b,m=0;n.onreadystatechange=function(){n.readyState==4?n.status==200||n.status==0?THREE.BinaryLoader.prototype.createBinModel(n.responseText,c,g,f):alert("Couldn't load ["+o+"] ["+n.status+"]"):n.readyState==3?h&&(m==0&&(m=n.getResponseHeader("Content-Length")),h({total:m,loaded:n.responseText.length})):n.readyState==2&&(m=n.getResponseHeader("Content-Length"))};n.open("GET",o,!0);n.overrideMimeType("text/plain; charset=x-user-defined");
n.setRequestHeader("Content-Type","text/plain");n.send(null)},createBinModel:function(b,f,c,d){var g=function(h){function n(aa,ia){var na=u(aa,ia),ua=u(aa,ia+1),Ea=u(aa,ia+2),Za=u(aa,ia+3),eb=(Za<<1&255|Ea>>7)-127;na|=(Ea&127)<<16|ua<<8;if(na==0&&eb==-127)return 0;return(1-2*(Za>>7))*(1+na*Math.pow(2,-23))*Math.pow(2,eb)}function o(aa,ia){var na=u(aa,ia),ua=u(aa,ia+1),Ea=u(aa,ia+2);return(u(aa,ia+3)<<24)+(Ea<<16)+(ua<<8)+na}function m(aa,ia){var na=u(aa,ia);return(u(aa,ia+1)<<8)+na}function p(aa,
ia){var na=u(aa,ia);return na>127?na-256:na}function u(aa,ia){return aa.charCodeAt(ia)&255}function v(aa){var ia,na,ua;ia=o(b,aa);na=o(b,aa+F);ua=o(b,aa+T);aa=m(b,aa+$);THREE.BinaryLoader.prototype.f3(C,ia,na,ua,aa)}function w(aa){var ia,na,ua,Ea,Za,eb;ia=o(b,aa);na=o(b,aa+F);ua=o(b,aa+T);Ea=m(b,aa+$);Za=o(b,aa+W);eb=o(b,aa+V);aa=o(b,aa+S);THREE.BinaryLoader.prototype.f3n(C,H,ia,na,ua,Ea,Za,eb,aa)}function x(aa){var ia,na,ua,Ea;ia=o(b,aa);na=o(b,aa+t);ua=o(b,aa+M);Ea=o(b,aa+I);aa=m(b,aa+P);THREE.BinaryLoader.prototype.f4(C,
ia,na,ua,Ea,aa)}function y(aa){var ia,na,ua,Ea,Za,eb,va,ra;ia=o(b,aa);na=o(b,aa+t);ua=o(b,aa+M);Ea=o(b,aa+I);Za=m(b,aa+P);eb=o(b,aa+O);va=o(b,aa+R);ra=o(b,aa+ca);aa=o(b,aa+U);THREE.BinaryLoader.prototype.f4n(C,H,ia,na,ua,Ea,Za,eb,va,ra,aa)}function A(aa){var ia,na;ia=o(b,aa);na=o(b,aa+ea);aa=o(b,aa+la);THREE.BinaryLoader.prototype.uv3(C.faceVertexUvs[0],G[ia*2],G[ia*2+1],G[na*2],G[na*2+1],G[aa*2],G[aa*2+1])}function B(aa){var ia,na,ua;ia=o(b,aa);na=o(b,aa+ta);ua=o(b,aa+xa);aa=o(b,aa+ya);THREE.BinaryLoader.prototype.uv4(C.faceVertexUvs[0],
G[ia*2],G[ia*2+1],G[na*2],G[na*2+1],G[ua*2],G[ua*2+1],G[aa*2],G[aa*2+1])}var C=this,E=0,z,H=[],G=[],F,T,$,W,V,S,t,M,I,P,O,R,ca,U,ea,la,ta,xa,ya,oa,Fa,Ca,Ga,Ha,wa;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(C,d,h);z={signature:b.substr(E,8),header_bytes:u(b,E+8),vertex_coordinate_bytes:u(b,E+9),normal_coordinate_bytes:u(b,E+10),uv_coordinate_bytes:u(b,E+11),vertex_index_bytes:u(b,E+12),normal_index_bytes:u(b,E+13),uv_index_bytes:u(b,E+14),material_index_bytes:u(b,E+15),nvertices:o(b,
E+16),nnormals:o(b,E+16+4),nuvs:o(b,E+16+8),ntri_flat:o(b,E+16+12),ntri_smooth:o(b,E+16+16),ntri_flat_uv:o(b,E+16+20),ntri_smooth_uv:o(b,E+16+24),nquad_flat:o(b,E+16+28),nquad_smooth:o(b,E+16+32),nquad_flat_uv:o(b,E+16+36),nquad_smooth_uv:o(b,E+16+40)};E+=z.header_bytes;F=z.vertex_index_bytes;T=z.vertex_index_bytes*2;$=z.vertex_index_bytes*3;W=z.vertex_index_bytes*3+z.material_index_bytes;V=z.vertex_index_bytes*3+z.material_index_bytes+z.normal_index_bytes;S=z.vertex_index_bytes*3+z.material_index_bytes+
z.normal_index_bytes*2;t=z.vertex_index_bytes;M=z.vertex_index_bytes*2;I=z.vertex_index_bytes*3;P=z.vertex_index_bytes*4;O=z.vertex_index_bytes*4+z.material_index_bytes;R=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes;ca=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*2;U=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*3;ea=z.uv_index_bytes;la=z.uv_index_bytes*2;ta=z.uv_index_bytes;xa=z.uv_index_bytes*2;ya=z.uv_index_bytes*3;h=z.vertex_index_bytes*
3+z.material_index_bytes;wa=z.vertex_index_bytes*4+z.material_index_bytes;oa=z.ntri_flat*h;Fa=z.ntri_smooth*(h+z.normal_index_bytes*3);Ca=z.ntri_flat_uv*(h+z.uv_index_bytes*3);Ga=z.ntri_smooth_uv*(h+z.normal_index_bytes*3+z.uv_index_bytes*3);Ha=z.nquad_flat*wa;h=z.nquad_smooth*(wa+z.normal_index_bytes*4);wa=z.nquad_flat_uv*(wa+z.uv_index_bytes*4);E+=function(aa){for(var ia,na,ua,Ea=z.vertex_coordinate_bytes*3,Za=aa+z.nvertices*Ea;aa<Za;aa+=Ea){ia=n(b,aa);na=n(b,aa+z.vertex_coordinate_bytes);ua=n(b,
aa+z.vertex_coordinate_bytes*2);THREE.BinaryLoader.prototype.v(C,ia,na,ua)}return z.nvertices*Ea}(E);E+=function(aa){for(var ia,na,ua,Ea=z.normal_coordinate_bytes*3,Za=aa+z.nnormals*Ea;aa<Za;aa+=Ea){ia=p(b,aa);na=p(b,aa+z.normal_coordinate_bytes);ua=p(b,aa+z.normal_coordinate_bytes*2);H.push(ia/127,na/127,ua/127)}return z.nnormals*Ea}(E);E+=function(aa){for(var ia,na,ua=z.uv_coordinate_bytes*2,Ea=aa+z.nuvs*ua;aa<Ea;aa+=ua){ia=n(b,aa);na=n(b,aa+z.uv_coordinate_bytes);G.push(ia,na)}return z.nuvs*ua}(E);
oa=E+oa;Fa=oa+Fa;Ca=Fa+Ca;Ga=Ca+Ga;Ha=Ga+Ha;h=Ha+h;wa=h+wa;(function(aa){var ia,na=z.vertex_index_bytes*3+z.material_index_bytes,ua=na+z.uv_index_bytes*3,Ea=aa+z.ntri_flat_uv*ua;for(ia=aa;ia<Ea;ia+=ua){v(ia);A(ia+na)}return Ea-aa})(Fa);(function(aa){var ia,na=z.vertex_index_bytes*3+z.material_index_bytes+z.normal_index_bytes*3,ua=na+z.uv_index_bytes*3,Ea=aa+z.ntri_smooth_uv*ua;for(ia=aa;ia<Ea;ia+=ua){w(ia);A(ia+na)}return Ea-aa})(Ca);(function(aa){var ia,na=z.vertex_index_bytes*4+z.material_index_bytes,
ua=na+z.uv_index_bytes*4,Ea=aa+z.nquad_flat_uv*ua;for(ia=aa;ia<Ea;ia+=ua){x(ia);B(ia+na)}return Ea-aa})(h);(function(aa){var ia,na=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*4,ua=na+z.uv_index_bytes*4,Ea=aa+z.nquad_smooth_uv*ua;for(ia=aa;ia<Ea;ia+=ua){y(ia);B(ia+na)}return Ea-aa})(wa);(function(aa){var ia,na=z.vertex_index_bytes*3+z.material_index_bytes,ua=aa+z.ntri_flat*na;for(ia=aa;ia<ua;ia+=na)v(ia);return ua-aa})(E);(function(aa){var ia,na=z.vertex_index_bytes*3+z.material_index_bytes+
z.normal_index_bytes*3,ua=aa+z.ntri_smooth*na;for(ia=aa;ia<ua;ia+=na)w(ia);return ua-aa})(oa);(function(aa){var ia,na=z.vertex_index_bytes*4+z.material_index_bytes,ua=aa+z.nquad_flat*na;for(ia=aa;ia<ua;ia+=na)x(ia);return ua-aa})(Ga);(function(aa){var ia,na=z.vertex_index_bytes*4+z.material_index_bytes+z.normal_index_bytes*4,ua=aa+z.nquad_smooth*na;for(ia=aa;ia<ua;ia+=na)y(ia);return ua-aa})(Ha);this.computeCentroids();this.computeFaceNormals()};g.prototype=new THREE.Geometry;g.prototype.constructor=
g;f(new g(c))},v:function(b,f,c,d){b.vertices.push(new THREE.Vertex(new THREE.Vector3(f,c,d)))},f3:function(b,f,c,d,g){b.faces.push(new THREE.Face3(f,c,d,null,null,b.materials[g]))},f4:function(b,f,c,d,g,h){b.faces.push(new THREE.Face4(f,c,d,g,null,null,b.materials[h]))},f3n:function(b,f,c,d,g,h,n,o,m){h=b.materials[h];var p=f[o*3],u=f[o*3+1];o=f[o*3+2];var v=f[m*3],w=f[m*3+1];m=f[m*3+2];b.faces.push(new THREE.Face3(c,d,g,[new THREE.Vector3(f[n*3],f[n*3+1],f[n*3+2]),new THREE.Vector3(p,u,o),new THREE.Vector3(v,
w,m)],null,h))},f4n:function(b,f,c,d,g,h,n,o,m,p,u){n=b.materials[n];var v=f[m*3],w=f[m*3+1];m=f[m*3+2];var x=f[p*3],y=f[p*3+1];p=f[p*3+2];var A=f[u*3],B=f[u*3+1];u=f[u*3+2];b.faces.push(new THREE.Face4(c,d,g,h,[new THREE.Vector3(f[o*3],f[o*3+1],f[o*3+2]),new THREE.Vector3(v,w,m),new THREE.Vector3(x,y,p),new THREE.Vector3(A,B,u)],null,n))},uv3:function(b,f,c,d,g,h,n){var o=[];o.push(new THREE.UV(f,c));o.push(new THREE.UV(d,g));o.push(new THREE.UV(h,n));b.push(o)},uv4:function(b,f,c,d,g,h,n,o,m){var p=
[];p.push(new THREE.UV(f,c));p.push(new THREE.UV(d,g));p.push(new THREE.UV(h,n));p.push(new THREE.UV(o,m));b.push(p)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};
THREE.SceneLoader.prototype={load:function(b,f){var c=this,d=new Worker(b);d.postMessage(0);var g=THREE.Loader.prototype.extractUrlbase(b);d.onmessage=function(h){function n(ea,la){return la=="relativeToHTML"?ea:g+"/"+ea}function o(){for(x in V.objects)if(!O.objects[x])if(E=V.objects[x],E.geometry!==void 0){if(F=O.geometries[E.geometry]){W=[];for(U=0;U<E.materials.length;U++)W[U]=O.materials[E.materials[U]];z=E.position;r=E.rotation;q=E.quaternion;s=E.scale;q=0;W.length==0&&(W[0]=new THREE.MeshFaceMaterial);
W.length>1&&(W=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(F,W);object.name=x;object.position.set(z[0],z[1],z[2]);q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=E.visible;O.scene.addObject(object);O.objects[x]=object;if(E.meshCollider){var ea=THREE.CollisionUtils.MeshColliderWBox(object);O.scene.collisions.colliders.push(ea)}if(E.castsShadow){ea=new THREE.ShadowVolume(F);O.scene.addChild(ea);
ea.position=object.position;ea.rotation=object.rotation;ea.scale=object.scale}E.trigger&&E.trigger.toLowerCase()!="none"&&(ea={type:E.trigger,object:E},O.triggers[object.name]=ea)}}else{z=E.position;r=E.rotation;q=E.quaternion;s=E.scale;q=0;object=new THREE.Object3D;object.name=x;object.position.set(z[0],z[1],z[2]);q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=E.visible!==void 0?E.visible:
!1;O.scene.addObject(object);O.objects[x]=object;O.empties[x]=object;E.trigger&&E.trigger.toLowerCase()!="none"&&(ea={type:E.trigger,object:E},O.triggers[object.name]=ea)}}function m(ea){return function(la){O.geometries[ea]=la;o();t-=1;c.onLoadComplete();u()}}function p(ea){return function(la){O.geometries[ea]=la}}function u(){c.callbackProgress({totalModels:I,totalTextures:P,loadedModels:I-t,loadedTextures:P-M},O);c.onLoadProgress();t==0&&M==0&&f(O)}var v,w,x,y,A,B,C,E,z,H,G,F,T,$,W,V,S,t,M,I,P,
O;V=h.data;h=new THREE.BinaryLoader;S=new THREE.JSONLoader;M=t=0;O={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};var R=!1;for(x in V.objects)if(E=V.objects[x],E.meshCollider){R=!0;break}if(R)O.scene.collisions=new THREE.CollisionSystem;if(V.transform){R=V.transform.position;H=V.transform.rotation;var ca=V.transform.scale;R&&O.scene.position.set(R[0],R[1],R[2]);H&&O.scene.rotation.set(H[0],H[1],H[2]);ca&&O.scene.scale.set(ca[0],
ca[1],ca[2]);(R||H||ca)&&O.scene.updateMatrix()}R=function(){M-=1;u();c.onLoadComplete()};for(A in V.cameras){H=V.cameras[A];if(H.type=="perspective")T=new THREE.Camera(H.fov,H.aspect,H.near,H.far);else if(H.type=="ortho"){T=new THREE.Camera;T.projectionMatrix=THREE.Matrix4.makeOrtho(H.left,H.right,H.top,H.bottom,H.near,H.far)}z=H.position;H=H.target;T.position.set(z[0],z[1],z[2]);T.target.position.set(H[0],H[1],H[2]);O.cameras[A]=T}for(y in V.lights){A=V.lights[y];T=A.color!==void 0?A.color:16777215;
H=A.intensity!==void 0?A.intensity:1;if(A.type=="directional"){z=A.direction;light=new THREE.DirectionalLight(T,H);light.position.set(z[0],z[1],z[2]);light.position.normalize()}else if(A.type=="point"){z=A.position;light=new THREE.PointLight(T,H);light.position.set(z[0],z[1],z[2])}O.scene.addLight(light);O.lights[y]=light}for(B in V.fogs){y=V.fogs[B];y.type=="linear"?$=new THREE.Fog(0,y.near,y.far):y.type=="exp2"&&($=new THREE.FogExp2(0,y.density));H=y.color;$.color.setRGB(H[0],H[1],H[2]);O.fogs[B]=
$}if(O.cameras&&V.defaults.camera)O.currentCamera=O.cameras[V.defaults.camera];if(O.fogs&&V.defaults.fog)O.scene.fog=O.fogs[V.defaults.fog];H=V.defaults.bgcolor;O.bgColor=new THREE.Color;O.bgColor.setRGB(H[0],H[1],H[2]);O.bgColorAlpha=V.defaults.bgalpha;for(v in V.geometries)if(B=V.geometries[v],B.type=="bin_mesh"||B.type=="ascii_mesh"){t+=1;c.onLoadStart()}I=t;for(v in V.geometries){B=V.geometries[v];B.type=="cube"?(F=new THREE.Cube(B.width,B.height,B.depth,B.segmentsWidth,B.segmentsHeight,B.segmentsDepth,
null,B.flipped,B.sides),O.geometries[v]=F):B.type=="plane"?(F=new THREE.Plane(B.width,B.height,B.segmentsWidth,B.segmentsHeight),O.geometries[v]=F):B.type=="sphere"?(F=new THREE.Sphere(B.radius,B.segmentsWidth,B.segmentsHeight),O.geometries[v]=F):B.type=="cylinder"?(F=new THREE.Cylinder(B.numSegs,B.topRad,B.botRad,B.height,B.topOffset,B.botOffset),O.geometries[v]=F):B.type=="torus"?(F=new THREE.Torus(B.radius,B.tube,B.segmentsR,B.segmentsT),O.geometries[v]=F):B.type=="icosahedron"?(F=new THREE.Icosahedron(B.subdivisions),
O.geometries[v]=F):B.type=="bin_mesh"?h.load({model:n(B.url,V.urlBaseType),callback:m(v)}):B.type=="ascii_mesh"?S.load({model:n(B.url,V.urlBaseType),callback:m(v)}):B.type=="embedded_mesh"&&(B=V.embeds[B.id])&&S.createModel(B,p(v),"")}for(C in V.textures)if(v=V.textures[C],v.url instanceof Array){M+=v.url.length;for(h=0;h<v.url.length;h++)c.onLoadStart()}else{M+=1;c.onLoadStart()}P=M;for(C in V.textures){v=V.textures[C];if(v.mapping!=void 0&&THREE[v.mapping]!=void 0)v.mapping=new THREE[v.mapping];
if(v.url instanceof Array){h=[];for(var U=0;U<v.url.length;U++)h[U]=n(v.url[U],V.urlBaseType);h=THREE.ImageUtils.loadTextureCube(h,v.mapping,R)}else{h=THREE.ImageUtils.loadTexture(n(v.url,V.urlBaseType),v.mapping,R);if(THREE[v.minFilter]!=void 0)h.minFilter=THREE[v.minFilter];if(THREE[v.magFilter]!=void 0)h.magFilter=THREE[v.magFilter]}O.textures[C]=h}for(w in V.materials){C=V.materials[w];for(G in C.parameters)if(G=="envMap"||G=="map"||G=="lightMap")C.parameters[G]=O.textures[C.parameters[G]];else if(G==
"shading")C.parameters[G]=C.parameters[G]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(G=="blending")C.parameters[G]=THREE[C.parameters[G]]?THREE[C.parameters[G]]:THREE.NormalBlending;else if(G=="combine")C.parameters[G]=C.parameters[G]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(G=="vertexColors")if(C.parameters[G]=="face")C.parameters[G]=THREE.FaceColors;else if(C.parameters[G])C.parameters[G]=THREE.VertexColors;if(C.parameters.opacity!==void 0&&C.parameters.opacity<
1)C.parameters.transparent=!0;C=new THREE[C.type](C.parameters);O.materials[w]=C}o();c.callbackSync(O)}}};
THREE.MarchingCubes=function(b,f){THREE.Object3D.call(this);this.materials=f instanceof Array?f:[f];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=
0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,d,g){return c+(d-c)*g};this.VIntX=function(c,d,g,h,n,o,m,p,u,v){n=(n-u)/(v-u);u=this.normal_cache;d[h]=o+n*this.delta;d[h+1]=m;d[h+2]=p;g[h]=this.lerp(u[c],u[c+3],n);g[h+1]=this.lerp(u[c+1],u[c+4],n);g[h+2]=this.lerp(u[c+2],u[c+5],n)};this.VIntY=function(c,d,g,h,n,o,m,p,u,v){n=(n-u)/(v-u);u=this.normal_cache;d[h]=o;d[h+1]=m+n*this.delta;d[h+
2]=p;d=c+this.yd*3;g[h]=this.lerp(u[c],u[d],n);g[h+1]=this.lerp(u[c+1],u[d+1],n);g[h+2]=this.lerp(u[c+2],u[d+2],n)};this.VIntZ=function(c,d,g,h,n,o,m,p,u,v){n=(n-u)/(v-u);u=this.normal_cache;d[h]=o;d[h+1]=m;d[h+2]=p+n*this.delta;d=c+this.zd*3;g[h]=this.lerp(u[c],u[d],n);g[h+1]=this.lerp(u[c+1],u[d+1],n);g[h+2]=this.lerp(u[c+2],u[d+2],n)};this.compNorm=function(c){var d=c*3;this.normal_cache[d]==0&&(this.normal_cache[d]=this.field[c-1]-this.field[c+1],this.normal_cache[d+1]=this.field[c-this.yd]-this.field[c+
this.yd],this.normal_cache[d+2]=this.field[c-this.zd]-this.field[c+this.zd])};this.polygonize=function(c,d,g,h,n,o){var m=h+1,p=h+this.yd,u=h+this.zd,v=m+this.yd,w=m+this.zd,x=h+this.yd+this.zd,y=m+this.yd+this.zd,A=0,B=this.field[h],C=this.field[m],E=this.field[p],z=this.field[v],H=this.field[u],G=this.field[w],F=this.field[x],T=this.field[y];B<n&&(A|=1);C<n&&(A|=2);E<n&&(A|=8);z<n&&(A|=4);H<n&&(A|=16);G<n&&(A|=32);F<n&&(A|=128);T<n&&(A|=64);var $=THREE.edgeTable[A];if($==0)return 0;var W=this.delta,
V=c+W,S=d+W;W=g+W;$&1&&(this.compNorm(h),this.compNorm(m),this.VIntX(h*3,this.vlist,this.nlist,0,n,c,d,g,B,C));$&2&&(this.compNorm(m),this.compNorm(v),this.VIntY(m*3,this.vlist,this.nlist,3,n,V,d,g,C,z));$&4&&(this.compNorm(p),this.compNorm(v),this.VIntX(p*3,this.vlist,this.nlist,6,n,c,S,g,E,z));$&8&&(this.compNorm(h),this.compNorm(p),this.VIntY(h*3,this.vlist,this.nlist,9,n,c,d,g,B,E));$&16&&(this.compNorm(u),this.compNorm(w),this.VIntX(u*3,this.vlist,this.nlist,12,n,c,d,W,H,G));$&32&&(this.compNorm(w),
this.compNorm(y),this.VIntY(w*3,this.vlist,this.nlist,15,n,V,d,W,G,T));$&64&&(this.compNorm(x),this.compNorm(y),this.VIntX(x*3,this.vlist,this.nlist,18,n,c,S,W,F,T));$&128&&(this.compNorm(u),this.compNorm(x),this.VIntY(u*3,this.vlist,this.nlist,21,n,c,d,W,H,F));$&256&&(this.compNorm(h),this.compNorm(u),this.VIntZ(h*3,this.vlist,this.nlist,24,n,c,d,g,B,H));$&512&&(this.compNorm(m),this.compNorm(w),this.VIntZ(m*3,this.vlist,this.nlist,27,n,V,d,g,C,G));$&1024&&(this.compNorm(v),this.compNorm(y),this.VIntZ(v*
3,this.vlist,this.nlist,30,n,V,S,g,z,T));$&2048&&(this.compNorm(p),this.compNorm(x),this.VIntZ(p*3,this.vlist,this.nlist,33,n,c,S,g,E,F));A<<=4;for(n=h=0;THREE.triTable[A+n]!=-1;){c=A+n;d=c+1;g=c+2;this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[c],3*THREE.triTable[d],3*THREE.triTable[g],o);n+=3;h++}return h};this.posnormtriv=function(c,d,g,h,n,o){var m=this.count*3;this.positionArray[m]=c[g];this.positionArray[m+1]=c[g+1];this.positionArray[m+2]=c[g+2];this.positionArray[m+3]=c[h];this.positionArray[m+
4]=c[h+1];this.positionArray[m+5]=c[h+2];this.positionArray[m+6]=c[n];this.positionArray[m+7]=c[n+1];this.positionArray[m+8]=c[n+2];this.normalArray[m]=d[g];this.normalArray[m+1]=d[g+1];this.normalArray[m+2]=d[g+2];this.normalArray[m+3]=d[h];this.normalArray[m+4]=d[h+1];this.normalArray[m+5]=d[h+2];this.normalArray[m+6]=d[n];this.normalArray[m+7]=d[n+1];this.normalArray[m+8]=d[n+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&o(this)};this.begin=function(){this.count=0;
this.hasNormal=this.hasPos=!1};this.end=function(c){if(this.count!=0){for(var d=this.count*3;d<this.positionArray.length;d++)this.positionArray[d]=0;c(this)}};this.addBall=function(c,d,g,h,n){var o=this.size*Math.sqrt(h/n),m=g*this.size,p=d*this.size,u=c*this.size,v=Math.floor(m-o);v<1&&(v=1);m=Math.floor(m+o);m>this.size-1&&(m=this.size-1);var w=Math.floor(p-o);w<1&&(w=1);p=Math.floor(p+o);p>this.size-1&&(p=this.size-1);var x=Math.floor(u-o);x<1&&(x=1);o=Math.floor(u+o);o>this.size-1&&(o=this.size-
1);for(var y,A,B,C,E,z;v<m;v++){u=this.size2*v;A=v/this.size-g;E=A*A;for(A=w;A<p;A++){B=u+this.size*A;y=A/this.size-d;z=y*y;for(y=x;y<o;y++){C=y/this.size-c;C=h/(1.0E-6+C*C+z+E)-n;C>0&&(this.field[B+y]+=C)}}}};this.addPlaneX=function(c,d){var g,h,n,o,m,p=this.size,u=this.yd,v=this.zd,w=this.field,x=p*Math.sqrt(c/d);x>p&&(x=p);for(g=0;g<x;g++)if(h=g/p,h*=h,o=c/(1.0E-4+h)-d,o>0)for(h=0;h<p;h++){m=g+h*u;for(n=0;n<p;n++)w[v*n+m]+=o}};this.addPlaneY=function(c,d){var g,h,n,o,m,p,u=this.size,v=this.yd,
w=this.zd,x=this.field,y=u*Math.sqrt(c/d);y>u&&(y=u);for(h=0;h<y;h++)if(g=h/u,g*=g,o=c/(1.0E-4+g)-d,o>0){m=h*v;for(g=0;g<u;g++){p=m+g;for(n=0;n<u;n++)x[w*n+p]+=o}}};this.addPlaneZ=function(c,d){var g,h,n,o,m,p;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/d);dist>size&&(dist=size);for(n=0;n<dist;n++)if(g=n/size,g*=g,o=c/(1.0E-4+g)-d,o>0){m=zd*n;for(h=0;h<size;h++){p=m+h*yd;for(g=0;g<size;g++)field[p+g]+=o}}};this.reset=function(){var c;for(c=0;c<this.size3;c++){this.normal_cache[c*
3]=0;this.field[c]=0}};this.render=function(c){this.begin();var d,g,h,n,o,m,p,u,v,w=this.size-2;for(n=1;n<w;n++){v=this.size2*n;p=(n-this.halfsize)/this.halfsize;for(h=1;h<w;h++){u=v+this.size*h;m=(h-this.halfsize)/this.halfsize;for(g=1;g<w;g++){o=(g-this.halfsize)/this.halfsize;d=u+g;this.polygonize(o,m,p,d,this.isolation,c)}}}this.end(c)};this.generateGeometry=function(){var c=0,d=new THREE.Geometry,g=[];this.render(function(h){var n,o,m,p,u,v,w,x;for(n=0;n<h.count;n++){w=n*3;u=w+1;x=w+2;o=h.positionArray[w];
m=h.positionArray[u];p=h.positionArray[x];v=new THREE.Vector3(o,m,p);o=h.normalArray[w];m=h.normalArray[u];p=h.normalArray[x];w=new THREE.Vector3(o,m,p);w.normalize();u=new THREE.Vertex(v);d.vertices.push(u);g.push(w)}nfaces=h.count/3;for(n=0;n<nfaces;n++){w=(c+n)*3;u=w+1;x=w+2;v=g[w];o=g[u];m=g[x];w=new THREE.Face3(w,u,x,[v,o,m]);d.faces.push(w)}c+=nfaces;h.count=0});return d};this.init(b)};THREE.MarchingCubes.prototype=new THREE.Object3D;THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;
THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);
THREE.Trident=function(b){function f(h){return new THREE.Mesh(new THREE.Cylinder(30,0.1,b.length/20,b.length/5),new THREE.MeshBasicMaterial({color:h}))}function c(h,n){var o=new THREE.Geometry;o.vertices=[new THREE.Vertex,new THREE.Vertex(h)];return new THREE.Line(o,new THREE.LineBasicMaterial({color:n}))}THREE.Object3D.call(this);var d=Math.PI/2,g;b=b||THREE.Trident.defaultParams;if(b!==THREE.Trident.defaultParams)for(g in THREE.Trident.defaultParams)b.hasOwnProperty(g)||(b[g]=THREE.Trident.defaultParams[g]);
this.scale=new THREE.Vector3(b.scale,b.scale,b.scale);this.addChild(c(new THREE.Vector3(b.length,0,0),b.xAxisColor));this.addChild(c(new THREE.Vector3(0,b.length,0),b.yAxisColor));this.addChild(c(new THREE.Vector3(0,0,b.length),b.zAxisColor));if(b.showArrows){g=f(b.xAxisColor);g.rotation.y=-d;g.position.x=b.length;this.addChild(g);g=f(b.yAxisColor);g.rotation.x=d;g.position.y=b.length;this.addChild(g);g=f(b.zAxisColor);g.rotation.y=Math.PI;g.position.z=b.length;this.addChild(g)}};
THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(b,f){this.point=b;this.normal=f};THREE.SphereCollider=function(b,f){this.center=b;this.radius=f;this.radiusSq=f*f};THREE.BoxCollider=function(b,f){this.min=b;this.max=f;this.dynamic=!0;this.normal=new THREE.Vector3};
THREE.MeshCollider=function(b,f){this.mesh=b;this.box=f;this.numFaces=this.mesh.geometry.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){this.colliders=this.colliders.concat(b.colliders);this.hits=this.hits.concat(b.hits)};
THREE.CollisionSystem.prototype.rayCastAll=function(b){b.direction.normalize();this.hits.length=0;var f,c,d,g,h=0;f=0;for(c=this.colliders.length;f<c;f++)if(g=this.colliders[f],d=this.rayCast(b,g),d<Number.MAX_VALUE){g.distance=d;d>h?this.hits.push(g):this.hits.unshift(g);h=d}return this.hits};
THREE.CollisionSystem.prototype.rayCastNearest=function(b){var f=this.rayCastAll(b);if(f.length==0)return null;for(var c=0;f[c]instanceof THREE.MeshCollider;){var d=this.rayMesh(b,f[c]);if(d.dist<Number.MAX_VALUE){f[c].distance=d.dist;f[c].faceIndex=d.faceIndex;break}c++}if(c>f.length)return null;return f[c]};
THREE.CollisionSystem.prototype.rayCast=function(b,f){if(f instanceof THREE.PlaneCollider)return this.rayPlane(b,f);else if(f instanceof THREE.SphereCollider)return this.raySphere(b,f);else if(f instanceof THREE.BoxCollider)return this.rayBox(b,f);else if(f instanceof THREE.MeshCollider&&f.box)return this.rayBox(b,f.box)};
THREE.CollisionSystem.prototype.rayMesh=function(b,f){for(var c=this.makeRayLocal(b,f.mesh),d=Number.MAX_VALUE,g,h=0;h<f.numFaces;h++){var n=f.mesh.geometry.faces[h],o=f.mesh.geometry.vertices[n.a].position,m=f.mesh.geometry.vertices[n.b].position,p=f.mesh.geometry.vertices[n.c].position,u=n instanceof THREE.Face4?f.mesh.geometry.vertices[n.d].position:null;n instanceof THREE.Face3?(n=this.rayTriangle(c,o,m,p,d,this.collisionNormal),n<d&&(d=n,g=h,f.normal.copy(this.collisionNormal),f.normal.normalize())):
n instanceof THREE.Face4&&(n=this.rayTriangle(c,o,m,u,d,this.collisionNormal),n<d&&(d=n,g=h,f.normal.copy(this.collisionNormal),f.normal.normalize()),n=this.rayTriangle(c,m,p,u,d,this.collisionNormal),n<d&&(d=n,g=h,f.normal.copy(this.collisionNormal),f.normal.normalize()))}return{dist:d,faceIndex:g}};
THREE.CollisionSystem.prototype.rayTriangle=function(b,f,c,d,g,h){var n=THREE.CollisionSystem.__v1,o=THREE.CollisionSystem.__v2;h.set(0,0,0);n.sub(c,f);o.sub(d,c);h.cross(n,o);o=h.dot(b.direction);if(!(o<0))return Number.MAX_VALUE;n=h.dot(f)-h.dot(b.origin);if(!(n<=0))return Number.MAX_VALUE;if(!(n>=o*g))return Number.MAX_VALUE;n/=o;o=THREE.CollisionSystem.__v3;o.copy(b.direction);o.multiplyScalar(n);o.addSelf(b.origin);Math.abs(h.x)>Math.abs(h.y)?Math.abs(h.x)>Math.abs(h.z)?(b=o.y-f.y,h=c.y-f.y,
g=d.y-f.y,o=o.z-f.z,c=c.z-f.z,d=d.z-f.z):(b=o.x-f.x,h=c.x-f.x,g=d.x-f.x,o=o.y-f.y,c=c.y-f.y,d=d.y-f.y):Math.abs(h.y)>Math.abs(h.z)?(b=o.x-f.x,h=c.x-f.x,g=d.x-f.x,o=o.z-f.z,c=c.z-f.z,d=d.z-f.z):(b=o.x-f.x,h=c.x-f.x,g=d.x-f.x,o=o.y-f.y,c=c.y-f.y,d=d.y-f.y);f=h*d-c*g;if(f==0)return Number.MAX_VALUE;f=1/f;d=(b*d-o*g)*f;if(!(d>=0))return Number.MAX_VALUE;f*=h*o-c*b;if(!(f>=0))return Number.MAX_VALUE;if(!(1-d-f>=0))return Number.MAX_VALUE;return n};
THREE.CollisionSystem.prototype.makeRayLocal=function(b,f){var c=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(f.matrixWorld,c);var d=THREE.CollisionSystem.__r;d.origin.copy(b.origin);d.direction.copy(b.direction);c.multiplyVector3(d.origin);c.rotateAxis(d.direction);d.direction.normalize();return d};
THREE.CollisionSystem.prototype.rayBox=function(b,f){var c;f.dynamic&&f.mesh&&f.mesh.matrixWorld?c=this.makeRayLocal(b,f.mesh):(c=THREE.CollisionSystem.__r,c.origin.copy(b.origin),c.direction.copy(b.direction));var d=0,g=0,h=0,n=0,o=0,m=0,p=!0;c.origin.x<f.min.x?(d=f.min.x-c.origin.x,d/=c.direction.x,p=!1,n=-1):c.origin.x>f.max.x&&(d=f.max.x-c.origin.x,d/=c.direction.x,p=!1,n=1);c.origin.y<f.min.y?(g=f.min.y-c.origin.y,g/=c.direction.y,p=!1,o=-1):c.origin.y>f.max.y&&(g=f.max.y-c.origin.y,g/=c.direction.y,
p=!1,o=1);c.origin.z<f.min.z?(h=f.min.z-c.origin.z,h/=c.direction.z,p=!1,m=-1):c.origin.z>f.max.z&&(h=f.max.z-c.origin.z,h/=c.direction.z,p=!1,m=1);if(p)return-1;p=0;g>d&&(p=1,d=g);h>d&&(p=2,d=h);switch(p){case 0:o=c.origin.y+c.direction.y*d;if(o<f.min.y||o>f.max.y)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*d;if(c<f.min.z||c>f.max.z)return Number.MAX_VALUE;f.normal.set(n,0,0);break;case 1:n=c.origin.x+c.direction.x*d;if(n<f.min.x||n>f.max.x)return Number.MAX_VALUE;c=c.origin.z+c.direction.z*
d;if(c<f.min.z||c>f.max.z)return Number.MAX_VALUE;f.normal.set(0,o,0);break;case 2:n=c.origin.x+c.direction.x*d;if(n<f.min.x||n>f.max.x)return Number.MAX_VALUE;o=c.origin.y+c.direction.y*d;if(o<f.min.y||o>f.max.y)return Number.MAX_VALUE;f.normal.set(0,0,m)}return d};THREE.CollisionSystem.prototype.rayPlane=function(b,f){var c=b.direction.dot(f.normal),d=f.point.dot(f.normal);if(c<0)c=(d-b.origin.dot(f.normal))/c;else return Number.MAX_VALUE;return c>0?c:Number.MAX_VALUE};
THREE.CollisionSystem.prototype.raySphere=function(b,f){var c=f.center.clone().subSelf(b.origin);if(c.lengthSq<f.radiusSq)return-1;var d=c.dot(b.direction.clone());if(d<=0)return Number.MAX_VALUE;c=f.radiusSq-(c.lengthSq()-d*d);if(c>=0)return Math.abs(d)-Math.sqrt(c);return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;
THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(b){b.geometry.computeBoundingBox();var f=b.geometry.boundingBox,c=new THREE.Vector3(f.x[0],f.y[0],f.z[0]);f=new THREE.Vector3(f.x[1],f.y[1],f.z[1]);c=new THREE.BoxCollider(c,f);c.mesh=b;return c};THREE.CollisionUtils.MeshAABB=function(b){var f=THREE.CollisionUtils.MeshOBB(b);f.min.addSelf(b.position);f.max.addSelf(b.position);f.dynamic=!1;return f};
THREE.CollisionUtils.MeshColliderWBox=function(b){return new THREE.MeshCollider(b,THREE.CollisionUtils.MeshOBB(b))};
var LoadingBar=function(b){function f(){var p=o/n;if(p>m){m=p;g.style.width=p*275+"px"}}var c,d,g,h,n=0,o=0,m=0;c=document.createElement("div");d=document.createElement("div");d.style.position="absolute";d.style.display="block";d.style.width="275px";d.style.height="8px";d.style.borderStyle="solid";d.style.borderColor="rgba(255,255,255,0.5)";d.style.borderWidth="1px";d.style.borderRadius="5px";d.style.marginLeft="12px";c.appendChild(d);g=document.createElement("div");g.style.position="absolute";g.style.height=
"8px";g.style.width="0";g.style.background="#fff";g.style.borderRadius="5px";g.style.margin="1px 0 0 13px";c.appendChild(g);h=document.createElement("div");h.setAttribute("style","margin: 30px auto 0 auto;");h.innerHTML="<img src = '/files/mouse_loading.png' alt = 'arrows' />";h.style.marginLeft="8px";c.appendChild(h);c.style.margin="-5px 0 0 0";this.addItem=function(){n++;f()};this.completeItem=function(){o++;f();if(n!=0&&n==o){if(n==o)g.style.background="#000";b()}};this.getMouseInfo=function(){return h};
this.getDomElement=function(){return c}};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
var Sequencer=function(){var b,f=[],c=[],d=[],g=0,h=0,n=0,o=!1;this.add=function(m,p,u,v){m.__active=!1;m.__start=p;m.__duration=u-p;m.__end=u;m.__layer=v;m.init();f.push(m);f.sort(function(w,x){return w.__start-x.__start});d.push(m);d.sort(function(w,x){return w.__end-x.__end})};this.update=function(m){if(m<n){this.clear();n=m}for(;f[g];){b=f[g];if(b.__start>m)break;if(!b.__active&&b.__end>m){b.show((m-b.__start)/b.__duration);b.__active=!0;c.push(b);o=!0}g++}for(;d[h];){b=d[h];if(b.__end>m)break;
if(b.__active){b.hide();b.__active=!1;var p=c.indexOf(b);p!==-1&&c.splice(p,1)}h++}if(o){c.sort(function(v,w){return v.__layer-w.__layer});o=!1}p=0;for(var u=c.length;p<u;p++){b=c[p];b.update((m-b.__start)/b.__duration,m-n,m)}n=m};this.clear=function(){for(h=g=0;c.length;){b=c[0];b.__active=!1;b.hide();c.splice(0,1)}}},SequencerItem=function(){};SequencerItem.prototype={init:function(){},load:function(){},show:function(){},hide:function(){},update:function(){}};
var Tune=function(b){var f,c,d;this.getCurrentTime=function(){return b.currentTime*1E3};this.setBPM=function(g){f=g;d=1/f*6E4};this.getBPM=function(){return f};this.setMS=function(g){d=g;f=1/d*6E4};this.getMS=function(){return d};this.setRows=function(g){c=g};this.getRows=function(){return c};this.getBeatMS=function(g){return d*g};this.getPatternMS=function(g){return d*c*g}};function preInitModel(b,f,c){f.initWebGLObjects(c);for(f=0;f<b.materials.length;f++);}
function preInitScene(b,f){f.initWebGLObjects(b.scene);var c,d;for(c in b.materials){d=b.materials[c];d instanceof THREE.MeshFaceMaterial||d.program||setTimeout(function(){f.initMaterial(d,b.scene.lights,b.scene.fog)},250)}}function preinitAnimal(b,f,c){f.initWebGLObjects(c)}LensFlareTextures={texture0:undefined,texture1:undefined,texture2:undefined};
function initLensFlares(b,f,c){if(LensFlareTextures.texture0===undefined){LensFlareTextures.texture0=THREE.ImageUtils.loadTexture("/files/textures/lensflare0.png");LensFlareTextures.texture1=THREE.ImageUtils.loadTexture("/files/textures/lensflare2.png");LensFlareTextures.texture2=THREE.ImageUtils.loadTexture("/files/textures/lensflare3.png")}var d=new THREE.LensFlare(LensFlareTextures.texture0,700,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,
512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture1,512,0,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,60,0.6,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,70,0.7,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,120,0.9,THREE.AdditiveBlending);d.add(LensFlareTextures.texture2,70,1,THREE.AdditiveBlending);d.customUpdateCallback=lensFlareUpdateCallback;d.position.copy(b);b=new THREE.Object3D;b.addChild(d);b.rotation.x=f*Math.PI/180;b.rotation.y=c*Math.PI/180;
return b}function lensFlareUpdateCallback(b){var f,c,d=b.lensFlares.length,g=-b.positionScreen.x*2,h=-b.positionScreen.y*2;for(c=0;c<d;c++){f=b.lensFlares[c];f.x=b.positionScreen.x+g*f.distance;f.y=b.positionScreen.y+h*f.distance;f.rotation=0}b.lensFlares[2].y+=0.025;b.lensFlares[3].rotation=b.positionScreen.x*0.5+45*Math.PI/180}function makeSceneStatic(b){var f,c,d;f=0;for(c=b.objects.length;f<c;f++){d=b.objects[f];d.matrixAutoUpdate=!1;d.updateMatrix()}}
function hideColliders(b){var f,c,d;f=0;for(c=b.collisions.colliders.length;f<c;f++){d=b.collisions.colliders[f].mesh;d.visible=!1}}function applyMaterial(b,f,c){var d,g,h,n=f.length;for(d=0;d<n;d++){g=f[d][0];h=f[d][1];b.objects[g]&&(b.objects[g].geometry.materials[h][0]=c)}}
var UgcObject=function(b){var f=UgcObject.TYPE_GROUND,c={},d=0;this.addVoxel=function(m,p,u,v,w){c[m+"."+p+"."+u]={x:m,y:p,z:u,color:v,object:w};d++};this.getType=function(){return f};this.setType=function(m){f=m};this.getVoxel=function(m,p,u){return c[m+"."+p+"."+u]};this.deleteVoxel=function(m,p,u){delete c[m+"."+p+"."+u];d--};this.isEmpty=function(){return d==0};this.getGrid=function(){return c};this.setGrid=function(m){c=m};this.clear=function(){delete c;c={};d=0};this.getJSON=function(){function m(){if(x.length){v.push(w);
v.push(y);v=v.concat(x)}}var p,u,v=[5],w=null,x=[],y=0;for(p in c){u=c[p];if(u.color!=w){m();w=u.color;y=0;x=[]}x.push(u.x,u.y,u.z);y++}m();return JSON.stringify(v)};this.getMesh=function(){var m,p,u=new THREE.Mesh(new THREE.Cube(50,50,50)),v=new THREE.Geometry;for(m in c){p=c[m];u.position.x=p.x*50;u.position.y=p.y*50;u.position.z=p.z*50;for(m=0;m<u.geometry.faces.length;m++)u.geometry.faces[m].color.setHex(p.color);GeometryUtils.merge(v,u)}m=new THREE.MeshShaderMaterial({uniforms:UgcShader.uniforms(),
vertexShader:UgcShader.vertexShader,fragmentShader:UgcShader.fragmentShader,shading:THREE.FlatShading,lights:!0,vertexColors:1});return new THREE.Mesh(v,m)};if(b&&b[0]==5)for(var g=1,h=b.length,n=0,o=0;g<h;){n=b[g++];o=b[g++];for(j=0;j<o;j++)this.addVoxel(b[g++],b[g++],b[g++],n)}};UgcObject.TYPE_GROUND="ground";UgcObject.TYPE_SKY="sky";
var UgcHandler=function(){function b(n){var o=window.location.search;if(o!==""){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");n=RegExp("[\\?&]"+n+"=([^&#]*)").exec(o);if(n!=null)return decodeURIComponent(n[1].replace(/\+/g," "))}}function f(n){var o,m,p,u,v,w;v=n.length;u=p=0;for(w=new Uint8Array(v/4*3);p<v;){do o=h[n.charCodeAt(p++)&255];while(p<v&&o==-1);if(o==-1)break;do m=h[n.charCodeAt(p++)&255];while(p<v&&m==-1);if(m==-1)break;w[u++]=o<<2|(m&48)>>4;do{o=n.charCodeAt(p++)&255;if(o==61)return w;
o=h[o]}while(p<v&&o==-1);if(o==-1)break;w[u++]=(m&15)<<4|(o&60)>>2;do{m=n.charCodeAt(p++)&255;if(m==61)return w;m=h[m]}while(p<v&&m==-1);if(m==-1)break;w[u++]=(o&3)<<6|m}return w}function c(n,o,m){function p(y){return y.charCodeAt(0)&255}m=m||{};m.type=m.type||"image/png";m.filename=m.filename||"file";var u=new XMLHttpRequest,v='--BEAUTIFUL----------------BOUNDRY\r\nContent-Disposition: form-data; name="file"; filename="'+m.filename+'"\r\nContent-Type: '+m.type+"\r\n\r\n";o=f(o.slice(m.type.length+
13));head=Array.prototype.map.call(v,p);tail=Array.prototype.map.call("\r\n--BEAUTIFUL----------------BOUNDRY--",p);var w=head.length,x=o.length;v=new Uint8Array(w+x+tail.length);v.set(head);v.set(o,w);v.set(tail,w+x);u.open("POST",n,!0);u.setRequestHeader("Content-Type","multipart/form-data; boundary=BEAUTIFUL----------------BOUNDRY");u.onreadystatechange=function(){u.readyState===4&&m.callback&&m.callback(u.responseText)};u.sendAsBinary?u.sendAsBinary(v.buffer):u.send(v.buffer);return u.responseText}
var d=this;this.getLatestUGOs=function(n,o){g(function(m){if(o===0){var p=b("id");p!==undefined?d.getUGO(p,function(u){n([u].concat(m))}):n(m)}else n(m)},o)};var g=function(n,o){var m=new XMLHttpRequest;m.open("GET","/ugc/objects?category=favorite&offset="+o*10+"&limit=10&property=data&property=category",!0);m.onreadystatechange=function(){if(m.readyState==4)if(m.status==200)if(m.responseText!=="")n(JSON.parse(m.responseText));else{console.warn("UGC response empty");n({})}else console.log("Unable to load latest User Generated Content")};
m.send(null)};this.getUGO=function(n,o){var m=new XMLHttpRequest;m.open("GET","/ugc/objects/"+n+"?property=data&property=category",!0);m.onreadystatechange=function(){if(m.readyState==4)if(m.status==200){var p=JSON.parse(m.responseText);o(p)}else console.log("Could not fetch "+n)};m.send(null)};var h=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,
2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];this.submitUGO=function(n,o,m){function p(){m({success:!1})}var u=new XMLHttpRequest;u.open("POST","/ugc/objects");u.onreadystatechange=function(){if(u.readyState==4)if(u.status==200)try{var v=JSON.parse(u.responseText);if(v.success){var w=v.upload_url;delete v.upload_url;c(w,o,{filename:n.title,callback:function(){m(v)}})}else p()}catch(x){console.log(x);
p()}else p()};u.send(JSON.stringify(n))}};
window.GEE=function(b){b||(b={});if(document.createElement("canvas").getContext){var f=this,c={},d={ctx:undefined,domElement:undefined,width:undefined,height:undefined,desiredFrameTime:1E3/60,frameCount:0,key:undefined,keyCode:undefined,mouseX:0,mouseY:0,pmouseX:undefined,pmouseY:undefined,mousePressed:!1},g,h=function(){for(var o=g,m=0,p=0;o;){p+=o.offsetTop;m+=o.offsetLeft;o=o.offsetParent}offset={x:m,y:p}};b.context||(b.context="2d");b.width||(b.width=500);b.height||(b.height=500);g=d.domElement=
document.createElement("canvas");d.ctx=g.getContext(b.context);if(d.ctx==null)b.fallback&&b.fallback();else{if(b.fullscreen){var n=function(){h();d.width=g.width=window.innerWidth;d.height=g.height=window.innerHeight-4};window.addEventListener("resize",n,!1);n();b.container||(b.container=document.body);document.body.style.margin="0px";document.body.style.padding="0px"}else{h();f.__defineSetter__("width",function(o){d.width=g.width=o});f.__defineSetter__("height",function(o){d.height=g.height=o});
f.width=b.width;f.height=b.height}if(b.container){b.container.appendChild(g);h()}b=function(o){f.__defineGetter__(o,function(){return d[o]})};b("ctx");b("width");b("height");b("frameCount");b("key");b("keyCode");b("mouseX");b("mouseY");b("pmouseX");b("pmouseY");b("mousePressed");b("domElement");b=function(){};f.loop=!0;f.keyup=b;f.keydown=b;f.draw=b;f.mousedown=b;f.mouseup=b;f.mousemove=b;f.mousedrag=b;f.__defineGetter__("frameRate",function(){return NaN});f.__defineGetter__("frameTime",function(){});
f.__defineGetter__("keyPressed",function(){for(var o in c)if(c[o])return!0;return!1});f.__defineSetter__("frameTime",function(o){d.desiredFrameTime=o});f.__defineSetter__("frameRate",function(o){d.desiredFrameTime=k/o});g.addEventListener("mouseenter",function(){h()},!1);window.addEventListener("mousemove",function(o){var m=o.pageX-offset.x;o=o.pageY-offset.y;if(d.pmouseX==undefined){d.pmouseX=m;d.pmouseY=o}else{d.pmouseX=d.mouseX;d.pmouseY=d.mouseY}d.mouseX=m;d.mouseY=o},!1);window.addEventListener("mousemove",
function(){f.mousemove()},!1)}}else b.fallback&&b.fallback()};function loadSVG(b,f,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200)if(d.responseXML==null)c!=undefined&&c.call(this,b);else{var g=d.responseXML.getElementsByTagName("svg").item(0);g=new SVG(g);g.filename=b;f.call(this,g,b)}else c!=undefined&&c.call(this,b)};d.open("GET",b,!0);d.send(null)}
var SVG=function(b){this.filename="";this.children=[];var f=b.getAttribute("width"),c=b.getAttribute("height");this.width=f==null?0:parseFloat(f.replace("px",""));this.height=c==null?0:parseFloat(c.replace("px",""));for(var d in b.childNodes)b.childNodes.item(d).getAttribute&&this.children.push(b.childNodes.item(d).nodeName=="g"?new SVG(b.childNodes.item(d)):new Path(b.childNodes.item(d)));this.draw=function(g){for(var h in this.children)this.children[h].draw(g)};this.__defineGetter__("path",function(){})},
Path=function(b){this.element=b;this.commands=commands(b);this.lineWidth=parseLineWidth(b);this.strokeStyle=parseStrokeStyle(b);this.fillStyle=parseFillStyle(b);this.totalLength=0;this.lengths=[];this.tlengths=[];var f=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0};this.reset()};this.draw=function(c){this.style(c);c.beginPath();this.shape(c);this.end(c)};this.getAnchorPoints=function(){var c=[],d;for(d in this.commands)c.push(this.commands[d].getAnchorPoints(f));
return c};this.shape=function(c){for(var d in this.commands)this.commands[d].shape(f,c)};this.lerp=function(c,d,g,h,n){var o=1-n;return c*o*o*o+3*d*n*o*o+3*g*n*n*o+h*n*n*n};this.at=function(c,d){var g,h;this.lengths.length==0&&this.calcLengths(d);h=this.tlengths[0];for(g=0;c>h;){g++;h+=this.tlengths[g]}pt=h-this.tlengths[g];h=this.map(c,pt,h,0,1);for(var n=0;n<=g;n++)this.commands[n].shape(f,d);var o=f.x;n=f.y;this.commands[g+1].shape(f,d);g=this.lerp(o,f.x1,f.x2,f.x,h);h=this.lerp(n,f.y1,f.y2,f.y,
h);return{x:g,y:h}};this.map=function(c,d,g,h,n){return h+(n-h)*((c-d)/(g-d))};this.calcLengths=function(c){var d,g,h,n,o=0;this.commands[0].shape(f,c);for(var m=h=f.x,p=n=f.y,u=1;u<this.commands.length;u++){o=0;m=f.x;p=f.y;this.commands[u].shape(f,c);for(var v=0;v<=1;v+=0.0010){d=this.lerp(m,f.x1,f.x2,f.x,v);g=this.lerp(p,f.y1,f.y2,f.y,v);o+=this.dist(d,g,h,n);h=d;n=g}this.lengths.push(o);this.totalLength+=o}for(c=0;c<this.lengths.length;c++)this.tlengths.push(this.lengths[c]/this.totalLength)};
this.dist=function(c,d,g,h){return Math.sqrt((c-g)*(c-g)+(d-h)*(d-h))};this.style=function(c){if(this.lineWidth!=null)c.lineWidth=this.lineWidth;if(this.strokeStyle!=null){c.strokeStyle=this.strokeStyle;if(this.lineWidth==undefined)c.lineWidth=1}if(this.fillStyle!=null)c.fillStyle=this.fillStyle};this.end=function(c){this.fillStyle!=null&&c.fill();this.strokeStyle!=null&&c.stroke()}},parseLineWidth=function(b){b=b.attributes.getNamedItem("stroke-width");return b==null?null:parseFloat(b.nodeValue)},
parseStrokeStyle=function(b){b=b.attributes.getNamedItem("stroke");return b==null?null:b.nodeValue},parseFillStyle=function(b){var f=b.attributes.getNamedItem("fill");if(f==null)return b.attributes.getNamedItem("stroke")!=null?null:"#000000";else{if(f.nodeValue=="none")return null;return f.nodeValue}},Command=function(b,f){this.type=b;this.data=f;this.debug=!1;this.shape=function(c,d){if(this.type=="M"){c.x=this.data[0];c.y=this.data[1];d&&d.moveTo(c.x,c.y)}else if(this.type=="C"){c.x=this.data[4];
c.y=this.data[5];if(d)d.bezierCurveTo(c.x1=this.data[0],c.y1=this.data[1],c.x2=this.data[2],c.y2=this.data[3],c.x,c.y)}else if(this.type=="c"){if(d)d.bezierCurveTo(c.x1=c.x+this.data[0],c.y1=c.y+this.data[1],c.x2=c.x+this.data[2],c.y2=c.y+this.data[3],c.x+=this.data[4],c.y+=this.data[5])}else if(this.type=="S"){c.x=this.data[2];c.y=this.data[3];var g=c.x-c.x2,h=c.y-c.y2;if(d)d.bezierCurveTo(c.x1=c.x+g,c.y1=c.y+h,c.x2=this.data[0],c.y2=this.data[1],c.x,c.y)}else if(this.type=="s"){g=c.x-c.x2;h=c.y-
c.y2;if(d)d.bezierCurveTo(c.x1=c.x+g,c.y1=c.y+h,c.x2=c.x+this.data[0],c.y2=c.y+this.data[1],c.x+=this.data[2],c.y+=this.data[3])}else if(this.type=="L"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="l"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=this.data[0],c.y+=this.data[1]);c.x2=c.x;c.y2=c.y}else if(this.type=="H"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x=this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="h"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x+=
this.data[0],c.y);c.x2=c.x;c.y2=c.y}else if(this.type=="V"){c.x1=c.x;c.y1=c.y;if(d)d.lineTo(c.x,c.y=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="v"){c.x1=c.x;c.y1=c.y;d&&d.lineTo(c.x,c.y+=this.data[0]);c.x2=c.x;c.y2=c.y}else if(this.type=="z")d.closePath();else console&&console.log("unrecognized command "+this.type);if(d){d.strokeStyle="#000000";d.lineWidth=1;if(this.debug){d.strokeRect(c.x-1.5,c.y-1.5,3,3);d.beginPath();d.moveTo(c.px,c.py);d.lineTo(c.x1,c.y1);d.closePath();d.stroke()}}}},
commands=function(b){if(b.nodeName.toLowerCase()=="path")return commandsFromD(b.getAttribute("d"));if(b.nodeName.toLowerCase()=="polygon")return commandsFromPoints(b.getAttribute("points"));if(b.nodeName.toLowerCase()=="line")return commandsFromLine(b);if(b.nodeName.toLowerCase()=="rect")return commandsFromRect(b);return[]},commandsFromD=function(b){var f=[];b=b.match(/[a-zA-Z][0-9\.\-\,]+/g);for(var c=0;c<b.length;c++){var d=b[c].charAt(0),g=b[c].substr(1);g=g.replace(/\-/g,",-");g.charAt(0)==","&&
(g=g.substr(1));g=g.split(",");for(var h=0;h<g.length;h++)g[h]=parseFloat(g[h]);f.push(new Command(d,g))}return f},commandsFromLine=function(b){var f=[],c=parseFloat(b.getAttribute("x1")),d=parseFloat(b.getAttribute("x2")),g=parseFloat(b.getAttribute("y1"));b=parseFloat(b.getAttribute("y2"));f.push(new Command("M",[c,g]));f.push(new Command("L",[d,b]));return f},commandsFromPoints=function(b){var f=!0;if(b.indexOf(",")==-1)for(var c=0;c<b.length;c++)if(b.charAt(c)==" "){f&&(b=b.setCharAt(c,","));
f=!f}b=("M"+b).replace(/ /g,"L")+"z";return commandsFromD(b)};String.prototype.setCharAt=function(b,f){if(b>this.length-1)return str;return this.substr(0,b)+f+this.substr(b+1)};
var commandsFromRect=function(b){var f=[],c=parseFloat(b.getAttribute("x")),d=parseFloat(b.getAttribute("y")),g=parseFloat(b.getAttribute("width"));b=parseFloat(b.getAttribute("height"));f.push(new Command("M",[c,d]));f.push(new Command("h",[g]));f.push(new Command("v",[b]));f.push(new Command("h",[-g]));f.push(new Command("v",[-b]));return f},WonderWall=WonderWall||{};
WonderWall.Point=function(b,f,c){var d=f,g=c,h=0;this.x=f;this.y=c;this.r=0.07;this.threshold=0.1;this.easing=0.125;this.updating=!1;this.angle=0;this.update=function(n){if(this.updating){var o=b.mouseY-g-n.y;f=d+(b.mouseX-d-n.x)*this.r;c=g+o*this.r;this.easing=0.0625}else{f=d;c=g;h=0;this.easing=0.125}this.x=this.ease(this.x,f,this.easing);this.y=this.ease(this.y,c,this.easing);this.angle=this.ease(this.angle,h,this.easing)};this.setPosition=function(n,o){d=n;g=o};this.getOriginPosition=function(){return{x:d,
y:g}};this.getPoint=function(){return{x:this.x,y:this.y}}};WonderWall.Point.prototype.ease=function(b,f,c){var d=f-b;if(Math.abs(d)<c/100)b=f;else b+=d*c;return b};
WonderWall.Pentagon=function(b,f,c,d){var g=b.ctx;this.separate=!1;this.showFill=!0;this.showStroke=!0;this.insides=!1;this.x=f;this.y=c;if(this.x==undefined||this.x==null||this.x==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y==NaN)this.y=b.height/2;f=this.generatePoints(this.x,this.y,d,5);var h=[];for(c=0;c<f.length;c++){var n=f[c];h.push(new WonderWall.Point(b,n.x,n.y))}this.update=function(o){this.x=b.width/2;this.y=b.height/2;var m=this.generatePoints(this.x,this.y,d,5);if(!this.separate)this.separate=
!0;for(var p=0;p<h.length;p++){var u=h[p],v=m[p];u.update(o);var w=u.getOriginPosition();(v.x!=w.x||v.y!=w.y)&&u.setPosition(v.x,v.y)}return this};this.render=function(){if(this.insides&&this.showStroke)for(var o=0;o<h.length;o++){var m=h[o];this.separate||m.update();g.beginPath();g.moveTo(this.x,this.y);g.lineTo(m.x,m.y);g.stroke()}g.beginPath();for(o=0;o<h.length;o++){m=h[o];this.separate||m.update();o<1?g.moveTo(m.x,m.y):g.lineTo(m.x,m.y)}g.closePath();this.showFill&&g.fill();this.showStroke&&
g.stroke()};this.setUpdate=function(o){for(var m=0;m<h.length;m++)h[m].updating=o};this.setUpdatePoint=function(o,m){h[m].updating=o};this.setRadius=function(o){for(var m=0;m<h.length;m++)h[m].r=o};this.getPoints=function(){return h}};WonderWall.Pentagon.prototype.generatePoints=function(b,f,c,d){for(var g=[],h=0;h<d;h++)g.push({x:c*Math.sin(h/d*2*Math.PI)+b,y:-c*Math.cos(h/d*2*Math.PI)+f});return g};
function Heart(b,f,c,d){var g=this,h=b.ctx;this.x=c;this.y=d;if(this.x==undefined||this.x==null||this.x||this==NaN)this.x=b.width/2;if(this.y==undefined||this.y==null||this.y||this==NaN)this.y=b.height/2;var n,o=!1;this.update=function(){return this};this.render=function(){if(o){h.save();h.translate(this.x,this.y);h.save();h.translate(-this.width/2,-this.height/2);n.draw(h);h.restore();h.restore()}};loadSVG(f,function(m,p){n=m;g.source=p;g.width=n.width;g.height=n.height;o=!0},function(){})}
var ClearEffect=function(b){SequencerItem.call(this);var f,c=b.renderer,d=b.renderTarget;this.init=function(){f=new THREE.Camera(60,1,1,1E4);f.position.z=2;new THREE.Scene};this.update=function(){c.clear();var g=c.getContext();g.bindFramebuffer(g.FRAMEBUFFER,d.__webglFramebuffer);g.viewport(0,0,d.width,d.height);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT)}};ClearEffect.prototype=new SequencerItem;ClearEffect.prototype.constructor=ClearEffect;
var FadeInEffect=function(b,f){SequencerItem.call(this);var c,d,g,h,n=f.renderer,o=f.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;g=new THREE.MeshBasicMaterial({color:b,opacity:0,depthTest:!1});h=new THREE.Mesh(new THREE.Plane(3,3),g);d.addObject(h)};this.update=function(m){g.opacity=1-m;n.render(d,c,o)}};FadeInEffect.prototype=new SequencerItem;FadeInEffect.prototype.constructor=FadeInEffect;
var FadeOutEffect=function(b,f){SequencerItem.call(this);var c,d,g,h,n=f.renderer,o=f.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;g=new THREE.MeshBasicMaterial({color:b,opacity:1,depthTest:!1});h=new THREE.Mesh(new THREE.Plane(3,3),g);d.addObject(h)};this.update=function(m){g.opacity=m;n.render(d,c,o)}};FadeOutEffect.prototype=new SequencerItem;FadeOutEffect.prototype.constructor=FadeOutEffect;
var RenderEffect=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,h=b.renderTarget;this.init=function(){f=new THREE.Camera;f.position.z=200;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c=new THREE.Scene;var n=new THREE.MeshBasicMaterial({map:h,depthTest:!1});d=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),n);d.scale.y=-1;d.doubleSided=!0;c.addObject(d)};this.update=function(){g.render(c,f)}};
RenderEffect.prototype=new SequencerItem;RenderEffect.prototype.constructor=RenderEffect;
var NoiseEffect=function(b,f,c,d){SequencerItem.call(this);var g,h,n,o,m,p=b.renderer,u=b.renderTarget;this.init=function(){g=new THREE.Camera;g.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);g.position.z=100;h=new THREE.Scene;o=THREE.ShaderUtils.lib.film;m=THREE.UniformsUtils.clone(o.uniforms);m.tDiffuse.texture=u;n=new THREE.MeshShaderMaterial({uniforms:m,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader});m.grayscale.value=
0;if(f!==undefined)m.nIntensity.value=f;if(c!==undefined)m.sIntensity.value=c;if(d!==undefined)m.sCount.value=d;var v=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),n);v.position.z=-500;h.addObject(v)};this.update=function(v,w,x){m.time.value=x*0.01%1E4;p.render(h,g,u,!1)}};NoiseEffect.prototype=new SequencerItem;NoiseEffect.prototype.constructor=NoiseEffect;
var BloomEffect=function(b,f){SequencerItem.call(this);var c,d,g,h,n,o,m,p,u,v,w,x=b.renderer,y=b.renderTarget;this.init=function(){c=new THREE.Camera;c.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);c.position.z=100;d=new THREE.Scene;var A={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};m=new THREE.WebGLRenderTarget(256,512,A);p=new THREE.WebGLRenderTarget(512,256,A);A=THREE.ShaderUtils.lib.screen;
h=THREE.UniformsUtils.clone(A.uniforms);h.tDiffuse.texture=y;h.opacity.value=f!==undefined?f:1;g=new THREE.MeshShaderMaterial({uniforms:h,vertexShader:A.vertexShader,fragmentShader:A.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0});A=THREE.ShaderUtils.lib.convolution;n=THREE.UniformsUtils.clone(A.uniforms);v=new THREE.Vector2(0.001953125,0);w=new THREE.Vector2(0,0.001953125);n.tDiffuse.texture=y;n.uImageIncrement.value=v;n.cKernel.value=THREE.ShaderUtils.buildKernel(4);o=new THREE.MeshShaderMaterial({uniforms:n,
vertexShader:"#define KERNEL_SIZE 25.0\n"+A.vertexShader,fragmentShader:"#define KERNEL_SIZE 25\n"+A.fragmentShader});u=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),o);u.position.z=-500;d.addObject(u)};this.update=function(){u.materials[0]=o;n.tDiffuse.texture=y;n.uImageIncrement.value=v;x.render(d,c,m,!0);n.tDiffuse.texture=m;n.uImageIncrement.value=w;x.render(d,c,p,!0);u.materials[0]=g;g.blending=THREE.AdditiveBlending;h.tDiffuse.texture=p;x.render(d,c,y,!1)}};
BloomEffect.prototype=new SequencerItem;BloomEffect.prototype.constructor=BloomEffect;
var HeatEffect=function(b){SequencerItem.call(this);var f,c,d,g,h=b.renderer,n=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;g={time:{type:"f",value:0},map:{type:"t",value:0,texture:n},sampleDistance:{type:"f",value:1/b.baseWidth}};d=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv;\ncolor = texture2D( map, uv );\nfloat param1 = 0.0009;\nfloat param2 = 0.001;\nadd = tmp = texture2D( map, uv + vec2( param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param1, -param1 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -param2, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, param2 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -param2 ));\nif( tmp.r < color.r ) color = tmp;\ngl_FragColor = color * color + add * 0.5 / 8.0;\n}"});
var o=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);o.position.z=-500;c.addObject(o)};this.update=function(o,m,p){g.time.value=p*0.01;h.render(c,f,n,!1)}};HeatEffect.prototype=new SequencerItem;HeatEffect.prototype.constructor=HeatEffect;
var PaintEffect=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,h=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.61},colorOffset:{type:"f",
value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.54},waveFactor:{type:"f",value:0.00127},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffect.prototype=new SequencerItem;PaintEffect.prototype.constructor=PaintEffect;
var PaintEffectPrairie=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,h=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.94},vingenettingDarkening:{type:"f",value:0.36},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.49},waveFactor:{type:"f",value:0.00161},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.55 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.g > color.g ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffectPrairie.prototype=new SequencerItem;PaintEffectPrairie.prototype.constructor=PaintEffectPrairie;
var PaintEffectDunes=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,h=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:1.2},vingenettingDarkening:{type:"f",value:0.64},
colorOffset:{type:"f",value:0},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0.4},waveFactor:{type:"f",value:0.00756},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2(4.0);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (1.86 + sample_dist) * sampleDistance * 0.5;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( 0.94/* vingenettingOffset*/ );\ncolor = (add / vec4(8.0));\ngl_FragColor = vec4( mix(color.rgb, color.ggg * colorFactor /* - vec3( vingenettingDarkening )*/, vec3( dot( uv, uv ))), 1.0 );\ngl_FragColor = vec4(1.0) - (vec4(1.0) - gl_FragColor) * (vec4(1.0) - gl_FragColor);\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffectDunes.prototype=new SequencerItem;PaintEffectDunes.prototype.constructor=PaintEffectDunes;
var PaintEffectVideo=function(b){SequencerItem.call(this);var f,c,d,g=b.renderer,h=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;this.uniforms={map:{type:"t",value:0,texture:h},screenWidth:{type:"f",value:b.baseWidth},screenHeight:{type:"f",value:b.baseHeight},vingenettingOffset:{type:"f",value:0.87},vingenettingDarkening:{type:"f",value:0.5},
colorOffset:{type:"f",value:0.95},colorFactor:{type:"f",value:0},colorBrightness:{type:"f",value:0},sampleDistance:{type:"f",value:0},waveFactor:{type:"f",value:0},colorA:{type:"v3",value:new THREE.Vector3(1,1,1)},colorB:{type:"v3",value:new THREE.Vector3(1,1,1)},colorC:{type:"v3",value:new THREE.Vector3(1,1,1)}};d=new THREE.MeshShaderMaterial({uniforms:this.uniforms,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float vingenettingOffset;\nuniform float vingenettingDarkening;\nuniform float colorOffset;\nuniform float colorFactor;\nuniform float sampleDistance;\nuniform float colorBrightness;\nuniform float waveFactor;\nuniform vec3 colorA;\nuniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( map, uv );\nvin = (uv - vec2(0.5)) * vec2( 1.4 /*vingenettingOffset * 2.0*/);\nsample_dist =(dot( vin, vin ) * 2.0);\nf = (waveFactor * 100.0 + sample_dist) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2(f);\nadd += tmp = texture2D( map, uv + vec2(0.111964, 0.993712) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.846724, 0.532032) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.943883, -0.330279) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(0.330279, -0.943883) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.532032, -0.846724) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.993712, -0.111964) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2(-0.707107, 0.707107) * sampleSize);\nif( tmp.b < color.b ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2( vingenettingOffset );\ncolor = color * vec4(2.0) - (add / vec4(8.0));\ncolor = color + (add / vec4(8.0) - color) * (vec4(1.0) - vec4(sample_dist * 0.5));\ngl_FragColor = vec4( mix(color.rgb * color.rgb * vec3(colorOffset) + color.rgb, color.ggg * colorFactor - vec3( vingenettingDarkening ), vec3( dot( uv, uv ))), 1.0 );\n}"});
var n=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);n.position.z=-500;c.addObject(n)};this.update=function(){g.render(c,f)}};PaintEffectVideo.prototype=new SequencerItem;PaintEffectVideo.prototype.constructor=PaintEffectVideo;
var PaintDarkEffect=function(b){SequencerItem.call(this);var f,c,d,g,h=b.renderer,n=b.renderTarget;this.init=function(){f=new THREE.Camera;f.projectionMatrix=THREE.Matrix4.makeOrtho(b.baseWidth/-2,b.baseWidth/2,b.baseHeight/2,b.baseHeight/-2,-1E4,1E4);f.position.z=100;c=new THREE.Scene;g={map:{type:"t",value:0,texture:n}};d=new THREE.MeshShaderMaterial({uniforms:g,vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, tmp, add;\nvec2 uv = vUv + vec2( sin( vUv.y * 100.0 ), sin( vUv.x * 100.0 )) * 0.0005;\ncolor = texture2D( map, uv );\nadd = tmp = texture2D( map, uv + vec2( 0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, 0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.0015, -0.0015 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( -0.002, 0.0 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, 0.002 ));\nif( tmp.r < color.r ) color = tmp;\nadd += tmp = texture2D( map, uv + vec2( 0, -0.002 ));\nif( tmp.r < color.r ) color = tmp;\nuv = (uv - vec2(0.5)) * vec2(0.7);\ngl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);\n}"});
var o=new THREE.Mesh(new THREE.Plane(b.baseWidth,b.baseHeight),d);o.position.z=-500;c.addObject(o)};this.update=function(){h.render(c,f,n,!1)}};PaintDarkEffect.prototype=new SequencerItem;PaintDarkEffect.prototype.constructor=PaintDarkEffect;
var OverlayEffect=function(b,f){SequencerItem.call(this);var c,d,g,h=b.renderer,n=b.renderTarget;this.init=function(){c=new THREE.Camera(60,1,1,1E4);c.position.z=2;d=new THREE.Scene;this.material=new THREE.MeshBasicMaterial({color:16777215,map:f,transparent:!0});g=new THREE.Mesh(new THREE.Plane(3,3),this.material);d.addObject(g)};this.update=function(){this.material.opacity=0.25;h.render(d,c,n)}};OverlayEffect.prototype=new SequencerItem;OverlayEffect.prototype.constructor=OverlayEffect;
var PointerEffect=function(b,f){SequencerItem.call(this);this.show=function(){document.body.style.cursor=f?'url("/files/mouse_ring.png"), auto':"none"};this.hide=function(){document.body.style.cursor="auto"}};PointerEffect.prototype=new SequencerItem;PointerEffect.prototype.constructor=PointerEffect;
var PointerImageEffect=function(b,f){SequencerItem.call(this);var c=0,d=0,g=14,h=document.createElement("div");h.setAttribute("style","width: 8px; height: 56px;");h.innerHTML="<img src = '"+f+"' alt = 'mouse' />";var n=document.createElement("div");n.setAttribute("style","width: 8px; height: 14px;");n.style.position="absolute";n.style.zIndex=1E3;n.style.display="none";n.style.cursor="none";n.style.overflow="hidden";n.appendChild(h);document.body.appendChild(n);this.show=function(){document.body.style.cursor=
"none !important";n.style.display="block"};b.signals.mousemoved.add(function(){var o=b.mouse.x-c,m=b.mouse.y-d;if(o>0)if(m>0)g=-28;else m<0&&(g=-14);else if(o<0)if(m>0)g=-42;else m<0&&(g=0)});this.hide=function(){n.style.display="none";document.body.style.cursor="auto !important"};this.update=function(){h.style.marginTop=g+"px";n.style.left=b.mouse.x-4+"px";n.style.top=b.mouse.y-7+"px";c=b.mouse.x;d=b.mouse.y}};PointerImageEffect.prototype=new SequencerItem;
PointerImageEffect.prototype.constructor=PointerImageEffect;
var CityWorld=function(b){var f=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;f.portals=[];this.scene.fog=new THREE.FogExp2(5461848,4.7E-5);this.scene.addLight(new THREE.AmbientLight(3359795));var c=new THREE.DirectionalLight(16777215);c.castShadow=!1;this.scene.addLight(c);var d=new THREE.DirectionalLight(16777215);d.castShadow=!1;this.scene.addLight(d);var g={fogDensity:2.64E-5,fogColor:{h:0,s:0.3235,v:0.347},ambientLight:{h:0.465,s:0.494,v:0},directionalLight1:{h:0.565,
s:0.329,v:0.841,x:0.5176767580772196,y:0.7138857482214859,z:-0.4715696264952919,phi:0.7757647058823531,theta:-0.7388235294117651},directionalLight2:{h:0,s:0,v:0.18235294117647058,x:-0.8372195027957865,y:-0.4114343306911316,z:-0.3602572631705248,phi:-1.9948235294117649,theta:0.4063529411764706},effectEnabled:!0,effectType:"noise",postprocessingNoise:{nIntensity:0.2411764705882353,sIntensity:0,sCount:4096},postprocessingBloom:{opacity:1},flarex:18.52941176470588,flarey:358,flyCamera:{position:{x:16.574202591686277,
y:462.26953453589,z:-10184.707948888321},target:{x:13.49395371115724,y:486.5924391778843,z:-10281.655916255411}},sceneScale:1};this.scene.fog.color.setHSV(g.fogColor.h,g.fogColor.s,g.fogColor.v);this.scene.fog.density=g.fogDensity;c.color.setHSV(g.directionalLight1.h,g.directionalLight1.s,g.directionalLight1.v);d.color.setHSV(g.directionalLight2.h,g.directionalLight2.s,g.directionalLight2.v);c.position.set(g.directionalLight1.x,g.directionalLight1.y,g.directionalLight1.z);d.position.set(g.directionalLight2.x,
g.directionalLight2.y,g.directionalLight2.z);f.scene.addChild(initLensFlares(new THREE.Vector3(0,0,-5E3),20,358));c=new THREE.SceneLoader;c.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};c.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};c.load("files/models/city/City.js",function(n){var o=n.scene;hideColliders(o);makeSceneStatic(o);preInitScene(n,b.renderer);o.scale.set(0.1,0.1,0.1);o.updateMatrix();f.scene.addChild(o);o.collisions&&f.scene.collisions.merge(o.collisions);
TriggerUtils.setupCityTriggers(n);n.objects.Backdrop_City.materials[0].map.wrapS=THREE.RepeatWrapping;n.objects.Backdrop_City.materials[0].map.wrapT=THREE.RepeatWrapping;f.portals.push({object:n.objects.Portal,radius:150,currentDistance:9999999});f.portals.push({object:n.objects["Portal.001"],radius:150,currentDistance:9999999});f.portals.push({object:n.objects["Portal.002"],radius:150,currentDistance:9999999});f.portals.push({object:n.objects["Portal.003"],radius:150,currentDistance:9999999});applyCityShader(n,
["Backdrop_City"]);f.scene.update(undefined,!0)});var h;this.update=function(n,o,m){h=o.matrixWorld.getPosition();TriggerUtils.effectorRadius=80;TriggerUtils.update("city");if(m)for(n=0;n<f.portals.length;n++){f.portals[n].currentDistance=f.portals[n].object.matrixWorld.getPosition().distanceTo(h);f.portals[n].currentDistance<f.portals[n].radius&&b.signals.startexploration.dispatch("dunes")}}},PrairieWorld=function(b,f,c){var d=this;this.scene=new THREE.Scene;this.scene.collisions=new THREE.CollisionSystem;
this.portals=[];this.cows={};this.scene.fog=new THREE.FogExp2(16777215,0);this.scene.fog.color.setHSV(0.559,0.741,0.588);this.ambient=new THREE.AmbientLight(2232576);this.ambient.color.setHSV(0.235,0.341,0.141);this.scene.addLight(this.ambient);this.directionalLight1=new THREE.DirectionalLight(16772829);this.directionalLight1.position.set(0.196,0.93,-0.3);this.directionalLight1.color.setHSV(0,0,0.876);this.scene.addLight(this.directionalLight1);this.directionalLight2=new THREE.DirectionalLight(16772829);
this.directionalLight2.position.set(0.19,-0.31,-0.93);this.directionalLight2.color.setHSV(0.347,0.51,0.135);this.scene.addLight(this.directionalLight2);this.settings={fogDensity:2.0588E-5,fogColor:{h:0.5235,s:0.5,v:1},ambientLight:{h:0.465,s:0,v:0},directionalLight1:{h:0.565,s:0,v:0.5058823529411764,x:0.7648718326037581,y:-0.5885011172553458,z:0.2619876231400604,phi:0.6649411764705881,theta:0.9235294117647057},directionalLight2:{h:0,s:0,v:0.4235294117647059,x:-0.4535568600884794,y:0.8775825618903728,
z:-0.1553545034191468,phi:-1.588470588235294,theta:0.6279999999999997},effectEnabled:!0,effectType:"bloom",postprocessingNoise:{nIntensity:1,sIntensity:0.05,sCount:4096},postprocessingBloom:{opacity:1},flarex:12.176470588235293,flarey:304.94117647058823,flyCamera:{position:{x:225.04246271915372,y:2.9824761744404835,z:-95.92308075145283},target:{x:318.61355381056615,y:-32.161822413807094,z:-92.86870868788631}},sceneScale:1};this.directionalLight1.color.setHSV(this.settings.directionalLight1.h,this.settings.directionalLight1.s,
this.settings.directionalLight1.v);this.directionalLight2.color.setHSV(this.settings.directionalLight2.h,this.settings.directionalLight2.s,this.settings.directionalLight2.v);this.directionalLight1.position.set(this.settings.directionalLight1.x,this.settings.directionalLight1.y,this.settings.directionalLight1.z);this.directionalLight2.position.set(this.settings.directionalLight2.x,this.settings.directionalLight2.y,this.settings.directionalLight2.z);ROME.TrailShader.init();f=initLensFlares(new THREE.Vector3(0,
0,-3E3),14,311);d.scene.addChild(f);var g=THREE.ImageUtils.loadTexture("/files/textures/trailMarkTexture.jpg");f=new THREE.SceneLoader;f.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};f.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};f.load("/files/models/prairie/Prairie.js",function(h){var n=h.scene;hideColliders(n);makeSceneStatic(n);ROME.TrailShaderUtils.setMaterials([h.objects.Ground],2500,g,b.renderer);TriggerUtils.setupPrairieTriggers(h);d.scene.addChild(n);h.objects.Backdrop.materials[0].map.wrapS=
THREE.RepeatWrapping;h.objects.Backdrop.materials[0].map.wrapT=THREE.RepeatWrapping;d.portals.push({object:h.objects.Portal,radius:120,currentDistance:9999999});d.portals.push({object:h.objects["Portal.001"],radius:120,currentDistance:9999999});d.portals[0].object.visible=!1;d.portals[1].object.visible=!1;preInitScene(h,b.renderer);n.collisions&&d.scene.collisions.merge(n.collisions);(new THREE.JSONLoader).load({model:"/files/models/soup/cow.js",callback:function(o){for(var m in h.objects){var p=
h.objects[m];if(m.toLowerCase().indexOf("cow")>=0){p.visible=!1;var u=ROME.Animal(o,!0),v=u.mesh;v.rotation.set(-1.57,0,3.14);v.matrixAutoUpdate=!1;v.update();v.updateMatrix();p.addChild(v);u.play(u.availableAnimals[0],u.availableAnimals[0]);if(d.cows[m]===undefined)d.cows[m]={alive:u,dead:null,position:new THREE.Vector3};else d.cows[m].alive=u;d.cows[m].position.set(p.matrixWorld.n14,p.matrixWorld.n24,p.matrixWorld.n34)}else if(m.toLowerCase().indexOf("carcass")>=0){p.visible=!1;u=m.replace("Carcass",
"Cow");if(d.cows[u]===undefined)d.cows[u]={alive:null,dead:p,position:new THREE.Vector3};else d.cows[u].dead=p}}}});d.scene.update(undefined,!0);c()});this.update=function(h,n,o){ROME.TrailShaderUtils.updateLava(h*1.0E-4,b.lavatrailx,-b.lavatrailz);ROME.TrailShaderUtils.setMarkAtWorldPosition(b.lavatrailx,-b.lavatrailz);TriggerUtils.effectorRadius=40;TriggerUtils.update("prairie");if(o){h=n.matrixWorld.getPosition();for(n=0;n<d.portals.length;n++){d.portals[n].currentDistance=d.portals[n].object.matrixWorld.getPosition().distanceTo(h);
d.portals[n].currentDistance<d.portals[n].radius&&b.signals.startexploration.dispatch("dunes")}}for(var m in d.cows){h=d.cows[m];if(h.position.distanceTo(b.prairieSoupHead)<15){h.alive.mesh.visible=!1;h.dead.visible=!0}}}},DunesWorld=function(b){function f(U){M=!1;for(var ea=0,la=U.length;ea<la;ea++){var ta=new UgcObject(JSON.parse(U[ea].data)),xa=U[ea].category;if(!ta.isEmpty()){ta=ta.getMesh();ta.category=xa;ta.visible=!1;S.push(ta);t=!0}}}function c(U,ea){var la=U.scene;applyDunesShader(U);o(la);
n(la,!0);H[ea]=la.collisions.colliders[0].mesh;H[ea].rotation.x=-90*Math.PI/180;H[ea].scale.set(u,u,u);p.scene.addChild(H[ea]);p.scene.collisions.merge(la.collisions);for(var ta=0;ta<G[ea];ta++)z[ea].push(d(la));p.scene.update(undefined,!0)}function d(U){for(var ea=0;ea<U.children.length;ea++)if(!U.children[ea].__isCollider){U=U.children[ea];U=new THREE.Mesh(U.geometry,U.materials);U.rotation.x=-90*Math.PI/180;U.scale.set(u,u,u);p.scene.addChild(U);return U}}function g(U){var ea=U.scene;ea.scale.set(u,
u,u);ea.matrixAutoUpdate=!0;o(ea);n(ea,!0);preInitScene(U,b.renderer);p.scene.addChild(ea);ea.collisions&&p.scene.collisions.merge(ea.collisions);for(var la in U.objects)if(la.toLowerCase().indexOf("cloud")>=0){applyCloudsShader(U.objects[la],CloudsShader);U.objects[la].position.z+=4E3;U.objects[la].updateMatrix();U.objects[la].matrixAutoUpdate=!1}return ea}function h(U,ea){return Math.round(Math.sin(U*0.0010)*Math.cos(ea*0.0050)*4)*(Math.PI/2)}function n(U,ea){THREE.SceneUtils.traverseHierarchy(U,
function(la){if(!la.__isCollider)la.visible=ea})}function o(U){THREE.SceneUtils.traverseHierarchy(U,function(ea){for(var la=U.collisions.colliders,ta=0;ta<la.length;ta++)if(la[ta].mesh==ea)ea.__isCollider=!0})}function m(U){U.state=0;U.radius*=u;b.influenceSpheres.push(U);U.type===0&&p.portals.push(U)}var p=this,u=0.2,v=29990*u;p.scale=u;p.portals=[];b.influenceSpheres=[];b.cameraSlowDown=!1;p.scene=new THREE.Scene;p.scene.collisions=new THREE.CollisionSystem;p.scene.fog=new THREE.FogExp2(16777215,
2.75E-6);p.scene.fog.color.setHSV(0.576,0.382,0.9);var w=new THREE.AmbientLight(2232576),x=new THREE.DirectionalLight(16772829),y=new THREE.DirectionalLight(16772829);p.ambient=w;p.directionalLight1=x;p.directionalLight2=y;p.skyWhite=1;w.color.setHSV(0,0,0.1);x.position.set(0.81,0.31,-0.5);x.color.setHSV(0.088,0,1);y.position.set(0.094,0.98,0.158);y.color.setHSV(0,0,0.86);p.scene.addLight(w);p.scene.addLight(x);p.scene.addLight(y);p.lensFlare=null;p.lensFlareRotate=null;w=initLensFlares(new THREE.Vector3(-5500,
-2500,-1E4),0,0);p.scene.addChild(w);p.lensFlareRotate=w;p.lensFlare=w.children[0];DunesShader.init();var A=new THREE.Object3D,B=new THREE.Object3D,C=WaterfallShader.createWaterfall(0),E=WaterfallShader.createWaterfall(1);p.scene.addChild(C);p.scene.addChild(E);var z=[[],[],[],[],[],[],[]],H=[],G=[0,0,0,0,1,1,1],F=[],T;for(w=0;w<5;w++){y=[];F.push(y);for(x=0;x<5;x++)if(x===0&&w===0)y.push(4);else if(x===3&&w===4)y.push(5);else if(x===1&&w===3)y.push(6);else if(x===4&&w===4){y.push(0);G[0]++}else if(x===
0&&w===4){y.push(0);G[0]++}else if(x===1&&w===4){y.push(2);G[2]++}else{T=Math.floor(Math.random()*3.99999);y.push(T);G[T]++}}var $=new THREE.Mesh(new THREE.Cube(5E4,5E4,5E4),undefined);$.flipSided=!0;applyDunesShader({objects:{skydome:$}});p.scene.addChild($);w=new THREE.SceneLoader;w.onLoadStart=function(){b.signals.loadItemAdded.dispatch()};w.onLoadComplete=function(){b.signals.loadItemCompleted.dispatch()};w.load("/files/models/dunes/D_tile_walk.js",function(U){applyDunesShader(U);z[4][0]=g(U);
p.scene.update(undefined,!0)});w.load("/files/models/dunes/D_tile_prairie.js",function(U){applyDunesShader(U,{D_tile_Prairie_Collis:!0,D_tile_Prairie_Island:!0},{"D_tile_Prairie_Is.000":-0.05},{D_tile_Prairie_Water:0.65});z[5][0]=g(U);A.position.set(-5165.693848,1024.796875,18247.871094);U.scene.addChild(A);m({name:"prairiePortal",object:U.empties.Prairie_Portal,radius:2E3,type:0,destination:"prairie"});m({name:"prairieSlowDown",object:U.empties.Prairie_Center,radius:1E4,type:1});p.scene.update(undefined,
!0)});w.load("/files/models/dunes/D_tile_city.js",function(U){applyDunesShader(U,{D_tile_City_Collision:!0,D_tile_City_Island_Co:!0},{D_tile_City_Island:-1},{D_tile_City_Water:0.65});z[6][0]=g(U);B.position.set(750.267456,709.979614,29121.154297);U.scene.addChild(B);m({name:"cityPortal",object:U.empties.City_Portal,radius:3500,type:0,destination:"city"});m({name:"citySlowDown",object:U.empties.City_Center,radius:12E3,type:1});p.scene.update(undefined,!0)});w.load("/files/models/dunes/D_tile_1.js",
function(U){c(U,0)});w.load("/files/models/dunes/D_tile_2.js",function(U){c(U,1)});w.load("/files/models/dunes/D_tile_3.js",function(U){c(U,2)});w.load("/files/models/dunes/D_tile_4.js",function(U){c(U,3)});w=new THREE.JSONLoader;w.load({model:"/files/models/dunes/D_tile_1_clouds.js",callback:function(U){for(var ea=new THREE.MeshFaceMaterial,la,ta,xa=0;xa<100;xa++){var ya=new THREE.Mesh(U,ea);la=15E4*(Math.random()-0.5);ta=15E4*(Math.random()-0.5);ya.scale.set(u,u,u);ya.position.set(la,3E3,ta);ya.updateMatrix();
ya.matrixAutoUpdate=!1;applyCloudsShader(ya,CloudsShader);p.scene.addChild(ya)}}});var W=new UgcHandler,V=0,S=[],t=!1,M=!1,I={},P={};w=new THREE.SphereCollider(new THREE.Vector3(0,-5E3,0),1);var O=[{x:-1,z:-1},{x:-1,z:-1},{x:0,z:1},{x:0,z:1},{x:1,z:1},{x:1,z:1},{x:1,z:-1},{x:1,z:-1}],R=[new THREE.Vector3(v*0.15,-1E3,-v*1.25),new THREE.Vector3(v,-1E3,-v)],ca=[new THREE.Vector3(v*0.15,1E4,-v*1.25),new THREE.Vector3(v,1E4,-v)];p.scene.collisions.colliders.push(w);p.update=function(U,ea,la){UgcShader.update(p.skyWhite);
var ta=ea.matrixWorld.getPosition(),xa,ya=S.length,oa;for(xa=0;xa<ya;xa++){oa=S[xa];oa.visible===!0&&oa.placedOnGrid&&(oa.position.y+=(oa.wantedY-oa.position.y)*0.05)}var Fa=Math.floor(ta.x/(v*3)),Ca=Math.floor(ta.z/(v*3));if(!P[Fa+" "+Ca]){P[Fa+" "+Ca]=!0;if(!M){M=!0;if(V<2){W.getLatestUGOs(f,V);V++}}}if(t){t=!1;Fa=Math.floor(ta.x/v);Ca=Math.floor(ta.z/v);var Ga,Ha,wa,aa,ia;ta=O.length;xa=ea.matrixWorld.getColumnZ().negate();var na=3+Math.ceil(3*Math.atan2(xa.x,xa.z)/Math.PI);na<0&&(na=0);for(xa=
0;xa<ya;xa++){oa=S[xa];if(!oa.placedOnGrid){wa=R;oa.category==="sky"&&(wa=ca);if(wa.length){oa.position.copy(wa.shift());oa.position.x+=Math.random()*200-100;oa.position.z+=Math.random()*200-100;oa.rotation.set(Math.random()*0.03,Math.random()*Math.PI,Math.random()*0.03);oa.visible=!0;oa.placedOnGrid=!0;oa.wantedY=oa.category==="sky"?2500:-5;p.scene.addChild(oa);Ga=Math.floor(oa.position.x/v);Ha=Math.floor(oa.position.z/v);I[Ga+" "+Ha+" "+oa.category]=!0}else{for(ia=0;ia<ta;ia++){Ga=wa=Fa+O[na].x;
Ha=aa=Ca+O[na].z;wa%=5;for(aa%=5;wa<0;)wa+=5;for(;aa<0;)aa+=5;if(F[aa][wa]<4&&!I[Ga+" "+Ha+" "+oa.category]){I[Ga+" "+Ha+" "+oa.category]=!0;break}na++;na%=O.length}if(ia!==ta){oa.position.set(Ga*v,0,Ha*v);if(oa.category==="sky"){oa.position.x+=Math.random()*200-100;oa.position.z+=Math.random()*200-100;oa.wantedY=2500+Math.random()*1E3-500;oa.position.y=1E4}else oa.wantedY=-5;oa.rotation.set(Math.random()*0.03,Math.random()*Math.PI,Math.random()*0.03);oa.visible=!0;oa.placedOnGrid=!0;oa.updateMatrix();
p.scene.addChild(oa)}}}}}p.checkInfluenceSpheres(ea,la);p.updateTiles(ea);updateDunesShader(U,p.skyWhite);C.position.copy(A.matrixWorld.getPosition());E.position.copy(B.matrixWorld.getPosition());WaterfallShader.update(U,p.skyWhite);$.position.copy(ea.matrixWorld.getPosition());$.updateMatrix();p.lensFlareRotate.position.copy(ea.matrixWorld.getPosition());p.lensFlareRotate.updateMatrix()};p.checkInfluenceSpheres=function(U,ea){var la,ta,xa,ya,oa=U.matrixWorld.getPosition();la=0;for(ta=b.influenceSpheres.length;la<
ta;la++){ya=b.influenceSpheres[la];xa=ya.object.matrixWorld.getPosition().distanceTo(oa);ya.currentDistance=xa;if(xa<ya.radius)if(ya.type===0&&ya.state===0){ya.state=1;if(ea){b.signals.showexploration.dispatch();b.signals.startexploration.dispatch(ya.destination,b.isExperience)}}else{if(ya.type==1)b.cameraSlowDown=!0}else{ya.state=0;b.cameraSlowDown=!1}}};p.updateTiles=function(U){var ea=Math.floor(2.5),la=U.matrixWorld.getPosition(),ta=la.x,xa=la.z;la.addSelf(U.matrixWorld.getColumnZ().multiplyScalar(-v*
1.5));la.x=Math.floor(la.x/v);la.z=Math.floor(la.z/v);U=la.x%5;for(var ya=la.z%5;U<0;)U+=5;for(;ya<0;)ya+=5;var oa,Fa,Ca,Ga,Ha,wa,aa,ia=[0,0,0,0,0,0,0],na=[-1,-1,-1,-1];for(Fa=-ea;Fa<ea+1;Fa++)for(oa=-ea;oa<ea+1;oa++){Ha=(la.x+oa)*v;wa=(la.z+Fa)*v;Ca=(U+oa)%5;for(Ga=(ya+Fa)%5;Ca<0;)Ca+=5;for(;Ga<0;)Ga+=5;aa=F[Ga][Ca];if(Ca=z[aa][ia[aa]++]){Ca.position.x=Ha;Ca.position.z=wa;Ca.rotation.z=aa!==6?h(Ha,wa):1.5*Math.PI}if(aa<4){Ca=Ha-ta;Ga=wa-xa;Ca=Ca*Ca+Ga*Ga;if(na[aa]===-1||Ca<na[aa]){na[aa]=Ca;if(Ca=
H[aa]){Ca.position.x=Ha;Ca.position.z=wa;Ca.rotation.z=h(Ha,wa)}}}}}},CityShaderEffectors=[new THREE.Vector4(0,0,-1E3,50),new THREE.Vector4(-100,0,-1500,150),new THREE.Vector4(100,0,-2E3,150),new THREE.Vector4(0,0,-2500,100)],CityShader={vertexShader:"varying vec3 vColor;\nvoid main() {\nvColor = color;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec3 vColor;\nvoid main() {\nvec3 surface = vec3( 0.15 * 2.0, 0.18 * 2.0, 0.2 * 2.0 );\nfloat depth = ( gl_FragCoord.z / gl_FragCoord.w ) * 0.0001;\ngl_FragColor = vec4( surface * vColor * 2.0, 1.0 );\ngl_FragColor = vec4( mix( gl_FragColor.rgb, vec3( 0.64, 0.88, 1 ), depth ), 1.0 );\n}"};
function applyCityShader(b,f){var c,d,g,h,n,o={};for(c=0;c<f.length;c++)o[f[c]]=!0;n=new THREE.MeshShaderMaterial({vertexShader:CityShader.vertexShader,fragmentShader:CityShader.fragmentShader,shading:THREE.FlatShading,vertexColors:THREE.VertexColors});for(d in b.objects){h=b.objects[d];if(!o[d]&&h.geometry&&h.geometry.morphTargets.length===0){g=h.geometry;for(c=0;c<g.materials.length;c++)h.materials[0]=n}}return n}
var DunesShaderEffectors={materials:[]},DunesShader={init:function(){DunesShader.uniforms.surfaceImage.texture=THREE.ImageUtils.loadTexture("/files/textures/CityShader_Clouds.jpg")},uniforms:{surfaceImage:{type:"t",value:0,texture:undefined},time:{type:"f",value:0},skyWhite:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",
value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform float  skyWhite;\nuniform sampler2D surfaceImage;\nuniform float time;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nvec4 surface;\nvec4 grass;\nsurface = vec4( vColor, 1.0 );\nvec3 worldPosition = vWorldPosition * 0.0005;\ngl_FragColor = mix( surface * texture2D( surfaceImage, worldPosition.zx * vec2( 0.4 ) + vec2(time)), surface, vec4( cloudMix, 0.1 ));\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
function applyDunesShader(b,f,c,d){function g(v){o=new THREE.MeshShaderMaterial(m);o.uniforms=THREE.UniformsUtils.clone(m.uniforms);o.uniforms.surfaceImage.texture=m.uniforms.surfaceImage.texture;o.uniforms.invertLightY.value=v;n.materials=[o];DunesShaderEffectors.materials.push(o)}var h,n,o;c=c!==undefined?c:{};f=f!==undefined?f:{};d=d!==undefined?d:{};var m={uniforms:DunesShader.uniforms,vertexShader:DunesShader.vertexShader,fragmentShader:DunesShader.fragmentShader,shading:THREE.FlatShading,lights:!0,
fog:!0,vertexColors:THREE.VertexColors};m.uniforms.surfaceImage.texture.wrapS=THREE.RepeatWrapping;m.uniforms.surfaceImage.texture.wrapT=THREE.RepeatWrapping;var p=1,u=1;for(h in b.objects)if(!f[h]){n=b.objects[h];p=c[h]?c[h]:1;u=d[h]?d[h]:1;n.geometry&&n.geometry.morphTargets.length===0&&g(p,u)}}
function updateDunesShader(b,f){f=f!==undefined?f:1;var c=DunesShader.uniforms.time.value+=b*1.0E-5;e=0;for(el=DunesShaderEffectors.materials.length;e<el;e++){DunesShaderEffectors.materials[e].uniforms.time.value=c;DunesShaderEffectors.materials[e].uniforms.skyWhite.value=f}}
WaterfallShader={geometry:undefined,materials:[],createWaterfall:function(b){if(WaterfallShader.geometry===undefined){var f=new THREE.Geometry,c,d=f.faces,g=f.vertices,h,n=WaterfallShader.attributes.time.value,o=WaterfallShader.attributes.direction.value,m=WaterfallShader.attributes.darkness.value,p=WaterfallShader.attributes.size.value;for(c=0;c<800;c++){d.push(new THREE.Face3(c*4+0,c*4+1,c*4+2));d.push(new THREE.Face3(c*4+0,c*4+2,c*4+3));d.push(new THREE.Face3(c*4+0,c*4+3,c*4+1));d.push(new THREE.Face3(c*
4+3,c*4+2,c*4+1));o.push(new THREE.Vector3(0+Math.random()*0.2,0.7+Math.random()*0.2,1.3+Math.random()*0.2));o.push(new THREE.Vector3(-1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(0+Math.random()*0.2,-1.3+Math.random()*0.2,0+Math.random()*0.2));h=new THREE.Vertex;h.position.x=Math.random()*240-120;h.position.y=-5800;h.position.z=Math.random()*240-120;g.push(h);
g.push(h);g.push(h);g.push(h);h=Math.random();n.push(h);n.push(h);n.push(h);n.push(h);h=Math.random()*0.3+0.7;m.push(h*(Math.random()*0.4+0.6));m.push(h*(Math.random()*0.4+0.6));m.push(h*(Math.random()*0.4+0.6));m.push(h*(Math.random()*0.4+0.6));h=Math.random()*30+5;p.push(h);p.push(h);p.push(h);p.push(h)}f.computeFaceNormals();f.computeBoundingSphere();f.boundingSphere.radius=5E3;WaterfallShader.geometry=f}b=new THREE.MeshShaderMaterial({uniforms:WaterfallShader.uniforms(b),attributes:WaterfallShader.attributes,
vertexShader:WaterfallShader.vertexShader,fragmentShader:WaterfallShader.fragmentShader,lights:!1,fog:!1});f=new THREE.Mesh(WaterfallShader.geometry,b);f.doubleSided=!0;WaterfallShader.materials.push(b);return f},update:function(b,f){for(var c=0;c<WaterfallShader.materials.length;c++){WaterfallShader.materials[c].uniforms.globalTime.value+=b*1.2E-4;WaterfallShader.materials[c].uniforms.skyWhite.value=f!==undefined?f:1}},uniforms:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):0;return{globalTime:{type:"f",
value:0},skyWhite:{type:"f",value:1},shrinkTop:{type:"f",value:b}}},attributes:{time:{type:"f",boundTo:"vertices",value:[]},darkness:{type:"f",boundTo:"faces",value:[]},direction:{type:"v3",boundTo:"vertices",value:[]},size:{type:"f",boundTo:"vertices",value:[]}},vertexShader:"const float \tPI \t\t\t= 3.14159265;\nconst vec3 \tBASECOLOR \t= vec3(  16.0 / 255.0,  93.0 / 255.0, 118.0 / 255.0 );\nconst vec3     HIGHLIGHT   = vec3( 235.0 / 255.0, 237.0 / 255.0, 245.0 / 255.0 );\nconst vec3 \tENDCOLOR \t= vec3( 99.00 / 255.0, 239.0 / 255.0, 253.0 / 255.0 );\nuniform \tfloat\tglobalTime;\nuniform    float   shrinkTop;\nattribute \tfloat\ttime;\nattribute \tfloat\tdarkness;\nattribute \tfloat\tsize;\nattribute \tvec3\tdirection;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat localTime = time + globalTime;\nfloat modTime = mod( localTime, 1.0 );\nfloat accTime = modTime * modTime;\nvec2 pulse = vec2( sin( localTime * 2.0 ) * 20.0, cos( localTime * 2.0 ) * 20.0 );\nvColor = mix( BASECOLOR * darkness, ENDCOLOR * darkness, modTime );\nvColor = mix( vColor, HIGHLIGHT, 1.0 - smoothstep( 0.0, 0.25, abs( modTime - ( sin( globalTime ) * 0.2 * darkness + 0.5 ))));\nvec3 animated = vec3( position.x + pulse.x, position.y * accTime, position.z + pulse.y );\nanimated.x -= ( 1.0 - accTime ) * shrinkTop * animated.x;\nanimated.z -= ( 1.0 - accTime ) * shrinkTop * animated.z;\nvec3 rotatedDirection;\nfloat rotation = modTime * size;\nfloat cosRot = cos( rotation );\nfloat sinRot = sin( rotation );\nrotatedDirection.x = ( cosRot * direction.x - sinRot * direction.y );\nrotatedDirection.y = ( sinRot * direction.x + cosRot * direction.y );\nrotatedDirection.z = direction.z;\nanimated += rotatedDirection * size * ( sin( localTime * 150.0 ) * 0.1 + 1.1 );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( animated, 1.0 );\nvWorldVector = ( vec3( objectMatrix * vec4( animated, 1.0 )).xyz - cameraPosition ) * vec3( 0.01, 0.02, 0.01 );\n}",
fragmentShader:"const   \tvec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t \tvec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform \tfloat \tskyWhite;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = vec4( vColor, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
var CloudsShader={uniforms:{fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},vertexShader:"uniform vec3 ambientLightColor;\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvNormal = transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlDirection = viewMatrix * vec4( directionalLightDirection[ 1 ], 0.0 );\ndirectionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvWorldVector = ( vWorldPosition - cameraPosition ) * vec3( 0.01, 0.02, 0.01 );\n}",
fragmentShader:"const vec3 skyBlue = vec3( -0.37, -0.05, 0.15 );\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormal;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nuniform vec3 vectorA;\nuniform vec3 vectorB;\nuniform vec3 vectorC;\nvarying vec3 vWorldVector;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\ngl_FragColor = vec4( vec3( vLightWeighting ) * vec3( 0.9, 0.5, 0.3 ) + vec3( 0.7, 0.6, 0.6 ), vLightWeighting * 0.95 + 0.05 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( 1.0 ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.a ), fogFactor );\n}"};
function applyCloudsShader(b,f){var c={uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,vertexColors:THREE.VertexColors},d=new THREE.MeshShaderMaterial(c);d.uniforms=THREE.UniformsUtils.clone(c.uniforms);b.materials[0]=d}
var UgcShader={update:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):1;for(var f=0;f<UgcShader.savedUniforms.length;f++)UgcShader.savedUniforms[f].skyWhite.value=b},savedUniforms:[],uniforms:function(){var b={skyWhite:{type:"f",value:1},invertLightY:{type:"f",value:1},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",
value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}};UgcShader.savedUniforms.push(b);return b},vertexShader:"uniform vec3  ambientLightColor;\nuniform vec3  directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3  directionalLightDirection[ MAX_DIR_LIGHTS ];\nuniform float invertLightY;\nvarying vec3 vWorldPosition;\nvarying vec3 vColor;\nvarying vec3 vNormalsquare;\nvarying vec3 vLightWeighting;\nvarying vec3 vWorldVector;\nvoid main() {\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormalsquare = transformedNormal * transformedNormal;\nvColor = color;\nvLightWeighting = ambientLightColor;\nvec3 lightDir = directionalLightDirection[ 0 ];\nlightDir.y *= invertLightY;\nvec4 lDirection = viewMatrix * vec4( lightDir, 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 0 ] * directionalLightWeighting;\nlightDir = directionalLightDirection[ 1 ];\nlightDir.y *= invertLightY;\nlDirection = viewMatrix * vec4( lightDir, 0.0 );\ndirectionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ 1 ] * directionalLightWeighting;\nvWorldPosition = vec3( objectMatrix * vec4( position, 1.0 )).xyz;\nvWorldVector = (vWorldPosition - cameraPosition) * vec3(0.01, 0.02, 0.01);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"const   vec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t vec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform float  skyWhite;\nuniform vec3 fogColor;\nuniform float fogDensity;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;\nvarying vec3 vNormalsquare;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldVector;\nvoid main() {\ngl_FragColor = vec4(vColor,1.);\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nfloat f = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nvec3 sky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
WaterfallShader={geometry:undefined,materials:[],createWaterfall:function(b){if(WaterfallShader.geometry===undefined){var f=new THREE.Geometry,c,d=f.faces,g=f.vertices,h,n=WaterfallShader.attributes.time.value,o=WaterfallShader.attributes.direction.value,m=WaterfallShader.attributes.darkness.value,p=WaterfallShader.attributes.size.value;for(c=0;c<800;c++){d.push(new THREE.Face3(c*4+0,c*4+1,c*4+2));d.push(new THREE.Face3(c*4+0,c*4+2,c*4+3));d.push(new THREE.Face3(c*4+0,c*4+3,c*4+1));d.push(new THREE.Face3(c*
4+3,c*4+2,c*4+1));o.push(new THREE.Vector3(0+Math.random()*0.2,0.7+Math.random()*0.2,1.3+Math.random()*0.2));o.push(new THREE.Vector3(-1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(1+Math.random()*0.2,0.7+Math.random()*0.2,-0.7+Math.random()*0.2));o.push(new THREE.Vector3(0+Math.random()*0.2,-1.3+Math.random()*0.2,0+Math.random()*0.2));h=new THREE.Vertex;h.position.x=Math.random()*240-120;h.position.y=-5800;h.position.z=Math.random()*240-120;g.push(h);
g.push(h);g.push(h);g.push(h);h=Math.random();n.push(h);n.push(h);n.push(h);n.push(h);h=Math.random()*0.3+0.7;m.push(h*(Math.random()*0.4+0.6));m.push(h*(Math.random()*0.4+0.6));m.push(h*(Math.random()*0.4+0.6));m.push(h*(Math.random()*0.4+0.6));h=Math.random()*30+5;p.push(h);p.push(h);p.push(h);p.push(h)}f.computeFaceNormals();f.computeBoundingSphere();f.boundingSphere.radius=5E3;WaterfallShader.geometry=f}b=new THREE.MeshShaderMaterial({uniforms:WaterfallShader.uniforms(b),attributes:WaterfallShader.attributes,
vertexShader:WaterfallShader.vertexShader,fragmentShader:WaterfallShader.fragmentShader,lights:!1,fog:!1});f=new THREE.Mesh(WaterfallShader.geometry,b);f.doubleSided=!0;WaterfallShader.materials.push(b);return f},update:function(b,f){for(var c=0;c<WaterfallShader.materials.length;c++){WaterfallShader.materials[c].uniforms.globalTime.value+=b*1.2E-4;WaterfallShader.materials[c].uniforms.skyWhite.value=f!==undefined?f:1}},uniforms:function(b){b=b!==undefined?Math.max(0,Math.min(1,b)):0;return{globalTime:{type:"f",
value:0},skyWhite:{type:"f",value:1},shrinkTop:{type:"f",value:b}}},attributes:{time:{type:"f",boundTo:"vertices",value:[]},darkness:{type:"f",boundTo:"faces",value:[]},direction:{type:"v3",boundTo:"vertices",value:[]},size:{type:"f",boundTo:"vertices",value:[]}},vertexShader:"const float \tPI \t\t\t= 3.14159265;\nconst vec3 \tBASECOLOR \t= vec3(  16.0 / 255.0,  93.0 / 255.0, 118.0 / 255.0 );\nconst vec3     HIGHLIGHT   = vec3( 235.0 / 255.0, 237.0 / 255.0, 245.0 / 255.0 );\nconst vec3 \tENDCOLOR \t= vec3( 99.00 / 255.0, 239.0 / 255.0, 253.0 / 255.0 );\nuniform \tfloat\tglobalTime;\nuniform    float   shrinkTop;\nattribute \tfloat\ttime;\nattribute \tfloat\tdarkness;\nattribute \tfloat\tsize;\nattribute \tvec3\tdirection;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat localTime = time + globalTime;\nfloat modTime = mod( localTime, 1.0 );\nfloat accTime = modTime * modTime;\nvec2 pulse = vec2( sin( localTime * 2.0 ) * 20.0, cos( localTime * 2.0 ) * 20.0 );\nvColor = mix( BASECOLOR * darkness, ENDCOLOR * darkness, modTime );\nvColor = mix( vColor, HIGHLIGHT, 1.0 - smoothstep( 0.0, 0.25, abs( modTime - ( sin( globalTime ) * 0.2 * darkness + 0.5 ))));\nvec3 animated = vec3( position.x + pulse.x, position.y * accTime, position.z + pulse.y );\nanimated.x -= ( 1.0 - accTime ) * shrinkTop * animated.x;\nanimated.z -= ( 1.0 - accTime ) * shrinkTop * animated.z;\nvec3 rotatedDirection;\nfloat rotation = modTime * size;\nfloat cosRot = cos( rotation );\nfloat sinRot = sin( rotation );\nrotatedDirection.x = ( cosRot * direction.x - sinRot * direction.y );\nrotatedDirection.y = ( sinRot * direction.x + cosRot * direction.y );\nrotatedDirection.z = direction.z;\nanimated += rotatedDirection * size * ( sin( localTime * 150.0 ) * 0.1 + 1.1 );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( animated, 1.0 );\nvWorldVector = ( vec3( objectMatrix * vec4( animated, 1.0 )).xyz - cameraPosition ) * vec3( 0.01, 0.02, 0.01 );\n}",
fragmentShader:"const   \tvec3 \tskyBlue = vec3( -0.37, -0.05, 0.15 );\nconst \t \tvec3 \tcloudMix = vec3( 0.83 * 0.83, 0.69 * 0.69, 0.51 * 0.51 );\nuniform \tfloat \tskyWhite;\nvarying \tvec3 \tvWorldVector;\nvarying \tvec3\tvColor;\nvoid main() {\nfloat f;\nvec3 normal;\nvec3 sky_color;\nconst float viewDistance = 6000.0 * 2.0;\nfloat fogFactor = clamp(( gl_FragCoord.z / gl_FragCoord.w ) / viewDistance, 0.0, 1.0 );\nfogFactor *= fogFactor;\nf = max( 0.0, normalize( vWorldVector ).y + cameraPosition.y * 0.0002 - 0.05 );\nsky_color = mix( vec3( skyWhite ), skyBlue, f );\ngl_FragColor = vec4( vColor, 1.0 );\ngl_FragColor = mix( gl_FragColor, vec4( sky_color, gl_FragColor.w ), fogFactor );\n}"};
DunesCamera=function(b){var f=10,c=new THREE.Ray,d,g,h=new THREE.Vector3,n={forward:1,left:1,right:1,up:1,down:1},o=0,m,p;m=b.worlds.dunes;p=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,20,1E5);p.target.position.set(0,0,-100);d=new THREE.Object3D;g=new THREE.Object3D;g.position.set(0,0,-100);m.scene.addChild(p);m.scene.addChild(p.target);m.scene.addChild(d);m.scene.addChild(g);var u={};u.camera=p;u.resetCamera=function(){window.wantedCamera=d;window.camera=p;f=10;d.position.set(0,350,600);
d.up.set(0,1,0);g.position.set(0,150,-300);g.position.subSelf(d.position).normalize().multiplyScalar(200).addSelf(d.position);p.position.copy(d.position);p.up.set(0,1,0);p.target.position.copy(g.position)};u.updateCamera=function(v,w){w=w>30||w<5?1:w/30;var x=b.mouse.x/b.screenWidth-0.5,y=b.mouse.y/b.screenHeight-0.5;if(v<0.03){c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.set(0,-1,0);var A=m.scene.collisions.rayCastNearest(c),B=-1;if(A&&A.distance!==-1){B=A.distance*0.1;d.position.y=
c.origin.y-B+f*0.5}g.position.x=d.position.x+12*x;g.position.x=Math.min(300,Math.max(-300,g.position.x));g.position.z=d.position.z-200;p.position.y=p.target.position.y=g.position.y=d.position.y;p.target.position.x+=(g.position.x-p.target.position.x)*0.35;p.target.position.z+=(g.position.z-p.target.position.z)*0.35}else if(v<0.39){c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.set(0,-1,0);if((A=m.scene.collisions.rayCastNearest(c))&&A.distance!==-1){B=A.distance*0.1;d.position.y=c.origin.y-
B+f}y=-y*35;g.position.y+y-d.position.y<=100&&(g.position.y+=y);g.position.y=Math.max(g.position.y,d.position.y);g.position.y=Math.min(g.position.y,d.position.y+100);h.sub(g.position,d.position).normalize();g.position.x=d.position.x+h.x*200-h.z*12*x*0.5;g.position.z=d.position.z+h.z*200+h.x*12*x*0.5;x=Math.sin(0.5*Math.PI*(v-0.03)/0.36);cameraSpeed=5*x*w;h.multiplyScalar(cameraSpeed);d.position.x+=h.x;d.position.y+=Math.sin((d.position.x+d.position.z)*0.1)*5*(1.5-x);d.position.z+=h.z;p.position.x+=
(d.position.x-p.position.x)*0.1;p.position.y+=(d.position.y-p.position.y)*0.1;p.position.z+=(d.position.z-p.position.z)*0.1;p.target.position.x+=(g.position.x-p.target.position.x)*0.1;p.target.position.y+=(g.position.y-p.target.position.y)*0.1;p.target.position.z+=(g.position.z-p.target.position.z)*0.1}else{var C,E,z;switch(o){case 0:z="forward";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(p.matrixWorld.getColumnZ().negate());C=200;E=60;break;case 1:z="left";c.origin.copy(d.matrixWorld.getPosition());
c.direction.copy(p.matrixWorld.getColumnX().negate());C=40;E=60;break;case 2:z="right";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(p.matrixWorld.getColumnX());C=40;E=60;break;case 3:z="down";c.origin.copy(d.matrixWorld.getPosition()).y+=100;c.direction.copy(p.matrixWorld.getColumnY().negate());C=50;E=60;break;case 4:z="up";c.origin.copy(d.matrixWorld.getPosition());c.direction.copy(p.matrixWorld.getColumnY());C=40;E=60}o++;o>4&&(o=0);n[z]=1;A=m.scene.collisions.rayCastNearest(c);B=
NaN;if(A&&A.distance!==-1){B=A.distance*0.1;z!=="down"&&B<C+E&&(n[z]=B<C?0:1-(B-C)/E)}if(z!=="forward"&&n[z]<1){A=new THREE.Vector3;A.copy(c.direction).negate().multiplyScalar((1-n[z])*15);if(z==="left"||z==="right")A.y=0;else{A.x=0;A.z=0}g.position.addSelf(A);n[z]=Math.max(n[z],0.3);x*=0.1;y*=0.1}if(z==="down"&&!isNaN(B)&&B<50){z=d.position.y;d.position.y=c.origin.addSelf(c.direction.multiplyScalar(B)).y+f;g.position.y+=d.position.y-z}else!isNaN(B)&&c.origin.addSelf(c.direction.multiplyScalar(B)).y<
200&&(n[z]=1);B=n.forward*n.up*n.down*n.right*n.left;y=-y*35;if(Math.abs(g.position.y+y-d.position.y)<=200)g.position.y+=y;else{if(g.position.y>d.position.y)g.position.y=d.position.y+200;if(g.position.y<d.position.y)g.position.y=d.position.y-200}g.position.y=Math.max(g.position.y,f);g.position.y=Math.min(g.position.y,4500);h.sub(g.position,d.position).normalize();g.position.x=d.position.x+h.x*200-h.z*12*x*w;g.position.z=d.position.z+h.z*200+h.x*12*x*w;cameraSpeed=25;b.cameraSlowDown||(cameraSpeed+=
5*((Math.min(Math.max(d.position.y,f),3E3)-f)/(3E3-f)));d.position.addSelf(h.multiplyScalar(cameraSpeed*B*w));if(v<0.475){d.position.y+=7.5*w;g.position.y+=6.75*w}f+=(75-f)*0.25;d.position.y=Math.max(d.position.y,f);d.position.y=Math.min(d.position.y,4500);p.position.x+=(d.position.x-p.position.x)*0.05;p.position.y+=(d.position.y-p.position.y)*0.05;p.position.z+=(d.position.z-p.position.z)*0.05;p.target.position.x+=(g.position.x-p.target.position.x)*0.05;p.target.position.y+=(g.position.y-p.target.position.y)*
0.05;p.target.position.z+=(g.position.z-p.target.position.z)*0.05;x=p.matrixWorld.getColumnZ();h.normalize();h.y=x.y;h.subSelf(x).normalize();h.multiplyScalar(0.4);d.up.set(0,1,0);d.up.subSelf(h).normalize();p.up.x+=(d.up.x-p.up.x)*0.05;p.up.y+=(d.up.y-p.up.y)*0.05;p.up.z+=(d.up.z-p.up.z)*0.05;h.sub(p.position,p.target.position).y=0;if(h.length()<1){d.position.y=g.position.y=p.target.position.y=p.position.y;g.position.z=p.target.position.z=-200}}};return u};
DunesCameraFreeExplore=function(b){var f=new THREE.Ray,c,d,g=new THREE.Vector3,h={forward:1,left:1,right:1,up:1,down:1},n=0,o,m;o=b.worlds.dunes;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);c=new THREE.Object3D;d=new THREE.Object3D;d.position.set(0,0,-100);o.scene.addChild(m);o.scene.addChild(m.target);o.scene.addChild(c);o.scene.addChild(d);var p={};p.camera=m;p.resetCamera=function(){c.position.set(0,150,300);d.position.set(0,150,-300);d.position.subSelf(c.position).normalize().multiplyScalar(200).addSelf(c.position);
m.position.copy(c.position);m.target.position.copy(d.position)};p.switchDirection=function(u){g.sub(m.position,m.target.position).normalize().multiplyScalar(u.radius*1.5).addSelf(u.object.matrixWorld.getPosition());c.position.copy(g);g.sub(m.position,m.target.position).normalize().multiplyScalar(u.radius*1.5+200).addSelf(u.object.matrixWorld.getPosition());d.position.copy(g);m.position.copy(c.position);m.target.position.copy(d.position)};p.updateCamera=function(u,v){v=v>30||v<5||isNaN(v)?1:v/30;var w,
x,y;switch(n){case 0:y="forward";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(m.matrixWorld.getColumnZ().negate());w=200;x=60;break;case 1:y="left";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(m.matrixWorld.getColumnX().negate());w=40;x=60;break;case 2:y="right";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(m.matrixWorld.getColumnX());w=40;x=60;break;case 3:y="down";f.origin.copy(c.matrixWorld.getPosition()).y+=100;f.direction.copy(m.matrixWorld.getColumnY().negate());
w=50;x=60;break;case 4:y="up";f.origin.copy(c.matrixWorld.getPosition());f.direction.copy(m.matrixWorld.getColumnY());w=40;x=60}n++;n>4&&(n=0);h[y]=1;var A=o.scene.collisions.rayCastNearest(f),B=NaN;if(A&&A.distance!==-1){B=A.distance*o.scale;y!=="down"&&B<w+x&&(h[y]=B<w?0:1-(B-w)/x)}w=b.mouse.x/b.screenWidth-0.5;x=b.mouse.y/b.screenHeight-0.5;if(y!=="forward"&&h[y]<1){A=new THREE.Vector3;A.copy(f.direction).negate().multiplyScalar((1-h[y])*15);if(y==="left"||y==="right")A.y=0;else{A.x=0;A.z=0}d.position.addSelf(A);
h[y]=Math.max(h[y],0.3);w*=0.1;x*=0.1}if(!isNaN(B)&&y==="down"&&B<50){y=c.position.y;c.position.y=f.origin.addSelf(f.direction.multiplyScalar(B)).y+75;d.position.y+=c.position.y-y}else!isNaN(B)&&f.origin.addSelf(f.direction.multiplyScalar(B)).y<200&&(h[y]=1);B=h.forward*h.up*h.down*h.right*h.left;y=-x*35;if(Math.abs(d.position.y+y-c.position.y)<=200)d.position.y+=y;else{if(d.position.y>c.position.y)d.position.y=c.position.y+200;if(d.position.y<c.position.y)d.position.y=c.position.y-200}d.position.y=
Math.max(d.position.y,75);d.position.y=Math.min(d.position.y,4500);g.sub(d.position,c.position).normalize();d.position.x=c.position.x+g.x*200-g.z*15*w*v;d.position.z=c.position.z+g.z*200+g.x*15*w*v;cameraSpeed=25;b.cameraSlowDown||(cameraSpeed+=10*((Math.min(Math.max(c.position.y,75),3E3)-75)/2925));c.position.addSelf(g.multiplyScalar(cameraSpeed*B*v));c.position.y=Math.max(c.position.y,75);c.position.y=Math.min(c.position.y,4500);m.position.x+=(c.position.x-m.position.x)*0.05;m.position.y+=(c.position.y-
m.position.y)*0.05;m.position.z+=(c.position.z-m.position.z)*0.05;m.target.position.x+=(d.position.x-m.target.position.x)*0.05;m.target.position.y+=(d.position.y-m.target.position.y)*0.05;m.target.position.z+=(d.position.z-m.target.position.z)*0.05;B=m.matrixWorld.getColumnZ();g.normalize();g.y=B.y;g.subSelf(B).normalize();g.multiplyScalar(0.4*v);c.up.set(0,1,0);c.up.subSelf(g).normalize();m.up.x+=(c.up.x-m.up.x)*0.05*v;m.up.y+=(c.up.y-m.up.y)*0.05*v;m.up.z+=(c.up.z-m.up.z)*0.05*v;g.sub(m.position,
m.target.position).y=0;if(g.length()<1){c.position.y=d.position.y=m.target.position.y=m.position.y;d.position.z=m.target.position.z=-200}};return p};
PrairieCameraFreeExplore=function(b){var f,c,d=new THREE.Vector3,g,h,n,o,m=new THREE.Vector3;g=b.worlds.prairie;h=g.portals;o=new THREE.Vector3(350,0,-300);n=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);n.target.position.set(0,0,-100);f=new THREE.Object3D;c=new THREE.Object3D;c.position.set(0,0,-100);g.scene.addChild(n);g.scene.addChild(n.target);g.scene.addChild(f);g.scene.addChild(c);g={};g.camera=n;g.resetCamera=function(){f.position.set(o.x-200,25,o.z);c.position.set(o.x+300,25,
o.z);n.position.copy(f.position);n.target.position.copy(c.position)};g.updateCamera=function(p,u){u=u*(1E3/30)/1E3;var v=b.mouse.x/b.screenWidth-0.5,w=b.mouse.y/b.screenHeight-0.5;if(Math.abs(c.position.y-f.position.y)<200)c.position.y-=w*20*u;else{c.position.y>f.position.y&&(c.position.y-=20);c.position.y<f.position.y&&(c.position.y+=20)}d.sub(c.position,f.position).normalize();c.position.x=f.position.x+d.x*350-d.z*15*v*u;c.position.z=f.position.z+d.z*350+d.x*15*v*u;var x;w=9999999999;for(var y=
0;y<h.length;y++){var A=h[y];v=m.sub(A.object.matrixWorld.getPosition(),f.position).normalize().dot(d);if(v>0.7&&A.currentDistance<w){w=A.currentDistance;x=A}}if(x&&w<x.radius*2){m.sub(x.object.matrixWorld.getPosition(),f.position);f.position.addSelf(m.normalize().multiplyScalar(2*u))}else{x=d.multiplyScalar(2*u);x.y=(25-f.position.y)*0.03;f.position.addSelf(x);w=f.position.x-o.x;y=f.position.z-o.z;v=m.sub(o,f.position).normalize().dot(d);Math.sqrt(w*w+y*y)>795&&v<0&&f.position.subSelf(x)}n.position.x+=
(f.position.x-n.position.x)*0.02*u;n.position.y+=(f.position.y-n.position.y)*0.02*u;n.position.z+=(f.position.z-n.position.z)*0.02*u;n.target.position.x+=(c.position.x-n.target.position.x)*0.02*u;n.target.position.y+=(c.position.y-n.target.position.y)*0.02*u;n.target.position.z+=(c.position.z-n.target.position.z)*0.02*u;v=n.matrixWorld.getColumnZ();d.normalize();d.y=v.y;d.subSelf(v).normalize();d.multiplyScalar(0.4*u);f.up.set(0,1,0);f.up.subSelf(d).normalize();n.up.x+=(f.up.x-n.up.x)*0.02*u;n.up.y+=
(f.up.y-n.up.y)*0.02*u;n.up.z+=(f.up.z-n.up.z)*0.02*u};return g};
CityCameraFreeExplore=function(b){var f={start:new THREE.Vector3(-3E3,10,-1500),end:new THREE.Vector3(3E3,200,-1500)},c={start:new THREE.Vector3(0,10,-300),end:new THREE.Vector3(0,250,-3200)},d,g,h=new THREE.Vector3,n=new THREE.Vector3,o,m,p;o=b.worlds.city;p=o.portals;m=new THREE.Camera(50,b.viewportWidth/b.viewportHeight,1,1E5);m.target.position.set(0,0,-100);d=new THREE.Object3D;g=new THREE.Object3D;g.position.set(0,0,-100);o.scene.addChild(m);o.scene.addChild(m.target);o.scene.addChild(d);o.scene.addChild(g);
o={};o.camera=m;o.resetCamera=function(){d.position.set(c.start.x,c.start.y,(c.end.z+c.start.z)*0.5);g.position.set(f.start.x,c.start.y,d.position.z);m.position.copy(d.position);m.target.position.copy(g.position)};o.updateCamera=function(u,v){v=v*(1E3/30)/1E3;var w=b.mouse.x/b.screenWidth-0.5,x=b.mouse.y/b.screenHeight-0.5;Math.abs(g.position.y-d.position.y)<50&&(g.position.y-=x*20);g.position.y=Math.max(g.position.y,c.start.y);g.position.y=Math.min(g.position.y,c.end.y);h.sub(g.position,d.position).normalize();
g.position.x=d.position.x+h.x*500-h.z*25*w*v;g.position.z=d.position.z+h.z*500+h.x*25*w*v;var y;w=9999999999;for(x=0;x<p.length;x++){var A=p[x];if(n.sub(A.object.matrixWorld.getPosition(),d.position).normalize().dot(h)>0.7&&A.currentDistance<w){w=A.currentDistance;y=A}}if(y&&w<y.radius*4){n.sub(y.object.matrixWorld.getPosition(),d.position);d.position.addSelf(n.normalize().multiplyScalar(6*v))}else{cameraSpeed=6;cameraSpeed+=3*((Math.min(Math.max(d.position.y,c.start.y),c.end.y)-c.start.y)/(c.end.y-
c.start.y));d.position.addSelf(h.multiplyScalar(cameraSpeed*v));d.position.x=c.start.x;d.position.y=Math.max(Math.min(d.position.y,c.end.y),c.start.y);d.position.z=Math.min(Math.max(d.position.z,c.end.z),c.start.z)}m.position.x+=(d.position.x-m.position.x)*0.05*v;m.position.y+=(d.position.y-m.position.y)*0.05*v;m.position.z+=(d.position.z-m.position.z)*0.05*v;m.target.position.x+=(g.position.x-m.target.position.x)*0.2*v;m.target.position.y+=(g.position.y-m.target.position.y)*0.2*v;m.target.position.z+=
(g.position.z-m.target.position.z)*0.2*v;y=m.matrixWorld.getColumnZ();h.normalize();h.y=y.y;h.subSelf(y).normalize();h.multiplyScalar(0.4*v);d.up.set(0,1,0);d.up.subSelf(h).normalize();m.up.x+=(d.up.x-m.up.x)*0.05*v;m.up.y+=(d.up.y-m.up.y)*0.05*v;m.up.z+=(d.up.z-m.up.z)*0.05*v};return o};
Trigger=function(b,f){var c={},d=new THREE.MeshShaderMaterial({uniforms:TriggerShader.uniforms(),vertexShader:TriggerShader.vertexShader,fragmentShader:TriggerShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1,map:b.materials[0].map});c.mesh=new THREE.Mesh(b,d);var g=1,h=0;f=f!==undefined?f:0;var n=c.mesh.morphTargetForcedOrder;n[0]=0;n[1]=1;c.play=function(o){g=o||1;h=0;c.mesh.visible=!0;THREE.AnimationHandler.addToUpdate(c);c.update(0)};c.update=function(o){if(o<
5||o>66)o=33;h+=o*g;if(h>=1E3){n[0]=0;n[1]=c.mesh.geometry.morphTargets.length-1;d.uniforms.morph.value=1;d.uniforms.darkness.value=f;THREE.AnimationHandler.removeFromUpdate(c)}else{o=h/1E3;var m,p=0.1,u=0.7;if(o==0)o=0;else if(o==1)o=1;else{u||(u=0.3);if(!p||p<1){p=1;m=u/4}else m=u/(2*Math.PI)*Math.asin(1/p);o=p*Math.pow(2,-10*o)*Math.sin((o-m)*2*Math.PI/u)+1}o*=1E3;if(o<1E3){n[0]=Math.floor(o/1E3);n[1]=Math.ceil(o/1E3)}else{n[0]=c.mesh.geometry.morphTargets.length-2;n[1]=c.mesh.geometry.morphTargets.length-
1}d.uniforms.morph.value=o/1E3;d.uniforms.darkness.value=f*h/1E3}};return c};
var TriggerBig=function(b){var f={},c=new THREE.MeshShaderMaterial({uniforms:TriggerBigShader.uniforms(),vertexShader:TriggerBigShader.vertexShader(),fragmentShader:TriggerBigShader.fragmentShader,shading:THREE.FlatShading,lights:!0,fog:!0,morphTargets:!0,vertexColors:1});f.mesh=new THREE.Mesh(b,c);f.mesh.doubleSided=!0;var d=0.1,g=0,h=(b.morphTargets.length-1)*1E3,n=f.mesh.morphTargetForcedOrder;n[0]=0;n[1]=1;f.play=function(o){d=o||1;g=0;THREE.AnimationHandler.addToUpdate(f);f.update(0)};f.update=
function(o){g+=o*d;if(g>=h){n[0]=0;n[1]=f.mesh.geometry.morphTargets.length-1;c.uniforms.morph.value=1;THREE.AnimationHandler.removeFromUpdate(f)}else{o=g/h*h;if(o<h){n[0]=Math.floor(o/1E3);n[1]=Math.ceil(o/1E3)}else{n[0]=f.mesh.geometry.morphTargets.length-2;n[1]=f.mesh.geometry.morphTargets.length-1}c.uniforms.morph.value=o/h}};return f},TriggerUtils=function(){var b={};b.effectors=[0,0,2E4];b.effectorRadius=300;var f=[],c=[],d=[];b.setupCityTriggers=function(g){if(g.triggers){var h,n,o,m,p=g.triggers,
u=[];for(o in p)if(o.indexOf("TriggerMesh")!==-1){m=p[o];m.name=o.slice(o.indexOf("_")+1);m.geometry=g.geometries[m.object.geometry];u.push(m);g.objects[o].parent.removeChild(g.objects[o]);g.objects[o].visible=!1;delete p[o]}f=[];c=[];for(o in p){h=0;for(n=u.length;h<n;h++)if(o.indexOf(u[h].name)!==-1&&u[h].geometry.morphTargets.length){m=new Trigger(u[h].geometry);g.objects[o].addChild(m.mesh);m.mesh.visible=!1;f.push(m);m.mesh.rotation.x=90*Math.PI/180}}}};b.setupPrairieTriggers=function(g){var h,
n,o=g.geometries,m,p,u,v,w,x,y;for(h in o){n=o[h];if(n.morphTargets.length){m=0;for(p=n.morphTargets.length;m<p;m++){w=n.morphTargets[m].vertices;u=0;for(v=w.length;u<v;u++){x=w[u].position;y=x.y;x.y=-x.z;x.z=y}}}}n=g.objects;d=[];for(h in n)if(n[h].geometry&&n[h].geometry.morphTargets.length){g=new Trigger(n[h].geometry,Math.random()*0.25+0.5);n[h].addChild(g.mesh);n[h].visible=!1;d.push(g)}};b.update=function(g){var h,n,o,m,p=b.effectors,u,v,w,x=b.effectorRadius*1.5;if(g==="city"){g=0;for(h=f.length;g<
h;g++){n=f[g].mesh.matrixWorld.getPosition();o=0;for(m=p.length;o<m;o+=3){u=Math.abs(p[o+0]-n.x);v=Math.abs(p[o+1]-n.y);w=Math.abs(p[o+2]-n.z);if(u+v+w<x){f[g].play(0.2+Math.random()*0.05);f.splice(g,1);g--;h--;break}}}g=0;for(h=c.length;g<h;g++){n=c[g].mesh.matrixWorld.getPosition();o=0;for(m=p.length;o<m;o+=3){u=Math.abs(p[o+0]-n.x);v=Math.abs(p[o+1]-n.y);w=Math.abs(p[o+2]-n.z);if(u+v+w<x){c[g].play(0.2+Math.random()*0.1);c.splice(g,1);g--;h--;break}}}}else{g=0;for(h=d.length;g<h;g++){n=d[g].mesh.matrixWorld.getPosition();
o=0;for(m=p.length;o<m;o+=3){u=Math.abs(p[o+0]-n.x);v=Math.abs(p[o+1]-n.y);w=Math.abs(p[o+2]-n.z);if(u+v+w<x){d[g].play(0.1+Math.random()*0.05);d.splice(g,1);g--;h--;break}}}}};return b}();
TriggerShader={uniforms:function(){return{morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}}},
vertexShader:["uniform float\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, morph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
TriggerBigShader={uniforms:function(){return{effectors:{type:"fv",value:TriggerUtils.effectors},morph:{type:"f",value:0},darkness:{type:"f",value:0},diffuse:{type:"c",value:new THREE.Color(16777215)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},
pointLightDistance:{type:"fv1",value:[]}}},vertexShader:function(){return["const \t\tint\t\tNUMEFFECTORS = "+TriggerUtils.effectors.length/3+";","uniform \tvec3 \teffectors[ NUMEFFECTORS ];\nuniform \tfloat\tmorph;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"varying vec3 vLightWeighting;\nfloat elastic( float k ) {\nfloat s;\nfloat a = 0.8;\nfloat p = 0.7;\nif ( k == 0.0 ) return 0.0; if ( k == 1.0 ) return 1.0; if ( p == 0.0 ) p = 0.3;\nif ( a == 0.0 || a < 1.0 ) { a = 1.0; s = p / 4.0; }\nelse s = p / ( 2.0 * 3.14159265 ) * asin( 1.0 / a );\nreturn ( a * pow( 2.0, -10.0 * k ) * sin( ( k - s ) * ( 2.0 * 3.14159265 ) / p ) + 1.0 );\n}\nvoid main() {\nfloat distanceMorph = 0.0;\nif( morph < 1.0 ) { \nvec3 worldPosition = ( objectMatrix * vec4( morphTarget0, 1.0 )).xyz;\nfor( int i = 0; i < NUMEFFECTORS; i++ ) {",
"distanceMorph = max( distanceMorph, smoothstep( 0.0, 0.4, 1.0 - distance( worldPosition, effectors[ i ] ) / "+TriggerUtils.effectorRadius+".0 ));","}\ndistanceMorph = elastic( max( morph, distanceMorph ));\n} else {\ndistanceMorph = 1.0;\n}\nvec4 mvPosition = modelViewMatrix * vec4( mix( morphTarget0, morphTarget1, distanceMorph ), 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},
fragmentShader:["uniform float  darkness;\nuniform vec3 \tdiffuse;\nuniform float \topacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,"gl_FragColor = vec4( gl_FragColor.rgb * ( 1.0 - darkness ), 1.0 );",THREE.ShaderChunk.fog_fragment,
"}"].join("\n")};
var CitySoup=function(b,f,c){function d(F){var T,$,W,V;T=0;for($=F.faces.length;T<$;T++){V=F.faces[T];for(j=0;j<V.vertexColors.length;j++){W=V.vertexColors[j];THREE.ColorUtils.adjustHSV(W,0.13,0.3,-0.05)}}}var g=this;g.camera=b;renderer=c.renderer;var h=0;c.camPos=new THREE.Vector3(0,0,-300);b=new THREE.JSONLoader;b.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};b.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var n=new CollisionScene(g.camera,f,0.1,c,500,!0,f);n.settings.maxSpeedDivider=
1;n.settings.capBottom=3;n.settings.capTop=1E3;n.settings.shootRayDown=!1;n.settings.allowFlying=!1;n.settings.emitterDivider=2;n.settings.normalOffsetAmount=8;n.settings.minDistance=100;n.settings.keepEmitterFollowDown=!0;n.emitter.position.z=-100;n.emitterFollow.position.z=-100;b.load({model:"/files/models/city/collision/City.Collision_Big.js",callback:function(F){var T=new THREE.Vector3(-1.570796,0,0),$=new THREE.Vector3(0,0,0);n.addLoaded(F,0.1,T,$,f)}});b.load({model:"/files/models/city/collision/City.Collision_Big.001.js",
callback:function(F){var T=new THREE.Vector3(-1.570796,0,0),$=new THREE.Vector3(0,0,0);n.addLoaded(F,0.1,T,$,f)}});b.load({model:"/files/models/city/collision/City.Collision_Big.002.js",callback:function(F){var T=new THREE.Vector3(-1.570796,0,0),$=new THREE.Vector3(0,0,0);n.addLoaded(F,0.1,T,$,f)}});b.load({model:"/files/models/city/collision/City.Collision_Big.003.js",callback:function(F){var T=new THREE.Vector3(-1.570796,0,0),$=new THREE.Vector3(0,0,0);n.addLoaded(F,0.1,T,$,f)}});var o=new THREE.Vector3(0,
0,-250),m=new Vectors(50,3,8,o),p=[new THREE.MeshLambertMaterial({color:5997888,opacity:1}),new THREE.MeshLambertMaterial({color:4285993,opacity:1}),new THREE.MeshLambertMaterial({color:3103761,opacity:1}),new THREE.MeshLambertMaterial({color:6525252,opacity:1})],u=new Ribbons(4,m.array,f,p);u.settings.ribbonPulseMultiplier_1=15;u.settings.ribbonPulseMultiplier_2=0;u.settings.ribbonMin=0.1;u.settings.ribbonMax=0.2;p=THREE.ImageUtils.loadTexture("/files/textures/particle_0.png");var v=THREE.ImageUtils.loadTexture("/files/textures/particle_1.png"),
w=THREE.ImageUtils.loadTexture("/files/textures/particle_2.png"),x=THREE.ImageUtils.loadTexture("/files/textures/particle_3.png"),y=THREE.ImageUtils.loadTexture("/files/textures/particle_4.png"),A=new Particles(22,f,5,[p,v,w,x,y],20,70,THREE.AdditiveBlending);A.settings.gravitateTowardsCamera=!0;var B=new Stragglers(5,f,m.array);B.settings.capy=0;var C=new AnimalSwarm2(30,f,m.array);C.settings.addaptiveSpeed=!0;C.settings.capy=0;C.settings.startPosition=o;C.settings.constantSpeed=0.75;C.settings.avoidCamera=
!0;C.settings.killAtDistance=!0;C.array[0]="moose";C.array[22]="moose";C.array[2]="elk";C.array[10]="elk";C.array[1]="elk";C.array[25]="elk";C.array[8]="fish";C.array[16]="fish";C.array[5]="sockjump";C.array[26]="sockjump";C.array[13]="sockpopup";C.array[29]="sockjump";b.load({model:"/files/models/soup/animals_A_life.js",callback:function(F){var T=[1,0,4,3,2,1,0,5,2,7,8,9,10,1,0,3,3,9,2,3],$=[6.5,13.12,9.76,7.47,4.74,4.94,0.777,6.252,3.412,5.52,5.576];C.addAnimal(F,null,1.5,T,$);T=[8,9,7,9,10];F=
B.addAnimal(F,null,1.8,T,$);preinitAnimal(F,renderer,f)}});b.load({model:"/files/models/soup/elk_life.js",callback:function(F){F=C.addAnimal(F,"elk",2.2,null,[6]);preinitAnimal(F,renderer,f)}});b.load({model:"/files/models/soup/moose_life.js",callback:function(F){F=C.addAnimal(F,"moose",1.1,null,[13.964]);preinitAnimal(F,renderer,f)}});b.load({model:"/files/models/soup/fish_life.js",callback:function(F){F=C.addAnimal(F,"fish",1.6,[0,1,2,3],[2]);preinitAnimal(F,renderer,f);C.array[8].isFish=!0;C.array[16].isFish=
!0}});b.load({model:"/files/models/soup/sockpuppet_jump.js",callback:function(F){F=C.addAnimal(F,"sockjump",1.8,null,[3],!0);preinitAnimal(F,c.renderer,f)}});b.load({model:"/files/models/soup/sockpuppet_popup.js",callback:function(F){F=C.addAnimal(F,"sockpopup",2,null,[0.1],!0);preinitAnimal(F,c.renderer,f)}});var E=new AnimalSwarm2(10,f,m.array);E.settings.flying=!0;E.settings.flyingDistance=60;for(o=0;o<10;++o)o%2==0&&(E.array[o]="b");b.load({model:"files/models/soup/birds_A_life.js",callback:function(F){F=
E.addAnimal(F,null,1.3,[0,1,2,3,0,1,2,3,0,1],[4.848,7,7.5,3.5]);preinitAnimal(F,renderer,f)}});b.load({model:"files/models/soup/birds_B_life.js",callback:function(F){F=E.addAnimal(F,"b",1.3,[1,1,0,0,1,0,0,1,0,0],[8.5,8.623]);preinitAnimal(F,renderer,f)}});var z=new AnimalInFrontOfCamera(15,f);b.load({model:"/files/models/soup/butterfly_hiD.js",callback:z.addAnimal});var H=new AnimalInFrontOfCamera(15,f);b.load({model:"/files/models/soup/butterfly_hiC.js",callback:H.addAnimal});var G=new Trail(80,
f);G.settings.freeRotation=!1;G.settings.tweenTime=2500;G.settings.aliveDivider=30;G.settings.offsetAmount=10;for(o=0;o<80;++o)G.array[o]="0"+(o%4+1);G.array[10]="tree1";G.array[30]="tree2";G.array[45]="tree3";G.array[60]="tree4";G.array[75]="tree5";G.array[70]="light";b.load({model:"/files/models/soup/grass01.js",callback:function(F){d(F);G.addInstance(F,"01",!1)}});b.load({model:"/files/models/soup/grass02.js",callback:function(F){d(F);var T=G.addInstance(F,"02",!1);preInitModel(F,renderer,f,T)}});
b.load({model:"/files/models/soup/grass03.js",callback:function(F){d(F);var T=G.addInstance(F,"03",!1);preInitModel(F,renderer,f,T)}});b.load({model:"/files/models/soup/grassFlower.js",callback:function(F){d(F);var T=G.addInstance(F,"04",!1);preInitModel(F,renderer,f,T)}});b.load({model:"/files/models/soup/evergreen_low.js",callback:function(F){d(F);var T=G.addInstance(F,"tree1",!0);preInitModel(F,renderer,f,T)}});b.load({model:"/files/models/soup/evergreen_high.js",callback:function(F){d(F);var T=
G.addInstance(F,"tree2",!0);preInitModel(F,renderer,f,T)}});b.load({model:"/files/models/soup/treeGeneric.js",callback:function(F){d(F);var T=G.addInstance(F,"tree3",!0);preInitModel(F,renderer,f,T)}});b.load({model:"/files/models/soup/treeGenericLower.js",callback:function(F){d(F);var T=G.addInstance(F,"tree4",!0);preInitModel(F,renderer,f,T)}});b.load({model:"/files/models/soup/treeOrange.js",callback:function(F){d(F);var T=G.addInstance(F,"tree5",!0);preInitModel(F,renderer,f,T)}});b.load({model:"/files/models/soup/lighthouse.js",
callback:function(F){var T=G.addInstance(F,"light",!1,!0);preInitModel(F,renderer,f,T);G.array[70].maxHeight=12}});this.update=function(F,T){if(!isNaN(F)&&!(F>1E3||F==0)){if(T){c.camPos.copy(T.matrixWorld.getPosition());n.settings.camera=T}else{c.camPos.x=g.camera.matrixWorld.n14;c.camPos.y=g.camera.matrixWorld.n24;c.camPos.z=g.camera.matrixWorld.n34;n.settings.camera=g.camera}h%8==7&&B.create(n.emitterFollow.position,n.currentNormal,n.emitter.position);++h;var $=0;h%4==0&&($=(Math.random()-0.5)*
1.2);if(h%2==0&&!T)g.camera.animationParent.position.y=18+(Math.random()-0.5)*1.2;if(!T)g.camera.position.x=0+$;h%4==3&&C.create(n.emitterFollow.position,n.currentNormal,n.emitterFollow.position);h%8==7&&E.create(n.emitterFollow.position,n.currentNormal,n.emitterFollow.position);n.update(c.camPos,F);m.update(n.emitterFollow.position,n.currentNormal);u.update(n.emitterFollow.position);A.update(F,m.array[0].position,c.camPos);C.update(F,c.camPos,n.emitterFollow.position,n.currentNormal);B.update(F,
c.camPos);E.update(F,c.camPos,n.emitterFollow.position,n.currentNormal);H.update(c.camPos,g.camera.theta,F);z.update(c.camPos,g.camera.theta,F,!0);G.update(n.emitter.position,n.emitterNormal,c.camPos,F);TWEEN.update();TriggerUtils.effectors[0]=m.array[0].position.x;TriggerUtils.effectors[1]=m.array[0].position.y;TriggerUtils.effectors[2]=m.array[0].position.z}};this.changeCamera=function(F){g.camera=F;n.settings.camera=F};this.destruct=function(){}},PrairieSoup=function(b,f,c){c.camPos=new THREE.Vector3(302.182,
-9.045,-105.662);var d=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,n=new THREE.JSONLoader;n.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};n.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};var o=0,m=0,p=[],u=new CollisionScene(b,f,1,c,1100);u.settings.maxSpeedDivider=1;u.settings.allowFlying=!1;u.settings.emitterDivider=1;u.settings.shootRayDown=!1;u.settings.keepEmitterFollowDown=!0;u.settings.normalOffsetAmount=7;u.settings.minDistance=0;u.emitter.position.set(c.camPos.x+
40,c.camPos.y,c.camPos.z+20);u.emitterFollow.position.set(c.camPos.x+40,c.camPos.y,c.camPos.z+20);var v=new THREE.Vector3(c.camPos.x-10,c.camPos.y,c.camPos.z+30),w=new Vectors(30,10,10,v),x=THREE.ImageUtils.loadTexture("/files/textures/dark_0.png"),y=THREE.ImageUtils.loadTexture("/files/textures/dark_1.png"),A=THREE.ImageUtils.loadTexture("/files/textures/dark_2.png"),B=THREE.ImageUtils.loadTexture("/files/textures/dark_3.png"),C=THREE.ImageUtils.loadTexture("/files/textures/dark_4.png"),E=new Particles(20,
f,1.5,[x,y,A,B,C],70,60);E.settings.zeroAlphaStart=!1;E.settings.aliveDivider=2;var z=new AnimalSwarm(40,f,w.array);z.settings.xPositionMultiplier=22;z.settings.zPositionMultiplier=18;z.settings.shootRayDown=!0;z.settings.adaptiveSpeed=!0;z.settings.divider=1;z.settings.startPosition=v;z.array[7]="gator";z.array[8]="gator";z.array[9]="animal";z.array[11]="goat";z.array[13]="gator";z.array[14]="arm";z.array[15]="gator";z.array[16]="goat";z.array[18]="goat";z.array[19]="animal";z.array[20]="animal";
z.array[21]="animal";z.array[22]="animal";z.array[23]="animal";z.array[24]="animal";z.array[25]="animal";z.array[26]="animal";z.array[27]="animal";z.array[28]="animal";z.array[29]="animal";z.array[30]="octo";z.array[31]="octo";z.array[32]="octo";z.array[33]="octo";z.array[34]="centipede";z.array[35]="goat";z.array[36]="octo";n.load({model:"/files/models/soup/taruffalo_black.js",callback:function(F){F=z.addAnimal(F,null,0.25,[0,1,0,1],[9.2,9.2]);preinitAnimal(F,c.renderer,f)}});n.load({model:"/files/models/soup/animals_A_black.js",
callback:function(F){F=z.addAnimal(F,"animal",0.35,[3,1,2,0,1,0,2,0,2,3,0],[11.12,9.73,6.7,3.06]);preinitAnimal(F,c.renderer,f)}});n.load({model:"/files/models/soup/gator_black.js",callback:function(F){F=z.addAnimal(F,"gator",0.35,null,[4.5]);preinitAnimal(F,c.renderer,f)}});n.load({model:"/files/models/soup/goat_black.js",callback:function(F){F=z.addAnimal(F,"goat",0.45,null,[5.2]);preinitAnimal(F,c.renderer,f)}});n.load({model:"/files/models/soup/arm_black.js",callback:function(F){F=z.addAnimal(F,
"arm",3,null,[1]);preinitAnimal(F,c.renderer,f);z.array[14].generalSpecialCase=!0}});n.load({model:"/files/models/soup/octo_black.js",callback:function(F){F=z.addAnimal(F,"octo",0.25,[0,0,1,2],[1.629,3,1.7]);preinitAnimal(F,c.renderer,f)}});n.load({model:"/files/models/soup/sickle.js",callback:function(F){F=z.addAnimal(F,"sickle",1.5,null,[0.5]);preinitAnimal(F,c.renderer,f)}});n.load({model:"/files/models/soup/centipede.js",callback:function(F){F=z.addAnimal(F,"centipede",0.5,null,[1]);preinitAnimal(F,
c.renderer,f)}});var H=new AnimalSwarm(10,f,w.array);H.settings.flying=!0;H.settings.xPositionMultiplier=24;H.settings.zPositionMultiplier=12;H.settings.constantSpeed=2;H.settings.divider=4;H.settings.flyingDistance=-15;n.load({model:"/files/models/soup/birds_A_black.js",callback:function(F){F=H.addAnimal(F,null,0.4,[0,0,0,0,1,0,0,0,0,1],[12,14]);preinitAnimal(F,c.renderer,f)}});var G=new Trail(80,f);G.settings.spread=10;G.settings.aliveDivider=40;G.settings.tweenTime=800;G.settings.scale=0.3;G.settings.offsetAmount=
10;G.settings.yscale=0.15;n.load({model:"/files/models/soup/darkblob01.js",callback:function(F){var T=G.addInstance(F,null,!1,!1);preInitModel(F,renderer,f,T)}});this.update=function(F,T){if(!isNaN(F)&&!(F>1E3||F==0)){if(T){c.camPos.copy(T.matrixWorld.getPosition());u.settings.camera=T}else{c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;c.camPos.z=b.matrixWorld.n34;u.settings.camera=b}g.copy(c.camPos);h.copy(g.subSelf(d).normalize());d.copy(c.camPos);if(c.camPos.x>1090){c.camPos.set(302.182,
-9.045,-105.662);u.reset(c.camPos.x,c.camPos.y,c.camPos.z);w.reset(c.camPos.x,c.camPos.y,c.camPos.z);z.reset(c.camPos.x,c.camPos.y,c.camPos.z);H.reset(c.camPos.x,c.camPos.y,c.camPos.z);E.reset(c.camPos.x,c.camPos.y,c.camPos.z)}o+=F;m+=F;u.update(c.camPos,F);w.update(u.emitterFollow.position,u.currentNormal);E.update(F,w.array[0].position);z.update(F,c.camPos);H.update(F,c.camPos);G.update(u.emitterFollow.position,u.emitterNormal,c.camPos,F);if(o>=100){z.create(u.emitterFollow.position,u.currentNormal,
h);o=0}if(m>=500){H.create(u.emitterFollow.position,u.currentNormal,h);m=0}TWEEN.update();var $=new THREE.Vector3(u.emitter.position.x,u.emitter.position.y,u.emitter.position.z);p.unshift($);if(p.length>10){$=p[10];ROME.TrailShaderUtils.updateLava(F*1.0E-4,$.x,-$.z);ROME.TrailShaderUtils.setMarkAtWorldPosition($.x,-$.z)}TriggerUtils.effectors[0]=w.array[1].position.x;TriggerUtils.effectors[1]=w.array[1].position.y;TriggerUtils.effectors[2]=w.array[1].position.z;c.prairieSoupHead.copy(u.emitter.position)}};
this.destruct=function(){}},DunesSoup=function(b,f,c){function d(){if(h==0){g.set("raven|raven|raven|vulture|vulture|raven|raven|raven|raven|raven|vulture");A.changeColor([0,1118481,0,1118481,0,1118481],0.5);C.switchGeometry(o);h=1}else{g.set("eagle|owl|parrot|flamingo|hummingbird|eagle|owl|stork|parrot|hummingbird|eagle");A.changeColor([14283771,15004149,16777215,15658734,14480378,13825020],0.25);C.switchGeometry(m);h=0}}var g=this;c.camPos=new THREE.Vector3(0,0,0);var h=0,n=!1,o=[],m=[],p=new THREE.JSONLoader;
p.onLoadStart=function(){c.signals.loadItemAdded.dispatch()};p.onLoadComplete=function(){c.signals.loadItemCompleted.dispatch()};c.signals.mousedown.add(function(){if(n){for(var E=0;E<B.initSettings.numOfAnimals;++E){var z=E==0?(new TWEEN.Tween(B.array[E])).to({scale:0.0010},300).easing(TWEEN.Easing.Linear.EaseNone).onComplete(d):(new TWEEN.Tween(B.array[E])).to({scale:0.0010},300).easing(TWEEN.Easing.Linear.EaseNone);z.start()}for(E=0;E<C.initSettings.numOfInstances;++E){z=(new TWEEN.Tween(C.array[E].c.scale)).to({x:0.0010,
y:0.0010,z:0.0010},300).easing(TWEEN.Easing.Linear.EaseNone);z.start()}}});g.addAnimal=function(E,z){E==undefined&&(E="eagle");var H=u[E].geometry,G=u[E].scale,F=u[E].speed,T=u[E].index;u[E].flying?B.switchAnimal(H,G,F,T,z):runningAnimals.switchAnimal(H,G,F,T,z)};g.set=function(E){E=E.split("|");for(var z=0,H=0,G=0;G<E.length;++G){var F=E[G],T=!0;u[F].flying&&(T=!1);if(T){g.addAnimal(F,z);++z}else{g.addAnimal(F,H);++H}}};var u={};u.eagle={geometry:null,index:0,speed:4.848,scale:1.3,flying:!0};u.owl=
{geometry:null,index:1,speed:7,scale:1.3,flying:!0};u.parrot={geometry:null,index:2,speed:7.5,scale:1.3,flying:!0};u.hummingbird={geometry:null,index:3,speed:3.5,scale:1.3,flying:!0};u.flamingo={geometry:null,index:0,speed:8.5,scale:1.3,flying:!0};u.stork={geometry:null,index:1,speed:8.623,scale:1.3,flying:!0};u.raven={geometry:null,index:0,speed:14,scale:1.75,flying:!0};u.vulture={geometry:null,index:1,speed:12,scale:1.55,flying:!0};var v=new CollisionScene(b,f,0.15,c,1200);v.settings.emitterDivider=
5;v.settings.maxSpeedDivider=0.1;v.settings.capBottom=-500;v.settings.allowFlying=!0;var w=new THREE.Vector3(c.camPos.x,c.camPos.y-1E3,c.camPos.z),x=new Vectors(50,3,10,w),y=[new THREE.MeshBasicMaterial({color:14283771,opacity:0.25}),new THREE.MeshBasicMaterial({color:15004149,opacity:0.25}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.25}),new THREE.MeshBasicMaterial({color:15658734,opacity:0.25}),new THREE.MeshBasicMaterial({color:14480378,opacity:0.25}),new THREE.MeshBasicMaterial({color:13825020,
opacity:0.25})],A=new Ribbons(6,x.array,f,y);A.settings.ribbonPulseMultiplier_1=20;A.settings.ribbonPulseMultiplier_2=0.01;A.settings.ribbonMin=0.05;A.settings.ribbonMax=0.1;var B=new AnimalSwarm_dunes(11,f,x.array);B.settings.flying=!0;B.settings.flyingDistance=0;B.settings.divider=1;B.settings.constantSpeed=0.8;B.settings.respawn=!1;B.settings.startPosition=w;B.settings.xPositionMultiplier=50;B.settings.zPositionMultiplier=30;for(w=0;w<12;++w)w%3==0&&(B.array[w]="b");p.load({model:"/files/models/soup/birds_A_life.js",
callback:function(E){u.eagle.geometry=E;u.owl.geometry=E;u.parrot.geometry=E;u.hummingbird.geometry=E;E=B.addAnimal(E,null,2.8,[0,1,2,3],1.2);preinitAnimal(E,c.renderer,f)}});p.load({model:"/files/models/soup/birds_B_life.js",callback:function(E){u.flamingo.geometry=E;u.stork.geometry=E;E=B.addAnimal(E,"b",2.8,[1,0],1.2);preinitAnimal(E,c.renderer,f)}});p.load({model:"/files/models/soup/birds_A_black.js",callback:function(E){u.raven.geometry=E;u.vulture.geometry=E}});var C=new Trail(80,f);C.settings.freeRotation=
!0;C.settings.tweenTime=800;C.settings.aliveDivider=50;C.settings.offsetAmount=0;C.settings.shootRayDown=!0;C.settings.scale=1.5;for(w=0;w<80;++w)C.array[w]="0"+(w%4+1);p.load({model:"/files/models/soup/grass01.js",callback:function(E){m.push(E);var z=C.addInstance(E,"01",!1);preInitModel(E,renderer,f,z)}});p.load({model:"/files/models/soup/grass02.js",callback:function(E){m.push(E);var z=C.addInstance(E,"02",!1);preInitModel(E,renderer,f,z)}});p.load({model:"/files/models/soup/grass03.js",callback:function(E){m.push(E);
var z=C.addInstance(E,"03",!1);preInitModel(E,renderer,f,z)}});p.load({model:"/files/models/soup/grassFlower.js",callback:function(E){m.push(E);var z=C.addInstance(E,"04",!1);preInitModel(E,renderer,f,z)}});p.load({model:"/files/models/soup/darkblob01.js",callback:function(E){o.push(E);preInitModel(E,renderer,f,object)}});this.update=function(E,z){if(!isNaN(E)&&!(E>1E3||E==0)){if(z){c.camPos.copy(z.matrixWorld.getPosition());v.settings.camera=z}else{c.camPos.x=b.matrixWorld.n14;c.camPos.y=b.matrixWorld.n24;
c.camPos.z=b.matrixWorld.n34;v.settings.camera=b}v.update(c.camPos,E);x.update(v.emitterFollow.position,v.currentNormal);A.update(v.emitterFollow.position);B.update(E,c.camPos);TWEEN.update();c.camPos.y<1200&&C.update(v.emitter.position,v.emitterNormal,c.camPos,E);n=!0}};this.destruct=function(){}},Ribbon=function(b,f,c){b=b||100;f=f||10;c=c||10;THREE.Geometry.call(this);f/=2;b/=c;for(var d=[],g=0;g<c+2;++g){var h=g*b,n=-f;d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(h,f,0)))-1);d.push(this.vertices.push(new THREE.Vertex(new THREE.Vector3(h,
n,0)))-1)}for(g=0;g<c*2;g+=2){this.faces.push(new THREE.Face3(d[g],d[g+2],d[g+1]));this.faces.push(new THREE.Face3(d[g+2],d[g+3],d[g+1]))}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};Ribbon.prototype=new THREE.Geometry;Ribbon.prototype.constructor=Ribbon;ROME={};
ROME.Animal=function(b,f){var c=ROME.AnimalAnimationData.init(b,f),d={};d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1,name:""};d.availableAnimals=c.availableAnimals;d.mesh=new THREE.Mesh(b,c.material);var g=!1,h=d.mesh.morphTargetForcedOrder,n=c.material;d.play=function(m,p,u,v,w){if(!g){g=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}p=
p!==undefined?p:m;o(m,d.animalA);o(p,d.animalB);d.animalA.currentTime=v?v:0;d.animalB.currentTime=w?w:0;d.update(0)};d.update=function(m){if(d.mesh._modelViewMatrix){var p,u=["animalA","animalB"],v,w,x,y,A,B;v=0;w=u.length;for(B=0;v<w;v++){p=d[u[v]];A=p.currentTime;p.currentTime=(p.currentTime+m*p.timeScale)%p.lengthInMS;if(A>p.currentTime)p.currentFrame=0;A=0;x=p.currentFrame;for(y=p.lengthInFrames-1;x<y;x++)if(p.currentTime>=p.frames[x].time&&p.currentTime<p.frames[x+1].time){A=x;break}p.currentFrame=
A;x=A+1<y?A+1:0;h[B++]=p.frames[A].index;h[B++]=p.frames[x].index;A=p.frames[A].time;x=p.frames[x].time>A?p.frames[x].time:p.frames[x].time+p.lengthInMS;p=(p.currentTime-A)/(x-A);n.uniforms[u[v]+"Interpolation"].value=p}n.uniforms.animalMorphValue.value=d.morph;if(n.attributes[d.animalA.name]!==undefined)n.attributes.colorAnimalA.buffer=n.attributes[d.animalA.name].buffer;if(n.attributes[d.animalB.name]!==undefined)n.attributes.colorAnimalB.buffer=n.attributes[d.animalB.name].buffer}};d.setNewTargetAnimal=
function(m,p){if(d.morph===1){for(var u in d.animalA)d.animalA[u]=d.animalB[u];d.animalB.currentTime=p?p:0;o(m,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var o=function(m,p){if(ROME.AnimalAnimationData[m]!==undefined){p.frames=ROME.AnimalAnimationData[m];p.lengthInFrames=p.frames.length;p.lengthInMS=p.frames[p.lengthInFrames-1].time;p.name=m.toLowerCase();p.normalsOffset=Math.floor(p.frames.length*0.5,10)}else console.log("Error: Couldn't find data for animal "+
m)};return d};
ROME.AnimalShader={uniforms:function(){return THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0},lightScale:{type:"f",value:1},lightOffset:{type:"v3",value:new THREE.Vector3(0,0,0)}}])},attributes:function(){return{colorAnimalA:{type:"c",boundTo:"faces",value:[]},colorAnimalB:{type:"c",boundTo:"faces",value:[]}}},vertexShader:["uniform \tfloat\tanimalAInterpolation;\nuniform \tfloat\tanimalBInterpolation;\nuniform \tfloat\tanimalMorphValue;\nattribute\tvec3\tcolorAnimalA;\nattribute\tvec3\tcolorAnimalB;\nvarying vec3 vColor;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.lights_pars_vertex,
"uniform float lightScale;\nuniform vec3 lightOffset;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvColor = mix( colorAnimalA, colorAnimalB, animalMorphValue );\nvec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec3( 0.2 );\nvec4 lDirection = viewMatrix * vec4( vec3( 0.0, 1.0, 1.0 ), 0.0 );\nfloat directionalLightWeighting = dot( transformedNormal, normalize( lDirection.xyz ) ) * 0.5 + 0.5;\nvLightWeighting += vec3( 1.0 ) * directionalLightWeighting;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"varying vec3 vLightWeighting;\nvarying vec3 vColor;\nvoid main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 ) * vec4( 0.9, 0.85, 0.8, 1.0 );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData={animalNames:["tarbuffalo","bearbrown","horse","deer","mountainlion","goldenRetreiver","fox","seal","chow","raccoon","bunny","frog","elk","moose","fishA","fishB","fishC","fish","sockPuppet","blackWidow","crab","scorp","goat","gator","tarbuffalo_runB","tarbuffalo","wolf","panther","bearblack","toad","eagle","owl","parrot","hummingBird","flamingo","stork","butterflyA","butterflyB","butterflyC","butterflyD","butterflyLowA","butterflyLowB","butterflyLowC","butterflyLowD","raven",
"vulture","bison","sickle","armHand","sickle","centipede","shdw2","shdw5","drownArm_A","drownArm_C"],colorVariations:{armhand:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bearBlack:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.1},bearBrown:{hRange:0.02,sRange:0.15,vRange:0.15,hOffset:-0.01,sOffset:0.05,vOffset:-0.15},blackWidow:{hRange:0.02,sRange:0.1,vRange:0.05,hOffset:0,sOffset:0,vOffset:-0.1},bunny:{hRange:0.05,sRange:0.125,vRange:0.2,hOffset:0,sOffset:-0.05,
vOffset:0},butterflyA:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyB:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyC:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},butterflyD:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0,vOffset:0},centipede:{hRange:0.05,sRange:0,vRange:0.55,hOffset:0,sOffset:0.1,vOffset:-0.45},chow:{hRange:0.025,sRange:0.15,vRange:0.1,hOffset:0,sOffset:-0.1,vOffset:-0.1},cow:{hRange:0,sRange:0,
vRange:0.2,hOffset:0,sOffset:0.05,vOffset:-0.25},cowCarcass:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:-0.1,vOffset:0},crab:{hRange:0.07,sRange:0,vRange:0.15,hOffset:-0.025,sOffset:0.15,vOffset:-0.16},deer:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},eagle:{hRange:0.075,sRange:0.1,vRange:0.25,hOffset:0,sOffset:0.1,vOffset:-0.05},elk:{hRange:0.03,sRange:0.1,vRange:0.3,hOffset:-0.0075,sOffset:0,vOffset:-0.2},fish:{hRange:0,sRange:0,vRange:0.2,hOffset:0,sOffset:0,vOffset:0},
flamingo:{hRange:0.1,sRange:0.15,vRange:0.25,hOffset:-0.03,sOffset:0.1,vOffset:-0.15},fox:{hRange:0.03,sRange:0.15,vRange:0.25,hOffset:-0.012,sOffset:0.05,vOffset:0},frog:{hRange:0.05,sRange:0.1,vRange:0.25,hOffset:0.01,sOffset:0.05,vOffset:-0.1},gator:{hRange:0.05,sRange:0,vRange:0.2,hOffset:-0.05,sOffset:0,vOffset:-0.26},goat:{hRange:0.02,sRange:0.07,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},goldenRetreiver:{hRange:0.025,sRange:0.2,vRange:0.05,hOffset:0,sOffset:-0.1,vOffset:0.015},horse:{hRange:0.025,
sRange:0.1,vRange:0.25,hOffset:-0.0050,sOffset:0,vOffset:-0.1},hummingbird:{hRange:0.05,sRange:0.1,vRange:0.3,hOffset:-0.02,sOffset:0.1,vOffset:-0.3},moose:{hRange:0.07,sRange:0.05,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.2},mountainlion:{hRange:0.02,sRange:0.1,vRange:0.15,hOffset:0,sOffset:0.1,vOffset:-0.05},owl:{hRange:0.025,sRange:0.4,vRange:0.15,hOffset:-0.0050,sOffset:-0.3,vOffset:-0.1},panther:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.16},parrot:{hRange:0.05,sRange:0.1,
vRange:0.3,hOffset:-0.025,sOffset:0.1,vOffset:-0.1},raccoon:{hRange:0,sRange:0.1,vRange:0.25,hOffset:0.6,sOffset:-0.1,vOffset:-0.2},raven:{hRange:0.02,sRange:0.1,vRange:0.1,hOffset:0,sOffset:0,vOffset:-0.1},scorp:{hRange:0,sRange:0.1,vRange:0.075,hOffset:0,sOffset:0,vOffset:-0.15},seal:{hRange:0,sRange:0,vRange:0.05,hOffset:0,sOffset:0.05,vOffset:-0.1},shdw2:{hRange:0,sRange:0.1,vRange:0.06,hOffset:0,sOffset:-0.05,vOffset:-0.15},sickle:{hRange:0.04,sRange:0,vRange:0.1,hOffset:0,sOffset:-0.2,vOffset:-0.3},
stork:{hRange:0,sRange:0.1,vRange:0.2,hOffset:0.02,sOffset:-0.05,vOffset:-0.05},tarbuffalo:{hRange:0.04,sRange:0.1,vRange:0.1,hOffset:-0.015,sOffset:0,vOffset:-0.175},toad:{hRange:0.07,sRange:0,vRange:0.1,hOffset:-0.02,sOffset:0,vOffset:-0.25},vulture:{hRange:0.01,sRange:0.25,vRange:0.08,hOffset:0,sOffset:-0.1,vOffset:-0.16},wolf:{hRange:0,sRange:0.2,vRange:0.06,hOffset:-0.05,sOffset:-0.15,vOffset:-0.1},zero:{hRange:0,sRange:0,vRange:0,hOffset:0,sOffset:0,vOffset:0}},animalVariationMap:{armhand:"armhand",
bearbrown:"bearBrown",bearblack:"bearBlack",blackwidow:"blackWidow",bunny:"bunny",butterflya:"butterflyA",butterflyb:"butterflyB",butterflyc:"butterflyC",butterflyd:"butterflyD",centipede:"centipede",chow:"chow",cow:"cow",cowcarcass:"cowCarcass",crab:"crab",deer:"deer",eagle:"eagle",elk:"elk",fisha:"fish",fishb:"fish",fishc:"fish",fishd:"fish",flamingo:"flamingo",fox:"fox",frog:"frog",gator:"gator",goat:"goat",goldenretreiver:"goldenRetreiver",horse:"horse",hummingbird:"hummingbird",moose:"moose",
mountainlion:"mountainlion",panther:"panther",owl:"owl",parrot:"parrot",raccoon:"raccoon",raven:"raven",scorpion:"scorp",seal:"seal",shdw:"shdw2",sickle:"sickle",stork:"stork",tarbuffalo:"tarbuffalo",toad:"toad",vulture:"vulture",wolf:"wolf",bison:"tarbuffalo"},init:function(b,f){if(b.initialized){u=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:{},vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,fog:!0,lights:!0,morphTargets:!0});
for(n in b.customAttributes){var c=b.customAttributes[n];u.attributes[n]=n==="colorAnimalA"||n==="colorAnimalB"?{type:"c",size:3,boundTo:c.boundTo,value:c.value,array:undefined,buffer:undefined,needsUpdate:!1,__webglInitialized:!0}:c}}else{b.initialized=!0;c=[];var d,g,h;u=b.morphTargets;var n,o,m,p;if(f){o=0;for(m=u.length;o<m;o++){n=0;for(h=this.animalNames.length;n<h;n++){g=this.animalNames[n];if(u[o].name.indexOf(g)!==-1)break}if(n===h){g=u[o].name;for(n=0;n<g.length;n++){h=g.charCodeAt(n);if(!(h>=
65&&h<=90||h>=97&&h<=122))break}this.animalNames.push(g.slice(0,n))}}}n=0;for(h=this.animalNames.length;n<h;n++){g=this.animalNames[n];d=this[g];p=0;if(d===undefined||d.length===0){d=this[g]=[];o=0;for(m=u.length;o<m;o++)if(u[o].name.indexOf(g)!==-1){d.push({index:o,time:p});p+=parseInt(1E3/24,10);c.indexOf(g)===-1&&c.push(g)}}else{o=0;for(m=u.length;o<m;o++)c.indexOf(g)===-1&&u[o].name.indexOf(g)!==-1&&c.push(g)}}var u=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader.uniforms(),attributes:ROME.AnimalShader.attributes(),
vertexShader:ROME.AnimalShader.vertexShader,fragmentShader:ROME.AnimalShader.fragmentShader,lights:!0,morphTargets:!0,vertexColors:THREE.VertexColors}),v;d=b.morphColors;p=u.attributes;if(b.morphColors&&b.morphColors.length){o=0;for(m=d.length;o<m;o++){v=d[o];g=v.name;for(n=0;n<g.length;n++){h=g.charCodeAt(n);if(!(h>=65&&h<=90||h>=97&&h<=122))break}g=g.slice(0,n).toLowerCase();p[g]={type:"c",boundTo:"faces",value:v.colors};n=this.colorVariations.zero;this.animalVariationMap[g]!==undefined&&(n=this.colorVariations[this.animalVariationMap[g]]);
u.uniforms.lightScale.value=n.lScale?n.lScale:0.5;n.lOffset?u.uniforms.lightOffset.value.set(n.lOffset[0],n.lOffset[1],n.lOffset[2]):u.uniforms.lightOffset.value.set(0.6,0.6,0.6);randomizeColors(p[g].value,n)}p.colorAnimalA.value=d[0].colors;p.colorAnimalB.value=d[0].colors;n=0;for(h=c.length;n<h;n++){g=c[n].toLowerCase();o=0;for(m=d.length;o<m;o++){v=d[o].name.toLowerCase();if(v.indexOf(g)!==-1)break}if(o===m){console.error("Animal.constructor: Morph Color missing for animal "+g+". Deploying backup plan.");
p[g]={type:"c",boundTo:"faces",value:[]};o=0;for(m=b.faces.length;o<m;o++)p[g].value.push(new THREE.Color(16711680))}}}else{console.error("Animal.constructor: Morph Colors doesn't exist, deploying fallback!");o=0;for(m=b.faces.length;o<m;o++)p.colorAnimalA.value.push(new THREE.Color(16711935));p.colorAnimalB.value=p.colorAnimalA.value;n=0;for(h=c;n<h;n++)p[c[n]]={type:"c",boundTo:"faces",value:p.colorAnimalA.value}}b.availableAnimals=c;b.customAttributes=u.attributes}return{availableAnimals:b.availableAnimals,
material:u}}};function randomizeColors(b,f){var c,d,g,h,n,o;c=0;for(d=b.length;c<d;c++){g=b[c];h=f.hRange*Math.random()+f.hOffset;n=f.sRange*Math.random()+f.sOffset;o=f.vRange*Math.random()+f.vOffset;THREE.ColorUtils.adjustHSV(g,h,n,o)}}
ROME.Animal_old=function(b,f){var c=new THREE.MeshShaderMaterial({uniforms:ROME.AnimalShader_old.uniforms,vertexShader:ROME.AnimalShader_old.vertex,fragmentShader:ROME.AnimalShader_old.fragment,morphTargets:!0,vertexColors:b.materials[0][0].vertexColors,lights:!0}),d={};d.mesh=new THREE.Mesh(b,c);d.morph=0;d.animalA={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};d.animalB={frames:undefined,currentFrame:0,lengthInFrames:0,currentTime:0,lengthInMS:0,timeScale:1};
d.availableAnimals=ROME.AnimalAnimationData_old.init(b,f);for(var g=!1,h=d.mesh.morphTargetForcedOrder,n,o,m,p,u=0;u<b.faces.length;u++){n=b.faces[u].color;o=0*Math.random()+0;m=0*Math.random()+0;p=0.4*Math.random()+-0.1;THREE.ColorUtils.adjustHSV(n,o,m,p)}d.play=function(w,x,y,A,B){if(!g){g=!0;d.morph=0;THREE.AnimationHandler.addToUpdate(d)}v(w,d.animalA);v(x,d.animalB);d.animalA.currentTime=A?A:0;d.animalB.currentTime=B?B:0;d.update(0)};d.update=function(w){var x,y=["animalA","animalB"],A,B,C,E,
z,H;A=0;B=y.length;for(H=0;A<B;A++){x=d[y[A]];z=x.currentTime;x.currentTime=(x.currentTime+w*x.timeScale)%x.lengthInMS;if(z>x.currentTime)x.currentFrame=0;z=0;C=x.currentFrame;for(E=x.lengthInFrames-1;C<E;C++)if(x.currentTime>=x.frames[C].time&&x.currentTime<x.frames[C+1].time){z=C;break}x.currentFrame=z;C=z+1<E?z+1:0;h[H++]=x.frames[z].index;h[H++]=x.frames[C].index;z=x.frames[z].time;C=x.frames[C].time>z?x.frames[C].time:x.frames[C].time+x.lengthInMS;x=(x.currentTime-z)/(C-z);c.uniforms[y[A]+"Interpolation"].value=
x}c.uniforms.animalMorphValue.value=d.morph};d.setNewTargetAnimal=function(w,x){if(d.morph===1){for(var y in d.animalA)d.animalA[y]=d.animalB[y];d.animalB.currentTime=x?x:0;v(w,d.animalB);d.morph=0}else console.log("Error: Cannot change animal target if morph != 1. Skipping.")};var v=function(w,x){if(ROME.AnimalAnimationData_old[w]!==undefined){x.frames=ROME.AnimalAnimationData_old[w];x.lengthInFrames=x.frames.length;x.lengthInMS=x.frames[x.lengthInFrames-1].time}else console.log("Error: Couldn't find data for animal "+
w)};return d};
ROME.AnimalShader_old={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{animalAInterpolation:{type:"f",value:0},animalBInterpolation:{type:"f",value:0},animalMorphValue:{type:"f",value:0}}]),vertex:["uniform float\tanimalAInterpolation;\nuniform float\tanimalBInterpolation;\nuniform float\tanimalMorphValue;\nvarying vec3 \tvLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,
THREE.ShaderChunk.color_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,"vec3 animalA = mix( morphTarget0, morphTarget1, animalAInterpolation );\nvec3 animalB = mix( morphTarget2, morphTarget3, animalBInterpolation );\nvec3 morphed = mix( animalA,      animalB,      animalMorphValue );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n}"].join("\n"),
fragment:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,
THREE.ShaderChunk.fog_fragment,"}"].join("\n")};
ROME.AnimalAnimationData_old={animalNames:["sockPuppet_jump","sockPuppet_popUp"],init:function(b,f){var c=[],d,g,h=b.morphTargets,n,o,m,p,u;if(f){m=0;for(p=h.length;m<p;m++){n=0;for(o=this.animalNames.length;n<o;n++){g=this.animalNames[n];if(h[m].name.indexOf(g)!==-1)break}if(n===o){g=h[m].name;for(n=0;o<g.length;n++){d=g.charCodeAt(n);if(!(d>=65&&d<=90||d>=97&&d<=122))break}this.animalNames.push(g.slice(0,n))}}}n=0;for(o=this.animalNames.length;n<o;n++){g=this.animalNames[n];d=this[g];u=0;if(d===
undefined||d.length===0){d=this[g]=[];m=0;for(p=h.length;m<p;m++)if(h[m].name.indexOf(g)!==-1){d.push({index:m,time:u});u+=parseInt(1E3/24,10);c.indexOf(g)===-1&&c.push(g)}}else{m=0;for(p=h.length;m<p;m++)c.indexOf(g)===-1&&h[m].name.indexOf(g)!==-1&&c.push(g)}}return c}};
var Ribbons=function(b,f,c,d){var g=this,h=[],n=[];g.initSettings={numOfRibbons:b||6};g.settings={ribbonPulseMultiplier_1:5.5,ribbonPulseMultiplier_2:5.5,ribbonMin:1.5,ribbonMax:3,visible:!0};var o=0,m;for(m=0;m<g.initSettings.numOfRibbons;++m){var p=new Ribbon(15,6,f.length-20),u=new THREE.Mesh(p,d[m%d.length]);u.dynamic=!0;u.doubleSided=!0;u.position.set(0,-500,0);c.addObject(u);h.push({r:p,rm:u,offset:3+Math.floor(Math.random()*10)});n.push(u)}this.changeColor=function(v,w){for(m=0;m<g.initSettings.numOfRibbons;++m){h[m].rm.materials[0].color.setHex(v[m%
v.length]);h[m].rm.materials[0].opacity=w}};this.update=function(v){o+=0.1;for(m=0;m<f.length;++m)for(var w=f[m].position.x,x=f[m].position.y,y=f[m].position.z,A=0;A<b;++A){var B=h[A].r,C=h[A].offset;if(!(m<C)){var E=Math.cos((m-o*10)/10)*g.settings.ribbonPulseMultiplier_1,z=Math.cos((m-o*10)/8)*g.settings.ribbonPulseMultiplier_2,H=A*(Math.PI*2/h.length),G=Math.cos(H+(m-o*10)/8)*E;E*=Math.sin(H+(m-o*10)/8);for(H=0;H<2;++H){var F=(m-C)*2+H;if(B.vertices[F]!=undefined){var T=m-o*2,$=Math.max(g.settings.ribbonMin,
m/(10+z));$=Math.min($,g.settings.ribbonMax);var W=Math.cos(T/3)*$;T=Math.sin(T/3)*$;B.vertices[F].position.x=w-v.x+W+G;if(H==0){B.vertices[F].position.y=x+T+E-v.y;B.vertices[F].position.z=y+W+G-v.z}else{B.vertices[F].position.y=x-T+E-v.y;B.vertices[F].position.z=y-W+G-v.z}}}}}for(m=0;m<h.length;++m){w=h[m].rm;w.position=v;B=h[m].r;B.__dirtyVertices=!0;w.visible=g.settings.visible}}},Vectors=function(b,f,c,d){var g=this;g.array=[];var h;g.initSettings={length:b||50};g.settings={divider:f||4,normaldivider:c||
10,absoluteTrail:!1,startPosition:d||new THREE.Vector3(0,0,0)};for(h=0;h<g.initSettings.length;++h){b=new THREE.Vector3(0,0,0);b.copy(g.settings.startPosition);b={position:b,lastposition:new THREE.Vector3(0,0,0),normal:new THREE.Vector3(0,1,0),scale:1};g.array.push(b)}this.update=function(n,o){for(h=0;h<g.initSettings.length;++h){var m=g.array[h];if(h==0)var p=n.x,u=n.y,v=n.z,w=o.x,x=o.y,y=o.z;else{p=g.array[h-1].lastposition.x;u=g.array[h-1].lastposition.y;v=g.array[h-1].lastposition.z;w=g.array[h-
1].normal.x;x=g.array[h-1].normal.y;y=g.array[h-1].normal.z}g.array[h].lastposition.x=m.position.x;g.array[h].lastposition.y=m.position.y;g.array[h].lastposition.z=m.position.z;if(g.settings.absoluteTrail){m.position.x=p;m.position.y=u;m.position.z=v;m.normal.x=w;m.normal.y=x;m.normal.z=y}else{u=(u-m.position.y)/g.settings.divider;v=(v-m.position.z)/g.settings.divider;m.position.x+=(p-m.position.x)/g.settings.divider;m.position.y+=u;m.position.z+=v;p=(x-m.normal.y)/g.settings.normaldivider;y=(y-m.normal.z)/
g.settings.normaldivider;m.normal.x+=(w-m.normal.x)/g.settings.normaldivider;m.normal.y+=p;m.normal.z+=y}}};this.reset=function(n,o,m){for(var p=0;p<g.array.length;++p){var u=g.array[p];u.position.x=n;u.position.y=o;u.position.z=m}}},Particles=function(b,f,c,d,g,h,n){var o=this,m=[];n=n||THREE.NormalBlending;o.initSettings={numOfParticleSystems:b||25,numInSystem:g||60,spread:h||50,particleSize:c||8};o.settings={aliveDivider:3,zeroAlphaStart:!0,visible:!0,gravitateTowardsCamera:!1};var p;c=new THREE.Geometry;
for(p=0;p<o.initSettings.numInSystem;p++){g=new THREE.Vector3(Math.random()*o.initSettings.spread-o.initSettings.spread/2,Math.random()*o.initSettings.spread-o.initSettings.spread/2,Math.random()*o.initSettings.spread-o.initSettings.spread/2);c.vertices.push(new THREE.Vertex(g))}for(p=0;p<o.initSettings.numOfParticleSystems;p++){g=new THREE.ParticleBasicMaterial({size:o.initSettings.particleSize,map:d[p%d.length],transparent:!0,depthTest:!0,blending:n});g=new THREE.ParticleSystem(c,g);g.rotation.x=
Math.random()*Math.PI;g.rotation.y=Math.random()*Math.PI;g.rotation.z=Math.random()*Math.PI;m.push({c:g,alivetime:p});f.addObject(g)}this.update=function(u,v,w){if(isNaN(u)||u>1E3)u=1E3/60;u/=60;for(p=0;p<b;++p){var x=m[p].c;m[p].alivetime+=u/o.settings.aliveDivider;if(m[p].alivetime>=b){m[p].alivetime=0;x.scale.x=x.scale.y=x.scale.z=0.5;x.position.x=v.x;x.position.y=v.y;x.position.z=v.z;if(o.settings.gravitateTowardsCamera){var y=-100;v.x>w.x&&(y=100);m[p].c.tox=v.x-y;m[p].c.toy=0;m[p].c.toz=v.z-
100;y=x.position.x-m[p].c.tox;var A=x.position.y-m[p].c.toy,B=x.position.z-m[p].c.toz;y=1E3+Math.abs(y*y+A*A+B*B)/25;x.position.y=v.y+50;x.rotation.x=Math.random()*Math.PI+Math.PI/2;x.rotation.y=Math.random()*Math.PI;x.rotation.z=Math.random()*Math.PI+Math.PI/2;x.scale.x=x.scale.y=x.scale.z=1.25;(new TWEEN.Tween(x.position)).to({x:m[p].c.tox,y:m[p].c.toy,z:m[p].c.toz},y).easing(TWEEN.Easing.Linear.EaseNone).start();(new TWEEN.Tween(x.rotation)).to({x:0,z:0},y).easing(TWEEN.Easing.Quadratic.EaseIn).start();
(new TWEEN.Tween(x.scale)).to({x:5,y:0.05,z:5},y).easing(TWEEN.Easing.Linear.EaseNone).start()}x.materials[0].opacity=o.settings.zeroAlphaStart?0:1}else{y=m[p].alivetime;if(!o.settings.gravitateTowardsCamera){x.position.y+=0.1;x.rotation.y+=0.015;x.rotation.z+=0.01;x.scale.x=x.scale.y=x.scale.z=0.5+Math.max(y/15,1)}y=o.settings.zeroAlphaStart?y/4:1-y/(m.length*2);y=Math.min(y,1);x.materials[0].opacity=y}}};this.reset=function(u,v,w){for(var x=0;x<m.length;++x){var y=m[x].c;y.position.x=u;y.position.y=
v;y.position.z=w}}},AnimalSwarm=function(b,f){var c=this;c.array=[];new THREE.Vector3;var d=0;c.initSettings={numOfAnimals:b||30};c.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1,respawn:!0,avoidCamera:!1,killAtDistance:!1};var g;this.addAnimal=function(h,n,o,m,p,u){n=n||null;var v=o||1.2;m=m||null;for(g=0;g<c.initSettings.numOfAnimals;++g)if(!(n==
null&&c.array[g]!=undefined||n!=c.array[g])){p==null&&(p=[1]);var w=u?ROME.Animal_old(h,!1):ROME.Animal(h,!1),x=w.mesh;x.position.copy(c.settings.startPosition);o=0.02+Math.random()/8;g<2&&(o=0.15);o=Math.max(o,0.1);x.matrixAutoUpdate=!1;x.visible=!1;f.addChild(x);var y=0,A=0;if(m!=null){y=m[g%m.length]%w.availableAnimals.length;A=y+1;if(Math.round(Math.random())==1&&y>0||A>w.availableAnimals.length-1)A=y-1}var B=p[y],C=p[A];w.play(w.availableAnimals[y],w.availableAnimals[A],0,Math.random(),Math.random());
var E=Math.random();g<2&&(E=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);o={c:x,a:w,f:g,keepRunning:!1,time:0,lifetime:0,dead:!1,startMorph:y,endMorph:A,speeda:B,speedb:C,toPosition:new THREE.Vector3,active:!1,normal:new THREE.Vector3(0,1,0),count:E,scale:o*v,origscale:o*v,ray:ray,rayIndex:g%2,lastToy:0,sockPuppetSpecialCase:u,generalSpecialCase:!1};c.array[g]=o}return w};this.removeAnimal=function(h,n){for(g=0;g<c.initSettings.numOfAnimals;++g){var o=c.array[g].a;if(o!=undefined){var m=
c.array[g].startMorph,p=c.array[g].endMorph;if(o.mesh.geometry==h&&(n==m||n==p)){f.removeChild(c.array[g].c);delete c.array[g].a;c.array[g].active=!1;break}}}};this.switchAnimal=function(h,n,o,m,p){var u=n||1.2;for(g=0;g<c.initSettings.numOfAnimals;++g){p!=undefined&&(g=p);n=c.array[g].a;var v=c.array[g].startMorph,w=c.array[g].endMorph;if(!(n!=undefined&&n.mesh.geometry==h&&p==undefined&&(v==m||w==m))){console.log("adding on "+g);p=c.array[g].c.position;h=ROME.Animal(h,!1);v=h.mesh;n=0.02+Math.random()/
8;g<2&&(n=0.15);n=Math.max(n,0.1);v.position=p;v.visible=!1;v.scale.set(1.0E-5,1.0E-5,1.0E-5);v.updateMatrix();v.matrixAutoUpdate=!1;f.removeChild(c.array[g].c);f.addChild(v);h.play(h.availableAnimals[m],h.availableAnimals[m],0,Math.random(),Math.random());c.array[g].c=v;c.array[g].a=h;c.array[g].scale=n*u;c.array[g].origscale=n*u;c.array[g].speeda=o;c.array[g].speedb=o;c.array[g].active=!1;c.array[g].startMorph=m;c.array[g].endMorph=m;break}}};this.create=function(h,n,o){for(g=0;g<c.initSettings.numOfAnimals;++g)if(!(c.array[g].active||
c.array[g].a==undefined)){c.array[g].active=!0;c.array[g].c.position.copy(h);c.array[g].normal.copy(n);c.array[g].c.visible=!0;c.array[g].f=0;c.array[g].time=0;c.array[g].lifetime=0;c.array[g].dead=!1;c.array[g].scale=c.array[g].origscale;c.array[g].keepRunning=!1;c.array[g].gravity=0;c.array[g].count=1;if(!c.settings.respawn)c.array[g].f=g;if(o!=undefined){c.array[g].keepRunning=!0;c.array[g].toPosition.copy(o)}c.array[g].scale*=0.25;(new TWEEN.Tween(c.array[g])).to({scale:c.array[g].origscale},
400).easing(TWEEN.Easing.Linear.EaseNone).start();h=180;o!=undefined&&(h=350);o=c.array[g].origscale;c.array[g].c.position.x-=n.x*o*h;c.array[g].c.position.y-=n.y*o*h;c.array[g].c.position.z-=n.z*o*h;c.array[g].lastToy=c.array[g].c.position.y;break}};this.update=function(h,n,o){if(isNaN(h)||h>1E3||h==0)h=1E3/60;++d;for(g=0;g<c.initSettings.numOfAnimals;++g){var m=c.array[g];if(m.active){n=m.c;var p=m.scale,u=m.normal,v=c.array[g].dead;c.array[g].time+=h;c.array[g].lifetime+=h;if(c.array[g].lifetime>
2500&&c.settings.respawn)c.array[g].dead=!0;c.array[g].count+=0.06;var w=Math.max(Math.cos(c.array[g].count)-0.5,0);w=Math.min(w,1);c.array[g].a.morph=w;var x=m.speeda;if(Math.round(w)==1)x=m.speedb;w=n.position.x+c.array[g].toPosition.x*20;var y=n.position.y+c.array[g].toPosition.y*20,A=n.position.z+c.array[g].toPosition.z*20;if(c.settings.capy!=null&&y<c.settings.capy)y=c.settings.capy;if(c.settings.flying){c.array[g].toPosition.y+=0.12;y=c.array[g].toPosition.y+c.settings.flyingDistance}if(c.settings.constantSpeed!=
null){c.array[g].a.animalA.timeScale=c.settings.constantSpeed;c.array[g].a.animalB.timeScale=c.settings.constantSpeed}if(c.settings.shootRayDown)if(c.array[g].rayIndex==d%2){m=m.ray;m.origin.copy(n.position);m.origin.y+=500;var B=f.collisions.rayCastNearest(m);if(B){y=m.origin.y-(B.distance*1+3);u=B.mesh.matrixRotationWorld.multiplyVector3(B.normal).normalize();c.array[g].lastToy=y;c.array[g].normal.copy(u)}}else y=c.array[g].lastToy;B=m=17;if(c.array[g].keepRunning){m=4;B=Math.abs(y-n.position.y)>
10?m/2:m*2}c.settings.flying&&(B=8);if(c.array[g].dead){if(c.settings.flying)y+=10;else{y-=u.y*3;w-=u.x*3;A-=u.z*3}B=20}w=(w-n.position.x)/m;y=(y-n.position.y)/B;A=(A-n.position.z)/m;if(c.settings.killAtDistance){m=n.position.x-o.x;B=n.position.y-o.y;var C=n.position.z-o.z;if(Math.abs(m*m+B*B+C*C)>25E3)c.array[g].dead=!0}c.array[g].dead&&!v&&(new TWEEN.Tween(c.array[g])).to({scale:c.array[g].scale*0.01},600).easing(TWEEN.Easing.Quartic.EaseIn).start();if(c.array[g].dead&&p<=0.0050){c.array[g].active=
!1;c.array[g].c.visible=!1}else{v=x/20;isNaN(v)&&(v=1);if(!c.array[g].keepRunning){y>v&&(y=v);y<-v&&(y=-v)}w>v&&(w=v);w<-v&&(w=-v);A>v&&(A=v);A<-v&&(A=-v);v=new THREE.Vector3(n.position.x+w,n.position.y+y,n.position.z+A);v.subSelf(n.position).normalize();x=new THREE.Vector3;u=new THREE.Vector3(u.x*-1,u.y*-1,u.z*-1);if(c.settings.flying||c.settings.gravity)u=new THREE.Vector3(0,-1,0);x.cross(v,u);u.cross(v,x);n.matrixWorld.n11=x.x*p;n.matrixWorld.n12=u.x*p;n.matrixWorld.n13=v.x*p;n.matrixWorld.n14=
n.position.x;n.matrixWorld.n21=x.y*p;n.matrixWorld.n22=u.y*p;n.matrixWorld.n23=v.y*p;n.matrixWorld.n24=n.position.y;n.matrixWorld.n31=x.z*p;n.matrixWorld.n32=u.z*p;n.matrixWorld.n33=v.z*p;n.matrixWorld.n34=n.position.z;n.position.x+=w;n.position.y+=y;n.position.z+=A}}}};this.reset=function(h,n,o){for(var m=0;m<c.initSettings.numOfAnimals;++m){var p=c.array[m].c;p.position.x=h;p.position.y=n;p.position.z=o;c.array[m].active=!1}}},AnimalSwarm2=function(b,f){var c=this;c.array=[];new THREE.Vector3;c.initSettings=
{numOfAnimals:b||30};c.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:25,zPositionMultiplier:25,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var d;this.addAnimal=function(g,h,n,o,m,p){h=h||null;var u=n||1.2;o=o||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(h==null&&c.array[d]!=undefined||h!=c.array[d])){m==null&&(m=[1]);var v=p?ROME.Animal_old(g,!1):ROME.Animal(g,!1),w=v.mesh;w.position.copy(c.settings.startPosition);
n=0.02+Math.random()/8;d<2&&(n=0.15);n=Math.max(n,0.1);w.matrixAutoUpdate=!1;w.visible=!1;f.addChild(w);var x=0,y=0;if(o!=null){x=o[d%o.length]%v.availableAnimals.length;y=Math.floor(Math.random()*v.availableAnimals.length)}var A=m[x],B=m[y];v.play(v.availableAnimals[x],v.availableAnimals[y],0,Math.random(),Math.random());x=Math.random();d<2&&(x=0);ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);n={c:w,a:v,positionArray:[],normalArray:[],lifetime:0,dead:!1,speeda:A,speedb:B,active:!1,normal:new THREE.Vector3(0,
1,0),toNormal:new THREE.Vector3(0,1,0),toPosition:new THREE.Vector3,count:x,scale:n*u,origscale:n*u,ray:ray,sockPuppetSpecialCase:p};c.array[d]=n}};this.create=function(g,h,n){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=!0;c.array[d].c.position.copy(g);c.array[d].toNormal.copy(h);c.array[d].c.visible=!0;c.array[d].toPosition.copy(n);c.array[d].scale=0.01;c.array[d].positionArray=[];c.array[d].normalArray=[h];c.array[d].lifetime=0;c.array[d].dead=!1;if(c.settings.flying){c.array[d].toNormal.set(0,
1,0);c.array[d].normal.set(0,1,0)}(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},300).easing(TWEEN.Easing.Linear.EaseNone).start();g=c.array[d].origscale;c.array[d].c.position.x-=h.x*g*100;c.array[d].c.position.y-=h.y*g*100;c.array[d].c.position.z-=h.z*g*100;break}};this.update=function(g,h,n,o){if(isNaN(g)||g>1E3||g==0)g=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var m=c.array[d];if(m.active){c.array[d].positionArray.push(n);c.array[d].normalArray.push(o);var p=c.array[d].positionArray,
u=m.c,v=m.scale,w=m.toNormal,x=m.normal,y=m.toPosition,A=c.array[d].dead;c.array[d].lifetime+=g;if(c.array[d].lifetime>2500)c.array[d].dead=!0;var B=d*(Math.PI*2/6),C=Math.sin(B+(d-0)/8)*c.settings.zPositionMultiplier;B=y.x+Math.cos(B+(d-0)/8)*c.settings.xPositionMultiplier*(1-Math.abs(x.x));var E=y.y+C*(1-Math.abs(x.y));C=y.z+C*(1-Math.abs(x.z));x.y>0.5&&(E=y.y-10);if(c.settings.capy!=null&&E<c.settings.capy)E=c.settings.capy;if(c.settings.flying){y=c.settings.flyingDistance;x.x<-0.8&&(B-=y);x.x>
0.8&&(B+=y);if(x.y<-0.8||x.y>0.8)E+=y;x.z<-0.8&&(C-=y);x.z>0.8&&(C+=y)}c.array[d].count+=0.04;var z=Math.max(Math.cos(c.array[d].count),0);z=Math.min(z,1);c.array[d].a.morph=z;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}y=m.speeda;if(Math.round(z)==1)y=m.speedb;z=8;c.array[d].sockPuppetSpecialCase&&(z=100);B=(B-u.position.x)/z;E=(E-u.position.y)/z;C=(C-u.position.z)/z;var H=(w.y-x.y)/z,G=(w.z-x.z)/
z;x.x+=(w.x-x.x)/z;x.y+=H;x.z+=G;m.normal=x;w=y;E>w&&(E=w);E<-w&&(E=-w);B>w&&(B=w);B<-w&&(B=-w);C>w&&(C=w);C<-w&&(C=-w);if(c.array[d].dead)if(c.settings.flying)E+=2;else{E-=x.y*2;B-=x.x*2;C-=x.z*2}if(u.position.x+B<h.x+40&&u.position.x+B>h.x-40&&u.position.z+C<h.z+40&&u.position.z+C>h.z-40)c.array[d].dead=!0;c.array[d].dead&&!A&&(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].scale*0.1},400).easing(TWEEN.Easing.Linear.EaseNone).start();if(c.array[d].dead&&v<=0.1){c.array[d].active=!1;c.array[d].c.visible=
!1}else{A=new THREE.Vector3(u.position.x+B,u.position.y+E,u.position.z+C);A.subSelf(u.position).normalize();w=new THREE.Vector3;x=new THREE.Vector3(x.x*-1,x.y*-1,x.z*-1);c.settings.flying&&(x=new THREE.Vector3(0,-1,0));w.cross(A,x);x.cross(A,w);u.matrixWorld.n11=w.x*v;u.matrixWorld.n12=x.x*v;u.matrixWorld.n13=A.x*v;u.matrixWorld.n14=u.position.x;u.matrixWorld.n21=w.y*v;u.matrixWorld.n22=x.y*v;u.matrixWorld.n23=A.y*v;u.matrixWorld.n24=u.position.y;u.matrixWorld.n31=w.z*v;u.matrixWorld.n32=x.z*v;u.matrixWorld.n33=
A.z*v;u.matrixWorld.n34=u.position.z;v=u.position.x-(u.position.x+B);x=u.position.y-(u.position.y+E);A=u.position.z-(u.position.z+C);if(Math.abs(v*v+x*x+A*A)<g/4&&p!=null&&p.length>0){p=c.array[d].positionArray.shift();v=c.array[d].normalArray.shift();m.toPosition.copy(p);m.toNormal.copy(v)}u.position.x+=B;u.position.y+=E;u.position.z+=C}}}};this.reset=function(g,h,n){for(var o=0;o<c.array.length;++o){var m=c.array[o].c;m.position.x=g;m.position.y=h;m.position.z=n;c.array[o].active=!1}}},AnimalSwarm_dunes=
function(b,f,c){var d=this;d.array=[];var g=0,h=0,n=0;d.initSettings={numOfAnimals:b||30};d.settings={divider:2,flying:!1,flyingDistance:35,xPositionMultiplier:30,zPositionMultiplier:30,constantSpeed:null,visible:!0,shootRayDown:!1,addaptiveSpeed:!1,capy:null,startPosition:new THREE.Vector3(0,0,0),switchPosition:!1};var o=0,m;this.addAnimal=function(p,u,v,w,x,y,A){u=u||null;var B=v||1.2;w=w||null;x=x||4;A=A||!1;for(m=0;m<d.initSettings.numOfAnimals;++m)if(!(u==null&&d.array[m]!=undefined||u!=d.array[m])){v=
new THREE.Color(Math.random()*16777215);y!=undefined&&y!=null&&(v=y[m%y.length]);var C=ROME.Animal(p,!1,v),E=C.mesh;E.position.set(d.settings.startPosition.x,d.settings.startPosition.y,d.settings.startPosition.z);E.updateMatrix();E.doubleSided=A;var z=Math.floor(m/x);v=0.02+Math.random()/8;if(m<2){v=0.15;z=m}z>g&&(g=z);v=Math.max(v,0.1);E.matrixAutoUpdate=!1;f.addChild(E);var H=0,G=0;if(w!=null){H=w[m%w.length]%C.availableAnimals.length;G=Math.floor(Math.random()*C.availableAnimals.length)}C.play(C.availableAnimals[H],
C.availableAnimals[G],0,Math.random(),Math.random());H=Math.random();m<2&&(H=0);G=m%2==0;ray=new THREE.Ray;ray.direction=new THREE.Vector3(0,-1,0);d.array[m]={c:E,a:C,f:z,count:H,clockwise:G,scale:v*B,ray:ray}}return C};this.switchAnimal=function(p,u,v,w,x){var y=u||1.2;for(m=0;m<d.initSettings.numOfAnimals;++m){x!=undefined&&(m=x);u=d.array[m].a;var A=d.array[m].startMorph,B=d.array[m].endMorph;if(!(u!=undefined&&u.mesh.geometry==p&&x==undefined&&(A==w||B==w))){x=d.array[m].c.position;p=ROME.Animal(p,
!1);A=p.mesh;u=0.02+Math.random()/8;m<2&&(u=0.15);u=Math.max(u,0.1);A.position=x;A.visible=!1;A.scale.set(1.0E-5,1.0E-5,1.0E-5);A.updateMatrix();A.matrixAutoUpdate=!1;f.removeChild(d.array[m].c);f.addChild(A);p.play(p.availableAnimals[w],p.availableAnimals[w],0,Math.random(),Math.random());d.array[m].c=A;d.array[m].a=p;d.array[m].scale=u*y;d.array[m].origscale=u*y;d.array[m].speeda=v;d.array[m].speedb=v;d.array[m].active=!1;d.array[m].startMorph=w;d.array[m].endMorph=w;d.array[m].scale=0.0010;v=d.array[m].origscale;
(new TWEEN.Tween(d.array[m])).to({scale:v},500).easing(TWEEN.Easing.Linear.EaseNone).start();break}}};this.update=function(p){o+=0.1;isNaN(p);h=Math.round(o/4);for(m=0;m<d.initSettings.numOfAnimals;++m){var u=d.array[m];p=u.c;var v=u.f,w=u.scale;u=u.clockwise;if(h!=n&&d.settings.switchPosition){if(u)++d.array[m].f;else--d.array[m].f;if(d.array[m].f>g){d.array[m].clockwise=!1;d.array[m].f=g}if(d.array[m].f<=0){d.array[m].clockwise=!0;d.array[m].f=0}v=d.array[m].f}u=m*(Math.PI*2/6);var x=Math.sin(u+
(m-o*2)/5)*d.settings.zPositionMultiplier;u=c[v].position.x+Math.cos(u+(m-o*2)/5)*d.settings.xPositionMultiplier;var y=c[v].position.y+x;x=c[v].position.z+x;d.array[m].count+=0.03;var A=Math.max(Math.cos(d.array[m].count),0);A=Math.min(A,1);d.array[m].a.morph=A;if(d.settings.constantSpeed!=null){d.array[m].a.animalA.timeScale=d.settings.constantSpeed;d.array[m].a.animalB.timeScale=d.settings.constantSpeed}u=(u-p.position.x)/10;y=(y-p.position.y)/10;x=(x-p.position.z)/10;A=new THREE.Vector3(p.position.x+
u,p.position.y+y,p.position.z+x);A.subSelf(p.position).normalize();var B=new THREE.Vector3;v=new THREE.Vector3(c[v].normal.x*-1,c[v].normal.y*-1,c[v].normal.z*-1);d.settings.flying&&(v=new THREE.Vector3(0,-1,0));B.cross(A,v);v.cross(A,B);p.matrixWorld.n11=B.x*w;p.matrixWorld.n12=v.x*w;p.matrixWorld.n13=A.x*w;p.matrixWorld.n14=p.position.x;p.matrixWorld.n21=B.y*w;p.matrixWorld.n22=v.y*w;p.matrixWorld.n23=A.y*w;p.matrixWorld.n24=p.position.y;p.matrixWorld.n31=B.z*w;p.matrixWorld.n32=v.z*w;p.matrixWorld.n33=
A.z*w;p.matrixWorld.n34=p.position.z;p.position.x+=u;p.position.y+=y;p.position.z+=x;p.visible=d.settings.visible}n=h};this.reset=function(p,u,v){for(var w=0;w<d.array.length;++w){var x=d.array[w].c;x.position.x=p;x.position.y=u;x.position.z=v}}},AnimalInFrontOfCamera=function(b,f){var c=this,d=[];c.initSettings={numOfAnimals:b||30};c.settings={};var g=0,h,n=new THREE.Cube(10,10,10),o=new THREE.Mesh(n);f.addChild(o);this.addAnimal=function(m){for(var p=0;p<c.initSettings.numOfAnimals;++p){var u=ROME.Animal(m,
!1),v=u.mesh,w=0.02+Math.random()/8,x=Math.random()*120-60,y=p*10-10,A=Math.random()*120-60;v.position.x=x;v.position.y=y;v.position.z=A;o.addChild(v);u.animalA.timeScale=0.8;u.animalB.timeScale=0.8;u.play(u.availableAnimals[0],u.availableAnimals[0],0,Math.random());d.push({c:v,x:x,y:y,z:A,a:u,scale:w*1.5})}};this.update=function(m,p,u,v){g+=0.1;o.position=m;if(!v){o.position.x-=Math.cos(p)*110;o.position.z-=Math.sin(p)*110}if(isNaN(u)||u>1E3)u=1E3/60;for(h=0;h<c.initSettings.numOfAnimals;++h){var w=
d[h];m=w.c;p=w.x;v=w.y;w=w.z;var x=Math.sin(h-g);p+=Math.cos(h-g);v+=0.5*(u/20);w+=x;v>140&&(v=-10);m.lookAt(new THREE.Vector3(p,v,w));m.position.x=p;m.position.y=v;m.position.z=w;d[h].x=p;d[h].y=v;d[h].z=w}}},Trail=function(b,f){var c=this;c.array=[];var d=!1,g=0,h=new THREE.Ray;h.direction=new THREE.Vector3(0,-1,0);c.initSettings={numOfInstances:b||100};c.settings={spread:70,visible:!0,aliveDivider:c.initSettings.numOfInstances,tweenTime:2500,scale:1,offsetAmount:6,freeRotation:!0,yscale:0.3,shootRayDown:!1};
var n;this.addInstance=function(o,m,p,u,v){m=m||null;p=p||!1;u=u||!1;for(n=0;n<c.initSettings.numOfInstances;++n)if(!(m==null&&c.array[n]!=undefined||m!=c.array[n])){var w=v==undefined?new THREE.Mesh(o,new THREE.MeshFaceMaterial):new THREE.Mesh(o,v[n%v.length]);w.scale.x=w.scale.y=w.scale.z=1.0E-8;var x={c:w,alivetime:n,normal:new THREE.Vector3,tree:p,lightHouse:u};f.addObject(w);c.array[n]=x}return w};this.switchGeometry=function(o){for(n=0;n<c.initSettings.numOfInstances;++n){var m=new THREE.Mesh(o[n%
o.length],new THREE.MeshFaceMaterial),p=new THREE.Vector3;p.copy(c.array[n].c.position);f.removeChild(c.array[n].c);f.addChild(m);m.position=p;c.array[n].c=m;m.scale.x=m.scale.y=m.scale.z=1.0E-8;m=c.settings.yscale*c.settings.scale;p=zscale=0.4*c.settings.scale;(new TWEEN.Tween(c.array[n].c.scale)).to({x:p,y:m,z:zscale},200).easing(TWEEN.Easing.Linear.EaseNone).start()}};this.update=function(o,m,p,u){if(isNaN(u)||u>1E3)u=1E3/60;g+=u;u/=c.settings.aliveDivider;for(n=0;n<c.array.length;++n){var v=c.array[n],
w=v.c,x=v.alivetime,y=v.tree;v=v.lightHouse;x+=u;if(x>c.initSettings.numOfInstances){if(v&&(d||g<4E3))continue;w.position.x=o.x;w.position.y=o.y;w.position.z=o.z;w.rotation.x=0;w.rotation.z=0;w.rotation.y=0;x=c.settings.offsetAmount;y&&(x=c.settings.offsetAmount+2);var A=0,B=0,C=0;if(c.settings.freeRotation){if(c.settings.shootRayDown){h.origin.copy(o);h.origin.y+=10;var E=f.collisions.rayCastNearest(h);if(E){w.position.y=h.origin.y-(E.distance*0.2-x);m.set(0,1,0)}}w.position.x=o.x-m.x*x;if(!c.settings.shootRayDown)w.position.y=
o.y-m.y*x;w.position.z=o.z-m.z*x;w.position.x+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(m.x));w.position.z+=(Math.random()*c.settings.spread-c.settings.spread/2)*(1-Math.abs(m.z));w.rotation.x=0;w.rotation.z=0;w.rotation.y=Math.random()*Math.PI;w.up.copy(m);w.lookAt(w.position)}else{if(m.x<-0.5){w.position.x=o.x+x/2;w.rotation.z=1.57;w.rotation.x=Math.random()*Math.PI;if(y){C=w.rotation.z+(Math.random()-0.5);w.rotation.z=0;A=w.rotation.x;B=w.rotation.y}w.position.y+=Math.random()*
c.settings.spread-c.settings.spread/2;w.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(m.x>0.5){w.position.x=o.x-x/2;w.rotation.z=-1.57;if(y){C=w.rotation.z+(Math.random()-0.5);w.rotation.z=0;A=w.rotation.x;B=w.rotation.y}w.rotation.x=Math.random()*Math.PI;w.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;w.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(m.y<-0.9){w.position.y=o.y+x;w.rotation.y=Math.random()*Math.PI;if(y){C=w.rotation.z+(Math.random()-
0.5);w.rotation.z=1.57;A=w.rotation.x;B=w.rotation.y}w.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;w.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(m.y>0.9){w.position.y=o.y-x;w.rotation.y=Math.random()*Math.PI;if(y){C+=w.rotation.z+(Math.random()-0.5);w.rotation.z=1.57;A=w.rotation.x;B=w.rotation.y}w.position.x+=Math.random()*c.settings.spread-c.settings.spread/2;w.position.z+=Math.random()*c.settings.spread-c.settings.spread/2}if(m.z<-0.5){w.position.z=o.z+
x/2;w.rotation.x=-1.57;w.rotation.y=Math.random()*Math.PI;if(y){A=w.rotation.x+(Math.random()-0.5);w.rotation.x=0;C=w.rotation.z;B=w.rotation.y}w.position.y+=Math.random()*c.settings.spread-c.settings.spread/2;w.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}if(m.z>0.5){w.position.z=o.z-x/2;w.rotation.x=1.57;w.rotation.y=Math.random()*Math.PI;if(y){A=w.rotation.x+(Math.random()-0.5);w.rotation.x=0;C=w.rotation.z;B=w.rotation.y}w.position.y+=Math.random()*c.settings.spread-c.settings.spread/
2;w.position.x+=Math.random()*c.settings.spread-c.settings.spread/2}}y&&(new TWEEN.Tween(w.rotation)).to({x:A,y:B,z:C},c.settings.tweenTime*2).easing(TWEEN.Easing.Elastic.EaseOut).start();if((y||v)&&w.position.x<p.x+60&&w.position.x>p.x-60){w.position.x=p.x+60;if(w.position.x<p.x)w.position.x=p.x-60}if((y||v)&&w.position.z<p.z+60&&w.position.z>p.z-60){w.position.z=p.z+60;if(w.position.z<p.z)w.position.z=p.z-60}w.scale.x=w.scale.y=w.scale.z=0.0010*c.settings.scale;x=zscale=yscale=0.1*c.settings.scale;
if(v){x=zscale=yscale=0.4*c.settings.scale;if(Math.abs(m.y)<0.9)continue;else{w.visible=!0;d=!0}}if(!y&&!v){yscale=c.settings.yscale*c.settings.scale;x=zscale=0.4*c.settings.scale}A=TWEEN.Easing.Quintic.EaseOut;if(y||v)A=TWEEN.Easing.Elastic.EaseOut;(new TWEEN.Tween(w.scale)).to({x:x,y:yscale,z:zscale},c.settings.tweenTime).easing(A).start();x=0}c.array[n].alivetime=x}}},CollisionScene=function(b,f,c,d,g,h){function n(W){W%=C;if(W>B)W-=C;else W<-B&&(W+=C);return W}function o(W,V,S,t,M,I,P,O,R){W=
new THREE.Mesh(W,R);W.scale.set(V,V,V);W.position.set(S,t,M);W.rotation.set(I,P,O);W.updateMatrix();m.settings.useOldRay?A.addObject(W):f.addObject(W);return W}var m=this;m.currentNormal=new THREE.Vector3(0,1,0);m.emitterNormal=new THREE.Vector3(0,1,0);m.distance=0;m.initSettings={};m.settings={useOldRay:h||!1,maxSpeedDivider:2,emitterDivider:5,cameraTargetDivider:10,capBottom:null,capTop:null,allowFlying:!1,collisionDistance:g||400,scale:c||1,shootRayDown:!1,keepEmitterFollowDown:!1,normalOffsetAmount:6,
minDistance:10,camera:b};var p=new THREE.Vector3(0,0,1),u=new THREE.Ray,v=new THREE.Matrix4,w=new THREE.Matrix4,x=new THREE.Vector3,y=new THREE.Projector,A=new THREE.Scene;b=new THREE.Cube(5,5,5);m.emitter=o(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:16777011,opacity:0.4}));m.emitterFollow=o(b,1,d.camPos.x,d.camPos.y,d.camPos.z,0,0,0,new THREE.MeshBasicMaterial({color:3407871,opacity:0.4}));m.emitter.visible=!1;m.emitterFollow.visible=!1;var B=Math.PI,C=B*2,E=B/
180;m.emitterFollow.rotationx=0;m.emitterFollow.rotationy=0;m.emitterFollow.rotationz=0;b=new THREE.Cube(5E4,5E4,10,1,1,1);c=new THREE.MeshLambertMaterial({color:255,opacity:0.2});var z=new THREE.Mesh(b,c),H=new THREE.Mesh(b,c);b=new THREE.Cube(10,5E4,5E4,1,1,1);var G=new THREE.Mesh(b,c),F=new THREE.Mesh(b,c);b=new THREE.Cube(5E4,10,5E4,1,1,1);var T=new THREE.Mesh(b,c),$=new THREE.Mesh(b,c);if(m.settings.useOldRay){A.addObject(z);A.addObject(H);A.addObject(G);A.addObject(F);A.addObject(T);A.addObject($)}this.addLoaded=
function(W,V,S,t){var M=new THREE.MeshLambertMaterial({color:16711935,opacity:1});W=new THREE.Mesh(W,M);W.scale.x=W.scale.y=W.scale.z=V;W.rotation=S||new THREE.Vector3;W.position=t||new THREE.Vector3;A.addObject(W)};this.update=function(W,V){if(m.settings.useOldRay){F.position.x=W.x+m.settings.collisionDistance;G.position.x=W.x-m.settings.collisionDistance;F.position.z=W.z;F.position.y=W.y;G.position.z=W.z;G.position.y=W.y;z.position.z=W.z-m.settings.collisionDistance;H.position.z=W.z+m.settings.collisionDistance;
z.position.x=W.x;z.position.y=W.y;H.position.x=W.x;H.position.y=W.y;$.position.y=W.y-m.settings.collisionDistance;T.position.y=W.y+m.settings.collisionDistance;$.position.x=W.x;$.position.z=W.z;T.position.x=W.x;T.position.z=W.z;if(m.settings.capBottom!=null&&$.position.y<m.settings.capBottom)$.position.y=m.settings.capBottom;if(m.settings.capTop!=null&&T.position.y<m.settings.capTop)T.position.y=m.settings.capTop}if(m.settings.useOldRay){var S=new THREE.Vector3(d.mouse.x/d.screenWidth*2-1,-(d.mouse.y/
d.screenHeight)*2+1,0.5);y.unprojectVector(S,m.settings.camera);var t=new THREE.Ray(W,S.subSelf(W).normalize()),M=t.intersectScene(A);if(M.length>0)for(var I=0;I<M.length;++I)if((S.z<0?M[I].point.z<W.z:M[I].point.z>W.z)&&M[I].object!=m.emitter&&M[I].object!=m.emitterFollow){m.emitter.position=M[I].point;t=M[I].object.matrixRotationWorld.multiplyVector3(M[I].face.normal.clone());m.emitterNormal=t;m.currentNormal=t;if(M[I].object==F||M[I].object==z||M[I].object==H||M[I].object==G||M[I].object==T){m.emitterNormal.x=
0;m.emitterNormal.y=1;m.emitterNormal.z=0;m.currentNormal.x=0;m.currentNormal.y=1;m.currentNormal.z=0;if(!m.settings.allowFlying)m.emitter.position.y=$.position.y+5}break}}else{p.x=d.mouse.x/d.screenWidth*2-1;p.y=-(d.mouse.y/d.screenHeight)*2+1;p.z=1;u.origin.copy(p);v.copy(m.settings.camera.matrixWorld);v.multiplySelf(THREE.Matrix4.makeInvert(m.settings.camera.projectionMatrix,w));v.multiplyVector3(u.origin);u.direction.copy(u.origin);u.direction.subSelf(W);if((M=f.collisions.rayCastNearest(u))&&
M.distance>m.settings.minDistance){I=M.distance*m.settings.scale;if(I>m.settings.collisionDistance)I=m.settings.collisionDistance}else{M={mesh:F};I=m.settings.collisionDistance}m.distance=I;x.copy(u.origin);x.addSelf(u.direction.multiplyScalar(I));m.emitter.position=x;if(M.normal!=undefined){t=M.mesh.matrixRotationWorld.multiplyVector3(M.normal).normalize();m.currentNormal=t;m.emitterNormal=t}if(M.mesh==F||M.mesh==z||M.mesh==H||M.mesh==G||M.mesh==T||M.mesh==$){m.currentNormal.set(0,1,0);if(!m.settings.allowFlying&&
!m.settings.shootRayDown)m.emitter.position.y=$.position.y;if(m.settings.shootRayDown){u.origin.copy(m.emitter.position);u.direction.set(0,-1,0);if((M=f.collisions.rayCastNearest(u))&&M.distance!==-1){m.emitter.position.y-=M.distance*m.settings.scale;t=M.mesh.matrixRotationWorld.multiplyVector3(M.normal).normalize();m.currentNormal=t}else{m.emitter.position.y=-m.settings.collisionDistance;m.currentNormal.set(0,1,0)}}}m.emitter.position.x+=m.currentNormal.x*m.settings.normalOffsetAmount;m.emitter.position.y+=
m.currentNormal.y*m.settings.normalOffsetAmount;m.emitter.position.z+=m.currentNormal.z*m.settings.normalOffsetAmount}if(isNaN(V)||V>1E3||V==0)V=1E3/60;M=V/m.settings.maxSpeedDivider;if(m.settings.useOldRay){if(m.currentNormal.y>0.5||m.currentNormal.y<-0.5){S=t=m.emitterFollow.rotationy/180*B;t+=B*0-B*0*Math.random();var P=m.emitter.position.x;I=m.emitter.position.z;P-=m.emitterFollow.position.x;var O=I-m.emitterFollow.position.z;I=Math.sqrt(P*P+O*O);P=Math.atan2(O,P);var R=0;O=(I-4)/4;O>1&&(O=1);
O>0&&(R+=(1-R)*O*O);t+=n(P-t)*R;P=t-S;Math.abs(P)>12*E&&(t=S+12*E*(P<0?-1:1));I/=4;I>M&&(I=M);m.emitterFollow.position.x+=Math.cos(t)*I;m.emitterFollow.position.z+=Math.sin(t)*I;m.emitterFollow.rotationy=t/E;t=m.emitter.position.y;t=(t-m.emitterFollow.position.y)/m.settings.emitterDivider;t>M&&(t=M);t<-M&&(t=-M);m.emitterFollow.position.y+=t}if(m.currentNormal.x>0.5||m.currentNormal.x<-0.5){S=t=m.emitterFollow.rotationx/180*B;t+=B*0-B*0*Math.random();R=m.emitter.position.y;I=m.emitter.position.z;
R-=m.emitterFollow.position.y;O=I-m.emitterFollow.position.z;I=Math.sqrt(O*O+R*R);P=Math.atan2(O,R);R=0;O=(I-4)/4;O>1&&(O=1);O>0&&(R+=(1-R)*O*O);t+=n(P-t)*R;P=t-S;Math.abs(P)>12*E&&(t=S+12*E*(P<0?-1:1));I/=4;I>M&&(I=M);m.emitterFollow.position.y+=Math.cos(t)*I;m.emitterFollow.position.z+=Math.sin(t)*I;m.emitterFollow.rotationx=t/E;I=m.emitter.position.x;I=(I-m.emitterFollow.position.x)/m.settings.emitterDivider;I>M&&(I=M);I<-M&&(I=-M);m.emitterFollow.position.x+=I}if(m.currentNormal.z>0.5||m.currentNormal.z<
-0.5){S=t=m.emitterFollow.rotationz/180*B;t+=B*0-B*0*Math.random();P=m.emitter.position.x;R=m.emitter.position.y;P-=m.emitterFollow.position.x;R-=m.emitterFollow.position.y;I=Math.sqrt(P*P+R*R);P=Math.atan2(P,R);R=0;O=(I-4)/4;O>1&&(O=1);O>0&&(R+=(1-R)*O*O);t+=n(P-t)*R;P=t-S;Math.abs(P)>12*E&&(t=S+12*E*(P<0?-1:1));I/=4;I>M&&(I=M);m.emitterFollow.position.y+=Math.cos(t)*I;m.emitterFollow.position.x+=Math.sin(t)*I;m.emitterFollow.rotationz=t/E;S=m.emitter.position.z;S=(S-m.emitterFollow.position.z)/
m.settings.emitterDivider;S>M&&(S=M);S<-M&&(S=-M);m.emitterFollow.position.z+=S}}else{I=m.emitter.position.x;I=(I-m.emitterFollow.position.x)/m.settings.emitterDivider;t=m.emitter.position.y;t=(t-m.emitterFollow.position.y)/m.settings.emitterDivider;S=m.emitter.position.z;S=(S-m.emitterFollow.position.z)/m.settings.emitterDivider;t>M&&(t=M);t<-M&&(t=-M);I>M&&(I=M);I<-M&&(I=-M);S>M&&(S=M);S<-M&&(S=-M);m.emitterFollow.position.x+=I;m.emitterFollow.position.y+=t;m.emitterFollow.position.z+=S}if(m.settings.keepEmitterFollowDown&&
!m.settings.useOldRay){m.emitterFollow.position.y=m.emitter.position.y+m.settings.collisionDistance;u.origin.copy(m.emitterFollow.position);u.direction.set(0,-1,0);if(M=f.collisions.rayCastNearest(u)){m.emitterFollow.position.y-=M.distance*m.settings.scale-m.settings.normalOffsetAmount;t=M.mesh.matrixRotationWorld.multiplyVector3(M.normal).normalize();m.currentNormal=t}}if(m.settings.useOldRay){S=new THREE.Vector3;t=new THREE.Ray(m.emitterFollow.position,S);P=1E4;R=m.emitterFollow.position;var ca,
U;S.set(-1,0,0);t.direction=S;M=t.intersectScene(A);if(M.length>0)for(I=0;I<M.length;++I)if(M[I].object!=m.emitter&&M[I].object!=G&&M[I].object!=F){if(M[I].distance<P){P=M[I].distance;R=M[I].point;U=M[I].face;ca=M[I].object}break}S.set(1,0,0);t.direction=S;M=t.intersectScene(A);if(M.length>0)for(I=0;I<M.length;++I)if(M[I].object!=m.emitter&&M[I].object!=G&&M[I].object!=F){if(M[I].distance<P){P=M[I].distance;R=M[I].point;U=M[I].face;ca=M[I].object}break}S.set(0,-1,0);t.direction=S;M=t.intersectScene(A);
if(M.length>0)for(I=0;I<M.length;++I)if(M[I].object!=m.emitter&&M[I].object!=T){if(M[I].distance<P){P=M[I].distance;R=M[I].point;U=M[I].face;ca=M[I].object}break}S.set(0,0,-1);t.direction=S;M=t.intersectScene(A);if(M.length>0)for(I=0;I<M.length;++I)if(M[I].object!=m.emitter&&M[I].object!=z&&M[I].object!=H){if(M[I].distance<P){P=M[I].distance;R=M[I].point;U=M[I].face;ca=M[I].object}break}S.set(0,0,1);t.direction=S;M=t.intersectScene(A);if(M.length>0)for(I=0;I<M.length;++I)if(M[I].object!=m.emitter&&
M[I].object!=z&&M[I].object!=H){if(M[I].distance<P){R=M[I].point;U=M[I].face;ca=M[I].object}break}m.emitterFollow.position=R;if(ca!=undefined){t=ca.matrixRotationWorld.multiplyVector3(U.normal.clone());m.currentNormal=t}d.renderer.render(A,m.settings.camera);d.renderer.clear()}};this.reset=function(W,V,S){m.emitter.position.set(W,V,S);m.emitterFollow.position.set(W,V,S)}};
ROME.TrailShaderUtils=function(){var b={},f,c,d,g,h,n=-9999999,o=-9999999,m=9999999,p=9999999,u,v;b.setMaterials=function(y,A,B,C){d=A;c=B;h=C;g=h.getContext();f=g.createTexture();g.bindTexture(g.TEXTURE_2D,f);g.texImage2D(g.TEXTURE_2D,0,g.RGB,d,d,0,g.RGB,g.UNSIGNED_BYTE,null);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,
g.NEAREST);ROME.TrailShader.textures.trailMap=new THREE.Texture;ROME.TrailShader.textures.trailMap.needsUpdate=!1;ROME.TrailShader.textures.trailMap.__webglTexture=f;var E,z,H,G,F,T;A=0;for(B=y.length;A<B;A++){E=y[A];C=E.position.x;z=E.position.y;T=E.geometry.vertices;G=0;for(F=T.length;G<F;G++){H=T[G].position;E=H.x+C;H=H.y+z;n=Math.max(n,E);o=Math.max(o,H);m=Math.min(m,E);p=Math.min(p,H)}}u=n-m;v=o-p;var $,W;for(A=0;A<B;A++){E=y[A];C=E.position.x;z=E.position.y;T=E.geometry.vertices;$=ROME.TrailShader.attributes();
W=$.trailUV.value;G=0;for(F=T.length;G<F;G++){H=T[G].position;W.push(new THREE.Vector2((H.x+C-m)/u,(H.y+z-p)/v))}C=new THREE.MeshShaderMaterial({uniforms:ROME.TrailShader.uniforms,attributes:$,vertexShader:ROME.TrailShader.vertexShader,fragmentShader:ROME.TrailShader.fragmentShader});C.fog=!0;C.lights=!0;C.vertexColors=2;C.uniforms.trailMap.texture=ROME.TrailShader.textures.trailMap;C.uniforms.faceMap.texture=ROME.TrailShader.textures.faceMap;C.uniforms.lavaMap.texture=ROME.TrailShader.textures.lavaMap;
C.uniforms.lavaNoiseMap.texture=ROME.TrailShader.textures.lavaNoiseMap;C.uniforms.lavaMap.texture.wrapS=C.uniforms.lavaMap.texture.wrapT=THREE.Repeat;C.uniforms.lavaNoiseMap.texture.wrapS=C.uniforms.lavaNoiseMap.texture.wrapT=THREE.Repeat;E.materials[0]=C}};b.updateLava=function(y){ROME.TrailShader.uniforms.lavaTime.value+=y!==undefined?y:1};var w=NaN,x=NaN;b.setMarkAtWorldPosition=function(y,A){if(d&&y&&A){var B=(y-m)/u*d,C=(A-p)/v*d,E=c.image.width;if(B>=0&&B<d-E&&C>=0&&C<d-E){if(isNaN(w)){w=B;
x=C}var z=B-w,H=C-x,G=Math.sqrt(z*z+H*H)+1;z=E*z/G*0.8;H=E*H/G*0.8;g.bindTexture(g.TEXTURE_2D,f);var F=w,T=x;do{g.texSubImage2D(g.TEXTURE_2D,0,Math.floor(F),Math.floor(T),g.RGB,g.UNSIGNED_BYTE,c.image);F+=z;T+=H;G-=E*0.8}while(G>E);w=B;x=C}}};return b}();
ROME.TrailShader={init:function(){ROME.TrailShader.textures.faceMap=THREE.ImageUtils.loadTexture("/files/textures/PaintDubs.jpg");ROME.TrailShader.textures.lavaMap=THREE.ImageUtils.loadTexture("/files/textures/lava.jpg");ROME.TrailShader.textures.lavaNoiseMap=THREE.ImageUtils.loadTexture("/files/textures/Color_noise.jpg")},textures:{trailMap:undefined,faceMap:undefined,lavaMap:undefined,lavaNoiseMap:undefined},uniforms:{trailMap:{type:"t",value:0,texture:undefined},faceMap:{type:"t",value:1,texture:undefined},
lavaMap:{type:"t",value:2,texture:undefined},lavaNoiseMap:{type:"t",value:3,texture:undefined},lavaHeadPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},lavaTime:{type:"f",value:0},lavaUvScale:{type:"v2",value:new THREE.Vector2(50,50)},fogColor:{type:"c",value:new THREE.Color},fogDensity:{type:"f",value:0},enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},
pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},attributes:function(){return{trailUV:{type:"v2",boundTo:"vertices",value:[]}}},vertexShader:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 \t\tdirectionalLightColor    [ MAX_DIR_LIGHTS ];\nuniform vec3 \t\tdirectionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 \t\tpointLightColor   [ MAX_POINT_LIGHTS ];\nuniform vec3 \t\tpointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float\t \tpointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\nuniform vec3 \t\tambientLightColor;\nattribute\tvec2\ttrailUV;\nvarying \tvec2\tvUV;\nvarying \tvec2\tvPos;\nvarying \tvec2\tvTrailUV;\nvarying\tvec3\tvColor;\nvarying  \tvec4\tvLightWeighting;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvLightWeighting = vec4( ambientLightColor, 1.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting.xyz += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\nvUV = uv;\nvTrailUV = trailUV;\nvColor = color;\nvPos = position.xy;\ngl_Position = projectionMatrix * mvPosition;\n}",
fragmentShader:"uniform \tsampler2D \tfaceMap;\nuniform \tsampler2D \ttrailMap;\nuniform \tsampler2D \tlavaMap;\nuniform \tsampler2D \tlavaNoiseMap;\nuniform  \tvec2\t\tlavaUvScale;\nuniform  \tfloat\t\tlavaTime;\nuniform \tvec3 \t\tlavaHeadPosition;\nuniform \tvec3 \t\tfogColor;\nuniform \tfloat \t\tfogDensity;\nvarying \tvec2\t\tvUV;\nvarying \tvec2\t\tvPos;\nvarying \tvec2\t\tvTrailUV;\nvarying\tvec3\t\tvColor;\nvarying \tvec4 \t\tvLightWeighting;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( -fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\nvec4 lavaColor;\nfloat mixValue, f;\nfloat offsetU = sin( lavaTime * 10.0 ) * 0.002;\nfloat offsetV = cos( lavaTime * 11.0 ) * 0.002;\nvec2 uvOffsetA = vec2( offsetU, offsetV );\nvec2 uvOffsetB = vec2( -offsetU, offsetV );\nvec2 lookup;\ngl_FragColor = vec4( vColor, 1.0 ) * texture2D(faceMap, vUV);\nlookup = texture2D(lavaNoiseMap, vTrailUV * vec2(65.0)).rg;\nf = texture2D(trailMap, vTrailUV + vec2(0.01) * lookup).r;\nif( f > 0.5)\n{\nmixValue = abs((texture2D(lavaNoiseMap, vTrailUV.yx * vec2(40.0, -40.0)).r - 0.5));\nmixValue = max(max(1.0 - mixValue * 32.0, 0.0) * (lookup.r - 0.5) * 8.0, 0.0);\ngl_FragColor = vec4(mixValue) * texture2D( lavaMap, vTrailUV * vec2(200.0) - vec2( lavaTime * 2.5)) * texture2D(lavaNoiseMap, vTrailUV * vec2(10.0) - vec2( lavaTime * 2.5)).rrrr * vec4(2.0);\n}\ngl_FragColor = gl_FragColor * vLightWeighting;\ngl_FragColor.a = 1.0;\n}"};
var Stragglers=function(b,f){var c=this;c.array=[];c.initSettings={numOfAnimals:b||3};c.settings={divider:2,constantSpeed:null,addaptiveSpeed:!1,capy:null};var d;this.addAnimal=function(g,h,n,o,m){h=h||null;var p=n||1.2;o=o||null;for(d=0;d<c.initSettings.numOfAnimals;++d)if(!(h==null&&c.array[d]!=undefined||h!=c.array[d])){m==null&&(m=[1]);var u=ROME.Animal(g,!1),v=u.mesh;n=0.02+Math.random()/8;n=Math.max(n,0.1);v.matrixAutoUpdate=!1;v.visible=!1;f.addChild(v);var w=0,x=0;if(o!=null){w=o[d%o.length]%
u.availableAnimals.length;x=w+1;if(Math.round(Math.random())==1&&w>0||x>u.availableAnimals.length-1)x=w-1}var y=m[w],A=m[x];u.play(u.availableAnimals[w],u.availableAnimals[x],0,Math.random(),Math.random());x=Math.random();d<2&&(x=0);n={c:v,a:u,active:!1,startMorph:w,lifetime:0,speeda:y,speedb:A,normal:new THREE.Vector3(0,-1,0),position:new THREE.Vector3(0,0,0),toVector:new THREE.Vector3(0,0,0),count:x,scale:n*p,origscale:n*p};c.array[d]=n}};this.create=function(g,h,n){for(d=0;d<c.initSettings.numOfAnimals;++d)if(!c.array[d].active){c.array[d].active=
!0;c.array[d].position.copy(g);c.array[d].normal.copy(h);c.array[d].c.position.copy(g);c.array[d].c.visible=!0;c.array[d].toVector=n.subSelf(g).normalize();c.array[d].lifetime=0;c.array[d].toVector.x*=1-Math.abs(h.x);c.array[d].toVector.y*=1-Math.abs(h.y);c.array[d].toVector.z*=1-Math.abs(h.z);c.array[d].toVector.z=Math.random();c.array[d].toVector.x=Math.random()-0.5;c.array[d].scale=0.01;(new TWEEN.Tween(c.array[d])).to({scale:c.array[d].origscale},2500).easing(TWEEN.Easing.Elastic.EaseOut).start();
g=c.array[d].scale;c.array[d].c.position.x-=h.x*g*150;c.array[d].c.position.y-=h.y*g*150;c.array[d].c.position.z-=h.z*g*150;break}};this.update=function(g){if(isNaN(g)||g>1E3||g==0)g=1E3/60;for(d=0;d<c.initSettings.numOfAnimals;++d){var h=c.array[d];if(h.active){var n=h.c,o=h.scale,m=h.normal,p=h.position,u=h.toVector;c.array[d].lifetime+=g;if(c.array[d].lifetime>4E3){c.array[d].active=!1;c.array[d].c.visible=!1}else{var v=p.x+u.x*10,w=p.y+u.y*10,x=p.z+u.z*10;m.y>0.5&&(w-=10);if(c.settings.capy!=
null&&w<c.settings.capy){w=c.settings.capy;m.set(0,1,0)}c.array[d].count+=0.03;p=Math.max(Math.cos(c.array[d].count),0);p=Math.min(p,1);c.array[d].a.morph=p;if(c.settings.constantSpeed!=null){c.array[d].a.animalA.timeScale=c.settings.constantSpeed;c.array[d].a.animalB.timeScale=c.settings.constantSpeed}var y=h.speeda;if(Math.round(p)==1)y=h.speedb;h=(v-n.position.x)/5;p=(w-n.position.y)/5;u=(x-n.position.z)/5;p>y&&(p=y);p<-y&&(p=-y);h>y&&(h=y);h<-y&&(h=-y);u>y&&(u=y);u<-y&&(u=-y);v=new THREE.Vector3(v,
w,x);v.subSelf(n.position).normalize();w=new THREE.Vector3;m=new THREE.Vector3(m.x*-1,m.y*-1,m.z*-1);w.cross(v,m);m.cross(v,w);n.matrixWorld.n11=w.x*o;n.matrixWorld.n12=m.x*o;n.matrixWorld.n13=v.x*o;n.matrixWorld.n14=n.position.x;n.matrixWorld.n21=w.y*o;n.matrixWorld.n22=m.y*o;n.matrixWorld.n23=v.y*o;n.matrixWorld.n24=n.position.y;n.matrixWorld.n31=w.z*o;n.matrixWorld.n32=m.z*o;n.matrixWorld.n33=v.z*o;n.matrixWorld.n34=n.position.z;n.position.x+=h;n.position.y+=p;n.position.z+=u;c.array[d].position.copy(n.position)}}}};
this.reset=function(g,h,n){for(var o=0;o<c.array.length;++o){var m=c.array[o].c;m.position.x=g;m.position.y=h;m.position.z=n;c.array[o].active=!1;c.array[o].c.visible=!1}}},VideoPlane=function(b,f,c){var d,g,h,n,o,m=!1,p=!1,u=f.path.match("png$")||f.path.match("jpg$"),v=f.bendForce||400,w=new PolyTrail;this.params={radius:0.95,trail:5,random:0.23,bulge:0.7,polyDetail:0.55,softEdge:0.77,softTail:0};var x=f.fps||20;this.locked=f.locked;this.path=f.path;this.removed=!1;this.removeAt=f.removeAt||1;if(u)g=
THREE.ImageUtils.loadTexture(f.path);else{VideoLoadRegister[f.path]=1;d=document.createElement("video");d.src=f.path;d.preload="auto";d.load();b.signals.loadItemAdded.dispatch();d.addEventListener("canplaythrough",function(){if(VideoLoadRegister[f.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[f.path]=2}},!1);setTimeout(function(){if(VideoLoadRegister[f.path]==1){b.signals.loadItemCompleted.dispatch();VideoLoadRegister[f.path]=2}},1E4);g=new THREE.Texture(d);g.minFilter=THREE.LinearFilter;
g.magFilter=THREE.LinearFilter}switch(f.shaderId){case VIDEO_OPAQUE:n=VideoShaderSource.opaque;break;case VIDEO_OPAQUE_DISTORT:n=VideoShaderSource.distortOpaque;m=!0;break;case VIDEO_KEYED_DISTORT:n=VideoShaderSource.distortKeyed;m=!0;p=!0;break;case VIDEO_HALFALPHA:n=VideoShaderSource.halfAlpha;break;case VIDEO_SMARTALPHA:n=VideoShaderSource.smartAlpha;break;case VIDEO_SMARTALPHA_DISTORT:n=VideoShaderSource.distortSmartalpha;m=!0;break;case VIDEO_KEYED_INVERSE:n=VideoShaderSource.keyedInverse;p=
!0;break;default:n=VideoShaderSource.keyed;p=!0}var y=THREE.UniformsUtils.clone(n.uniforms);y.map.texture=g;if(m){y.mouseXY.value=new THREE.Vector2(0,0);y.aspect.value=c.aspect;y.mouseSpeed.value=1;y.mouseRad.value=1}if(p){y.colorScale.value=f.colorScale;y.threshold.value=f.threshold;y.alphaFadeout.value=f.alphaFadeout}o=new THREE.MeshShaderMaterial({uniforms:y,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,depthTest:!1});if(!f.width)f.width=m?1.104:1;if(!f.height)f.height=m?1.24:1;n=
m?c.grid:f.paralax?new THREE.Plane(1,1,50,10):new THREE.Plane(1,1,1,1);if(f.paralax)for(var A=0;A<n.vertices.length;++A){p=Math.sin((n.vertices[A].position.x+0.5)*Math.PI);n.vertices[A].position.z=(1-p)*v*f.width;n.vertices[A].position.y*=1+(1-p)*0.35*f.height}this.mesh=new THREE.Mesh(n,o);this.mesh.scale.x=f.width;this.mesh.scale.y=f.height;this.mesh.position.z=f.z;this.mesh.position.y=f.y||0;this.mesh.scale.x*=Math.abs(f.z)*c.adj*c.aspect;this.mesh.scale.y*=Math.abs(f.z)*c.adj;this.start=function(B,
C,E){w.set(-C*c.aspect,-E);if(!u){try{d.currentTime=d.duration*B}catch(z){}d.play();g.needsUpdate=!0;h=setInterval(function(){if(d.readyState===d.HAVE_ENOUGH_DATA)g.needsUpdate=!0},1E3/x)}};this.stop=function(){if(!u){d.pause();try{d.currentTime=0}catch(B){}clearInterval(h)}};this.update=function(B,C,E){if(m){w.target.x=-B*c.aspect;w.target.y=-C;w.update();for(A=0;A<=4;A++){o.uniforms["trail"+A].value.x=this.params.polyDetail*w.s[A*2*this.params.trail].x;o.uniforms["trail"+A].value.y=this.params.polyDetail*
w.s[A*2*this.params.trail].y+1.0E-4*A}o.uniforms.mouseXY.value.x=-B*c.aspect;o.uniforms.mouseXY.value.y=-C;o.uniforms.mouseSpeed.value=E;o.uniforms.mouseRad.value=this.params.radius;o.uniforms.polyRandom.value=this.params.random;o.uniforms.polyDetail.value=this.params.polyDetail;o.uniforms.bulge.value=this.params.bulge;o.uniforms.softEdge.value=this.params.softEdge}}};function PolyTrail(){this.target=new THREE.Vector2;this.s=[];for(var b=0;b<=50;b++)this.s[b]=new THREE.Vector2}
PolyTrail.prototype.set=function(b,f){for(var c=50;c>=0;c-=1)this.s[c]=new THREE.Vector3(b,f,0)};PolyTrail.prototype.update=function(){for(var b=50;b>0;b-=1){this.s[b].x=this.s[b-1].x;this.s[b].y=this.s[b-1].y}this.s[0].x=this.target.x;this.s[0].y=this.target.y};
var VideoLoadRegister={},VIDEO_OPAQUE=1,VIDEO_HALFALPHA=2,VIDEO_OPAQUE_DISTORT=3,VIDEO_KEYED=4,VIDEO_KEYED_DISTORT=5,VIDEO_KEYED_INVERSE=6,VIDEO_SMARTALPHA=7,VIDEO_SMARTALPHA_DISTORT=8,VideoPlayer=function(b,f){var c=this,d=(new Date).getTime();SequencerItem.call(this);var g=new THREE.Color(0),h={},n=[],o=!1,m,p,u=b.renderer,v=b.renderTarget,w=0,x=0,y=0,A=0,B=0,C=0,E=1,z;this.duration=f[0].duration;this.init=function(){h.prx=f[0].paralaxHorizontal||0;h.pry=f[0].paralaxVertical||0;h.tgd=f[0].targetDistance||
1500;onGrid=function(H){h.grid=H;c.onLoad()};gridLoader=new THREE.JSONLoader;gridLoader.load({model:"/files/models/VideoDistortGrid.js",callback:onGrid})};this.onLoad=function(){o=!0;b.signals.mousemoved.add(function(){w=b.mouse.x/b.screenWidth*-2+1;x=b.mouse.y/b.screenHeight*2-1});z=new THREE.Vector2(0,0);h.fov=54;h.aspect=2.35;h.adj=Math.tan(h.fov*Math.PI/360)*2;p=new THREE.Camera(h.fov,h.aspect,1,1E5);p.target.position=new THREE.Vector3(0,0,h.tgd*-1);p.updateMatrix();m=new THREE.Scene;m.addLight(new THREE.AmbientLight(0));
m.addObject(p);for(var H=0;H<f.length;H++){var G=new VideoPlane(b,f[H],h);n.push(G)}};this.show=function(H){for(var G=0;G<n.length;G++){var F=n[G];F.locked?p.addChild(F.mesh):m.addChild(F.mesh);F.start(H,w,x)}u.setClearColor(g)};this.hide=function(){for(var H=0;H<n.length;H++)n[H].stop()};this.update=function(H,G,F){F=(new Date).getTime();G=F-d;d=F;if(o){B=w;C=x;E+=(700*(Math.abs(Math.max(Math.min(B-y,0.05),-0.05)/G)+Math.abs(Math.max(Math.min(C-A,0.05),-0.05)/G))-E)/20;y=w;A=x;z.x=w*-2*h.prx;z.y=
x*-2*h.pry;z.x=Math.min(z.x,h.prx);z.x=Math.max(z.x,-h.prx);z.y=Math.min(z.y,h.pry);z.y=Math.max(z.y,-h.pry);p.target.position.x+=(z.x-p.target.position.x)*0.1;p.target.position.y+=(z.y-p.target.position.y)*0.1;for(G=0;G<n.length;G++){F=n[G];if(H>F.removeAt&&!F.removed){F.locked&&p.removeChild(F.mesh);m.removeChild(F.mesh);F.stop();F.removed=!0}else F.update(w,x,E,1)}u.render(m,p,v)}}};VideoPlayer.prototype=new SequencerItem;VideoPlayer.prototype.constructor=VideoPlayer;
var DistortUniforms={aspect:{type:"f",value:0},map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5},mouseXY:{type:"v2",value:new THREE.Vector2},trail0:{type:"v2",value:new THREE.Vector2},trail1:{type:"v2",value:new THREE.Vector2},trail2:{type:"v2",value:new THREE.Vector2},trail3:{type:"v2",value:new THREE.Vector2},trail4:{type:"v2",value:new THREE.Vector2},mouseSpeed:{type:"f",value:1},mouseRad:{type:"f",value:1},polyRandom:{type:"f",
value:1},polyDetail:{type:"f",value:1},bulge:{type:"f",value:1},softEdge:{type:"f",value:0}},DistortShaderFragmentPars="uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nuniform float softEdge;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distancePoly;\nvarying float distance;\nvarying vec2 closest;",DistortVertexShader="uniform vec2 mouseXY;\nuniform vec2 trail0;\nuniform vec2 trail1;\nuniform vec2 trail2;\nuniform vec2 trail3;\nuniform vec2 trail4;\nuniform float aspect;\nuniform float mouseSpeed;\nuniform float mouseRad;\nuniform float polyRandom;\nuniform float polyDetail;\nuniform float bulge;\nvarying vec2 vUv;\nvarying vec2 vUvPoly;\nvarying float distance;\nvarying float distancePoly;\nvarying vec2 closest;\nvec2 getClosest(vec2 p, vec2 l1, vec2 l2){\nvec2 pl1 = p - l1;\nvec2 l2l1 = l2 - l1;\nfloat dot = pl1.x * l2l1.x + pl1.y * l2l1.y;\nfloat len_sq = pow(length(l2l1),2.);\nfloat param = dot / len_sq;\nif(param < 0.) return l1;\nelse if(param > 1.) return l2;\nelse return (l1 + l2l1 * param);\n}\nfloat getDistance(vec2 p, vec2 li){\nreturn 1. - sqrt( (p.x-li.x)*(p.x-li.x) + (p.y-li.y)*(p.y-li.y) );\n}\nvoid main() {\nvUvPoly = uv+vec2(normal.x,normal.y);\nvUv = (uv-vec2(.5))/polyDetail+vec2(.5);\nvUvPoly = (vUvPoly-vec2(.5))/polyDetail+vec2(.5);\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position*(1./polyDetail), 1.0 );\nvec4 glPosPoly = projectionMatrix * modelViewMatrix * vec4( position-vec3(-normal.x,normal.y,0.), 1.0 );\nvec2 projPos = vec2(aspect,1.)*vec2(gl_Position.x/gl_Position.z,gl_Position.y/gl_Position.z);\nvec2 projPosPoly = vec2(aspect,1.)*vec2(glPosPoly.x/glPosPoly.z,glPosPoly.y/glPosPoly.z);\nfloat dist = (normal.z*2.)*polyRandom + 1.-polyRandom;\nvec2 closestTrailPoly0 = getClosest(projPosPoly,trail0,trail1);\nvec2 closestTrailPoly1 = getClosest(projPosPoly,trail1,trail2);\nvec2 closestTrailPoly2 = getClosest(projPosPoly,trail2,trail3);\nvec2 closestTrailPoly3 = getClosest(projPosPoly,trail3,trail4);\nfloat distanceTrailPoly0 = 1.0*dist * getDistance(projPosPoly,closestTrailPoly0);\nfloat distanceTrailPoly1 = 0.8*dist * getDistance(projPosPoly,closestTrailPoly1);\nfloat distanceTrailPoly2 = 0.6*dist * getDistance(projPosPoly,closestTrailPoly2);\nfloat distanceTrailPoly3 = 0.4*dist * getDistance(projPosPoly,closestTrailPoly3);\ndistancePoly = mouseRad*max(0.,max(distanceTrailPoly0,max(distanceTrailPoly1,max(distanceTrailPoly2,distanceTrailPoly3))));\ndistance = mouseRad*max(0.,1.-length(projPos-trail0  ));\ngl_Position.xy = gl_Position.xy + normalize(projPos.xy-trail0)*vec2(bulge*distance*mouseSpeed*50.);\n}";
debug="//gl_FragColor = vec4(vec3(closest,1.),1.);";
var VideoShaderSource={opaque:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( map, vUv );\n}"},keyedInverse:{uniforms:{map:{type:"t",value:0,texture:null},colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t > threshold )\nalpha = 0.0;//(1.0 - (t - 2.0)) * alphaFadeout;\ngl_FragColor = vec4( c.xyz * cs, alpha );\n}"},halfAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",
fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.5, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.5 + vUv.x * 0.5, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},distortSmartalpha:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\nc.a = a.r;\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x * 0.6666, vUvPoly.y ) );\nvec4 aPoly = texture2D( map, vec2( 0.6666 + vUvPoly.x * 0.3333, vUvPoly.y ) );\ncPoly.a = aPoly.r;\nif ((distancePoly)>0.5) c = cPoly; \ngl_FragColor = mix(c,cPoly,max(0.,distancePoly*softEdge));",
debug,"}"].join("\n")},smartAlpha:{uniforms:{map:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nvarying vec2 vUv;\nvoid main() {\nvec4 c = texture2D( map, vec2( vUv.x * 0.6666, vUv.y ) );\nvec4 a = texture2D( map, vec2( 0.6666 + vUv.x * 0.3333, vUv.y ) );\ngl_FragColor = vec4(c.rgb, a.r);\n}"},keyed:{uniforms:{map:{type:"t",value:0,texture:null},
colorScale:{type:"f",value:1},threshold:{type:"f",value:0.5},alphaFadeout:{type:"f",value:0.5}},vertexShader:"varying vec2 vUv;\nuniform bool flip;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D map;\nuniform float colorScale;\nuniform float threshold;\nuniform float alphaFadeout;\nvarying vec2 vUv;\nvoid main() {\nvec3 cd = vec3(1.0 - colorScale);\nvec3 cs = vec3(colorScale);\nvec4 c = texture2D( map, vUv );\nfloat t = c.x + c.y + c.z;\nfloat alpha = 1.0;\nif( t < threshold )\nalpha = t / alphaFadeout;\ngl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}"},
distortOpaque:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \ngl_FragColor = mix(c,cPoly,max(0.,distancePoly*softEdge));",debug,"}"].join("\n")},distortKeyed:{uniforms:DistortUniforms,vertexShader:DistortVertexShader,fragmentShader:[DistortShaderFragmentPars,"void main() {\nvec4 c = texture2D( map, vec2( vUv.x, vUv.y ) );\nvec4 cPoly = texture2D( map, vec2( vUvPoly.x, vUvPoly.y ) );\nif ((distancePoly)>0.5) c = cPoly; \nif (c.a<=0.1) {\n\tdiscard;\n} else {\n\tvec3 cd = vec3(1.0 - colorScale);\n\tvec3 cs = vec3(colorScale);\n\tfloat t = c.x + c.y + c.z;\n\tfloat alpha = 1.0;\n\tif( t < threshold )\n\t\talpha = t / alphaFadeout;\n\tgl_FragColor = vec4( (c.xyz - cd) * cs, alpha );\n}\n}"].join("\n")}},
VideoShots={introLayers:[{path:"/files/videos/intro.webm",shaderId:VIDEO_OPAQUE,z:-1E3,fps:48,width:1.01,height:1.01,duration:22E3}],s01_01:[{path:"/files/videos/city/s01.webm",shaderId:VIDEO_OPAQUE,z:-1E3,duration:3120}],s01_03:[{path:"/files/videos/city/s03_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1100,width:1.56,height:1.59,paralax:!0,duration:8120,paralaxHorizontal:600,paralaxVertical:200},{path:"/files/videos/city/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,locked:!0,removeAt:0.3}],s01_06:[{path:"/files/videos/city/s06_layer02.webm",
shaderId:VIDEO_OPAQUE,z:-1E3,duration:2030},{path:"/files/videos/city/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-900}],s01_09:[{path:"/files/videos/city/s09_layer02.webm",shaderId:VIDEO_KEYED,z:-1E3,colorScale:0.99,threshold:0.45,alphaFadeout:0.35,paralax:!0,width:1.5625,height:1.1627,duration:8230,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/city/s09_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-500,locked:!0,removeAt:0.3}],s02_01:[{path:"/files/videos/prairie/s01_layer02.webm",
shaderId:VIDEO_OPAQUE,width:1.5625,height:1,paralax:!0,paralaxHorizontal:600,paralaxVertical:0,bendForce:73,z:-200,duration:9800},{path:"/files/videos/prairie/s01_layer01.webm",shaderId:VIDEO_SMARTALPHA,width:1.05,height:1.05,locked:!0,z:-100}],s02_02:[{path:"/files/videos/prairie/s02_layer03.jpg",shaderId:VIDEO_OPAQUE,z:-1010,duration:2E3},{path:"/files/videos/prairie/s02_layer02.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3},{path:"/files/videos/prairie/s02_layer01.webm",shaderId:VIDEO_SMARTALPHA,
z:-990}],s02_03:[{path:"/files/videos/prairie/s03_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1500,duration:2125},{path:"/files/videos/prairie/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_04:[{path:"/files/videos/prairie/s04_layer02.webm",shaderId:VIDEO_OPAQUE,z:-1010,duration:5E3},{path:"/files/videos/prairie/s04_layer01.webm",shaderId:VIDEO_SMARTALPHA_DISTORT,z:-1E3}],s02_06:[{path:"/files/videos/prairie/s06_layer01.webm",shaderId:VIDEO_SMARTALPHA,colorScale:1,threshold:2.4,alphaFadeout:1,
z:-1010,duration:6E3}],s03_01:[{path:"/files/videos/dunes/s01_layer03.webm",shaderId:VIDEO_OPAQUE,z:-1E3,width:1.56,height:1.22,paralax:!0,duration:8E3,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/dunes/s01_layer02.webm",shaderId:VIDEO_KEYED_DISTORT,z:-800,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,width:1.56,height:1.22,paralax:!0},{path:"/files/videos/dunes/s01_layer01.webm",shaderId:VIDEO_KEYED,colorScale:0,threshold:0.5,alphaFadeout:0.5,z:-100,locked:!0}],s03_02:[{path:"/files/videos/dunes/s02_layer02.webm",
shaderId:VIDEO_OPAQUE,z:-1010,duration:3500},{path:"/files/videos/dunes/s02_layer01.webm",shaderId:VIDEO_KEYED_DISTORT,colorScale:0.9,threshold:0.2,alphaFadeout:0.35,z:-1E3}],s03_03:[{path:"/files/videos/dunes/s03_layer02.webm",shaderId:VIDEO_SMARTALPHA,z:-400,paralax:!0,width:1.526,height:1.11,duration:11E3,paralaxHorizontal:600,paralaxVertical:100},{path:"/files/videos/dunes/s03_layer01.webm",shaderId:VIDEO_SMARTALPHA,z:-100,removeAt:0.3,locked:!0}]},City=function(b){var f=this;SequencerItem.call(this);
b.signals.initscenes.add(function(){f.update(0.0010,34.99,45199)});var c,d,g,h,n,o=b.renderer,m=b.renderTarget,p=[],u=[],v=!1,w=0;b.debug=!1;if(function(x){return(x=RegExp("[?&]"+x+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(x[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){p=[[0,18,-300],[0,18,-1430]];d=new THREE.PathCamera({fov:65,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:p,duration:9.7,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,
createDebugDummy:!1,lookSpeed:0.0010,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});d.position.set(0,0,0);d.lon=180;d.lat=-20;c=d;if(b.debug){gui=new GUI;gui.add(c,"fov",50,120).name("Lens")}h=new CityWorld(b);n=new CitySoup(c,h.scene,b);b.worlds.city=h;b.soups.city=n;b.sequences.city=this;h.scene.addObject(c.animationParent)};this.resetCamera=function(){v=!1;d.position.set(0,0,0);d.lon=180;d.lat=
-20;c=d;c.animation.play(!1,0);n.changeCamera(c);o.setClearColor(h.scene.fog.color)};this.show=function(){this.resetCamera();b.started.city=!0};this.hide=function(){};this.update=function(x,y){if(isNaN(y)||y>1E3||y==0)y=1E3/60;w+=y;if(w<2E3){c.lon=180;c.lat=-20}b.debug&&c.updateProjectionMatrix();var A=c.animationParent.position.z;if(A<-1400&&!v){u=[[0,18,A],[0,18,-3400]];c.theta<1.2&&(u=[[0,18,A],[0,18,-1650],[-110,18,-1740],[-1670,18,-1740]]);c.theta>1.8&&(u=[[0,18,A],[0,18,-1650],[110,18,-1740],
[1670,18,-1740]]);A=65;if(b.debug)A=d.fov;g=new THREE.PathCamera({fov:A,aspect:b.viewportWidth/b.viewportHeight,near:1,far:1E5,waypoints:u,duration:15.6,useConstantSpeed:!0,resamplingCoef:5,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0010,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0.09,3.05],dstRange:[0.4,2]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});g.lat=d.lat;g.lon=d.lon;h.scene.addObject(g.animationParent);g.animation.play(!1,0);c=g;n.changeCamera(c);
d.animation.stop();b.debug&&gui.add(c,"fov",50,120).name("Lens");v=!0}THREE.AnimationHandler.update(y);n.update(y);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/400;o.render(h.scene,c,m);h.update(y,c,!1)}};City.prototype=new SequencerItem;City.prototype.constructor=City;
var Prairie=function(b){var f=this;SequencerItem.call(this);b.signals.initscenes.add(function(){f.update(9.0E-4,49.99,90375)});var c,d,g,h=b.renderer,n=b.renderTarget,o,m=[],p=0;b.debug=!1;if(function(u){return(u=RegExp("[?&]"+u+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(u[1].replace(/\+/g," "))}("debug")=="true")b.debug=!0;this.init=function(){m=[[332.182,105.662,-15.045],[352.207,114.403,-16.674],[402.111,120.122,-17.99],[452.904,122.699,-19.151],[504.217,120.952,-20.024],[553.975,
113.019,-20.361],[602.272,99.086,-20.384],[649.469,80.302,-20.309],[693.666,56.337,-19.92],[736.849,28.213,-19.488],[778.636,-1.415,-19.337],[819.084,-33.658,-19.508],[856.894,-66.605,-19.823],[895.344,-100.75,-20.237],[934.572,-133.462,-20.619],[974.512,-164.171,-20.174],[1014.98,-193.612,-21.554],[1055.66,-220.791,-32.133],[1085.89,-240.61,-66.939],[1094.09,-246.713,-99.358]];var u,v;for(u=0;u<m.length;u++){v=m[u][1];m[u][1]=m[u][2]+6;m[u][2]=-v}o=new THREE.PathCamera({fov:73,aspect:b.viewportWidth/
b.viewportHeight,near:1,far:1E6,waypoints:m,duration:26.2,useConstantSpeed:!0,resamplingCoef:1,createDebugPath:!1,createDebugDummy:!1,lookSpeed:0.0028,lookVertical:!0,lookHorizontal:!0,verticalAngleMap:{srcRange:[0,6.28],dstRange:[1.7,3]},horizontalAngleMap:{srcRange:[0,6.28],dstRange:[0,Math.PI]}});o.position.set(0,0,0);o.lon=360;c=o;if(b.debug){gui=new GUI;gui.add(c,"fov",50,120).name("Lens")}d=new PrairieWorld(b,c,function(){g=new PrairieSoup(c,d.scene,b);b.soups.prairie=g;b.prairieSoupHead=new THREE.Vector3});
b.worlds.prairie=d;b.sequences.prairie=this;d.scene.addObject(o.animationParent)};this.show=function(){this.resetCamera();b.started.prairie=!0};this.hide=function(){};this.resetCamera=function(){p=0;c.position.set(0,0,0);c.lon=360;c.animation.play(!1,0)};this.update=function(u,v){if(isNaN(v)||v>1E3||v==0)v=1E3/60;p+=v;if(p<2500)c.lon=360;b.debug&&c.updateProjectionMatrix();THREE.AnimationHandler.update(v);if(c.animationParent)c.animationParent.rotation.z=c.target.position.x/300;c.animationParent.position.y+=
(Math.random()-0.5)*0.3;d.update(v,c,!1);g&&g.update(v);h.render(d.scene,c,n)}};Prairie.prototype=new SequencerItem;Prairie.prototype.constructor=Prairie;
var Dunes=function(b){SequencerItem.call(this);var f=this,c,d,g,h=b.renderer,n=b.renderTarget;new THREE.Vector3;b.signals.initscenes.add(function(){f.update(9.0E-4,49.99,90375)});this.init=function(){d=new DunesWorld(b);b.worlds.dunes=d;b.sequences.dunes=this;c=DunesCamera(b);g=new DunesSoup(c.camera,d.scene,b);b.soups.dunes=g};this.show=function(){c.resetCamera();b.started.dunes=!0;d.ambient.color.setHSV(0,0,0);d.directionalLight1.color.setHSV(0.08823529411764706,0,0);d.directionalLight2.color.setHSV(0,
0,0);d.lensFlare.position.y=-2500;d.skyWhite=0.02};this.hide=function(){};this.resetCamera=function(){c.resetCamera();h.setClearColor(d.scene.fog.color)};this.update=function(o,m,p){if(o>0.05&&o<0.15){var u=Math.sin((o-0.05)/(0.15-0.05)*Math.PI*0.5);d.lensFlare.position.y=-2500+6E3*u;d.skyWhite=0.02+0.98*u;d.ambient.color.setHSV(0,0,0.1*u);d.directionalLight1.color.setHSV(0.08823529411764706,0,u);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*u)}else if(o>0.9){u=Math.sin((1-(o-0.9)/0.1)*
Math.PI*0.5);u*=u;d.lensFlare.position.y=-1E3+4500*u;d.skyWhite=u;d.ambient.color.setHSV(0,0,0.1*u);d.directionalLight1.color.setHSV(0.08823529411764706,0,u);d.directionalLight2.color.setHSV(0,0,0.8647058823529412*u)}else if(o>0.05){d.skyWhite=1;d.ambient.color.setHSV(0,0,0.1);d.directionalLight1.color.setHSV(0.08823529411764706,0,1);d.directionalLight2.color.setHSV(0,0,0.8647058823529412);d.lensFlare.position.y=3500}o>0.38&&g.update(m);c.updateCamera(o,m,p);THREE.AnimationHandler.update(m);d.update(m,
c.camera,!0);h.render(d.scene,c.camera,n)}};Dunes.prototype=new SequencerItem;Dunes.prototype.constructor=Dunes;var Section=function(){};Section.prototype={load:function(){},show:function(){},hide:function(){},resize:function(){},update:function(){},getDomElement:function(){}};
var LauncherSection=function(b){Section.call(this);var f,c,d,g,h,n,o,m,p,u,v,w,x,y=start_time=(new Date).getTime(),A,B,C=1;f=document.createElement("div");f.style.background="-moz-linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";f.style.background="-webkit-linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";f.style.background="linear-gradient(top, #04142e 0%, #1d508f 35%, #5299d1 50%, #1d508f 100%)";f.style.textAlign="center";var E=!1,z=!1;this.load=
function(){function H($,W,V){var S=document.createElement("div");S.style.position="absolute";S.style.cursor="pointer";S.style.margin=$;var t=document.createElement("img");t.src=W;S.appendChild(t);S.addEventListener("mouseout",function(){t.src=W},!1);S.addEventListener("mouseover",function(){t.src=V},!1);return S}c=new Clouds(b);c.getDomElement().style.position="absolute";c.getDomElement().style.left="0px";c.getDomElement().style.top="0px";c.getDomElement().style.width=window.innerWidth+"px";c.getDomElement().style.height=
window.innerHeight+"px";f.appendChild(c.getDomElement());A=document.createElement("div");A.style.background="rgba(255,255,255,1)";A.style.width="100%";A.style.height="100%";A.style.position="absolute";A.style.zIndex=1E3;f.appendChild(A);n=document.createElement("div");n.style.position="absolute";n.setAttribute("id","ui-container");n.style.marginTop="30px";d=document.createElement("div");d.style.position="absolute";d.innerHTML='<img src="/files/logo_heart.png" style="display:block; margin-top:-30px;" />';
n.appendChild(d);g=H("10px 0 0 85px","/files/enter_idle.png","/files/enter_rollover.png");g.addEventListener("click",function(){u.getDomElement().style.display="block";g.style.display="none";E=!0;if(p!=undefined&&m!=undefined){p.style.display="none";m.style.display="none"}b.signals.load.dispatch()},!1);n.appendChild(g);h=H("30px 0 0 85px","/files/start_idle.png","/files/start_rollover.png");h.style.display="none";h.addEventListener("click",function(){if(b.originLink=="/explore"&&b.shouldSkip){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch("dunes",!1);_gaq.push(["_trackPageview","/explore"]);b.hasExplored=!0;b.shouldSkip=!1}else{b.signals.showfilm.dispatch();setTimeout(function(){b.signals.startfilm.dispatch(0,1);_gaq.push(["_trackPageview","/launcher_start_film"])},1E3)}},!1);n.appendChild(h);u=new LoadingBar(function(){u.getMouseInfo().style.display="none";h.style.display="block";b.loadedContent=!0;E=!1;b.signals.initscenes.dispatch()});u.getDomElement().style.position="absolute";u.getDomElement().style.display=
"none";n.appendChild(u.getDomElement());b.signals.loadItemAdded.add(u.addItem);b.signals.loadItemCompleted.add(u.completeItem);if(HandleErrors.isWebGLAndBeta){o=document.createElement("div");o.style.paddingTop="60px";o.style.marginLeft="-2px";o.innerHTML="<img src = '/files/footer/header-trans.png' alt = 'ROME' />";f.appendChild(o)}else f.appendChild(n);if(localStorage.getItem("RomeSeen")=="true"){if(!z){var G=document.createTextNode(".seen-before {\n\topacity: .35;\n\tcursor: pointer;\n}\n.seen-before:hover {\n\topacity: 1.0;\n}"),
F=document.getElementsByTagName("head")[0],T=document.createElement("style");if(T.stylesheet)T.styleSheet.cssText=G.nodeValue;else T.appendChild(G);F.appendChild(T);z=!0}p=document.createElement("div");p.setAttribute("class","seen-before");p.setAttribute("style","background: url('files/launcher/add-trans.png') 0 0 no-repeat; width: 145px; height: 10px;");p.style.position="absolute";p.style.top="248px";p.style.left=window.innerWidth/2-354+"px";p.addEventListener("click",function($){$.preventDefault();
b.signals.showugc.dispatch();_gaq.push(["_trackPageview","/launcher_add_to_dream"])},!1);m=document.createElement("div");m.setAttribute("class","seen-before");m.setAttribute("style","background: url('files/launcher/explore-trans.png') 0 0 no-repeat; width: 199px; height: 10px;");m.style.position="absolute";m.style.top="248px";m.style.left=window.innerWidth/2+168+"px";m.addEventListener("click",function($){$.preventDefault();window.open("/gallery","Gallery");_gaq.push(["_trackPageview","/launcher_gallery"])},
!1);n.appendChild(p);n.appendChild(m)}else localStorage.setItem("RomeSeen",!0);v=document.createElement("div");v.style.position="absolute";v.style.left="0";v.style.bottom="0";v.style.width="100%";new Footer(v);f.appendChild(v)};this.show=function(){c.show();f.style.display="block";if(!b.loadedContent)h.style.display="none"};this.resize=function(H,G){c.resize(H,G);if(d){d.style.top="60px";d.style.left=(window.innerWidth-358)/2+"px"}if(g){g.style.top=h.style.top="210px";g.style.left=h.style.left=(window.innerWidth-
358)/2+"px"}if(u){u.getDomElement().style.top="215px";u.getDomElement().style.left=(window.innerWidth-300)/2+"px"}if(m&&p){m.style.left=window.innerWidth/2+168+"px";p.style.left=window.innerWidth/2-354+"px"}f.style.width=H+"px";f.style.height=G+"px"};this.hide=function(){c.hide();f.style.display="none"};this.update=function(){x=(new Date).getTime();w=x-y;y=x;E||c.update();if(C>0){C-=4.0E-4*w;B=TWEEN.Easing.Exponential.EaseOut(C);A.style.background="rgba(255,255,255,"+B+")"}else{A.style.display="none";
A.style.zIndex=0}};LauncherSection.showUI=function(){if(o)o.style.display="none";f.appendChild(n)};this.getDomElement=function(){return f}};LauncherSection.prototype=new Section;LauncherSection.prototype.constructor=LauncherSection;
var FilmSection=function(b){function f(){n=!1;g.pause()}function c($){switch($.keyCode){case 32:g.paused?g.play():g.pause();break;case 37:try{g.currentTime--}catch(W){console.error(W)}o.clear();break;case 39:try{g.currentTime++}catch(V){console.error(V)}o.clear();break;case 38:g.playbackRate+=0.1;break;case 40:g.playbackRate-=0.1;break;case 77:g.volume=g.volume?0:1}}Section.call(this);var d,g,h,n=!1,o,m,p;d=document.createElement("div");d.style.display="none";g=document.createElement("audio");g.preload=
"auto";d.appendChild(g);source=document.createElement("source");source.src="/files/Black.ogg";g.appendChild(source);h=new Tune(g);h.setBPM(85);h.setRows(4);b.baseWidth=1024;b.baseHeight=436;b.viewportWidth=b.baseWidth*(window.innerWidth/b.baseWidth);b.viewportHeight=b.baseHeight*(window.innerWidth/b.baseWidth);m=new THREE.WebGLRenderer({stencil:!1});m.domElement.style.position="absolute";m.setSize(b.viewportWidth,b.baseHeight);m.sortObjects=!1;m.autoClear=!1;p=new THREE.WebGLRenderTarget(b.viewportWidth,
b.baseHeight,{stencilBuffer:!1});p.minFilter=THREE.LinearFilter;p.magFilter=THREE.LinearFilter;b.renderer=m;b.renderTarget=p;b.signals.startfilm.add(function($,W){d.appendChild(m.domElement);n=!0;try{g.currentTime=h.getPatternMS($)/1E3}catch(V){console.error(V)}g.play();g.volume=W;b.isExperience=!0});b.signals.stopfilm.add(f);var u=new VideoPlayer(b,VideoShots.s01_01),v=new VideoPlayer(b,VideoShots.s01_03),w=new VideoPlayer(b,VideoShots.s01_06),x=new VideoPlayer(b,VideoShots.s01_09),y=new VideoPlayer(b,
VideoShots.s02_01),A=new VideoPlayer(b,VideoShots.s02_02),B=new VideoPlayer(b,VideoShots.s02_03),C=new VideoPlayer(b,VideoShots.s02_04),E=new VideoPlayer(b,VideoShots.s02_06),z=new VideoPlayer(b,VideoShots.s03_01),H=new VideoPlayer(b,VideoShots.s03_02),G=new VideoPlayer(b,VideoShots.s03_03);o=new Sequencer;o.add(new ClearEffect(b),h.getPatternMS(0),h.getPatternMS(73.25),0);o.add(new VideoPlayer(b,VideoShots.introLayers),h.getPatternMS(0),h.getPatternMS(7.9),1);var F=h.getPatternMS(7.9),T=h.getPatternMS(16);
o.add(u,F,F+u.duration,1);F+=u.duration;o.add(v,F,F+v.duration,1);F+=v.duration;o.add(w,F,F+w.duration,1);F+=w.duration;o.add(x,F,T,4);u=h.getPatternMS(16)-2E3;o.add(new City(b),u,h.getPatternMS(23.9),1);o.add(new PaintEffect(b),u,h.getPatternMS(23.9),5);u=h.getPatternMS(23.9);h.getPatternMS(32);o.add(y,u,u+y.duration,1);u+=y.duration;o.add(A,u,u+A.duration,1);u+=A.duration;o.add(B,u,u+B.duration,1);u+=B.duration;o.add(C,u,u+C.duration,1);u+=C.duration;o.add(E,u,u+E.duration,4);y=h.getPatternMS(32)-
3E3;o.add(new Prairie(b),y,h.getPatternMS(40),1);o.add(new PaintEffectPrairie(b),y,h.getPatternMS(40),5);y=h.getPatternMS(40);h.getPatternMS(48);o.add(z,y,y+z.duration,1);y+=z.duration;o.add(H,y,y+H.duration,1);y+=H.duration;o.add(G,y,y+G.duration,4);y+=G.duration;z=h.getPatternMS(48)-11E3;o.add(new Dunes(b),z,h.getPatternMS(73.25),1);o.add(new PaintEffectDunes(b),z,h.getPatternMS(73.25),5);o.add(new FadeOutEffect(0,b),h.getPatternMS(23.5),h.getPatternMS(24),3);o.add(new FadeOutEffect(0,b),h.getPatternMS(39.5),
h.getPatternMS(40),3);o.add(new FadeOutEffect(0,b),h.getPatternMS(72.2),h.getPatternMS(73.25),3);o.add(new PointerEffect(b,!0),h.getPatternMS(8),h.getPatternMS(73.25),1E3);o.add(new RenderEffect(b),h.getPatternMS(0),h.getPatternMS(8),6);o.add(new PaintEffect(b),h.getPatternMS(8),h.getPatternMS(16)-2E3,6);o.add(new PaintEffectPrairie(b),h.getPatternMS(24),h.getPatternMS(32)-3E3,6);o.add(new RenderEffect(b),h.getPatternMS(40),h.getPatternMS(48)-11E3,6);this.getDomElement=function(){return d};this.show=
function(){d.style.display="block";b.signals.keydown.add(c)};this.hide=function(){d.style.display="none";b.signals.keydown.remove(c);f()};this.resize=function($,W){b.viewportWidth=b.baseWidth*($/b.baseWidth);b.viewportHeight=b.baseHeight*($/b.baseWidth);m.setSize(b.viewportWidth,b.viewportHeight);p.width=b.viewportWidth;p.height=b.viewportHeight;delete p.__webglFramebuffer;m.domElement.style.left="0px";m.domElement.style.top=(W-b.viewportHeight)/2+"px"};this.update=function(){if(n)if(g.currentTime>
209){b.signals.showrelauncher.dispatch();f()}else{o.update(g.currentTime*1E3);b.currentTime=g.currentTime}}};FilmSection.prototype=new Section;FilmSection.prototype.constructor=FilmSection;
var RelauncherSection=function(b){function f(){for(var H=B.getPoints(),G=0;G<H.length;G++){var F=H[G].getOriginPosition(),T=g.list[G],$=F.x+p.x;F=F.y+p.y;if(G==0){$-=113;F-=162}else if(G==1){$+=137;F-=46}else if(G==2){$+=106;F+=78}else if(G==3){$-=312;F+=75}else{$-=344;F-=46}T.style.left=$+"px";T.style.top=F+"px"}}function c(H,G,F,T,$){G=document.createElement(G);G.setAttribute("id",F);G.setAttribute("class",T);G.innerHTML=$;H.appendChild(G);return G}Section.call(this);var d=document.createElement("div");
d.style.width=window.innerWidth+"px";d.style.height=window.innerHeight+"px";d.style.display="none";d.style.backgroundColor="#ffffff";d.setAttribute("id","relauncher-section");var g={},h,n=document.createTextNode("#relauncher-section div.after-experience { position: absolute; height: 57px; overflow: hidden; cursor: pointer; } #relauncher-section div.after-experience img { display: block; } #relauncher-section div.after-experience:hover img { margin-top: -57px; }"),o=document.getElementsByTagName("head")[0],
m=document.createElement("style");m.type="text/css";if(m.styleSheet)m.styleSheet.cssText=n.nodeValue;else m.appendChild(n);o.appendChild(m);var p={x:window.innerWidth/2-225,y:window.innerHeight/2-175},u=new Clouds(b,!0);u.getDomElement().style.position="absolute";u.getDomElement().style.left="0px";u.getDomElement().style.top="0px";u.getDomElement().style.width=window.innerWidth+"px";u.getDomElement().style.height=window.innerHeight+"px";d.appendChild(u.getDomElement());var v=document.createElement("div");
v.setAttribute("id","container");v.setAttribute("style","position: absolute; top: "+p.y+"px; left: "+p.x+"px;");d.appendChild(v);var w=document.createElement("div");w.setAttribute("style","-webkit-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -moz-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); -o-transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750); transition: all 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750);");w.style.position="absolute";w.style.width=
"100%";w.style.height="100%";w.style.backgroundColor="#000";d.appendChild(w);var x=new GEE({fullscreen:!1,container:v,width:450,height:350,loop:!1}),y=x.ctx;h=document.createElement("div");h.style.position="absolute";h.style.width="100%";h.style.top=window.innerHeight-78+"px";h.style.left="0";new Footer(h);d.appendChild(h);var A=new WonderWall.Pentagon(x,x.width*0.5,x.height*0.5,80),B=new WonderWall.Pentagon(x,x.width*0.5,x.height*0.5,95),C=new WonderWall.Pentagon(x,x.width*0.5,x.height*0.5,130,0.25);
C.showFill=!1;C.insides=!0;B.showFill=!1;C.setRadius(0.09);A.setRadius(0.06);var E={svg:new Heart(x,"files/eminating-heart.svg",0,0),point:new WonderWall.Point(x,x.width*0.5,x.height*0.5+6)};E.point.r=0.0625;var z=z||{};z.color={red:"#f15d22",black:"#30302e",white:"#f4f4ea"};g=function(H){var G={},F=c(H,"div","start-over","after-experience","<img src = '/files/relaunch_section/start_over.png' alt = 'Start Over' />"),T=c(H,"div","technology","after-experience","<img src = '/files/relaunch_section/technology.png' alt = 'Technology' />"),
$=c(H,"div","add-to-the-dream","after-experience","<img src = '/files/relaunch_section/add_dreams.png' alt = 'Add to the Dream' />"),W=c(H,"div","explore-other-dreams","after-experience","<img src = '/files/relaunch_section/explore_dreams.png' alt = 'Explore Other Dreams' />");H=c(H,"div","continue-to-explore","after-experience","<img src = '/files/relaunch_section/continue.png' alt = 'Continue To Explore' />");F.addEventListener("click",function(V){V.preventDefault();b.signals.showfilm.dispatch();
b.signals.startfilm.dispatch(0,1);_gaq.push(["_trackPageview","/relauncher_start_over"])},!1);T.addEventListener("click",function(V){V.preventDefault();window.location="/tech";_gaq.push(["_trackPageview","/relauncher_tech"])},!1);$.addEventListener("click",function(V){V.preventDefault();b.signals.showugc.dispatch();_gaq.push(["_trackPageview","/relauncher_add_to_dream"])},!1);W.addEventListener("click",function(V){V.preventDefault();window.location="/gallery";_gaq.push(["_trackPageview","/relauncher_gallery"])},
!1);H.addEventListener("click",function(V){V.preventDefault();b.isExperience=!1;b.signals.showexploration.dispatch();b.signals.startexploration.dispatch("dunes",!1);_gaq.push(["_trackPageview","/relauncher_continue_explore"])},!1);G.start=F;G.technology=T;G.add=$;G.otherDreams=W;G.explore=H;G.list=[H,F,W,$,T];init=!0;return G}(d);for(n=0;n<g.list.length;n++){o=g.list[n];o.addEventListener("mouseover",function(){var H=g.list.indexOf(this);A.setUpdatePoint(!0,H);B.setUpdatePoint(!0,H);C.setUpdatePoint(!0,
H);E.point.updating=!0},!1);o.addEventListener("mouseout",function(){var H=g.list.indexOf(this);A.setUpdatePoint(!1,H);B.setUpdatePoint(!1,H);C.setUpdatePoint(!1,H);E.point.updating=!1},!1)}f();x.draw=function(){B.update(p);B.getPoints();y.clearRect(0,0,x.width,x.height);y.globalCompositeOperation="source-over";y.strokeStyle=z.color.black;y.lineWidth=0.5;C.update(p).render();y.globalCompositeOperation="destination-out";A.update(p).render();y.globalCompositeOperation="xor";y.lineWidth=24;B.showStroke=
!0;B.showFill=!1;B.render();y.globalCompositeOperation="source-over";y.save();y.translate(x.width/2,x.height/2);E.svg.render();y.restore()};this.show=function(){u.show();f();d.style.display="block";setTimeout(function(){w.style.opacity=0},1);for(var H=v.getElementsByTagName("div"),G=0;G<H.length;G++)H[G].style.display="block"};this.resize=function(H,G){var F=window.innerWidth/2,T=window.innerHeight/2;d.style.width=H+"px";d.style.height=G+"px";u.resize(H,G);h.style.top=window.innerHeight-78+"px";p=
{x:F-225,y:T-175};v.setAttribute("style","position: absolute; top: "+p.y+"px; left: "+p.x+"px;");f()};this.hide=function(){u.hide();d.style.display="none";w.style.opacity=1};this.getDomElement=function(){return d};this.update=function(){u.update();x.draw()}};RelauncherSection.prototype=new Section;RelauncherSection.prototype.constructor=RelauncherSection;
var ExplorationSection=function(b){function f(ca){(ca.keyCode==13||ca.keyCode==32||ca.keyCode==27)&&c()}function c(){if(W=!W){m.style.display="block";p.style.display="block"}else{m.style.display="none";p.style.display="none"}}function d(){V=window.innerWidth/b.baseWidth;b.viewportWidth=b.baseWidth*V;b.viewportHeight=b.baseHeight*V;w.setSize(b.viewportWidth,b.viewportHeight);x.width=b.viewportWidth;x.height=b.viewportHeight;delete x.__webglFramebuffer;w.domElement.style.left="0px";w.domElement.style.top=
(window.innerHeight-b.viewportHeight)/2+"px"}Section.call(this);var g=document.createElement("div");g.style.display="none";var h=document.createTextNode("#rome-explore-hex-audio:hover polygon,\n\t#rome-explore-hex-poly-top:hover polygon,\n\t#rome-explore-hex-poly-bottom:hover polygon {\n\t\topacity: 1.0;\n\t}\n#rome-explore-hex-poly-middle,\n#rome-explore-hex-audio,\n\t#rome-explore-hex-poly-top,\n\t#rome-explore-hex-poly-bottom {\n\t\tcursor: pointer;\n\t}"),n=document.getElementsByTagName("head")[0],
o=document.createElement("style");if(o.stylesheet)o.styleSheet.cssText=h.nodeValue;else o.appendChild(h);n.appendChild(o);var m=document.createElement("div"),p=document.createElement("div"),u=0,v=0,w=b.renderer,x=b.renderTarget,y,A,B,C,E,z,H,G,F,T=0,$="",W=!1,V,S=!0,t=!1,M,I;E=new ClearEffect(b);E.init();F=new FadeOutEffect(0,b);F.init();z=new PaintEffect(b);z.init();H=new PaintEffectPrairie(b);H.init();G=new PaintEffectDunes(b);G.init();var P=!0;M=document.createElement("audio");M.volume=0;M.loop=
!0;M.src="/files/nature.mp3";M.autoplay=!1;document.body.appendChild(M);I=document.createElement("audio");I.volume=0;I.loop=!1;I.src="/files/Black.ogg";I.autoplay=!1;document.body.appendChild(I);var O,R={};R.dunes=new DunesCameraFreeExplore(b);R.prairie=new PrairieCameraFreeExplore(b);R.city=new CityCameraFreeExplore(b);b.signals.startexploration.add(function(ca,U){p.style.position="absolute";p.style.zIndex=1E3;p.innerHTML='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" x="0px" y="0px" width="184px" height="47px" viewBox="0 0 184 47" overflow="visible" enable-background="new 0 0 184 47" xml:space="preserve">\n\t<g id = "rome-explore-hex-audio" onClick="ExplorationSection.handleHexClick(2)">\n\t\t<polygon opacity="0.5" points="0,0 27.237,47.176 156.857,47.176 184.095,0 "/>\n\t\t<path id="rome-explore-hex-audio-play" display="none" fill="#FFFFFF" d="M118.749,14.089c-5.246,0-9.499,4.253-9.499,9.499s4.253,9.499,9.499,9.499s9.499-4.253,9.499-9.499 S123.995,14.089,118.749,14.089z M116.27,27.811v-7.75l6.875,3.527L116.27,27.811z"/>\n\t\t<path id="rome-explore-hex-audio-pause" fill="#FFFFFF" d="M118.75,14.089c-5.246,0-9.5,4.253-9.5,9.499s4.254,9.499,9.5,9.499s9.498-4.253,9.498-9.499 S123.996,14.089,118.75,14.089z M118.031,27.463h-2v-7.75h2V27.463z M121.469,27.463h-2v-7.75h2V27.463z"/>\n\t\t<text x="50" y="28" font-size="12" font-family="Futura, sans-serif" fill="#fff" letter-spacing="1">AUDIO</text>\n\t</g>\n</svg>';
p.style.display="none";g.appendChild(p);m.style.position="absolute";m.style.zIndex=1E3;m.innerHTML='<g id = "svgHex-container">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" x="-184px" y="-159px" width="368px" height="318px" viewBox="0 0.972 368 318" overflow="visible" enable-background="new 0 0.972 368 318" xml:space="preserve">\n\t<polygon opacity="0.5" points="298.816,133.629 353.291,133.629 276.7,0.972 249.464,48.149 "/>\n\t<polygon opacity="0.5" points="119.064,47.554 91.827,0.377 14.897,133.629 69.37,133.629 "/>\n\t<g id="rome-explore-hex-poly-top" onClick="ExplorationSection.handleHexClick(1)">\n\t\t<polygon opacity="0.5" points="120.01,47.177 248.861,47.177 276.098,0 92.773,0 92.825,0.089 "/>\n\t\t<text x="168" y="28" font-size="14" font-family="Futura, sans-serif" fill="#fff" letter-spacing="1">EXIT</text>\n\t</g>\n\t<polygon opacity="0.5" points="353.868,134.629 299.394,134.629 313.714,159.433 298.996,184.925 353.471,184.925 368.188,159.433 "/>\n\t<polygon opacity="0.5" points="298.419,185.925 249.267,271.062 276.503,318.239 352.894,185.925 "/>\n\t<g id="rome-explore-hex-poly-bottom" onClick="ExplorationSection.handleHexClick(0)">\n\t\t<polygon opacity="0.5" points="120.405,271.692 93.168,318.869 275.702,318.869 248.466,271.692 "/>\n\t\t<text x="156" y="300" font-size="14" font-family="Futura, sans-serif" fill="#fff" letter-spacing="1">RESUME</text>\n\t</g>\n\t<polygon opacity="0.5" points="69.767,185.925 15.294,185.925 92.024,318.833 119.262,271.656 "/>\n\t<polygon opacity="0.5" points="54.473,159.433 68.793,134.629 14.728,134.629 14.728,133.922 0,159.433 14.728,184.944 14.728,184.925 69.19,184.925 "/>\n\t<g id="rome-explore-hex-poly-middle" onClick="ExplorationSection.handleHexClick(3)">\n\t\t<polygon opacity="0.5" fill="#F6F4EC" points="119.282,271.692 54.473,159.433 119.282,47.177 248.902,47.177 313.714,159.433 248.902,271.692 "/>\n\t</g>\n</svg>\n</g>';
m.style.display="none";g.appendChild(m);y=b.worlds[ca];B=y.portals;O=R[ca];if(ca==="dunes"&&$!==""&&$!=="dunes"&&B){for(var ea=99999999999,la,ta=0;ta<B.length;ta++)if(B[ta].currentDistance<ea){ea=B[ta].currentDistance;la=B[ta]}O.switchDirection(la)}else O.resetCamera();$=ca;A=b.soups[ca];T=0;if(P)if(U||!t)if(I.volume==0){if(U)I.currentTime=b.currentTime;else{I.currentTime=0;t=!0}I.play();I.volume=1;S=!U}else{M.play();M.volume=1}else{M.play();M.volume=1}if(ca=="city")C=z;else if(ca=="prairie")C=H;
else{C=G;y.skyWhite=1;y.ambient.color.setHSV(0,0,0.1);y.directionalLight1.color.setHSV(0.08823529411764706,0,1);y.directionalLight2.color.setHSV(0,0,0.8647058823529412);y.lensFlare.position.y=3500}d();u=v=(new Date).getTime()});b.signals.windowresized.add(d);this.getDomElement=function(){return g};this.show=function(){if(!b.hasExplored)b.hasExplored=!0;g.style.display="block";g.appendChild(w.domElement);b.signals.keyup.add(f);m.style.display="none";m.style.top=window.innerHeight/2-184+"px";m.style.left=
window.innerWidth/2-159+"px";p.style.display="none";p.style.top=(window.innerHeight-b.viewportHeight)/2+"px";p.style.left=window.innerWidth/2-66+"px";W=!1};this.hide=function(){g.style.display="none";b.signals.keyup.remove(f);P&&M.pause()};this.resize=function(){m.style.top=window.innerHeight/2-184+"px";m.style.left=window.innerWidth/2-159+"px";p.style.top=(window.innerHeight-b.viewportHeight)/2+"px";p.style.left=window.innerWidth/2-66+"px"};this.update=function(){time=(new Date).getTime()-u;delta=
time-v;v=time;delta=Math.min(1E3,Math.max(0,delta));if(!W){if(y&&y.scene){A&&A.update(delta,O.camera);THREE.AnimationHandler.update(delta);O.updateCamera(0,delta,time);y.update(delta,O.camera,!0);E.update(0,delta,time);w.setClearColor(y.scene.fog?y.scene.fog.color:16777215);w.render(y.scene,O.camera,x);if(T<1E3){T+=delta;F.update(1-T/1E3)}else for(var ca=0;ca<B.length;ca++)B[ca].currentDistance<B[ca].radius*1.25&&F.update(1-(B[ca].currentDistance-B[ca].radius)/(B[ca].radius*0.25));C.update(0,delta,
time)}if(I.volume>0&&I.currentTime>209){I.pause();I.volume=0;S||b.signals.showrelauncher.dispatch()}}};ExplorationSection.handleHexClick=function(ca){switch(ca){case 0:c();break;case 1:if(I.volume>0){I.pause();I.volume=0}b.signals.showrelauncher.dispatch();break;case 2:if(P){I.volume>0&&I.pause();M.volume>0&&M.pause();document.getElementById("rome-explore-hex-audio-pause").setAttribute("display","none");document.getElementById("rome-explore-hex-audio-play").setAttribute("display","svg-path");P=!1}else{I.volume>
0&&I.currentTime<208&&I.play();M.volume>0&&M.play();document.getElementById("rome-explore-hex-audio-play").setAttribute("display","none");document.getElementById("rome-explore-hex-audio-pause").setAttribute("display","svg-path");P=!0}break;case 3:window.open(w.domElement.toDataURL("image/png"),"Make ro.me your wallpaper!");break;default:c()}}};ExplorationSection.prototype=new Section;ExplorationSection.prototype.constructor=ExplorationSection;
var UgcSection=function(b){function f(O){T+=O;T=T<100?100:T>5E3?5E3:T}function c(O){if(O.button==2){y=!0;$=u.getPainter().getMode();u.getPainter().setMode(VoxelPainter.MODE_IDLE)}A=!0;if(y){B=H;C=G;E=O.clientX;z=O.clientY}}function d(O){if(O.button==2){y=!1;u.getPainter().setMode($)}A=!1}function g(O){if(y&&A){H=B-(O.clientX-E)*0.1;G=C+(O.clientY-z)*0.1;switch(m){case 0:G=G>90?90:G<0?0:G;break;case 1:G=G>90?90:G<-90?-90:G}}}function h(O){f(-O.wheelDeltaY*0.5)}function n(O){O.preventDefault()}var o=
this,m,p,u,v,w=document.createElement("div");w.style.display="none";var x=Math.PI/180,y=!1,A=!1,B,C,E,z,H=45,G=15,F=3E3,T=3E3,$,W=new THREE.Camera(50,window.innerWidth/window.innerHeight,1,2E4);W.target.position.y=20;o.scene=new THREE.Scene;o.scene.fog=new THREE.FogExp2(16777215,1.5E-4);o.scene.fog.color.setHSV(0.576,0.382,0.9);var V=new THREE.AmbientLight(4465152),S=new THREE.DirectionalLight(16772829),t=new THREE.DirectionalLight(16772829);V.color.setHSV(0,0,0.1);S.color.setHSV(0.088,0,1);S.position.set(0.8,
0.3,-0.5);S.position.normalize();t.color.setHSV(0,0,0.564);t.position.set(0.1,0.5,0.2);t.position.normalize();o.scene.addLight(V);o.scene.addLight(S);o.scene.addLight(t);V=initLensFlares(new THREE.Vector3(0,0,-7500),60,292);o.scene.addChild(V);var M=new THREE.Object3D;o.scene.addChild(M);(new THREE.SceneLoader).load("/files/models/dunes/D_tile_1.js",function(O){for(var R=0,ca=O.scene.objects.length;R<ca;R++){var U=O.scene.objects[R];if(U.visible){U.rotation.x=-90*Math.PI/180;U.position.y=-100;U.position.x=
1E3;U.scale.x=U.scale.y=U.scale.z=0.75;M.addChild(U)}}o.clouds=new THREE.Object3D;M.addChild(o.clouds);O=new THREE.Plane(1E3,1E3);for(R=0;R<100;R++){ca=new THREE.Mesh(O,new THREE.MeshLambertMaterial({color:16777215,opacity:0.5,blending:THREE.AdditiveBlending}));ca.position.x=Math.random()-0.5;ca.position.y=Math.random();ca.position.z=Math.random()-0.5;ca.position.normalize();ca.position.x=ca.position.x*(Math.random()*5E3+2500)*3;ca.position.y=ca.position.y*(Math.random()*2500+5E3)-2800;ca.position.z=
ca.position.z*(Math.random()*5E3+2500)*3;ca.rotation.x=-90*Math.PI/180;ca.scale.x=Math.random()*2+1;ca.scale.y=Math.random()*2+1;ca.doubleSided=!0;o.clouds.addChild(ca)}});var I=new THREE.Mesh(new THREE.Plane(4050,4050,81,81),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0}));I.position.y=-25;I.rotation.x=-90*Math.PI/180;M.addChild(I);var P=new THREE.WebGLRenderer({stencil:!1});P.domElement.style.position="absolute";P.setSize(window.innerWidth,window.innerHeight);P.setClearColor(o.scene.fog.color);
P.sortObjects=!1;P.autoClear=!1;w.appendChild(P.domElement);this.getDomElement=function(){return w};this.load=function(){function O(U,ea,la){U=U||300;ea=ea||180;la=la||7;var ta=document.createElement("canvas"),xa=W.position.clone(),ya=45,oa=360/la;ta.width=U;ta.height=ea*la;var Fa=P.domElement,Ca=Fa.width,Ga=Fa.height,Ha=ta.getContext("2d");o.resize(U,ea);u.getPainter().hideBrush();I.visible=!1;THREE.SceneUtils.traverseHierarchy(o.clouds,function(ra){ra.visible=!1});var wa=u.getPainter().getObject().getMesh().geometry.vertices,
aa=wa[0].position.x,ia=wa[0].position.y,na=wa[0].position.z,ua=wa[0].position.x,Ea=wa[0].position.y,Za=wa[0].position.z,eb,va;for(va in wa){wa[va].position.x>aa&&(aa=wa[va].position.x);wa[va].position.y>ia&&(ia=wa[va].position.y);wa[va].position.z>na&&(na=wa[va].position.z);wa[va].position.x<ua&&(ua=wa[va].position.x);wa[va].position.y<Ea&&(Ea=wa[va].position.y);wa[va].position.z<Za&&(Za=wa[va].position.z)}wa=(ua+aa)/2;eb=(Za+na)/2;F=2*Math.max(aa-ua,Math.max(ia-Ea,na-Za));W.target.position.set(wa,
(Ea+ia)/2,eb);for(va=0;va<la;va++){W.position.x=F*Math.sin(ya*x)*Math.cos(35*x)+wa;W.position.y=F*Math.sin(35*x);W.position.z=F*Math.cos(ya*x)*Math.cos(35*x)+eb;P.clear();P.render(o.scene,W);Ha.drawImage(Fa,0,0,U,ea,0,ea*va,U,ea);ya+=oa}W.target.position.set(0,0,0);o.resize(Ca,Ga);U=ta.toDataURL("image/png");delete ta;W.position.copy(xa);I.visible=!0;THREE.SceneUtils.traverseHierarchy(o.clouds,function(ra){ra.visible=!0});P.clear();P.render(o.scene,W);return U}var R=signals.Signal;b.ugcSignals={};
b.ugcSignals.showintro=new R;b.ugcSignals.showobjectcreator=new R;b.ugcSignals.showsoupcreator=new R;b.ugcSignals.object_mode=new R;b.ugcSignals.soup_mode=new R;b.ugcSignals.object_createmode=new R;b.ugcSignals.object_erasemode=new R;b.ugcSignals.object_symmetrymode=new R;b.ugcSignals.object_rotatemode=new R;b.ugcSignals.object_changecolor=new R;b.ugcSignals.object_colormode=new R;b.ugcSignals.object_changesize=new R;b.ugcSignals.object_zoomin=new R;b.ugcSignals.object_zoomout=new R;b.ugcSignals.submit_dialogue=
new R;b.ugcSignals.submit=new R;b.ugcSignals.object_smoothup=new R;b.ugcSignals.object_smoothdown=new R;b.ugcSignals.object_undo=new R;b.ugcSignals.object_requestsnapshot=new R;b.ugcSignals.object_receivesnapshot=new R;p=new UgcIntro(b);w.appendChild(p.getDomElement());u=new UgcObjectCreator(b,W,o.scene);v=new UgcUI(b);v.getDomElement().style.position="absolute";v.getDomElement().style.left="0px";v.getDomElement().style.top="0px";v.getDomElement().style.display="none";w.appendChild(v.getDomElement());
v.addListeners();b.ugcSignals.showintro.add(function(){m=null;u.disable();p.getDomElement().style.display="block";v.getDomElement().style.display="none";u.getPainter().clear()});b.ugcSignals.showobjectcreator.add(function(U){m=U;p.getDomElement().style.display="none";u.enable();v.setType(U);v.getDomElement().style.display="block";switch(m){case 0:u.getPainter().getObject().setType(UgcObject.TYPE_GROUND);var ea={theta:H,phi:G};(new TWEEN.Tween(ea)).to({theta:45,phi:15},2E3).easing(TWEEN.Easing.Exponential.EaseOut).onUpdate(function(){H=
ea.theta;G=ea.phi}).start();(new TWEEN.Tween(M.position)).to({y:0},3E3).easing(TWEEN.Easing.Exponential.EaseOut).start();break;case 1:u.getPainter().getObject().setType(UgcObject.TYPE_SKY);ea={theta:H,phi:G};(new TWEEN.Tween(ea)).to({theta:45,phi:15},2E3).easing(TWEEN.Easing.Exponential.EaseOut).onUpdate(function(){H=ea.theta;G=ea.phi}).start();(new TWEEN.Tween(M.position)).to({y:-5E3},3E3).easing(TWEEN.Easing.Exponential.EaseOut).start()}(new TWEEN.Tween(W.target.position)).to({y:20},1E3).easing(TWEEN.Easing.Exponential.EaseOut).start()});
b.ugcSignals.object_createmode.add(function(){y=!1});b.ugcSignals.object_erasemode.add(function(){y=!1});b.ugcSignals.object_rotatemode.add(function(){y=!0});b.ugcSignals.object_zoomin.add(function(){f(-200)});b.ugcSignals.object_zoomout.add(function(){f(200)});b.ugcSignals.object_requestsnapshot.add(function(){var U=O(735,465);b.ugcSignals.object_receivesnapshot.dispatch(U)});var ca=new UgcHandler;b.ugcSignals.submit.add(function(U,ea){var la=O(),ta=u.getPainter().getObject();ta={title:U,email:ea,
category:ta.getType(),data:ta.getJSON()};ca.submitUGO(ta,la,function(xa){if(xa.success)window.location="/gallery";else alert("There was an error submitting your model. Please try again in a moment.")})})};this.show=function(){b.signals.mousedown.add(c);b.signals.mouseup.add(d);b.signals.mousemoved.add(g);b.signals.mousewheel.add(h);w.style.display="block";u.show();b.ugcSignals.showintro.dispatch();w.addEventListener("contextmenu",n,!1)};this.hide=function(){b.signals.mousedown.remove(c);b.signals.mouseup.remove(d);
b.signals.mousemoved.remove(g);b.signals.mousewheel.remove(h);w.style.display="none";u.hide();w.removeEventListener("contextmenu",n,!1)};this.resize=function(O,R){p.resize(O,R);W.aspect=O/R;W.updateProjectionMatrix();b.viewportWidth=O;b.viewportHeight=R;P.setSize(O,R);P.domElement.style.left="0px";P.domElement.style.top="0px"};this.update=function(){TWEEN.update();m==null&&(H=(H+=0.1)%360);v.update();F+=(T-F)/20;W.position.x=F*Math.sin(H*x)*Math.cos(G*x);W.position.y=F*Math.sin(G*x);W.position.z=
F*Math.cos(H*x)*Math.cos(G*x);P.clear();P.render(o.scene,W)}};UgcSection.prototype=new Section;UgcSection.prototype.constructor=UgcSection;
var Clouds=function(b,f){function c(){if(!f){p.x=b.mouse.x/b.screenWidth*100-50;p.y=b.mouse.y/b.screenHeight*60-30;u=new THREE.Vector3(b.mouse.x-b.screenWidth/2,-b.mouse.y+b.screenHeight/2,0)}}function d(I){for(var P=0;P<2;P++){g=o[P]=new Boid;g.position.x=320;g.position.y=20+Math.random()*10;g.position.z=200+Math.random();g.velocity.x=Math.random()*2-1;g.velocity.y=Math.random()*2-1;g.velocity.z=Math.random()*2-1;g.setAvoidWalls(!0);g.setWorldSize(1E3,200,400);m[P]=new ROME.Animal(I,!0);m[P].timeOffset=
Math.random()*100;h=n[P]=m[P].mesh;h.phase=Math.floor(Math.random()*62.8);h.rotation.set(0,-0.5,0);h.updateMatrix();h.update();window.morphObject=m[P];m[P].play(m[P].availableAnimals[0],m[P].availableAnimals[0]);h.position=o[P].position;h.doubleSided=!1;h.scale.x=h.scale.y=h.scale.z=0.03+0.05*Math.random();H.addChild(h)}G.position.z=-4E3;B.addObject(G);F.position.z=0;B.addObject(F);E.addObject(H)}var g,h,n=[],o=[],m=[],p={x:0,y:0},u={x:0,y:0,z:0},v,w,x=start_time=(new Date).getTime(),y,A,B,C,E,z,
H,G,F,T,$,W,V,S,t;$=new THREE.Fog(5413329,-100,3E3);y=new THREE.Camera(30,window.innerWidth/window.innerHeight,1,3E3);y.position.z=6E3;B=new THREE.Scene;E=new THREE.Scene;H=new THREE.Object3D;T=new THREE.Geometry;var M=THREE.ImageUtils.loadTexture("/files/cloud256.png",null,function(){W=new THREE.MeshShaderMaterial({uniforms:{map:{type:"t",value:2,texture:M},fogColor:{type:"c",value:$.color},fogNear:{type:"f",value:$.near},fogFar:{type:"f",value:$.far}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D map;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec2 vUv;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\ngl_FragColor = texture2D( map, vUv );\ngl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}",depthTest:!1});for(var I=new THREE.Mesh(new THREE.Plane(64,64)),P=0;P<4E3;P++){I.position.x=
Math.random()*1E3-500;I.position.y=f?-Math.random()*Math.random()*200+25:-Math.random()*Math.random()*200-15;I.position.z=P;I.rotation.z=Math.random()*Math.PI;I.scale.x=I.scale.y=Math.random()*Math.random()*1.5+0.5;GeometryUtils.merge(T,I)}G=new THREE.Mesh(T,W);F=new THREE.Mesh(T,W);(new THREE.JSONLoader).load({model:"/files/models/soup/birds_B_life.js",callback:d})});M.magFilter=THREE.LinearMipMapLinearFilter;M.minFilter=THREE.LinearMipMapLinearFilter;z=new THREE.WebGLRenderer({antialias:!1,clearColor:0,
clearAlpha:0});z.domElement.style.position="absolute";z.domElement.style.left="0px";z.domElement.style.top="0px";z.getContext();z.sortObjects=!1;z.autoClear=!1;S=new THREE.WebGLRenderTarget(512,512,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});t=new THREE.WebGLRenderTarget(1024,512,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter});S.depthBuffer=!1;S.stencilBuffer=!1;t.depthBuffer=!1;t.stencilBuffer=!1;window.renderTargetClouds=S;A=new THREE.Camera;A.projectionMatrix=THREE.Matrix4.makeOrtho(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);C=new THREE.Scene;V=new THREE.MeshShaderMaterial({uniforms:{tClouds:{type:"t",value:0,texture:S},tFlamingos:{type:"t",value:1,texture:t},width:{type:"f",value:window.innerWidth},height:{type:"f",value:window.innerHeight},fogColor:{type:"c",value:$.color}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tClouds;\nuniform sampler2D tFlamingos;\nuniform vec3 fogColor;\nuniform float width;\nuniform float height;\nvarying vec2 vUv;\nvoid main() {\nvec4 flamingos = vec4(0.);\nif (vUv.y > 0.5) {\nflamingos += texture2D( tFlamingos, vUv );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,0.) );\nflamingos += texture2D( tFlamingos, vUv+vec2(.0,1./height) );\nflamingos += texture2D( tFlamingos, vUv+vec2(1./width,1./height) );\nflamingos *= 1./4.;\nflamingos.rgb = mix(flamingos.rgb, vec3(fogColor), 0.15*flamingos.a);\n}\nvec4 clouds = texture2D( tClouds, vUv );\ngl_FragColor = mix(flamingos, clouds, clouds.a);\ngl_FragColor.rgb *= 1./gl_FragColor.a;\n}"});
C.addObject(new THREE.Mesh(new THREE.Plane(window.innerWidth,window.innerHeight),V));this.getDomElement=function(){return z.domElement};this.show=function(){b.signals.mousemoved.add(c)};this.hide=function(){b.signals.mousemoved.remove(c)};this.resize=function(I,P){y.aspect=I/P;y.updateProjectionMatrix();z.setSize(I,P);z.domElement.style.width=I+"px";z.domElement.style.height=P+"px"};this.update=function(){position=((new Date).getTime()-start_time)*0.03%4E3;w=(new Date).getTime();v=w-x;x=w;y.position.x+=
(p.x-y.position.x)*0.0090;y.position.y+=(-p.y-y.position.y)*0.0090;y.position.z=-position+4E3;H.position.z=y.position.z-500;H.position.y=-50;y.target.position.x=y.position.x;y.target.position.y=y.position.y;y.target.position.z=y.position.z-1E3;z.clear();z.render(B,y,S,!0);z.render(E,y,t,!0);z.render(C,A);for(var I=0,P=n.length;I<P;I++){g=o[I];u.z=g.position.z;g.run(o);h=n[I];h.rotation.y=Math.atan2(-g.velocity.z,g.velocity.x)+Math.PI/2;h.rotation.z=Math.asin(g.velocity.y/g.velocity.length());h.phase=
(h.phase+(Math.max(0,h.rotation.z)+0.1))%62.83;m[I].update(v*h.phase/100)}}},Boid=function(){var b=new THREE.Vector3,f,c=500,d=500,g=200,h,n=!1;this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;f=new THREE.Vector3;this.setGoal=function(o){h=o};this.setAvoidWalls=function(o){n=o};this.setWorldSize=function(o,m,p){c=o;d=m;g=p};this.run=function(o){if(n){b.set(-c*15,this.position.y,this.position.z);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(c,this.position.y,this.position.z);
b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,0,this.position.z);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,d,this.position.z);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,this.position.y,-g);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b);b.set(this.position.x,this.position.y,g);b=this.avoid(b);b.multiplyScalar(5);f.addSelf(b)}Math.random()>0.5&&this.flock(o);this.move()};this.flock=function(o){h&&f.addSelf(this.reach(h,
0.0050));f.addSelf(this.alignment(o));f.addSelf(this.cohesion(o));f.addSelf(this.separation(o))};this.move=function(){this.velocity.addSelf(f);var o=this.velocity.length();o>0.6&&this.velocity.divideScalar(o/0.6);this.position.addSelf(this.velocity);f.set(0,0,0)};this.checkBounds=function(){if(this.position.x>c)this.position.x=-c;if(this.position.x<-c)this.position.x=c;if(this.position.y>d)this.position.y=-d;if(this.position.y<-d)this.position.y=d;if(this.position.z>g)this.position.z=-g;if(this.position.z<
-g)this.position.z=g};this.avoid=function(o){var m=new THREE.Vector3;m.copy(this.position);m.subSelf(o);m.multiplyScalar(1/this.position.distanceToSquared(o));return m};this.repulse=function(o){var m=this.position.distanceTo(o);if(m<150){var p=new THREE.Vector3;p.sub(this.position,o);p.multiplyScalar(0.5/m);f.addSelf(p)}};this.reach=function(o,m){var p=new THREE.Vector3;p.sub(o,this.position);p.multiplyScalar(m);return p};this.alignment=function(o){for(var m,p=new THREE.Vector3,u=0,v=0,w=o.length;v<
w;v++)if(!(Math.random()>0.6)){m=o[v];distance=m.position.distanceTo(this.position);if(distance>0&&distance<=3E3){p.addSelf(m.velocity);u++}}if(u>0){p.divideScalar(u);o=p.length();o>0.03&&p.divideScalar(o/0.03)}return p};this.cohesion=function(o){for(var m,p,u=new THREE.Vector3,v=new THREE.Vector3,w=0,x=0,y=o.length;x<y;x++)if(!(Math.random()>0.6)){m=o[x];p=m.position.distanceTo(this.position);if(p>0&&p<=3E3){u.addSelf(m.position);w++}}w>0&&u.divideScalar(w);v.sub(u,this.position);o=v.length();o>
0.03&&v.divideScalar(o/0.03);return v};this.separation=function(o){for(var m,p,u=new THREE.Vector3,v=new THREE.Vector3,w=0,x=o.length;w<x;w++)if(!(Math.random()>0.6)){m=o[w];p=m.position.distanceTo(this.position);if(p>0&&p<=3E3){v.sub(this.position,m.position);v.normalize();v.divideScalar(p);u.addSelf(v)}}return u}},UgcIntro=function(b){var f=document.createElement("div");f.style.position="absolute";f.style.width=window.innerWidth+"px";f.style.height=window.innerHeight+"px";f.style.background="rgba(0,0,0,0.75)";
var c=document.createElement("div");c.style.position="absolute";c.style.left=window.innerWidth/2-384+"px";c.style.top=window.innerHeight/2-97+"px";c.style.width="272px";c.style.height="137px";c.style.background="url(/files/ugcIntro/instructions.png) 0 0 no-repeat";f.appendChild(c);var d=document.createElement("div");d.style.position="absolute";d.style.left=window.innerWidth/2+38+"px";d.style.top=window.innerHeight/2-197+"px";d.style.width="234px";d.style.height="71px";d.style.overflow="hidden";d.style.cursor=
"pointer";var g=document.createElement("img");g.setAttribute("src","/files/ugcIntro/sky.png");g.setAttribute("alt","SKY");g.style.display="block";d.appendChild(g);var h=document.createElement("div");h.style.position="absolute";h.style.left=window.innerWidth/2+54+"px";h.style.top=window.innerHeight/2+62+"px";h.style.width="197px";h.style.height="71px";h.style.overflow="hidden";h.style.cursor="pointer";var n=document.createElement("img");n.setAttribute("src","/files/ugcIntro/ground.png");n.setAttribute("alt",
"GROUND");n.style.display="block";h.appendChild(n);f.appendChild(d);f.appendChild(h);d.addEventListener("mouseover",function(){g.style.marginTop="-71px"},!1);d.addEventListener("mouseout",function(){g.style.marginTop="0px"},!1);d.addEventListener("click",function(){b.ugcSignals.showobjectcreator.dispatch(1)},!1);h.addEventListener("mouseover",function(){n.style.marginTop="-71px"},!1);h.addEventListener("mouseout",function(){n.style.marginTop="0px"},!1);h.addEventListener("click",function(){b.ugcSignals.showobjectcreator.dispatch(0)},
!1);this.show=function(){};this.resize=function(o,m){f.style.width=o+"px";f.style.height=m+"px";c.style.left=o/2-384+"px";c.style.top=m/2-97+"px";d.style.left=o/2+38+"px";d.style.top=m/2-197+"px";h.style.left=o/2+54+"px";h.style.top=m/2+62+"px"};this.hide=function(){};this.getDomElement=function(){return f};this.update=function(){}};
function ColorPicker(b){function f(){B.clearRect(0,0,E,z);B.drawImage(W==0?T:$,u,u);B.fillStyle="rgba(0,0,0,"+(1-V/100)+")";B.save();B.translate(E/2,z/2);B.rotate(Math.PI/2);c(177,0,0);B.fill();B.restore();var S=C.createLinearGradient(u,0,E-u,0),t=new DAT.Color(F);t.v=100;S.addColorStop(0,t.toString());S.addColorStop(1,"#000");C.strokeStyle="#fff";C.lineWidth=3;C.clearRect(0,0,E,z);C.fillStyle=S;C.fillRect(u,u,E-u*2,v);c(v/2+5.5,(1-Math.round(F.v)/100)*(E-u*2)+u,u+v/2,C);C.fill();C.stroke()}function c(S,
t,M,I){I=I||B;I.beginPath();I.moveTo(Math.cos(0)*S+t,Math.sin(0)*S+M);for(var P=0,O=0;P<=6;P++,O=P/6*Math.PI*2)I.lineTo(Math.cos(O)*S+t,Math.sin(O)*S+M)}function d(S,t){S=S||H;t=t||G;H=S;G=t;B.fillStyle=F.toString();B.strokeStyle="#fff";B.lineWidth=3;B.save();B.translate(S,t);B.rotate(Math.PI/2);c(20,0,0);B.restore();B.fill();B.stroke()}function g(S){S.stopImmediatePropagation();S.stopPropagation();document.removeEventListener("mousemove",o,!1);document.removeEventListener("mousemove",h,!1);document.removeEventListener("mouseup",
g,!1);p.onColorChange(F.hex)}function h(S){S.stopImmediatePropagation();S.stopPropagation();S=S.pageX-n(x).left;if(S>=u&&S<=E-u){V=100-(S-u)/(E-u*2)*100;F.v=V;f();d()}}function n(S){var t=0,M=0;if(S.offsetParent){do{t+=S.offsetLeft;M+=S.offsetTop}while(S=S.offsetParent)}return{left:t,top:M}}function o(S){S.stopImmediatePropagation();S.stopPropagation();var t=n(y),M=S.pageX-t.left;S=S.pageY-t.top;if(m(M,S)){f();d(M,S)}}function m(S,t){S=S||H;t=t||G;var M=A.getImageData(S,t,1,1).data;if(M[3]<255)return!1;
F.r=M[0];F.g=M[1];F.b=M[2];F.v=V;return!0}var p=this,u=20,v=20,w=document.createElement("canvas"),x=document.createElement("canvas");x.style.position="relative";var y=document.createElement("canvas");y.style.position="relative";y.style.top=0;this.domElement=document.createElement("div");this.domElement.setAttribute("id","ugcui-color-picker");var A,B,C,E,z,H,G,F=new DAT.Color(255,255,255),T=document.createElement("img"),$=document.createElement("img");T.src="/files/wheel.png";$.src="/files/wheel-sky.png";
var W=0,V=100;this.onColorChange=function(){};this.setType=function(S){W=S;if(S==1){x.style.display="none";A.drawImage($,u,u)}else{x.style.display="block";A.drawImage(T,u,u)}m();p.onColorChange(F.hex);f();d()};T.onload=function(){E=x.width=w.width=y.width=T.width+u*2;z=w.height=y.height=T.height+u*2;x.height=v+u*2;C=x.getContext("2d");p.domElement.appendChild(y);p.domElement.appendChild(x);b.appendChild(p.domElement);A=w.getContext("2d");A.drawImage(T,u,u);B=y.getContext("2d");C.shadowBlur=B.shadowBlur=
4;C.shadowColor=B.shadowColor="rgba(0,0,0,0.3)";H=E/2;G=z/2;f();d()};y.addEventListener("mousedown",function(S){S.stopImmediatePropagation();S.stopPropagation();o(S);document.addEventListener("mousemove",o,!1);document.addEventListener("mouseup",g,!1)},!1);x.addEventListener("mousedown",function(S){S.stopImmediatePropagation();S.stopPropagation();h(S);document.addEventListener("mousemove",h,!1);document.addEventListener("mouseup",g,!1)},!1)}
var UgcUI=function(b){function f(I,P){var O=document.createElement(I);O.setAttribute("class",P);return O}function c(I,P){var O=document.createElement(I);O.setAttribute("id",P);return O}function d(I,P){var O;O=typeof I=="string"?document.getElementById(I):I;O.addEventListener("mouseup",function(){P.call(O)},!1)}function g(){E.style.zIndex="-20";z.style.top="200%";z.style.opacity=0;G.value=u;F.value="YOUR EMAIL ADDRESS";n(document.getElementById("agree-terms"),"error");document.getElementById("agree").checked=
!1;W=!1}function h(I,P){I.getAttribute("class").indexOf(P)==-1&&I.setAttribute("class",I.getAttribute("class")+" "+P)}function n(I,P){if(I.getAttribute("class").indexOf(P)!=-1){var O;I.setAttribute("class",I.getAttribute("class").replace(RegExp(" "+P,"g"),""))}}function o(){var I=f("div","animal"),P=f("img","animal-thumb");P.src="/files/soupthumbs/test.png";P.style.position="absolute";var O=f("div","animal-controls"),R=f("div","animal-count");R.style.font="12px/22px FuturaBT-Bold";R.innerHTML="0";
var ca=f("div","animal-add");ca.style.font="12px/22px FuturaBT-Bold";ca.innerHTML="+";var U=f("div","animal-remove");U.style.font="12px/22px FuturaBT-Bold";U.innerHTML="-";I.appendChild(P);O.appendChild(U);O.appendChild(R);O.appendChild(ca);I.appendChild(O);return I}function m(I){if(!(I==undefined||I.style==undefined)){I.onselectstart=function(){return!1};I.style.MozUserSelect="none";I.style.KhtmlUserSelect="none";I.unselectable="on";I=I.childNodes;for(var P=0;P<I.length;P++)m(I[P])}}var p=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,
u="GIVE YOUR DREAM A TITLE",v=0,w=0,x=document.createElement("div"),y=document.createElement("style");y.setAttribute("type","text/css");y.innerHTML='.ugcui { position: fixed;  } \n#ugcui-top-right { position: fixed; top: 40px; right: 40px; } \n#ugcui-bottom-right { position: fixed; bottom: 40px; right: 40px; z-index: 5 } \n#ugcui-top-left { position: fixed; top: 10px; left: 35px; } \n#ugcui-bottom-left { position: fixed; bottom: 120px; left: 35px; } \n.ugcui g.button {\n  cursor: pointer;\n}\n.ugcui g.button polygon.hex {\n  fill: rgba(255, 255, 255, 0.7);\n}\n.ugcui g.button:not(.disabled):hover polygon.hex {\n  fill: #fff;\n}\n.ugcui g.button.active polygon.hex {\n  fill: #F15C22;\n}\n.ugcui g.button.active:hover polygon.hex {\n  fill: #F77952;\n}\n.ugcui g.folder g.options, .ugcui g.folder polygon.hitbox {\n  display: none;\n}\n.ugcui g.disabled { opacity: 0.1; cursor: auto; }\n.ugcui g.folder:hover g.options {\n  display: block;\n}\n.ugcui g.folder:hover #ugcui-zoom-folder polygon.hex { fill: #fff; }\n.ugcui g.folder polygon.hitbox {\n  display: block; fill-opacity: 0;\n}\n#ugcui-size g.button.active polygon.hex { fill: rgba(255, 255, 255, 0.7); }\n#ugcui-size:hover g.button.active polygon.hex { fill: #F15C22; }\n#ugcui-size:hover g.button.active:hover polygon.hex { fill: #F77952; }\n#agree-terms.error { background-color: rgba(255, 0, 0, 0.3); }\n#voxel-submit-text { float: left; width: 300px; margin-right: 10px; }\n#voxel-submit-inputs { margin-right: 10px; margin-top: -4px; float: left; }\n#voxel-submit-submit { cursor: pointer; letter-spacing: 0.025em; font: 17px/65px FuturaBT-Bold, sans-serif; float: left; border: 1px solid #d6d1c2; width: 200px; text-align: center; margin-top: -2px;  }\n#voxel-submit-submit:hover { border-color: #404040; background-color: #404040; color: #f4f1e8; }\n#voxel-submit input[type="text"] { margin-bottom: 3px; color: #404040; font: 11px/22px FuturaBT-Bold, sans-serif; width: 200px; padding: 2px 4px  }\n#voxel-submit a { color: #000 } \n#voxel-submit-image { margin-bottom: 20px; width: 735px; height: 465px; background-color: #000; }\n#voxel-submit-shade { z-index: -12; opacity: 0.4; -webkit-transition: opacity 0.2s linear; background-color: #f4f1e8; position: fixed; top: 0; left: 0; width: 100%; height: 100% }\n#voxel-submit { font: 12px/18px FuturaBT-Medium; color: #404040; z-index: 21; opacity: 0; -webkit-transition: opacity 0.2s linear; width: 735px; height: 556px; padding: 13px; margin-left: -380px; margin-top: -291px; background-color: #f4f1e8; box-shadow: 0px 0px 10px rgba(0,0,0,0.3) }\n#voxel-submit small { line-height: 15px; display: block; margin-top: 7px }\n.animal-container { opacity: 1; -webkit-transition: opacity 0.3s linear; }\n.animal { text-align: center; -webkit-transition: all 0.1s linear; float: left; height: 92px; background: url(/files/soupthumbs/shadow.png); border: 1px solid rgba(0,0,0,0); width: 120px; margin-right: 10px; }\n.animal:hover { background-color: rgba(255, 255, 255, 0.4); border: 1px solid #fff; }\n.animal-controls { height: 21px; overflow:hidden; line-height: 0px; border-right: 1px solid #fff; opacity: 0; display: inline-block; position: relative; margin-top: 71px; }\n.animal:hover .animal-controls { opacity: 1; }\n.animal-controls div { display: none; text-align: center; border: 1px solid #fff; border-right: 0; border-bottom: 0; display: inline-block; width: 20px;}\n.animal-controls div.animal-add:hover, .animal-controls div.animal-remove:hover { cursor: pointer; background-color: #f65824; }\n.animal-controls div.animal-count { background-color: #fff; color: #777; width: 25px; }';
document.getElementsByTagName("head")[0].appendChild(y);x.innerHTML+='<svg class="ugcui" id="ugcui-top-left" version="1.1"\n     xmlns="http://www.w3.org/2000/svg"\n     xmlns:xlink="http://www.w3.org/1999/xlink"\n     xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n     x="0px" y="0px" width="800px" height="600px" viewBox="0 -1.338 800 600"\n     enable-background="new 0 -1.338 800 600"\n     xml:space="preserve" >\n    <g class="button" title="Symmetry Mode [s]" id="ugcui-reflect">\n      <polygon class="hex"\n               points="13.126,93.332 0,70.598 13.126,47.862 39.377,47.862 52.503,70.598 39.377,93.332 "/>\n      <path fill="#404040" d="M26.195,77.438c-0.428,0-0.771,0.345-0.771,0.771v1.158c0,0.428,0.343,0.772,0.771,0.772\n  s0.771-0.345,0.771-0.772v-1.158C26.966,77.783,26.623,77.438,26.195,77.438 M26.195,73.965c-0.428,0-0.771,0.344-0.771,0.771v1.158\n  c0,0.425,0.343,0.771,0.771,0.771s0.771-0.346,0.771-0.771v-1.158C26.966,74.309,26.623,73.965,26.195,73.965 M20.23,64.94\n  l-4.149-4.594c-0.238-0.262-0.61-0.351-0.939-0.224c-0.327,0.125-0.545,0.441-0.545,0.794v9.187v9.188\n  c0,0.351,0.218,0.667,0.545,0.793c0.1,0.039,0.203,0.057,0.306,0.057c0.235,0,0.467-0.098,0.633-0.28l4.149-4.594l4.149-4.593\n  c0.293-0.324,0.293-0.817,0-1.142L20.23,64.94z M18.968,74.126l-2.667,2.952v-6.976v-6.976l2.667,2.955l3.632,4.021L18.968,74.126z\n  M28.011,69.532c-0.292,0.324-0.292,0.817,0,1.142l4.149,4.593l4.149,4.594c0.165,0.183,0.397,0.28,0.633,0.28\n  c0.103,0,0.205-0.018,0.306-0.057c0.327-0.126,0.544-0.442,0.544-0.793v-9.188v-9.187c0-0.353-0.216-0.669-0.544-0.794\n  c-0.33-0.127-0.702-0.038-0.938,0.224L32.16,64.94L28.011,69.532z M29.79,70.103l3.634-4.021l2.667-2.955v6.976v6.976l-2.667-2.952\n  L29.79,70.103z M26.195,70.489c-0.428,0-0.771,0.345-0.771,0.772v1.159c0,0.427,0.343,0.772,0.771,0.772s0.771-0.345,0.771-0.772\n  v-1.159C26.966,70.834,26.623,70.489,26.195,70.489 M26.195,60.066c-0.428,0-0.771,0.346-0.771,0.772v1.158\n  c0,0.427,0.343,0.773,0.771,0.773s0.771-0.347,0.771-0.773v-1.158C26.966,60.412,26.623,60.066,26.195,60.066 M26.195,63.541\n  c-0.428,0-0.771,0.345-0.771,0.772v1.158c0,0.428,0.343,0.771,0.771,0.771s0.771-0.343,0.771-0.771v-1.158\n  C26.966,63.886,26.623,63.541,26.195,63.541 M26.195,67.014c-0.428,0-0.771,0.346-0.771,0.772v1.158\n  c0,0.426,0.343,0.772,0.771,0.772s0.771-0.346,0.771-0.772v-1.158C26.966,67.36,26.623,67.014,26.195,67.014"/>\n    </g>\n    <g class="button active" title="Draw [d]" id="ugcui-create">\n      <polygon class="hex" points="54.576,69.401 41.45,46.666 54.576,23.932 80.828,23.932 93.954,46.666\n  80.827,69.401 "/>\n      <path fill="#404040" d="M67.92,32.249l-12.121,7.29l-0.154-0.098v13.47l12.256,7.661l12.258-7.661V40.265L67.92,32.249z\n  M67.883,34.149l9.991,6.543l-9.978,6.405l-10.564-6.602L67.883,34.149z M57.255,42.346l9.842,6.151v9.673l-9.842-6.151V42.346z\n  M78.548,52.019l-9.842,6.15v-9.679l9.842-6.318V52.019z"/>\n    </g>\n    <g class="button" title="Erase [e]" id="ugcui-erase">\n      <polygon class="hex" points="96.026,93.332 82.9,70.598 96.026,47.862 122.277,47.862 135.404,70.597\n  122.277,93.332 "/>\n      <path fill="#404040" d="M111.728,61.285l-13.493,7.131v5.163l9.462,5.387l13.086-7.798v-4.968L111.728,61.285z M113.478,69.723\n  l-5.788,3.394l-7.658-4.416l6.083-3.215L113.478,69.723z M108.238,74.062l5.928-3.477v3.252l-5.928,3.534V74.062z M99.328,69.556\n  l7.817,4.509v3.328l-7.817-4.45V69.556z"/>\n    </g>\n    <g class="button" title="Fill Color [f]" id="ugcui-color">\n      <polygon class="hex" points="96.026,141.194 82.9,118.46 96.026,95.725 122.277,95.725 135.404,118.459\n  122.277,141.194 "/>\n      <path fill="#404040" d="M121.346,114.964c-2.85-3.684-8.097-1.808-8.097-1.808s3.946,3.913,5.455,5.42\n  c1.633,1.633,2.081,10.199,3.058,8.201C123.29,123.65,123.54,117.801,121.346,114.964 M110.458,110.993v2.259l6.309,6.309\n  l-10.072,10.071l-8.699-8.697l10.074-10.073l0.27,0.271v-2.149c-0.084-0.031-0.176-0.049-0.27-0.049\n  c-0.213,0-0.414,0.082-0.565,0.233l-11.202,11.204c-0.312,0.311-0.312,0.817,0,1.129l9.827,9.828\n  c0.152,0.151,0.352,0.235,0.565,0.235c0.211,0,0.413-0.084,0.565-0.235l11.202-11.203c0.151-0.152,0.235-0.353,0.235-0.565\n  c0-0.214-0.084-0.413-0.236-0.563L110.458,110.993z M101.645,108.202c0.001-0.733,0.593-1.325,1.324-1.326h4.543\n  c0.729,0.001,1.322,0.593,1.323,1.324v8.447c-0.212,0.081-0.41,0.205-0.579,0.374c-0.321,0.32-0.485,0.748-0.483,1.17\n  c-0.001,0.421,0.163,0.85,0.484,1.172c0.322,0.323,0.749,0.487,1.173,0.485h0.004c0.419,0,0.844-0.162,1.167-0.484l-0.396-0.397\n  l0.398,0.396c0.321-0.322,0.484-0.75,0.484-1.172s-0.163-0.85-0.485-1.171c-0.186-0.186-0.407-0.313-0.642-0.391v-8.429\n  c0-1.353-1.095-2.449-2.448-2.449h-4.543c-1.353,0-2.45,1.096-2.45,2.451v7.208l1.126-1.126V108.202z M109.053,117.816\n  c0.107-0.107,0.239-0.156,0.378-0.158c0.137,0.001,0.271,0.051,0.374,0.156c0.107,0.106,0.155,0.239,0.155,0.376\n  c0,0.136-0.049,0.271-0.155,0.378c-0.104,0.104-0.239,0.153-0.374,0.153c-0.139,0-0.272-0.051-0.377-0.154\n  c-0.104-0.105-0.155-0.24-0.155-0.377C108.9,118.053,108.95,117.92,109.053,117.816"/>\n    </g>\n        <g class="button" title="Large" transform="translate(41.5 ,-23)" id="ugcui-size-med">\n          <polygon class="hex" points="13.126,188.696 0,165.962 13.126,143.227 39.377,143.227 52.503,165.962\n    39.377,188.696 "/>\n          <path fill="#404040" d="M35.384,164.724v-9.757l-8.837-4.797l-9.248,4.927v9.452l-9.613,5.704l18.509,11.5l18.509-11.5\n    L35.384,164.724z M20.675,170.283l2.864-1.765l2.803,1.666l2.609-1.564l2.74,1.678l-5.496,3.367L20.675,170.283z M25.674,173.983\n    l-5.517,3.378l-5.459-3.391l5.458-3.367L25.674,173.983z M34.889,165.062l2.718,1.612l-5.395,3.305l-2.734-1.674L34.889,165.062z\n    M23.011,168.204l-2.856,1.761l-5.373-3.291l2.832-1.68L23.011,168.204z M32.212,170.616l5.478,3.354l-5.458,3.391l-5.517-3.378\n    L32.212,170.616z M32.732,170.297l5.404-3.31l5.52,3.276l-5.45,3.386L32.732,170.297z M14.253,166.988l5.383,3.297l-5.454,3.364\n    l-5.449-3.385L14.253,166.988z M20.675,177.683l5.52-3.381l5.519,3.381l-5.519,3.429L20.675,177.683z"/>\n        </g>\n      </g>\n      <g class="button active" title="Small" id="ugcui-size-small">\n        <polygon class="hex" points="13.126,141.194 0,118.46 13.126,95.725 39.377,95.725 52.503,118.46 39.377,141.194\n    "/>\n        <path fill="#404040" d="M32.34,113.829v-6.316l-6.006-3.258l-6.285,3.118v6.456l-12.364,7.334l18.509,11.5l18.509-11.5\n    L32.34,113.829z M20.676,121.195l5.477-3.378l5.539,3.391l-5.497,3.367L20.676,121.195z M25.674,124.894l-5.517,3.378l-5.457-3.391\n    l5.457-3.367L25.674,124.894z M29.156,115.964l2.936-1.65l5.515,3.272l-5.395,3.304l-5.541-3.393L29.156,115.964z M20.366,114.272\n    l5.266,3.226l-5.476,3.378l-5.374-3.29L20.366,114.272z M32.212,121.527l5.477,3.354l-5.457,3.39l-5.517-3.378L32.212,121.527z\n    M32.733,121.208l5.403-3.309l5.52,3.274l-5.45,3.386L32.733,121.208z M14.253,117.899l5.384,3.297l-5.454,3.364l-5.45-3.386\n    L14.253,117.899z M20.675,128.594l5.521-3.381l5.52,3.38l-5.52,3.43L20.675,128.594z"/>\n      </g>\n    </g>\n</svg>';
x.innerHTML+='<svg class="ugcui" id="ugcui-top-right" version="1.1"\n\t xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"\n\t x="0px" y="0px" width="70px" height="70px" viewBox="-2 -2 60 60"\n\t xml:space="preserve">\n<g transform="translate(-1, 0)" class="button" id="ugcui-quit">\n<polygon class="hex" points="13.126,45.469 0,22.735 13.126,0 39.377,0 52.504,22.735 39.377,45.469 "/>\n<path fill="#222222" d="M22.568,23.39c0-1.193-0.437-2.16-1.309-2.901c-0.726-0.617-1.547-0.925-2.462-0.925\n\tc-1.01,0-1.885,0.352-2.626,1.056c-0.764,0.726-1.145,1.632-1.145,2.719c0,1.109,0.403,2.02,1.21,2.733\n\tc0.741,0.648,1.59,0.972,2.546,0.972c0.738,0,1.408-0.193,2.01-0.58l0.564,0.58h1.369l-1.191-1.164\n\tC22.224,25.155,22.568,24.325,22.568,23.39z M20.778,25.096l-1.046-1.041h-1.407l1.696,1.644c-0.38,0.215-0.805,0.322-1.275,0.322\n\tc-0.691,0-1.307-0.255-1.846-0.766c-0.517-0.495-0.775-1.131-0.775-1.909c0-0.796,0.251-1.455,0.752-1.975\n\tc0.499-0.523,1.134-0.784,1.906-0.784c0.764,0,1.402,0.261,1.916,0.784s0.771,1.172,0.771,1.947\n\tC21.47,24.024,21.239,24.617,20.778,25.096z"/>\n<path fill="#222222" d="M28.188,24.041c0,0.629-0.102,1.082-0.304,1.359c-0.303,0.414-0.729,0.621-1.28,0.621\n\tc-0.548,0-0.974-0.207-1.275-0.621c-0.203-0.287-0.304-0.739-0.304-1.359v-4.342h-1.089v4.644c0,0.76,0.236,1.386,0.71,1.878\n\tc0.53,0.548,1.183,0.822,1.958,0.822s1.43-0.274,1.962-0.822c0.474-0.492,0.711-1.118,0.711-1.878v-4.644h-1.089V24.041z"/>\n<rect x="31.006" y="19.699" fill="#222222" width="1.089" height="7.214"/>\n<polygon fill="#222222" points="33.071,19.699 33.071,20.722 34.729,20.722 34.729,26.913 35.818,26.913 35.818,20.722 \n\t37.473,20.722 37.473,19.699 "/>\n</g>\n</svg>';
x.innerHTML+='<svg id="ugcui-bottom-right" class="ugcui" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t x="0px" y="0px" width="70px" height="70px" viewBox="-2 -2 60 60" xml:space="preserve">\n<g class="button" transform="translate(-1, 0)" id="ugcui-submit">\n<polygon class="hex" points="13.126,45.469 0,22.735 13.126,0 39.377,0 \n\t52.504,22.734 39.377,45.469 "/><g transform="translate(0,-1)">\n<path fill="#222222" d="M13.54,21.303l-0.883,0.523c-0.166-0.287-0.323-0.474-0.473-0.561c-0.155-0.1-0.356-0.15-0.603-0.15\n\tc-0.302,0-0.553,0.086-0.752,0.258c-0.199,0.168-0.299,0.381-0.299,0.636c0,0.353,0.262,0.636,0.784,0.851l0.72,0.295\n\tc0.586,0.237,1.014,0.526,1.285,0.867c0.271,0.342,0.406,0.76,0.406,1.256c0,0.664-0.221,1.213-0.663,1.646\n\tc-0.445,0.437-0.998,0.655-1.659,0.655c-0.626,0-1.143-0.187-1.551-0.559C9.451,26.647,9.2,26.125,9.1,25.452l1.103-0.242\n\tc0.05,0.424,0.137,0.717,0.262,0.878c0.224,0.312,0.551,0.468,0.98,0.468c0.34,0,0.622-0.113,0.846-0.342\n\tc0.225-0.227,0.337-0.515,0.337-0.863c0-0.14-0.02-0.268-0.059-0.385c-0.039-0.117-0.1-0.225-0.183-0.322\n\tc-0.082-0.098-0.188-0.189-0.319-0.275c-0.131-0.086-0.287-0.168-0.468-0.245l-0.696-0.29c-0.987-0.416-1.48-1.027-1.48-1.83\n\tc0-0.541,0.207-0.994,0.621-1.358c0.414-0.367,0.93-0.551,1.547-0.551C12.423,20.093,13.072,20.496,13.54,21.303z"/>\n<path fill="#222222" d="M16.128,20.232v4.342c0,0.62,0.101,1.072,0.304,1.359c0.302,0.414,0.728,0.621,1.275,0.621\n\tc0.552,0,0.978-0.207,1.28-0.621c0.202-0.277,0.304-0.73,0.304-1.359v-4.342h1.089v4.645c0,0.76-0.237,1.387-0.711,1.879\n\tc-0.532,0.548-1.187,0.822-1.962,0.822s-1.428-0.274-1.958-0.822c-0.474-0.492-0.71-1.119-0.71-1.879v-4.645H16.128z"/>\n<path fill="#222222" d="M22.108,27.447v-7.215h1.084c0.482,0,0.867,0.037,1.154,0.113c0.289,0.074,0.534,0.2,0.733,0.378\n\tc0.202,0.184,0.362,0.413,0.481,0.687c0.121,0.277,0.182,0.558,0.182,0.842c0,0.517-0.197,0.954-0.593,1.312\n\tc0.383,0.131,0.685,0.359,0.906,0.687c0.225,0.324,0.336,0.7,0.336,1.131c0,0.563-0.199,1.04-0.598,1.43\n\tc-0.24,0.239-0.51,0.406-0.809,0.5c-0.327,0.091-0.736,0.136-1.229,0.136h-1.647V27.447z M23.197,23.33h0.341\n\tc0.405,0,0.702-0.089,0.891-0.268c0.188-0.18,0.282-0.443,0.282-0.793c0-0.339-0.097-0.597-0.29-0.773\n\tc-0.192-0.176-0.474-0.264-0.841-0.264h-0.383V23.33z M23.197,26.424h0.673c0.492,0,0.854-0.097,1.084-0.29\n\tc0.243-0.208,0.364-0.474,0.364-0.794c0-0.312-0.117-0.573-0.351-0.785c-0.228-0.209-0.634-0.312-1.22-0.312h-0.551L23.197,26.424\n\tL23.197,26.424z"/>\n<path fill="#222222" d="M27.515,27.447l1.519-7.756l2.476,5.605l2.565-5.605l1.364,7.756h-1.116l-0.696-4.355l-2.136,4.687\n\tl-2.074-4.69l-0.775,4.359h-1.127V27.447z"/>\n<path fill="#222222" d="M38.055,20.232v7.215h-1.089v-7.215H38.055z"/>\n<path fill="#222222" d="M41.778,21.256v6.191h-1.089v-6.191h-1.658v-1.023h4.401v1.023H41.778z"/>\n</g></g>\n</svg>';
x.innerHTML+='<svg class="ugcui" id="ugcui-bottom-left" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="800px"\n\t height="200px" viewBox="-2 -100 800 200" enable-background="new 0 0 800 200" xml:space="preserve">\n<g class="button" id="ugcui-rotate" title="Rotate [R]">\n\t<polygon class="hex" points="13.127,21.759 0,-0.975 13.127,-23.71 39.377,-23.71 52.504,-0.975 39.377,21.759"/>\n\t<path fill="#404040" d="M38.91-5.208c-0.406-0.224-0.83-0.434-1.266-0.633v-4.373l-10.986-5.962L15.162-10.47v4.656\n\t\tc-0.391,0.179-0.771,0.365-1.135,0.563C10.816-3.495,8.951-1.157,8.67,1.388H6.924L9.41,4.831l2.486-3.443h-1.66\n\t\tc0.295-1.96,1.875-3.812,4.539-5.27c0.123-0.067,0.26-0.125,0.387-0.19v5.677l11.496,6.545l10.986-6.18v-6.064\n\t\tc0.17,0.086,0.348,0.166,0.512,0.257c2.959,1.63,4.586,3.742,4.582,5.946c-0.004,2.202-1.639,4.308-4.604,5.928\n\t\tc-3.1,1.695-7.23,2.625-11.639,2.625h-0.055v0.001c-0.188,0-0.371-0.002-0.555-0.006l-0.031,1.562\n\t\tc0.195,0.003,0.387,0.005,0.582,0.005l0,0h0.059c4.664,0,9.062-1,12.387-2.816c3.486-1.906,5.41-4.498,5.416-7.297\n\t\tC44.303-0.69,42.391-3.287,38.91-5.208z"/>\n\t<path fill="#404040" d="M13.49,9.064c0.598,0.359,1.246,0.696,1.932,0.999l0.635-1.426c-0.627-0.281-1.219-0.586-1.766-0.912\n\t\tL13.49,9.064z"/>\n\t<path fill="#404040" d="M16.422,10.478c0.65,0.25,1.338,0.479,2.043,0.679l0.424-1.503c-0.658-0.188-1.299-0.398-1.906-0.635\n\t\tL16.422,10.478z"/>\n\t<path fill="#404040" d="M22.662,11.991c0.699,0.087,1.414,0.15,2.129,0.188l0.082-1.56c-0.678-0.037-1.357-0.096-2.021-0.178\n\t\tL22.662,11.991z"/>\n\t<path fill="#404040" d="M19.504,11.427c0.682,0.162,1.389,0.305,2.1,0.417L21.85,10.3c-0.674-0.105-1.34-0.24-1.984-0.392\n\t\tL19.504,11.427z"/>\n</g>\n<g class="folder"  id="ugcui-zoom">\t\n\t<g class="options">\n\t<polygon class="hitbox" points="97.417,22.957 82.56,-2.779 52.844,-2.779 39.029,21.152 11.394,21.152 \n\t\t-3.464,46.888 11.394,72.622 39.027,72.622 52.844,96.553 82.559,96.553 97.417,70.818 83.601,46.887 \t"/>\n\t\t<g class="button" title="zoom in" id="ugcui-zoom-in">\n\t\t<polygon class="hex" points="54.576,45.69 41.451,22.957 54.576,0.221 80.828,0.221 93.953,22.957 80.828,45.69"/>\n\t\t<polygon fill="#404040" points="73.414,21.578 68.235,21.578 68.235,16.399 66.093,16.399 66.093,21.578 60.914,21.578 \n\t\t\t60.914,23.721 66.093,23.721 66.093,28.899 68.235,28.899 68.235,23.721 73.414,23.721 \t"/>\n\t\t</g>\n\t\t<g class="button" title="zoom out" id="ugcui-zoom-out">\n\t\t<polygon class="hex" points="54.576,93.553 41.45,70.818 54.576,48.084 80.828,48.084 93.953,70.818 80.827,93.553 "/>\n\t\t<rect x="60.914" y="68.899" fill="#404040" width="12.5" height="2.143"/>\n\t\t</g>\n\t</g><g class="button" title="zoom" id="ugcui-zoom-folder">\n\t<polygon class="hex" points="13.126,69.622 0,46.888 13.126,24.152 39.377,24.152 52.503,46.888 39.377,69.622"/>\n\t<path fill="#404040" d="M24.141,35.035c-4.986,0-9.029,4.043-9.029,9.029c0,4.988,4.043,9.03,9.029,9.03\n\t\tc4.988,0,9.031-4.042,9.031-9.03C33.172,39.078,29.129,35.035,24.141,35.035 M24.141,50.909c-3.779,0-6.844-3.065-6.844-6.845\n\t\tc0-3.778,3.064-6.843,6.844-6.843c3.781,0,6.844,3.064,6.844,6.843C30.984,47.844,27.922,50.909,24.141,50.909"/>\n\t<path fill="#404040" d="M37.717,55.305c0.264,0.275,0.213,0.758-0.109,1.065l-2.216,2.112c-0.323,0.312-0.804,0.343-1.069,0.063\n\t\tl-4.318-4.521c-0.266-0.276-0.215-0.756,0.111-1.065l2.212-2.114c0.326-0.311,0.808-0.341,1.073-0.062L37.717,55.305z"/>\n\t</g></g>\n</g>\n</svg>';
var A=document.createElement("div");A.style.position="fixed";A.style.font="12px/0px FuturaBT-Medium";A.style.padding="13px 7px 10px 7px";A.style.display="none";A.style.backgroundColor="#fff";A.style.boxShadow="-1px 1px 0px rgba(0,0,0,0.4)";A.style.textTransform="uppercase";A.style.color="#000";A.style.zIndex="15";A.innerHTML="CREATE";x.appendChild(A);y=f("div","animal-container");y.setAttribute("id","animal-container");y.style.display="none";y.style.overflow="hidden";y.style.backgroundColor="rgba(255, 255, 255, 0.4)";
y.style.width="100%";y.style.height="114px";y.style.position="fixed";y.style.top="100%";y.style.left=0;y.style.marginTop="-114px";var B=f("div","animal-inner");B.style.padding="10px";B.style.width="1400px";B.style.height="100%";B.style.position="absolute";y.appendChild(B);for(var C=0;C<10;C++)B.appendChild(o());x.appendChild(y);var E=document.createElement("div");E.setAttribute("id","voxel-submit-shade");x.appendChild(E);var z=document.createElement("div");z.addEventListener("mousemove",function(I){I.stopImmediatePropagation&&
I.stopImmediatePropagation();I.stopPropagation()},!1);z.addEventListener("mouseup",function(I){I.stopImmediatePropagation&&I.stopImmediatePropagation();I.stopPropagation()},!1);z.addEventListener("mousedown",function(I){I.stopImmediatePropagation&&I.stopImmediatePropagation();I.stopPropagation()},!1);E.addEventListener("mousemove",function(I){I.stopImmediatePropagation&&I.stopImmediatePropagation();I.stopPropagation()},!1);E.addEventListener("mouseup",function(I){I.stopImmediatePropagation&&I.stopImmediatePropagation();
I.stopPropagation()},!1);E.addEventListener("mousedown",function(I){g();I.stopImmediatePropagation&&I.stopImmediatePropagation();I.stopPropagation()},!1);B=c("div","voxel-submit-text");B.innerHTML='<span id="agree-terms" class="foo"><input id="agree" type="checkbox" /> &nbsp;I agree to the <a id="terms-link" href="/terms">terms and conditions</a>.</span><br/>';B.innerHTML+="<small>Thank you for contributing a model! We'll email you when <br/>your unique dream is approved for sharing.</small>";var H=
c("div","voxel-submit-image");y=c("div","voxel-submit-inputs");var G=c("input","voxel-submit-title");G.setAttribute("type","text");G.setAttribute("value",u);G.setAttribute("maxlength",35);G.addEventListener("focus",function(){this.value=""},!1);var F=c("input","voxel-submit-email");F.setAttribute("type","text");F.setAttribute("value","YOUR EMAIL ADDRESS");F.addEventListener("focus",function(){this.value=""},!1);C=c("div","voxel-submit-submit");C.innerHTML="SUBMIT";C.addEventListener("click",function(){var I=
document.getElementById("voxel-submit-email"),P=document.getElementById("voxel-submit-title").value;I=I.value;var O;if(p.test(I))O=!1;else{alert("Please enter a valid email address");O=!0}if(!O&&!function(R){if(R==u||R.replace(/^\s\s*/,"").replace(/\s\s*$/,"")==""){alert("Please enter a title.");return!0}if(R.length<3){alert("Please enter a title 3 characters or longer.");return!0}return!1}(P))if(document.getElementById("agree").checked){b.ugcSignals.submit.dispatch(P,I);g()}else{alert("You must agree to the terms and conditions.");
h(document.getElementById("agree-terms"),"error")}},!1);var T=!1,$=!1,W=!1;z.appendChild(H);z.appendChild(B);z.appendChild(y);z.appendChild(C);z.setAttribute("id","voxel-submit");z.style.position="fixed";z.style.top="200%";z.style.left="50%";x.appendChild(z);var V=document.createElement("div"),S=new ColorPicker(V);S.onColorChange=function(I){b.ugcSignals.object_changecolor.dispatch(I)};V.style.position="fixed";V.style.left="50%";V.style.top="50%";V.style.display="none";V.style.marginTop="-230px";
V.style.marginLeft="-175px";x.appendChild(V);B=document.createElement("span");B.innerHTML+="<br/>";y.appendChild(F);y.appendChild(B);y.appendChild(G);m(V);m(A);this.setType=function(I){w=I;if(I==1){V.style.display="none";b.ugcSignals.object_changecolor.dispatch(16777215);h(document.getElementById("ugcui-color"),"disabled")}else n(document.getElementById("ugcui-color"),"disabled");S.setType(I)};this.updateCapacity=function(I){document.getElementById("capacity").textContent=Math.round(I*100)+"%"};this.addListeners=
function(){Footer.handleLinkListeners(document.getElementById("terms-link"),"terms");x.addEventListener("mousemove",function(R){A.style.top=R.pageY-40+"px";A.style.left=R.pageX+20+"px"},!0);b.ugcSignals.submit_dialogue.add(function(){W=!0;b.ugcSignals.object_requestsnapshot.dispatch()});b.ugcSignals.object_receivesnapshot.add(function(R){H.style.backgroundImage="url("+R+")";E.style.zIndex="20";z.style.top="50%";z.style.opacity=1});for(var I=document.getElementsByClassName("button"),P=0;P<I.length;P++)if(I[P].getAttribute("title")!=
undefined){I[P].addEventListener("mouseover",function(){if(this.getAttribute("class").indexOf("disabled")==-1){A.style.display="inline-block";A.innerHTML=this.getAttribute("title")}},!1);I[P].addEventListener("mouseout",function(){A.style.display="none"},!1)}window.addEventListener("keydown",function(R){if(!W)switch(R.keyCode){case 90:b.ugcSignals.object_undo.dispatch();break;case 68:b.ugcSignals.object_createmode.dispatch();break;case 70:T?b.ugcSignals.object_createmode.dispatch():b.ugcSignals.object_colormode.dispatch();
break;case 83:b.ugcSignals.object_symmetrymode.dispatch(!$);break;case 69:b.ugcSignals.object_erasemode.dispatch();break;case 82:b.ugcSignals.object_rotatemode.dispatch()}},!1);d("ugcui-color",function(){T?b.ugcSignals.object_createmode.dispatch():b.ugcSignals.object_colormode.dispatch()});d("ugcui-size-small",function(){b.ugcSignals.object_changesize.dispatch(1)});d("ugcui-size-med",function(){b.ugcSignals.object_changesize.dispatch(3)});d("ugcui-submit",function(){b.ugcSignals.submit_dialogue.dispatch()});
d("ugcui-quit",function(){confirm("Are you sure you want to quit?")&&b.signals.showrelauncher.dispatch()});d("ugcui-zoom-in",function(){b.ugcSignals.object_zoomin.dispatch()});d("ugcui-zoom-out",function(){b.ugcSignals.object_zoomout.dispatch()});d("ugcui-create",function(){b.ugcSignals.object_createmode.dispatch()});d("ugcui-erase",function(){b.ugcSignals.object_erasemode.dispatch()});d("ugcui-rotate",function(){b.ugcSignals.object_rotatemode.dispatch()});d("ugcui-reflect",function(){b.ugcSignals.object_symmetrymode.dispatch(!$)});
b.ugcSignals.object_symmetrymode.add(function(R){($=R)?h(document.getElementById("ugcui-reflect"),"active"):n(document.getElementById("ugcui-reflect"),"active")});b.ugcSignals.object_rotatemode.add(function(){T=!1;h(document.getElementById("ugcui-rotate"),"active");n(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-erase"),"active");n(document.getElementById("ugcui-color"),"active");V.style.display="none"});b.ugcSignals.object_erasemode.add(function(){T=!1;h(document.getElementById("ugcui-erase"),
"active");n(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-rotate"),"active");n(document.getElementById("ugcui-color"),"active");V.style.display="none"});b.ugcSignals.object_createmode.add(function(){T=!1;h(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-erase"),"active");n(document.getElementById("ugcui-rotate"),"active");n(document.getElementById("ugcui-color"),"active");V.style.display="none"});b.ugcSignals.object_colormode.add(function(){if(w!=
1){T=!0;n(document.getElementById("ugcui-create"),"active");n(document.getElementById("ugcui-erase"),"active");n(document.getElementById("ugcui-rotate"),"active");h(document.getElementById("ugcui-color"),"active");V.style.display="block"}});I=document.getElementsByClassName("button");for(P=0;P<I.length;P++){var O=I[P];O.addEventListener("mousemove",function(R){R.stopImmediatePropagation&&R.stopImmediatePropagation();R.stopPropagation()},!1);O.addEventListener("mouseup",function(R){R.stopImmediatePropagation&&
R.stopImmediatePropagation();R.stopPropagation()},!1);O.addEventListener("mousedown",function(R){R.stopImmediatePropagation&&R.stopImmediatePropagation();R.stopPropagation()},!1)}b.ugcSignals.object_changesize.add(function(R){n(document.getElementById("ugcui-size-small"),"active");n(document.getElementById("ugcui-size-med"),"active");switch(R){case 1:h(document.getElementById("ugcui-size-small"),"active");break;case 3:h(document.getElementById("ugcui-size-med"),"active");break;case 5:h(document.getElementById("ugcui-size-large"),
"active")}})};var t=0,M=0;this.update=function(){v+=(0-v)*0.5;H.style.backgroundPosition="0px "+-(t*H.offsetHeight)+"px";M++;M%10==0&&(t+=1)};this.getDomElement=function(){return x}},UgcObjectCreator=function(b,f,c){function d(){o=!0;n&&m.update(o)}function g(){o=!1;n&&m.update(o)}function h(){m.moveMouse(b.mouse.x/b.viewportWidth,b.mouse.y/b.viewportHeight);n&&m.update(o)}var n=!1,o=!1,m=new VoxelPainter(f,c);b.ugcSignals.object_createmode.add(function(){m.setMode(VoxelPainter.MODE_CREATE)});b.ugcSignals.object_erasemode.add(function(){m.setMode(VoxelPainter.MODE_ERASE)});
b.ugcSignals.object_symmetrymode.add(function(p){m.setSymmetry(p)});b.ugcSignals.object_rotatemode.add(function(){m.setMode(VoxelPainter.MODE_IDLE)});b.ugcSignals.object_changecolor.add(function(p){m.setColor(p)});b.ugcSignals.object_changesize.add(function(p){m.setSize(p)});b.ugcSignals.object_changesize.add(function(p){m.setSize(p)});this.enable=function(){n=!0};this.disable=function(){n=!1};this.show=function(){b.signals.mousedown.add(d);b.signals.mouseup.add(g);b.signals.mousemoved.add(h)};this.hide=
function(){b.signals.mousedown.remove(d);b.signals.mouseup.remove(g);b.signals.mousemoved.remove(h)};this.getPainter=function(){return m}},UgcSoupCreator=function(b){var f;this.init=function(){b.ugc.scene.collisions=new THREE.CollisionSystem;new THREE.Object3D;f=new UgcSoup(b.ugc.camera,b.ugc.scene,b,!0)};this.getDomElement=function(){return b.renderer.domElement};this.show=function(){};this.hide=function(){};this.resize=function(){};this.update=function(){f.update(20);THREE.AnimationHandler.update(20)}},
VoxelPainter=function(b,f){function c(P){return Math.round(P/h)}function d(P,O,R){if(!(P<-40||P>40))if(!(O<0||O>40))if(!(R<-40||R>40)){var ca=v.getVoxel(P,O,R);if(ca)ca.object.materials[0].color.setHex(m);else{ca=new THREE.Mesh(S.geometry,new THREE.MeshLambertMaterial({color:m}));ca.position.x=P*h;ca.position.y=O*h;ca.position.z=R*h;ca.matrixAutoUpdate=!1;ca.updateMatrix();ca.update();f.addObject(ca);W.push(ca);v.addVoxel(P,O,R,m,ca)}}}function g(P){v.deleteVoxel(c(P.position.x),c(P.position.y),c(P.position.z));
f.removeObject(P);var O=W.indexOf(P);O!==-1&&W.splice(O,1);delete P}var h=50,n=1,o=0,m=16777215,p=VoxelPainter.MODE_CREATE,u=!1,v=new UgcObject,w,x,y,A=[],B=new THREE.Vector3,C=new THREE.Object3D;C.matrixAutoUpdate=!1;C.visible=!1;var E=[],z=new THREE.Plane(8100,8100,2,2),H=new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0});_plane=new THREE.Mesh(z,H);_plane.doubleSided=!0;_plane.visible=C.visible;C.addChild(_plane);E.push(_plane);_plane=new THREE.Mesh(z,H);_plane.rotation.y=
-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=C.visible;C.addChild(_plane);E.push(_plane);_plane=new THREE.Mesh(z,H);_plane.rotation.x=-90*Math.PI/180;_plane.doubleSided=!0;_plane.visible=C.visible;C.addChild(_plane);E.push(_plane);f.addObject(C);var G,F,T,$;G=new THREE.Projector;F=new THREE.Vector3(0,0,0.5);$=new THREE.Ray(b.position,null);var W=[],V=new THREE.Mesh(new THREE.Plane(4050,4050),new THREE.MeshBasicMaterial({color:0,opacity:0.1,transparent:!0,wireframe:!0}));V.position.y=-h/2;
V.rotation.x=-90*Math.PI/180;V.updateMatrix();V.update();W.push(V);var S=new THREE.Mesh(new THREE.Cube(h,h,h)),t=[],M=[],I=new THREE.MeshLambertMaterial({color:m,opacity:0.5,transparent:!0});M[0]=[];M[1]=[];for(z=1;z<=5;z+=2){M[0][z]=new THREE.Mesh(new THREE.Cube(z*h,z*h,z*h,z,z,z),I);M[0][z].visible=!1;M[1][z]=new THREE.Mesh(new THREE.Cube(z*h,z*h,z*h,z,z,z),I);M[1][z].visible=!1;f.addObject(M[0][z]);f.addObject(M[1][z])}t[0]=M[0][n];t[1]=M[1][n];this.getMode=function(){return p};this.setMode=function(P){p=
P};this.setColor=function(P){m=P;I.color.setHex(m)};this.setSize=function(P){n=P;o=Math.floor(n/2);t[0]=M[0][n];t[1]=M[1][n]};this.setSymmetry=function(P){u=P};this.hideBrush=function(){t[0].visible=!1;t[1].visible=!1};this.moveMouse=function(P,O){F.x=P*2-1;F.y=-O*2+1;T=G.unprojectVector(F.clone(),b);$.direction=T.subSelf(b.position).normalize()};this.clear=function(){for(;W.length>1;){var P=W[1];f.removeObject(P);W.splice(1,1);delete P}v.clear()};this.update=function(P){var O;O=0;for(var R=A.length;O<
R;O++)A[O].materials[0].opacity=1;switch(p){case VoxelPainter.MODE_IDLE:t[0].visible=!1;t[1].visible=!1;break;case VoxelPainter.MODE_CREATE:O=$.intersectObjects(W);if(P){t[0].visible=!1;t[1].visible=!1;O=$.intersectObjects(E);if(x&&O.length>0){var ca,U;P=O[0].point.clone();P.addSelf(y.matrixRotationWorld.multiplyVector3(x.normal.clone()));O=w.distanceTo(B.set(P.x,w.y,w.z));R=w.distanceTo(B.set(w.x,P.y,w.z));ca=w.distanceTo(B.set(w.x,w.y,P.z));U=Math.max(O,Math.max(R,ca));if(O==U)P.set(P.x,w.y,w.z);
else if(R==U)P.set(w.x,P.y,w.z);else ca==U&&P.set(w.x,w.y,P.z);O=c(P.x);R=c(P.y);P=c(P.z);for(ca=-o;ca<n-o;ca++)for(U=-o;U<n-o;U++)for(var ea=-o;ea<n-o;ea++){d(O+ca,R+U,P+ea);u&&d(-O+1+ca,R+U,P+ea)}}}else if(O.length>0){w=O[0].point;x=O[0].face;y=O[0].object;C.position.copy(w);C.position.addSelf(y.matrixRotationWorld.multiplyVector3(x.normal.clone()));C.updateMatrix();C.update();w.addSelf(y.matrixRotationWorld.multiplyVector3(x.normal.clone()));w.x=c(w.x)*h;w.y=c(w.y)*h;w.z=c(w.z)*h;t[0].position.copy(w);
t[0].visible=!0;if(u){t[1].position.copy(t[0].position);t[1].position.x=-t[1].position.x+h;t[1].visible=!0}}else{x=y=null;t[0].visible=!1;t[1].visible=!1}break;case VoxelPainter.MODE_ERASE:O=$.intersectObjects(W);if(O.length>0&&O[0].object!=V){y=O[0].object;if(P){g(y);if(u){P=v.getVoxel(-c(y.position.x)+1,c(y.position.y),c(y.position.z));P!==undefined&&g(P.object)}}else{y.materials[0].opacity=0.5;A=[];A.push(y);if(u){P=v.getVoxel(-c(y.position.x)+1,c(y.position.y),c(y.position.z));if(P!==undefined){P.object.materials[0].opacity=
0.5;A.push(P.object)}}}}}};this.getObject=function(){return v}};VoxelPainter.MODE_IDLE="VoxelPainter.MODE_IDLE";VoxelPainter.MODE_CREATE="VoxelPainter.MODE_CREATE";VoxelPainter.MODE_ERASE="VoxelPainter.MODE_ERASE";
var Footer=function(b,f){var c=f||"files/footer";this.id=Footer.multipleInstances;var d="rome_footer_buy_album-"+this.id,g="rome_terms-"+this.id,h="rome_privacy-"+this.id,n="rome_facebook-"+this.id,o="rome_twitter-"+this.id,m="rome_credits-"+this.id;if(!window.screenX&&!window.screenY){window.screenX=window.screenLeft;window.screenY=window.screenTop}var p={x:window.screenX+window.innerWidth/2,y:window.screenY+window.innerHeight/2},u="menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=1, titlebar=0, left="+
(p.x-150)+", top="+(p.y-300)+", width=330, height=600",v="menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=1, titlebar=0, left="+(p.x-225)+", top="+(p.y-250)+", width=550, height=500";this.getDomElement=function(){return b};this.load=function(){var y=y||null;y&&(new y({buttonID:"c9e456919b824bdeb2e3a326b122db43",buttonImageUrl:c+"/buy_button-trans.png",useVendorImages:!0})).replaceDiv(d);Footer.handleLinkListeners(document.getElementById(m),"Credits",u);Footer.handleLinkListeners(document.getElementById(h),
"Privacy",u);Footer.handleLinkListeners(document.getElementById(g),"Terms",u);Footer.handleLinkListeners(document.getElementById(o),"Twitter",v);Footer.handleLinkListeners(document.getElementById(n),"Facebook",v);return this};Footer.handleLinkListeners=function(y,A,B){function C(E,z){z.preventDefault();var H=E.getAttribute("href");window.open(H,A,B);return!1}B||(B=u);y.addEventListener?y.addEventListener("click",function(E){C(this,E)},!1):y.attachEvent("click",function(E){C(this,E)})};window.addEventListener?
window.addEventListener("load",this.load,!1):window.attachEvent("load",this.load);p=['<div class="rome-footer">\n<div class="shout-out">\n  <ul>','    <li class="last"><a href="http://www.chromeexperiments.com/webgl"><img src="'+c+'/chrome-trans.png" alt="This is a Chrome Experiment" border="0" /></a></li>','    <li class="divider">&nbsp;</li>','    <li class="last"><a href="http://google.com/"><img src="'+c+'/google-trans.png" alt="Made With Friends From Google" border="0" /></a></li>','    <li class="clear">&nbsp;</li>\n  </ul>\n</div>\n<div class="navigation">\n  <ul class="primary">\n    <li class="first"><a href="/tech" target="_blank">Technology</a></li>',
'    <li><a id = "'+m+'" href="/credits">Credits</a></li>','    <li><a href="http://romealbum.com/" target="_blank">Rome Album</a></li>','    <li id="'+d+'" class="rome_footer_buy_album">','      <a href = "http://widgets.platform.emi.com/landing/2520403d33984be0b70fca43945728e9.html" onClick="_gaq.push([\'_trackPageview\', \'/buy_album\'])" target="blank">Buy Album</a>\n    </li>\n    <li class="last">Share</li>','    <li class="last icons"><a id = "'+n+'" href="http://www.facebook.com/sharer.php?u=http://ro.me?fb=1" target="_blank"><img src="'+
c+'/fb-trans.png" alt="facebook" border="0"  /></a></li>','    <li class="last icons"><a id = "'+o+'" href="http://twitter.com/share?text=%E2%80%9C3%20Dreams%20of%20Black%E2%80%9D%20an%20interactive%20film%20by%20Chris%20Milk%20for%20Danger%20Mouse%20%26%20Daniele%20Luppi%E2%80%99s%20ROME%20album%20%E2%99%A5%20http%3A%2F%2Fro.me%20%23rome%20%23webgl&url=" target="_blank"><img src="'+c+'/twitter-trans.png" alt="twitter" border="0" /></a></li>','    <li class="clear last">&nbsp;</li>\n  </ul>\n  <ul class="secondary">',
'    <li class="first"><a id = "'+g+'" href="/terms">Terms</a></li>','    <li class="last"><a id = "'+h+'" href="/privacy">Privacy</a></li>','    <li class="clear last">&nbsp;</li>\n  </ul>\n</div>\n<div class="clear">&nbsp;</div>\n</div>\n</div>'].join("\n");b.innerHTML=p;if(Footer.multipleInstances<1){p=document.createTextNode('.rome-footer * {\n  margin: 0;\n  padding: 0;\n}\n.rome-footer {\n  font: 500 10px/18px "FuturaBT-Medium", Arial, sans-serif;\n  color: #434343;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n.rome-footer .shout-out {\n  float: left;\n  margin: 0 0 0 18px;\n}\n.rome-footer .navigation {\n  float: right;\n  margin: 20px 26px 0 0;\n  vertical-align: middle;\n}\n.rome-footer ul li {\n  height: 16px;\n  border-right: 1px solid #a0a0a0;\n  padding: 0 10px 0 10px;\n  width: auto;\n  float: left;\n  line-height: 18px;\n  list-style: none;\n}\n.rome-footer ul li.last,\n.rome-footer ul li.last li {\n  border: none;\n  padding: 0 0 0 10px;\n}\n.rome-footer .shout-out ul li {\n  margin: 0;\n  border: 0;\n}\n.rome-footer .shout-out li.divider {\n  margin: 15px -15px 15px 15px;\n  height: 24px;\n  border-left: 1px solid #a0a0a0;\n  border-right: 0 !important;\n}\n.rome-footer a img {\n  border: 0;\n}\n.rome-footer .secondary a:link, .rome-footer .secondary a:visited {\n  color: #777;\n}\n.rome-footer a:link, .rome-footer a:visited,\n.rome-footer .secondary a:hover, .rome-footer .secondary a:active {\n  color: #434343;\n  text-decoration: none;\n}\n.rome-footer a:hover, .rome-footer a:active {\n  color: #000;\n}\n.emi_buy_button_link {\n  margin-top: 2px;\n  height: 8px;\n  line-height: 8px;\n  overflow: hidden;\n}\n.rome-footer .rome_footer_buy_album img {\n  display: block;\n  margin-top: 0;\n}\n.rome-footer .rome_footer_buy_album a:hover img {\n  margin-top: -8px;\n}\n.emi_vendor_menu.using_image a:hover img {\n  margin-top: 0;\n}\n.emi_vendor_menu.using_image {\n  margin-top: -145px;\n  margin-left: -11px;\n  padding: 10px;\n}\n.emi_vendor_menu.using_image * {\n  text-transform: none;\n}\n.emi_vendor_menu.using_image .emi_vendor_link {\n  margin-top: 5px;\n}\n.rome-footer .secondary {\n  margin: 10px 0 0 0;\n  float: right;\n}\n.clear {\n  clear: both;\n  display: block;\n  overflow: hidden;\n  visibility: hidden;\n  width: 0;\n  height: 0;\n}');
var w=document.getElementsByTagName("head")[0],x=document.createElement("style");x.type="text/css";if(x.styleSheet)x.styleSheet.cssText=p.nodeValue;else x.appendChild(p);w.appendChild(x)}Footer.multipleInstances++};Footer.multipleInstances=0;
var Shortcuts=function(b){function f(){var n=document.createElement("span");n.innerHTML=" ";h.appendChild(n)}function c(n,o){var m=document.createElement("span");m.style.cursor="pointer";m.style.padding="0.5em";m.style.marginRight="4px";m.style.background="rgba(255,255,255,0.15)";m.innerHTML=n;m.addEventListener("click",o,!1);h.appendChild(m)}function d(n,o){c(n,function(){b.signals.showfilm.dispatch();b.signals.startfilm.dispatch(o,1)})}function g(n,o){c(n,function(){b.signals.showexploration.dispatch();
b.signals.startexploration.dispatch(o)})}var h=document.createElement("div");h.style.position="absolute";h.style.left="0px";h.style.top="0px";h.style.padding="0.5em";h.style.fontSize="10px";(function(n){c(n,function(){b.signals.showlauncher.dispatch()})})("Launcher");f();d("Intro",0);f();d("Transition to City",8);d("City",16);f();d("Transition to Prairie",24);d("Prairie",32);f();d("Transition to Dunes",40);d("Dunes",48);f();(function(n){c(n,function(){b.signals.showrelauncher.dispatch()})})("Relauncher");
f();g("Explore City","city");g("Explore Prairie","prairie");g("Explore Dunes","dunes");f();(function(n){c(n,function(){b.signals.showugc.dispatch()})})("Ugc");this.getDomElement=function(){return h}};
(function(){function b(){h.loadedContent||h.signals.showlauncher.dispatch()}function f(){var E=window.location.pathname.toString();if(E==="/"||E==="/index.html")h.signals.showlauncher.dispatch();else for(var z=0;z<A.length;z++)if(E.match(A[z])){C[z].dispatch();if(z==0)h.signals.startfilm.dispatch(0,1);else z==1&&h.signals.startexploration.dispatch("dunes");break}}function c(E,z,H){o&&o.hide();if(!E.__loaded){E.load();E.__loaded=!0}E.resize(window.innerWidth,window.innerHeight);E.show();if(z&&H){for(var G=
B.length;G--;)if(B[G]===H){H+=window.location.search;break}history&&history.pushState({pState:window.location.pathname.toString()},z,H)}o=E}function d(E){if(o!=w){if(!E.gamma&&!E.beta){E.gamma=-(E.x*(180/Math.PI));E.beta=-(E.y*(180/Math.PI))}else if(E.alpha==null&&E.beta==null&&E.gamma==null){window.removeEventListener("deviceorientation",d,!1);window.removeEventListener("MozOrientation",d,!1)}var z=Math.abs(E.gamma)>4||Math.abs(E.beta)>4,H=z?E.gamma:0;z=z?E.beta:0;if(y!=H||x!=z){var G=Math.round(1.5*
H)+h.mouse.x,F=-Math.round(1.5*z)+h.mouse.y;Math.abs(G)>window.innerWidth&&(G=G<0?-window.innerWidth:window.innerWidth);Math.abs(F)>window.innerHeight&&(F=F<0?-window.innerHeight:window.innerHeight);h.mouse.x=G;h.mouse.y=F;y=H;x=z;h.signals.mousemoved.dispatch(E)}}}function g(){requestAnimationFrame(g);o&&o.update()}var h,n=signals.Signal,o,m,p,u,v,w,x=0,y=0,A=["film","explore","relauncher","tool"],B=["/","/film","/explore"],C=[];h={mouse:{x:0,y:0},screenWidth:window.innerWidth,screenHeight:window.innerHeight,
loadedContent:!1,hasExplored:!1,originLink:window.location.pathname.toString(),shouldSkip:!1,signals:{mousedown:new n,mouseup:new n,mousemoved:new n,mousewheel:new n,keydown:new n,keyup:new n,windowresized:new n,load:new n,showlauncher:new n,showfilm:new n,showrelauncher:new n,showexploration:new n,showugc:new n,loadBegin:new n,loadItemAdded:new n,loadItemCompleted:new n,startfilm:new n,stopfilm:new n,startexploration:new n,initscenes:new n},worlds:{},soups:{},sequences:{},started:{city:!1,prairie:!1,
dunes:!1},currentTime:0,isExperience:!1};m=new LauncherSection(h);document.body.appendChild(m.getDomElement());u=new RelauncherSection(h);document.body.appendChild(u.getDomElement());w=new UgcSection(h);document.body.appendChild(w.getDomElement());n=(new Shortcuts(h)).getDomElement();n.style.display="none";n.id="shortcuts";document.body.appendChild(n);h.signals.load.add(function(){h.signals.loadBegin.dispatch();p=new FilmSection(h);document.body.appendChild(p.getDomElement());v=new ExplorationSection(h);
document.body.appendChild(v.getDomElement());h.signals.showfilm.add(function(){c(p,A[0],"/"+A[0])});h.signals.showexploration.add(function(){c(v,A[1],"/"+A[1])})});h.signals.showfilm.add(b);h.signals.showexploration.add(b);h.signals.showlauncher.add(function(){c(m,"/","/")});h.signals.showlauncher.add(function(){if(h.originLink.match("/explore")&&!h.loadedContent)h.shouldSkip=!0});h.signals.showrelauncher.add(function(){c(u,A[2],"/"+A[2])});h.signals.showugc.add(function(){c(w,A[3],"/"+A[3])});C.push(h.signals.showfilm);
C.push(h.signals.showexploration);C.push(h.signals.showrelauncher);C.push(h.signals.showugc);document.addEventListener("mousedown",function(E){h.signals.mousedown.dispatch(E);E.preventDefault();E.stopPropagation()},!1);document.addEventListener("mouseup",function(E){h.signals.mouseup.dispatch(E);E.preventDefault();E.stopPropagation()},!1);document.addEventListener("mousemove",function(E){h.mouse.x=E.clientX;h.mouse.y=E.clientY;h.signals.mousemoved.dispatch(E)},!1);document.addEventListener("mousewheel",
function(E){h.signals.mousewheel.dispatch(E)},!1);document.addEventListener("keydown",function(E){h.signals.keydown.dispatch(E)},!1);document.addEventListener("keyup",function(E){h.signals.keyup.dispatch(E)},!1);window.addEventListener("deviceorientation",d,!1);window.addEventListener("MozOrientation",d,!1);window.addEventListener("resize",function(){o.resize(window.innerWidth,window.innerHeight);h.screenWidth=window.innerWidth;h.screenHeight=window.innerHeight;h.signals.windowresized.dispatch()},
!1);f();g();window.onpopstate=function(){f()}})();
